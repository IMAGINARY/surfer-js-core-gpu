function e(e){Object.defineProperty(e,"__esModule",{value:!0,configurable:!0})}function t(e,t,r,n){Object.defineProperty(e,t,{get:r,set:n,enumerable:!0,configurable:!0})}var r="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{};function n(e){return e&&e.__esModule?e.default:e}e(module.exports),t(module.exports,"default",(function(){return y}));var i,a={},o={},l=l||{};
/*
 npm.im/iphone-inline-video 2.0.2  npm.im/intervalometer  https://github.com/paulmillr/es6-shim
 @license es6-shim Copyright 2013-2016 by Paul Miller (http://paulmillr.com)
   and contributors,  MIT License
 es6-shim: v0.35.4
 see https://github.com/paulmillr/es6-shim/blob/0.35.3/LICENSE
 Details and documentation:
 https://github.com/paulmillr/es6-shim/
*/l.scope={},l.ASSUME_ES5=!1,l.ASSUME_NO_NATIVE_MAP=!1,l.ASSUME_NO_NATIVE_SET=!1,l.defineProperty=l.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,r){e!=Array.prototype&&e!=Object.prototype&&(e[t]=r.value)},l.getGlobal=function(e){return"undefined"!=typeof window&&window===e?e:void 0!==r&&null!=r?r:e},l.global=l.getGlobal(a),l.SYMBOL_PREFIX="jscomp_symbol_",l.initSymbol=function(){l.initSymbol=function(){},l.global.Symbol||(l.global.Symbol=l.Symbol)},l.Symbol=(i=0,function(e){return l.SYMBOL_PREFIX+(e||"")+i++}),l.initSymbolIterator=function(){l.initSymbol();var e=l.global.Symbol.iterator;e||(e=l.global.Symbol.iterator=l.global.Symbol("iterator")),"function"!=typeof Array.prototype[e]&&l.defineProperty(Array.prototype,e,{configurable:!0,writable:!0,value:function(){return l.arrayIterator(this)}}),l.initSymbolIterator=function(){}},l.arrayIterator=function(e){var t=0;return l.iteratorPrototype((function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}))},l.iteratorPrototype=function(e){return l.initSymbolIterator(),(e={next:e})[l.global.Symbol.iterator]=function(){return this},e},l.makeIterator=function(e){l.initSymbolIterator(),l.initSymbol(),l.initSymbolIterator();var t=e[Symbol.iterator];return t?t.call(e):l.arrayIterator(e)},l.arrayFromIterator=function(e){for(var t,r=[];!(t=e.next()).done;)r.push(t.value);return r},l.arrayFromIterable=function(e){return e instanceof Array?e:l.arrayFromIterator(l.makeIterator(e))},l.polyfill=function(e,t,r,n){if(t){for(r=l.global,e=e.split("."),n=0;n<e.length-1;n++){var i=e[n];i in r||(r[i]={}),r=r[i]}(t=t(n=r[e=e[e.length-1]]))!=n&&null!=t&&l.defineProperty(r,e,{configurable:!0,writable:!0,value:t})}},l.FORCE_POLYFILL_PROMISE=!1,l.polyfill("Promise",(function(e){function t(){this.batch_=null}function r(e){return e instanceof i?e:new i((function(t,r){t(e)}))}if(e&&!l.FORCE_POLYFILL_PROMISE)return e;t.prototype.asyncExecute=function(e){return null==this.batch_&&(this.batch_=[],this.asyncExecuteBatch_()),this.batch_.push(e),this},t.prototype.asyncExecuteBatch_=function(){var e=this;this.asyncExecuteFunction((function(){e.executeBatch_()}))};var n=l.global.setTimeout;t.prototype.asyncExecuteFunction=function(e){n(e,0)},t.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var e=this.batch_;this.batch_=[];for(var t=0;t<e.length;++t){var r=e[t];e[t]=null;try{r()}catch(e){this.asyncThrow_(e)}}}this.batch_=null},t.prototype.asyncThrow_=function(e){this.asyncExecuteFunction((function(){throw e}))};var i=function(e){this.state_=0,this.result_=void 0,this.onSettledCallbacks_=[];var t=this.createResolveAndReject_();try{e(t.resolve,t.reject)}catch(e){t.reject(e)}};i.prototype.createResolveAndReject_=function(){function e(e){return function(n){r||(r=!0,e.call(t,n))}}var t=this,r=!1;return{resolve:e(this.resolveTo_),reject:e(this.reject_)}},i.prototype.resolveTo_=function(e){if(e===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(e instanceof i)this.settleSameAsPromise_(e);else{e:switch(typeof e){case"object":var t=null!=e;break e;case"function":t=!0;break e;default:t=!1}t?this.resolveToNonPromiseObj_(e):this.fulfill_(e)}},i.prototype.resolveToNonPromiseObj_=function(e){var t=void 0;try{t=e.then}catch(e){return void this.reject_(e)}"function"==typeof t?this.settleSameAsThenable_(t,e):this.fulfill_(e)},i.prototype.reject_=function(e){this.settle_(2,e)},i.prototype.fulfill_=function(e){this.settle_(1,e)},i.prototype.settle_=function(e,t){if(0!=this.state_)throw Error("Cannot settle("+e+", "+t+"): Promise already settled in state"+this.state_);this.state_=e,this.result_=t,this.executeOnSettledCallbacks_()},i.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var e=0;e<this.onSettledCallbacks_.length;++e)a.asyncExecute(this.onSettledCallbacks_[e]);this.onSettledCallbacks_=null}};var a=new t;return i.prototype.settleSameAsPromise_=function(e){var t=this.createResolveAndReject_();e.callWhenSettled_(t.resolve,t.reject)},i.prototype.settleSameAsThenable_=function(e,t){var r=this.createResolveAndReject_();try{e.call(t,r.resolve,r.reject)}catch(e){r.reject(e)}},i.prototype.then=function(e,t){function r(e,t){return"function"==typeof e?function(t){try{n(e(t))}catch(e){a(e)}}:t}var n,a,o=new i((function(e,t){n=e,a=t}));return this.callWhenSettled_(r(e,n),r(t,a)),o},i.prototype.catch=function(e){return this.then(void 0,e)},i.prototype.callWhenSettled_=function(e,t){function r(){switch(n.state_){case 1:e(n.result_);break;case 2:t(n.result_);break;default:throw Error("Unexpected state: "+n.state_)}}var n=this;null==this.onSettledCallbacks_?a.asyncExecute(r):this.onSettledCallbacks_.push(r)},i.resolve=r,i.reject=function(e){return new i((function(t,r){r(e)}))},i.race=function(e){return new i((function(t,n){for(var i=l.makeIterator(e),a=i.next();!a.done;a=i.next())r(a.value).callWhenSettled_(t,n)}))},i.all=function(e){var t=l.makeIterator(e),n=t.next();return n.done?r([]):new i((function(e,i){function a(t){return function(r){o[t]=r,0==--l&&e(o)}}var o=[],l=0;do{o.push(void 0),l++,r(n.value).callWhenSettled_(a(o.length-1),i),n=t.next()}while(!n.done)}))},i}),"es6","es3"),l.iteratorFromArray=function(e,t){l.initSymbolIterator(),e instanceof String&&(e+="");var r=0,n={next:function(){if(r<e.length){var i=r++;return{value:t(i,e[i]),done:!1}}return n.next=function(){return{done:!0,value:void 0}},n.next()}};return n[Symbol.iterator]=function(){return n},n},l.polyfill("Array.prototype.keys",(function(e){return e||function(){return l.iteratorFromArray(this,(function(e){return e}))}}),"es6","es3"),l.polyfill("Number.isNaN",(function(e){return e||function(e){return"number"==typeof e&&isNaN(e)}}),"es6","es3"),l.polyfill("Number.isFinite",(function(e){return e||function(e){return"number"==typeof e&&(!isNaN(e)&&1/0!==e&&-1/0!==e)}}),"es6","es3"),l.polyfill("Math.sign",(function(e){return e||function(e){return 0===(e=Number(e))||isNaN(e)?e:0<e?1:-1}}),"es6","es3"),l.polyfill("Number.EPSILON",(function(e){return Math.pow(2,-52)}),"es6","es3"),l.polyfill("Number.MAX_SAFE_INTEGER",(function(){return 9007199254740991}),"es6","es3"),l.checkStringArgs=function(e,t,r){if(null==e)throw new TypeError("The 'this' value for String.prototype."+r+" must not be null or undefined");if(t instanceof RegExp)throw new TypeError("First argument to String.prototype."+r+" must not be a regular expression");return e+""},l.polyfill("String.prototype.startsWith",(function(e){return e||function(e,t){var r=l.checkStringArgs(this,e,"startsWith");e+="";var n=r.length,i=e.length;t=Math.max(0,Math.min(0|t,r.length));for(var a=0;a<i&&t<n;)if(r[t++]!=e[a++])return!1;return a>=i}}),"es6","es3"),l.polyfill("String.prototype.endsWith",(function(e){return e||function(e,t){var r=l.checkStringArgs(this,e,"endsWith");e+="",void 0===t&&(t=r.length),t=Math.max(0,Math.min(0|t,r.length));for(var n=e.length;0<n&&0<t;)if(r[--t]!=e[--n])return!1;return 0>=n}}),"es6","es3"),l.polyfill("Object.is",(function(e){return e||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}}),"es6","es3"),l.polyfill("Array.prototype.includes",(function(e){return e||function(e,t){var r=this;r instanceof String&&(r=String(r));var n=r.length;for(0>(t=t||0)&&(t=Math.max(t+n,0));t<n;t++){var i=r[t];if(i===e||Object.is(i,e))return!0}return!1}}),"es7","es3"),l.polyfill("String.prototype.includes",(function(e){return e||function(e,t){return-1!==l.checkStringArgs(this,e,"includes").indexOf(e,t||0)}}),"es6","es3"),l.polyfill("Array.prototype.values",(function(e){return e||function(){return l.iteratorFromArray(this,(function(e,t){return t}))}}),"es8","es3"),l.polyfill("Array.from",(function(e){return e||function(e,t,r){l.initSymbolIterator(),t=null!=t?t:function(e){return e};var n=[],i=e[Symbol.iterator];if("function"==typeof i)for(e=i.call(e);!(i=e.next()).done;)n.push(t.call(r,i.value));else{i=e.length;for(var a=0;a<i;a++)n.push(t.call(r,e[a]))}return n}}),"es6","es3"),l.polyfill("Array.prototype.entries",(function(e){return e||function(){return l.iteratorFromArray(this,(function(e,t){return[e,t]}))}}),"es6","es3"),l.polyfill("Number.isInteger",(function(e){return e||function(e){return!!Number.isFinite(e)&&e===Math.floor(e)}}),"es6","es3"),l.findInternal=function(e,t,r){e instanceof String&&(e=String(e));for(var n=e.length,i=0;i<n;i++){var a=e[i];if(t.call(r,a,i,e))return{i:i,v:a}}return{i:-1,v:void 0}},l.polyfill("Array.prototype.find",(function(e){return e||function(e,t){return l.findInternal(this,e,t).v}}),"es6","es3"),l.polyfill("Array.prototype.findIndex",(function(e){return e||function(e,t){return l.findInternal(this,e,t).i}}),"es6","es3"),l.polyfill("Object.getOwnPropertySymbols",(function(e){return e||function(){return[]}}),"es6","es5"),l.polyfill("Math.expm1",(function(e){return e||function(e){if(.25>(e=Number(e))&&-.25<e){for(var t=e,r=1,n=e,i=0;i!=n;)n=(i=n)+(t*=e/++r);return n}return Math.exp(e)-1}}),"es6","es3"),l.polyfill("Math.sinh",(function(e){if(e)return e;var t=Math.exp;return function(e){return 0===(e=Number(e))?e:(t(e)-t(-e))/2}}),"es6","es3"),l.polyfill("Math.cosh",(function(e){if(e)return e;var t=Math.exp;return function(e){return e=Number(e),(t(e)+t(-e))/2}}),"es6","es3"),l.polyfill("Math.log1p",(function(e){return e||function(e){if(.25>(e=Number(e))&&-.25<e){for(var t=e,r=1,n=e,i=0,a=1;i!=n;)n=(i=n)+(a*=-1)*(t*=e)/++r;return n}return Math.log(1+e)}}),"es6","es3"),l.polyfill("Math.asinh",(function(e){return e||function(e){if(0===(e=Number(e)))return e;var t=Math.log(Math.abs(e)+Math.sqrt(e*e+1));return 0>e?-t:t}}),"es6","es3"),l.polyfill("Math.atanh",(function(e){if(e)return e;var t=Math.log1p;return function(e){return e=Number(e),(t(e)-t(-e))/2}}),"es6","es3"),l.polyfill("Math.tanh",(function(e){return e||function(e){if(0===(e=Number(e)))return e;var t=Math.exp(-2*Math.abs(e));return t=(1-t)/(1+t),0>e?-t:t}}),"es6","es3"),l.polyfill("Math.acosh",(function(e){return e||function(e){return e=Number(e),Math.log(e+Math.sqrt(e*e-1))}}),"es6","es3"),l.polyfill("Math.cbrt",(function(e){return e||function(e){if(0===e)return e;e=Number(e);var t=Math.pow(Math.abs(e),1/3);return 0>e?-t:t}}),"es6","es3"),l.polyfill("Math.imul",(function(e){return e||function(e,t){var r=65535&(e=Number(e)),n=65535&(t=Number(t));return r*n+((e>>>16&65535)*n+r*(t>>>16&65535)<<16>>>0)|0}}),"es6","es3"),l.checkEs6ConformanceViaProxy=function(){try{var e={},t=Object.create(new l.global.Proxy(e,{get:function(r,n,i){return r==e&&"q"==n&&i==t}}));return!0===t.q}catch(e){return!1}},l.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS=!1,l.ES6_CONFORMANCE=l.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS&&l.checkEs6ConformanceViaProxy(),l.owns=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},l.polyfill("WeakMap",(function(e){function t(e){l.owns(e,n)||l.defineProperty(e,n,{value:{}})}function r(e){var r=Object[e];r&&(Object[e]=function(e){return t(e),r(e)})}if(l.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(e&&l.ES6_CONFORMANCE)return e}else if(function(){if(!e||!Object.seal)return!1;try{var t=Object.seal({}),r=Object.seal({}),n=new e([[t,2],[r,3]]);return 2==n.get(t)&&3==n.get(r)&&(n.delete(t),n.set(r,4),!n.has(t)&&4==n.get(r))}catch(e){return!1}}())return e;var n="$jscomp_hidden_"+Math.random();r("freeze"),r("preventExtensions"),r("seal");var i=0,a=function(e){if(this.id_=(i+=Math.random()+1).toString(),e){l.initSymbol(),l.initSymbolIterator(),e=l.makeIterator(e);for(var t;!(t=e.next()).done;)t=t.value,this.set(t[0],t[1])}};return a.prototype.set=function(e,r){if(t(e),!l.owns(e,n))throw Error("WeakMap key fail: "+e);return e[n][this.id_]=r,this},a.prototype.get=function(e){return l.owns(e,n)?e[n][this.id_]:void 0},a.prototype.has=function(e){return l.owns(e,n)&&l.owns(e[n],this.id_)},a.prototype.delete=function(e){return!(!l.owns(e,n)||!l.owns(e[n],this.id_))&&delete e[n][this.id_]},a}),"es6","es3"),l.MapEntry=function(){},l.polyfill("Map",(function(e){if(l.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(e&&l.ES6_CONFORMANCE)return e}else if(function(){if(l.ASSUME_NO_NATIVE_MAP||!e||"function"!=typeof e||!e.prototype.entries||"function"!=typeof Object.seal)return!1;try{var t=Object.seal({x:4}),r=new e(l.makeIterator([[t,"s"]]));if("s"!=r.get(t)||1!=r.size||r.get({x:4})||r.set({x:4},"t")!=r||2!=r.size)return!1;var n=r.entries(),i=n.next();return!i.done&&i.value[0]==t&&"s"==i.value[1]&&!((i=n.next()).done||4!=i.value[0].x||"t"!=i.value[1]||!n.next().done)}catch(e){return!1}}())return e;l.initSymbol(),l.initSymbolIterator();var t=new WeakMap,r=function(e){if(this.data_={},this.head_=a(),this.size=0,e){e=l.makeIterator(e);for(var t;!(t=e.next()).done;)t=t.value,this.set(t[0],t[1])}};r.prototype.set=function(e,t){var r=n(this,e=0===e?0:e);return r.list||(r.list=this.data_[r.id]=[]),r.entry?r.entry.value=t:(r.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:e,value:t},r.list.push(r.entry),this.head_.previous.next=r.entry,this.head_.previous=r.entry,this.size++),this},r.prototype.delete=function(e){return!(!(e=n(this,e)).entry||!e.list)&&(e.list.splice(e.index,1),e.list.length||delete this.data_[e.id],e.entry.previous.next=e.entry.next,e.entry.next.previous=e.entry.previous,e.entry.head=null,this.size--,!0)},r.prototype.clear=function(){this.data_={},this.head_=this.head_.previous=a(),this.size=0},r.prototype.has=function(e){return!!n(this,e).entry},r.prototype.get=function(e){return(e=n(this,e).entry)&&e.value},r.prototype.entries=function(){return i(this,(function(e){return[e.key,e.value]}))},r.prototype.keys=function(){return i(this,(function(e){return e.key}))},r.prototype.values=function(){return i(this,(function(e){return e.value}))},r.prototype.forEach=function(e,t){for(var r,n=this.entries();!(r=n.next()).done;)r=r.value,e.call(t,r[1],r[0],this)},r.prototype[Symbol.iterator]=r.prototype.entries;var n=function(e,r){var n=r&&typeof r;"object"==n||"function"==n?t.has(r)?n=t.get(r):(n=""+ ++o,t.set(r,n)):n="p_"+r;var i=e.data_[n];if(i&&l.owns(e.data_,n))for(e=0;e<i.length;e++){var a=i[e];if(r!=r&&a.key!=a.key||r===a.key)return{id:n,list:i,index:e,entry:a}}return{id:n,list:i,index:-1,entry:void 0}},i=function(e,t){var r=e.head_;return l.iteratorPrototype((function(){if(r){for(;r.head!=e.head_;)r=r.previous;for(;r.next!=r.head;)return r=r.next,{done:!1,value:t(r)};r=null}return{done:!0,value:void 0}}))},a=function(){var e={};return e.previous=e.next=e.head=e},o=0;return r}),"es6","es3"),l.polyfill("Set",(function(e){if(l.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(e&&l.ES6_CONFORMANCE)return e}else if(function(){if(l.ASSUME_NO_NATIVE_SET||!e||"function"!=typeof e||!e.prototype.entries||"function"!=typeof Object.seal)return!1;try{var t=Object.seal({x:4}),r=new e(l.makeIterator([t]));if(!r.has(t)||1!=r.size||r.add(t)!=r||1!=r.size||r.add({x:4})!=r||2!=r.size)return!1;var n=r.entries(),i=n.next();return!i.done&&i.value[0]==t&&i.value[1]==t&&(!(i=n.next()).done&&i.value[0]!=t&&4==i.value[0].x&&i.value[1]==i.value[0]&&n.next().done)}catch(e){return!1}}())return e;l.initSymbol(),l.initSymbolIterator();var t=function(e){if(this.map_=new Map,e){e=l.makeIterator(e);for(var t;!(t=e.next()).done;)this.add(t.value)}this.size=this.map_.size};return t.prototype.add=function(e){return e=0===e?0:e,this.map_.set(e,e),this.size=this.map_.size,this},t.prototype.delete=function(e){return e=this.map_.delete(e),this.size=this.map_.size,e},t.prototype.clear=function(){this.map_.clear(),this.size=0},t.prototype.has=function(e){return this.map_.has(e)},t.prototype.entries=function(){return this.map_.entries()},t.prototype.values=function(){return this.map_.values()},t.prototype.keys=t.prototype.values,t.prototype[Symbol.iterator]=t.prototype.values,t.prototype.forEach=function(e,t){var r=this;this.map_.forEach((function(n){return e.call(t,n,n,r)}))},t}),"es6","es3"),l.underscoreProtoCanBeSet=function(){var e={};try{return e.__proto__={a:!0},e.a}catch(e){}return!1},l.setPrototypeOf="function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:l.underscoreProtoCanBeSet()?function(e,t){if(e.__proto__=t,e.__proto__!==t)throw new TypeError(e+" is not extensible");return e}:null,l.polyfill("Object.setPrototypeOf",(function(e){return e||l.setPrototypeOf}),"es6","es5"),l.assign="function"==typeof Object.assign?Object.assign:function(e,t){for(var r=1;r<arguments.length;r++){var n=arguments[r];if(n)for(var i in n)l.owns(n,i)&&(e[i]=n[i])}return e},l.polyfill("Object.assign",(function(e){return e||l.assign}),"es6","es3"),l.polyfill("Object.values",(function(e){return e||function(e){var t,r=[];for(t in e)l.owns(e,t)&&r.push(e[t]);return r}}),"es8","es3"),l.polyfill("Array.prototype.fill",(function(e){return e||function(e,t,r){var n=this.length||0;for(0>t&&(t=Math.max(0,n+t)),(null==r||r>n)&&(r=n),0>(r=Number(r))&&(r=Math.max(0,n+r)),t=Number(t||0);t<r;t++)this[t]=e;return this}}),"es6","es3");var s,u=function(){function e(e,t,r,n){function i(t){!!e[r]==!!n&&t.stopImmediatePropagation(),delete e[r]}return e.addEventListener(t,i,!1),i}function t(e,t,r,n){function i(e){r[t]=e}n&&i(e[t]),Object.defineProperty(e,t,{get:function(){return r[t]},set:i})}function r(e,t,r){r.addEventListener(t,(function(){return e.dispatchEvent(new Event(t))}))}function n(e,t){Promise.resolve().then((function(){e.dispatchEvent(new Event(t))}))}function i(e,t,r){(u||0)+200<Date.now()&&(e[f]=!0,u=Date.now()),r||(e.currentTime=t),d[++m%3]=100*t|0}function a(e){this.video.readyState>=this.video.HAVE_FUTURE_DATA?(this.hasAudio||(this.driver.currentTime=this.video.currentTime+e*this.video.playbackRate/1e3,this.video.loop&&this.driver.currentTime>=this.video.duration&&(this.driver.currentTime=0)),i(this.video,this.driver.currentTime)):this.video.networkState===this.video.NETWORK_IDLE&&0===this.video.buffered.length&&this.video.load(),this.video.ended&&(delete this.video[f],this.video.pause(!0))}function o(){var e=this[p];return this.webkitDisplayingFullscreen?void this[h]():("data:"!==e.driver.src&&e.driver.src!==this.src&&(i(this,0,!0),e.driver.src=this.src),void(this.paused&&(e.paused=!1,0===this.buffered.length&&this.load(),e.driver.play(),e.updater.start(),e.hasAudio||(n(this,"play"),e.video.readyState>=e.video.HAVE_ENOUGH_DATA&&n(this,"playing")))))}function l(e){var t=this[p];t.driver.pause(),t.updater.stop(),this.webkitDisplayingFullscreen&&this[v](),t.paused&&!e||(t.paused=!0,t.hasAudio||n(this,"pause"),this.ended&&(this[f]=!0,n(this,"ended")))}function s(e,t){var o=e[p]={};o.paused=!0,o.hasAudio=t,o.video=e,o.updater=function(e,t,r,n){function i(r){a=t(i,n),e(r-(o||r)),o=r}var a,o;return{start:function(){a||i(0)},stop:function(){r(a),a=null,o=0}}}(a.bind(o),requestAnimationFrame,cancelAnimationFrame),t?o.driver=function(e){var t=new Audio;return r(e,"play",t),r(e,"playing",t),r(e,"pause",t),t.crossOrigin=e.crossOrigin,t.src=e.src||e.currentSrc||"data:",t}(e):(e.addEventListener("canplay",(function(){e.paused||n(e,"playing")})),o.driver={src:e.src||e.currentSrc||"data:",muted:!0,paused:!0,pause:function(){o.driver.paused=!0},play:function(){o.driver.paused=!1,o.driver.currentTime>=o.video.duration&&i(e,0)},get ended(){return o.driver.currentTime>=o.video.duration}}),e.addEventListener("emptied",(function(){var t=!o.driver.src||"data:"===o.driver.src;o.driver.src&&o.driver.src!==e.src&&(i(e,0,!0),o.driver.src=e.src,t?o.driver.play():o.updater.stop())}),!1),e.addEventListener("webkitbeginfullscreen",(function(){e.paused?t&&0===o.driver.buffered.length&&o.driver.load():(e.pause(),e[h]())})),t&&(e.addEventListener("webkitendfullscreen",(function(){o.driver.currentTime=e.currentTime})),e.addEventListener("seeking",(function(){0>d.indexOf(100*e.currentTime|0)&&(o.driver.currentTime=e.currentTime)})))}var u,c="object"==typeof document&&"object-fit"in document.head.style&&!matchMedia("(-webkit-video-playable-inline)").matches,p="bfred-it:iphone-inline-video",f="bfred-it:iphone-inline-video:event",h="bfred-it:iphone-inline-video:nativeplay",v="bfred-it:iphone-inline-video:nativepause",d=[],m=0;return function(r,n){void 0===n&&(n={}),r[p]||(n.everywhere||c&&(n.iPad||n.ipad?/iPhone|iPod|iPad/:/iPhone|iPod/).test(navigator.userAgent))&&(!r.paused&&r.webkitDisplayingFullscreen&&r.pause(),s(r,!r.muted),n=r[p],r[h]=r.play,r[v]=r.pause,r.play=o,r.pause=l,t(r,"paused",n.driver),t(r,"muted",n.driver,!0),t(r,"playbackRate",n.driver,!0),t(r,"ended",n.driver),t(r,"loop",n.driver,!0),e(r,"seeking"),e(r,"seeked"),e(r,"timeupdate",f,!1),e(r,"ended",f,!1),r.classList.add("IIV"),r.muted&&r.autoplay&&r.play(),/iPhone|iPod|iPad/.test(navigator.platform)||console.warn("iphone-inline-video is not guaranteed to work in emulated environments"))}}();!function(){function e(e,t,r){d.biginteger_used=1,null!=e&&("number"==typeof e&&void 0===t?this.fromInt(e):"number"==typeof e?this.fromNumber(e,t,r):null==t&&"string"!=typeof e?this.fromString(e,256):this.fromString(e,t))}function t(){return new e(null,void 0,void 0)}function r(e,t){return null==(e=T[e.charCodeAt(t)])?-1:e}function n(e){var r=t();return r.fromInt(e),r}function i(e){var t,r=1;return 0!=(t=e>>>16)&&(e=t,r+=16),0!=(t=e>>8)&&(e=t,r+=8),0!=(t=e>>4)&&(e=t,r+=4),0!=(t=e>>2)&&(e=t,r+=2),0!=e>>1&&(r+=1),r}function o(e){this.m=e}function l(e){this.m=e,this.mp=e.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<e.DB-15)-1,this.mt2=2*e.t}function s(e,t){return e&t}function u(e,t){return e|t}function c(e,t){return e^t}function p(e,t){return e&~t}function f(){}function h(e){return e}function v(r){this.r2=t(),this.q3=t(),e.ONE.dlShiftTo(2*r.t,this.r2),this.mu=this.r2.divide(r),this.m=r}var d={use_lines:!0,use_xyz:!1},m=!1;if(a?(a=d,m=!0):"undefined"!=typeof document?window.ClipperLib=d:self.ClipperLib=d,m){y="chrome";var g="Netscape"}else{var y=navigator.userAgent.toString().toLowerCase();g=navigator.appName}var b=-1!=y.indexOf("chrome")&&-1==y.indexOf("chromium")?1:0;m=-1!=y.indexOf("chromium")?1:0;var x=-1!=y.indexOf("safari")&&-1==y.indexOf("chrome")&&-1==y.indexOf("chromium")?1:0,P=-1!=y.indexOf("firefox")?1:0;y.indexOf("firefox/17"),y.indexOf("firefox/15"),y.indexOf("firefox/3");var C=-1!=y.indexOf("opera")?1:0;y.indexOf("msie 10"),y.indexOf("msie 9");var _=-1!=y.indexOf("msie 8")?1:0,w=-1!=y.indexOf("msie 7")?1:0;y=-1!=y.indexOf("msie ")?1:0,d.biginteger_used=null,"Microsoft Internet Explorer"==g?(e.prototype.am=function(e,t,r,n,i,a){var o=32767&t;for(t>>=15;0<=--a;){var l=32767&this[e],s=this[e++]>>15,u=t*l+s*o;i=((l=o*l+((32767&u)<<15)+r[n]+(1073741823&i))>>>30)+(u>>>15)+t*s+(i>>>30),r[n++]=1073741823&l}return i},g=30):"Netscape"!=g?(e.prototype.am=function(e,t,r,n,i,a){for(;0<=--a;){var o=t*this[e++]+r[n]+i;i=Math.floor(o/67108864),r[n++]=67108863&o}return i},g=26):(e.prototype.am=function(e,t,r,n,i,a){var o=16383&t;for(t>>=14;0<=--a;){var l=16383&this[e],s=this[e++]>>14,u=t*l+s*o;i=((l=o*l+((16383&u)<<14)+r[n]+i)>>28)+(u>>14)+t*s,r[n++]=268435455&l}return i},g=28),e.prototype.DB=g,e.prototype.DM=(1<<g)-1,e.prototype.DV=1<<g,e.prototype.FV=Math.pow(2,52),e.prototype.F1=52-g,e.prototype.F2=2*g-52;var S,T=[];for(g=48,S=0;9>=S;++S)T[g++]=S;for(g=97,S=10;36>S;++S)T[g++]=S;for(g=65,S=10;36>S;++S)T[g++]=S;o.prototype.convert=function(e){return 0>e.s||0<=e.compareTo(this.m)?e.mod(this.m):e},o.prototype.revert=function(e){return e},o.prototype.reduce=function(e){e.divRemTo(this.m,null,e)},o.prototype.mulTo=function(e,t,r){e.multiplyTo(t,r),this.reduce(r)},o.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)},l.prototype.convert=function(r){var n=t();return r.abs().dlShiftTo(this.m.t,n),n.divRemTo(this.m,null,n),0>r.s&&0<n.compareTo(e.ZERO)&&this.m.subTo(n,n),n},l.prototype.revert=function(e){var r=t();return e.copyTo(r),this.reduce(r),r},l.prototype.reduce=function(e){for(;e.t<=this.mt2;)e[e.t++]=0;for(var t=0;t<this.m.t;++t){var r=32767&e[t],n=r*this.mpl+((r*this.mph+(e[t]>>15)*this.mpl&this.um)<<15)&e.DM;for(e[r=t+this.m.t]+=this.m.am(0,n,e,t,0,this.m.t);e[r]>=e.DV;)e[r]-=e.DV,e[++r]++}e.clamp(),e.drShiftTo(this.m.t,e),0<=e.compareTo(this.m)&&e.subTo(this.m,e)},l.prototype.mulTo=function(e,t,r){e.multiplyTo(t,r),this.reduce(r)},l.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)},e.prototype.copyTo=function(e){for(var t=this.t-1;0<=t;--t)e[t]=this[t];e.t=this.t,e.s=this.s},e.prototype.fromInt=function(e){this.t=1,this.s=0>e?-1:0,0<e?this[0]=e:-1>e?this[0]=e+this.DV:this.t=0},e.prototype.fromString=function(t,n){if(16==n)n=4;else if(8==n)n=3;else if(256==n)n=8;else if(2==n)n=1;else if(32==n)n=5;else{if(4!=n)return void this.fromRadix(t,n);n=2}this.s=this.t=0;for(var i=t.length,a=!1,o=0;0<=--i;){var l=8==n?255&t[i]:r(t,i);0>l?"-"==t.charAt(i)&&(a=!0):(a=!1,0==o?this[this.t++]=l:o+n>this.DB?(this[this.t-1]|=(l&(1<<this.DB-o)-1)<<o,this[this.t++]=l>>this.DB-o):this[this.t-1]|=l<<o,(o+=n)>=this.DB&&(o-=this.DB))}8==n&&0!=(128&t[0])&&(this.s=-1,0<o&&(this[this.t-1]|=(1<<this.DB-o)-1<<o)),this.clamp(),a&&e.ZERO.subTo(this,this)},e.prototype.clamp=function(){for(var e=this.s&this.DM;0<this.t&&this[this.t-1]==e;)--this.t},e.prototype.dlShiftTo=function(e,t){var r;for(r=this.t-1;0<=r;--r)t[r+e]=this[r];for(r=e-1;0<=r;--r)t[r]=0;t.t=this.t+e,t.s=this.s},e.prototype.drShiftTo=function(e,t){for(var r=e;r<this.t;++r)t[r-e]=this[r];t.t=Math.max(this.t-e,0),t.s=this.s},e.prototype.lShiftTo=function(e,t){var r=e%this.DB,n=this.DB-r,i=(1<<n)-1;e=Math.floor(e/this.DB);var a,o=this.s<<r&this.DM;for(a=this.t-1;0<=a;--a)t[a+e+1]=this[a]>>n|o,o=(this[a]&i)<<r;for(a=e-1;0<=a;--a)t[a]=0;t[e]=o,t.t=this.t+e+1,t.s=this.s,t.clamp()},e.prototype.rShiftTo=function(e,t){t.s=this.s;var r=Math.floor(e/this.DB);if(r>=this.t)t.t=0;else{e%=this.DB;var n=this.DB-e,i=(1<<e)-1;t[0]=this[r]>>e;for(var a=r+1;a<this.t;++a)t[a-r-1]|=(this[a]&i)<<n,t[a-r]=this[a]>>e;0<e&&(t[this.t-r-1]|=(this.s&i)<<n),t.t=this.t-r,t.clamp()}},e.prototype.subTo=function(e,t){for(var r=0,n=0,i=Math.min(e.t,this.t);r<i;)n+=this[r]-e[r],t[r++]=n&this.DM,n>>=this.DB;if(e.t<this.t){for(n-=e.s;r<this.t;)n+=this[r],t[r++]=n&this.DM,n>>=this.DB;n+=this.s}else{for(n+=this.s;r<e.t;)n-=e[r],t[r++]=n&this.DM,n>>=this.DB;n-=e.s}t.s=0>n?-1:0,-1>n?t[r++]=this.DV+n:0<n&&(t[r++]=n),t.t=r,t.clamp()},e.prototype.multiplyTo=function(t,r){var n=this.abs(),i=t.abs(),a=n.t;for(r.t=a+i.t;0<=--a;)r[a]=0;for(a=0;a<i.t;++a)r[a+n.t]=n.am(0,i[a],r,a,0,n.t);r.s=0,r.clamp(),this.s!=t.s&&e.ZERO.subTo(r,r)},e.prototype.squareTo=function(e){for(var t=this.abs(),r=e.t=2*t.t;0<=--r;)e[r]=0;for(r=0;r<t.t-1;++r){var n=t.am(r,t[r],e,2*r,0,1);(e[r+t.t]+=t.am(r+1,2*t[r],e,2*r+1,n,t.t-r-1))>=t.DV&&(e[r+t.t]-=t.DV,e[r+t.t+1]=1)}0<e.t&&(e[e.t-1]+=t.am(r,t[r],e,2*r,0,1)),e.s=0,e.clamp()},e.prototype.divRemTo=function(r,n,a){var o=r.abs();if(!(0>=o.t)){var l=this.abs();if(l.t<o.t)null!=n&&n.fromInt(0),null!=a&&this.copyTo(a);else{null==a&&(a=t());var s=t(),u=this.s;r=r.s;var c=this.DB-i(o[o.t-1]);if(0<c?(o.lShiftTo(c,s),l.lShiftTo(c,a)):(o.copyTo(s),l.copyTo(a)),0!=(l=s[(o=s.t)-1])){var p=l*(1<<this.F1)+(1<o?s[o-2]>>this.F2:0),f=this.FV/p;p=(1<<this.F1)/p;var h=1<<this.F2,v=a.t,d=v-o,m=null==n?t():n;for(s.dlShiftTo(d,m),0<=a.compareTo(m)&&(a[a.t++]=1,a.subTo(m,a)),e.ONE.dlShiftTo(o,m),m.subTo(s,s);s.t<o;)s[s.t++]=0;for(;0<=--d;){var g=a[--v]==l?this.DM:Math.floor(a[v]*f+(a[v-1]+h)*p);if((a[v]+=s.am(0,g,a,d,0,o))<g)for(s.dlShiftTo(d,m),a.subTo(m,a);a[v]<--g;)a.subTo(m,a)}null!=n&&(a.drShiftTo(o,n),u!=r&&e.ZERO.subTo(n,n)),a.t=o,a.clamp(),0<c&&a.rShiftTo(c,a),0>u&&e.ZERO.subTo(a,a)}}}},e.prototype.invDigit=function(){if(1>this.t)return 0;var e=this[0];if(0==(1&e))return 0;var t=3&e;return 0<(t=(t=(t=(t=t*(2-(15&e)*t)&15)*(2-(255&e)*t)&255)*(2-((65535&e)*t&65535))&65535)*(2-e*t%this.DV)%this.DV)?this.DV-t:-t},e.prototype.isEven=function(){return 0==(0<this.t?1&this[0]:this.s)},e.prototype.exp=function(r,n){if(4294967295<r||1>r)return e.ONE;var a=t(),o=t(),l=n.convert(this),s=i(r)-1;for(l.copyTo(a);0<=--s;)if(n.sqrTo(a,o),0<(r&1<<s))n.mulTo(o,l,a);else{var u=a;a=o,o=u}return n.revert(a)},e.prototype.toString=function(e){if(0>this.s)return"-"+this.negate().toString(e);if(16==e)e=4;else if(8==e)e=3;else if(2==e)e=1;else if(32==e)e=5;else{if(4!=e)return this.toRadix(e);e=2}var t,r=(1<<e)-1,n=!1,i="",a=this.t,o=this.DB-a*this.DB%e;if(0<a--)for(o<this.DB&&0<(t=this[a]>>o)&&(n=!0,i="0123456789abcdefghijklmnopqrstuvwxyz".charAt(t));0<=a;)o<e?(t=(this[a]&(1<<o)-1)<<e-o,t|=this[--a]>>(o+=this.DB-e)):(t=this[a]>>(o-=e)&r,0>=o&&(o+=this.DB,--a)),0<t&&(n=!0),n&&(i+="0123456789abcdefghijklmnopqrstuvwxyz".charAt(t));return n?i:"0"},e.prototype.negate=function(){var r=t();return e.ZERO.subTo(this,r),r},e.prototype.abs=function(){return 0>this.s?this.negate():this},e.prototype.compareTo=function(e){var t=this.s-e.s;if(0!=t)return t;var r=this.t;if(0!=(t=r-e.t))return 0>this.s?-t:t;for(;0<=--r;)if(0!=(t=this[r]-e[r]))return t;return 0},e.prototype.bitLength=function(){return 0>=this.t?0:this.DB*(this.t-1)+i(this[this.t-1]^this.s&this.DM)},e.prototype.mod=function(r){var n=t();return this.abs().divRemTo(r,null,n),0>this.s&&0<n.compareTo(e.ZERO)&&r.subTo(n,n),n},e.prototype.modPowInt=function(e,t){return t=256>e||t.isEven()?new o(t):new l(t),this.exp(e,t)},e.ZERO=n(0),e.ONE=n(1),f.prototype.convert=h,f.prototype.revert=h,f.prototype.mulTo=function(e,t,r){e.multiplyTo(t,r)},f.prototype.sqrTo=function(e,t){e.squareTo(t)},v.prototype.convert=function(e){if(0>e.s||e.t>2*this.m.t)return e.mod(this.m);if(0>e.compareTo(this.m))return e;var r=t();return e.copyTo(r),this.reduce(r),r},v.prototype.revert=function(e){return e},v.prototype.reduce=function(e){for(e.drShiftTo(this.m.t-1,this.r2),e.t>this.m.t+1&&(e.t=this.m.t+1,e.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);0>e.compareTo(this.r2);)e.dAddOffset(1,this.m.t+1);for(e.subTo(this.r2,e);0<=e.compareTo(this.m);)e.subTo(this.m,e)},v.prototype.mulTo=function(e,t,r){e.multiplyTo(t,r),this.reduce(r)},v.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)};var M=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],I=67108864/M[M.length-1];e.prototype.chunkSize=function(e){return Math.floor(Math.LN2*this.DB/Math.log(e))},e.prototype.toRadix=function(e){if(null==e&&(e=10),0==this.signum()||2>e||36<e)return"0";var r=this.chunkSize(e),i=n(r=Math.pow(e,r)),a=t(),o=t(),l="";for(this.divRemTo(i,a,o);0<a.signum();)l=(r+o.intValue()).toString(e).substr(1)+l,a.divRemTo(i,a,o);return o.intValue().toString(e)+l},e.prototype.fromRadix=function(t,n){this.fromInt(0),null==n&&(n=10);for(var i=this.chunkSize(n),a=Math.pow(n,i),o=!1,l=0,s=0,u=0;u<t.length;++u){var c=r(t,u);0>c?"-"==t.charAt(u)&&0==this.signum()&&(o=!0):(s=n*s+c,++l>=i&&(this.dMultiply(a),this.dAddOffset(s,0),s=l=0))}0<l&&(this.dMultiply(Math.pow(n,l)),this.dAddOffset(s,0)),o&&e.ZERO.subTo(this,this)},e.prototype.fromNumber=function(t,r,n){if("number"==typeof r)if(2>t)this.fromInt(1);else for(this.fromNumber(t,n),this.testBit(t-1)||this.bitwiseTo(e.ONE.shiftLeft(t-1),u,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(r);)this.dAddOffset(2,0),this.bitLength()>t&&this.subTo(e.ONE.shiftLeft(t-1),this);else{var i=7&t;(n=[]).length=1+(t>>3),r.nextBytes(n),n[0]=0<i?n[0]&(1<<i)-1:0,this.fromString(n,256)}},e.prototype.bitwiseTo=function(e,t,r){var n,i=Math.min(e.t,this.t);for(n=0;n<i;++n)r[n]=t(this[n],e[n]);if(e.t<this.t){var a=e.s&this.DM;for(n=i;n<this.t;++n)r[n]=t(this[n],a);r.t=this.t}else{for(a=this.s&this.DM,n=i;n<e.t;++n)r[n]=t(a,e[n]);r.t=e.t}r.s=t(this.s,e.s),r.clamp()},e.prototype.changeBit=function(t,r){return t=e.ONE.shiftLeft(t),this.bitwiseTo(t,r,t),t},e.prototype.addTo=function(e,t){for(var r=0,n=0,i=Math.min(e.t,this.t);r<i;)n+=this[r]+e[r],t[r++]=n&this.DM,n>>=this.DB;if(e.t<this.t){for(n+=e.s;r<this.t;)n+=this[r],t[r++]=n&this.DM,n>>=this.DB;n+=this.s}else{for(n+=this.s;r<e.t;)n+=e[r],t[r++]=n&this.DM,n>>=this.DB;n+=e.s}t.s=0>n?-1:0,0<n?t[r++]=n:-1>n&&(t[r++]=this.DV+n),t.t=r,t.clamp()},e.prototype.dMultiply=function(e){this[this.t]=this.am(0,e-1,this,0,0,this.t),++this.t,this.clamp()},e.prototype.dAddOffset=function(e,t){if(0!=e){for(;this.t<=t;)this[this.t++]=0;for(this[t]+=e;this[t]>=this.DV;)this[t]-=this.DV,++t>=this.t&&(this[this.t++]=0),++this[t]}},e.prototype.multiplyLowerTo=function(e,t,r){var n,i=Math.min(this.t+e.t,t);for(r.s=0,r.t=i;0<i;)r[--i]=0;for(n=r.t-this.t;i<n;++i)r[i+this.t]=this.am(0,e[i],r,i,0,this.t);for(n=Math.min(e.t,t);i<n;++i)this.am(0,e[i],r,i,0,t-i);r.clamp()},e.prototype.multiplyUpperTo=function(e,t,r){--t;var n=r.t=this.t+e.t-t;for(r.s=0;0<=--n;)r[n]=0;for(n=Math.max(t-this.t,0);n<e.t;++n)r[this.t+n-t]=this.am(t-n,e[n],r,0,0,this.t+n-t);r.clamp(),r.drShiftTo(1,r)},e.prototype.modInt=function(e){if(0>=e)return 0;var t=this.DV%e,r=0>this.s?e-1:0;if(0<this.t)if(0==t)r=this[0]%e;else for(var n=this.t-1;0<=n;--n)r=(t*r+this[n])%e;return r},e.prototype.millerRabin=function(r){var n=this.subtract(e.ONE),i=n.getLowestSetBit();if(0>=i)return!1;var a=n.shiftRight(i);(r=r+1>>1)>M.length&&(r=M.length);for(var o=t(),l=0;l<r;++l){o.fromInt(M[Math.floor(Math.random()*M.length)]);var s=o.modPow(a,this);if(0!=s.compareTo(e.ONE)&&0!=s.compareTo(n)){for(var u=1;u++<i&&0!=s.compareTo(n);)if(0==(s=s.modPowInt(2,this)).compareTo(e.ONE))return!1;if(0!=s.compareTo(n))return!1}}return!0},e.prototype.clone=function(){var e=t();return this.copyTo(e),e},e.prototype.intValue=function(){if(0>this.s){if(1==this.t)return this[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this[0];if(0==this.t)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]},e.prototype.byteValue=function(){return 0==this.t?this.s:this[0]<<24>>24},e.prototype.shortValue=function(){return 0==this.t?this.s:this[0]<<16>>16},e.prototype.signum=function(){return 0>this.s?-1:0>=this.t||1==this.t&&0>=this[0]?0:1},e.prototype.toByteArray=function(){var e=this.t,t=[];t[0]=this.s;var r,n=this.DB-e*this.DB%8,i=0;if(0<e--)for(n<this.DB&&(r=this[e]>>n)!=(this.s&this.DM)>>n&&(t[i++]=r|this.s<<this.DB-n);0<=e;)8>n?(r=(this[e]&(1<<n)-1)<<8-n,r|=this[--e]>>(n+=this.DB-8)):(r=this[e]>>(n-=8)&255,0>=n&&(n+=this.DB,--e)),0!=(128&r)&&(r|=-256),0==i&&(128&this.s)!=(128&r)&&++i,(0<i||r!=this.s)&&(t[i++]=r);return t},e.prototype.equals=function(e){return 0==this.compareTo(e)},e.prototype.min=function(e){return 0>this.compareTo(e)?this:e},e.prototype.max=function(e){return 0<this.compareTo(e)?this:e},e.prototype.and=function(e){var r=t();return this.bitwiseTo(e,s,r),r},e.prototype.or=function(e){var r=t();return this.bitwiseTo(e,u,r),r},e.prototype.xor=function(e){var r=t();return this.bitwiseTo(e,c,r),r},e.prototype.andNot=function(e){var r=t();return this.bitwiseTo(e,p,r),r},e.prototype.not=function(){for(var e=t(),r=0;r<this.t;++r)e[r]=this.DM&~this[r];return e.t=this.t,e.s=~this.s,e},e.prototype.shiftLeft=function(e){var r=t();return 0>e?this.rShiftTo(-e,r):this.lShiftTo(e,r),r},e.prototype.shiftRight=function(e){var r=t();return 0>e?this.lShiftTo(-e,r):this.rShiftTo(e,r),r},e.prototype.getLowestSetBit=function(){for(var e=0;e<this.t;++e)if(0!=this[e]){var t=e*this.DB;if(0==(e=this[e]))e=-1;else{var r=0;0==(65535&e)&&(e>>=16,r+=16),0==(255&e)&&(e>>=8,r+=8),0==(15&e)&&(e>>=4,r+=4),0==(3&e)&&(e>>=2,r+=2),0==(1&e)&&++r,e=r}return t+e}return 0>this.s?this.t*this.DB:-1},e.prototype.bitCount=function(){for(var e=0,t=this.s&this.DM,r=0;r<this.t;++r){for(var n=this[r]^t,i=0;0!=n;)n&=n-1,++i;e+=i}return e},e.prototype.testBit=function(e){var t=Math.floor(e/this.DB);return t>=this.t?0!=this.s:0!=(this[t]&1<<e%this.DB)},e.prototype.setBit=function(e){return this.changeBit(e,u)},e.prototype.clearBit=function(e){return this.changeBit(e,p)},e.prototype.flipBit=function(e){return this.changeBit(e,c)},e.prototype.add=function(e){var r=t();return this.addTo(e,r),r},e.prototype.subtract=function(e){var r=t();return this.subTo(e,r),r},e.prototype.multiply=function(e){var r=t();return this.multiplyTo(e,r),r},e.prototype.divide=function(e){var r=t();return this.divRemTo(e,r,null),r},e.prototype.remainder=function(e){var r=t();return this.divRemTo(e,null,r),r},e.prototype.divideAndRemainder=function(e){var r=t(),n=t();return this.divRemTo(e,r,n),[r,n]},e.prototype.modPow=function(e,r){var a=e.bitLength(),s=n(1);if(0>=a)return s;var u=18>a?1:48>a?3:144>a?4:768>a?5:6;r=8>a?new o(r):r.isEven()?new v(r):new l(r);var c=[],p=3,f=u-1,h=(1<<u)-1;if(c[1]=r.convert(this),1<u)for(a=t(),r.sqrTo(c[1],a);p<=h;)c[p]=t(),r.mulTo(a,c[p-2],c[p]),p+=2;var d,m=e.t-1,g=!0,y=t();for(a=i(e[m])-1;0<=m;){for(a>=f?d=e[m]>>a-f&h:(d=(e[m]&(1<<a+1)-1)<<f-a,0<m&&(d|=e[m-1]>>this.DB+a-f)),p=u;0==(1&d);)d>>=1,--p;if(0>(a-=p)&&(a+=this.DB,--m),g)c[d].copyTo(s),g=!1;else{for(;1<p;)r.sqrTo(s,y),r.sqrTo(y,s),p-=2;0<p?r.sqrTo(s,y):(p=s,s=y,y=p),r.mulTo(y,c[d],s)}for(;0<=m&&0==(e[m]&1<<a);)r.sqrTo(s,y),p=s,s=y,y=p,0>--a&&(a=this.DB-1,--m)}return r.revert(s)},e.prototype.modInverse=function(t){var r=t.isEven();if(this.isEven()&&r||0==t.signum())return e.ZERO;for(var i=t.clone(),a=this.clone(),o=n(1),l=n(0),s=n(0),u=n(1);0!=i.signum();){for(;i.isEven();)i.rShiftTo(1,i),r?(o.isEven()&&l.isEven()||(o.addTo(this,o),l.subTo(t,l)),o.rShiftTo(1,o)):l.isEven()||l.subTo(t,l),l.rShiftTo(1,l);for(;a.isEven();)a.rShiftTo(1,a),r?(s.isEven()&&u.isEven()||(s.addTo(this,s),u.subTo(t,u)),s.rShiftTo(1,s)):u.isEven()||u.subTo(t,u),u.rShiftTo(1,u);0<=i.compareTo(a)?(i.subTo(a,i),r&&o.subTo(s,o),l.subTo(u,l)):(a.subTo(i,a),r&&s.subTo(o,s),u.subTo(l,u))}return 0!=a.compareTo(e.ONE)?e.ZERO:0<=u.compareTo(t)?u.subtract(t):0>u.signum()?(u.addTo(t,u),0>u.signum()?u.add(t):u):u},e.prototype.pow=function(e){return this.exp(e,new f)},e.prototype.gcd=function(e){var t=0>this.s?this.negate():this.clone();if(e=0>e.s?e.negate():e.clone(),0>t.compareTo(e)){var r=t;t=e,e=r}r=t.getLowestSetBit();var n=e.getLowestSetBit();if(0>n)return t;for(r<n&&(n=r),0<n&&(t.rShiftTo(n,t),e.rShiftTo(n,e));0<t.signum();)0<(r=t.getLowestSetBit())&&t.rShiftTo(r,t),0<(r=e.getLowestSetBit())&&e.rShiftTo(r,e),0<=t.compareTo(e)?(t.subTo(e,t),t.rShiftTo(1,t)):(e.subTo(t,e),e.rShiftTo(1,e));return 0<n&&e.lShiftTo(n,e),e},e.prototype.isProbablePrime=function(e){var t,r=this.abs();if(1==r.t&&r[0]<=M[M.length-1]){for(t=0;t<M.length;++t)if(r[0]==M[t])return!0;return!1}if(r.isEven())return!1;for(t=1;t<M.length;){for(var n=M[t],i=t+1;i<M.length&&n<I;)n*=M[i++];for(n=r.modInt(n);t<i;)if(0==n%M[t++])return!1}return r.millerRabin(e)},e.prototype.square=function(){var e=t();return this.squareTo(e),e},e.prototype.IsNegative=function(){return-1==this.compareTo(e.ZERO)},e.op_Equality=function(e,t){return 0==e.compareTo(t)},e.op_Inequality=function(e,t){return 0!=e.compareTo(t)},e.op_GreaterThan=function(e,t){return 0<e.compareTo(t)},e.op_LessThan=function(e,t){return 0>e.compareTo(t)},e.op_Addition=function(t,r){return new e(t).add(new e(r))},e.op_Subtraction=function(t,r){return new e(t).subtract(new e(r))},e.Int128Mul=function(t,r){return new e(t).multiply(new e(r))},e.op_Division=function(e,t){return e.divide(t)},e.prototype.ToDouble=function(){return parseFloat(this.toString())},g=function(e,t){var r;if(void 0===Object.getOwnPropertyNames)for(r in t.prototype)void 0!==e.prototype[r]&&e.prototype[r]!=Object.prototype[r]||(e.prototype[r]=t.prototype[r]);else for(var n=Object.getOwnPropertyNames(t.prototype),i=0;i<n.length;i++)void 0===Object.getOwnPropertyDescriptor(e.prototype,n[i])&&Object.defineProperty(e.prototype,n[i],Object.getOwnPropertyDescriptor(t.prototype,n[i]));for(r in t)void 0===e[r]&&(e[r]=t[r]);e.$baseCtor=t},d.Path=function(){return[]},d.Paths=function(){return[]},d.DoublePoint=function(){var e=arguments;this.Y=this.X=0,1==e.length?(this.X=e[0].X,this.Y=e[0].Y):2==e.length&&(this.X=e[0],this.Y=e[1])},d.DoublePoint0=function(){this.Y=this.X=0},d.DoublePoint1=function(e){this.X=e.X,this.Y=e.Y},d.DoublePoint2=function(e,t){this.X=e,this.Y=t},d.PolyNode=function(){this.m_Parent=null,this.m_polygon=new d.Path,this.m_endtype=this.m_jointype=this.m_Index=0,this.m_Childs=[],this.IsOpen=!1},d.PolyNode.prototype.IsHoleNode=function(){for(var e=!0,t=this.m_Parent;null!==t;)e=!e,t=t.m_Parent;return e},d.PolyNode.prototype.ChildCount=function(){return this.m_Childs.length},d.PolyNode.prototype.Contour=function(){return this.m_polygon},d.PolyNode.prototype.AddChild=function(e){var t=this.m_Childs.length;this.m_Childs.push(e),e.m_Parent=this,e.m_Index=t},d.PolyNode.prototype.GetNext=function(){return 0<this.m_Childs.length?this.m_Childs[0]:this.GetNextSiblingUp()},d.PolyNode.prototype.GetNextSiblingUp=function(){return null===this.m_Parent?null:this.m_Index==this.m_Parent.m_Childs.length-1?this.m_Parent.GetNextSiblingUp():this.m_Parent.m_Childs[this.m_Index+1]},d.PolyNode.prototype.Childs=function(){return this.m_Childs},d.PolyNode.prototype.Parent=function(){return this.m_Parent},d.PolyNode.prototype.IsHole=function(){return this.IsHoleNode()},d.PolyTree=function(){this.m_AllPolys=[],d.PolyNode.call(this)},d.PolyTree.prototype.Clear=function(){for(var e=0,t=this.m_AllPolys.length;e<t;e++)this.m_AllPolys[e]=null;this.m_AllPolys.length=0,this.m_Childs.length=0},d.PolyTree.prototype.GetFirst=function(){return 0<this.m_Childs.length?this.m_Childs[0]:null},d.PolyTree.prototype.Total=function(){var e=this.m_AllPolys.length;return 0<e&&this.m_Childs[0]!=this.m_AllPolys[0]&&e--,e},g(d.PolyTree,d.PolyNode),d.Math_Abs_Int64=d.Math_Abs_Int32=d.Math_Abs_Double=function(e){return Math.abs(e)},d.Math_Max_Int32_Int32=function(e,t){return Math.max(e,t)},d.Cast_Int32=y||C||x?function(e){return 0|e}:function(e){return~~e},d.Cast_Int64=b?function(e){return-2147483648>e||2147483647<e?0>e?Math.ceil(e):Math.floor(e):~~e}:P&&"function"==typeof Number.toInteger?function(e){return Number.toInteger(e)}:w||_?function(e){return parseInt(e,10)}:y?function(e){return-2147483648>e||2147483647<e?0>e?Math.ceil(e):Math.floor(e):0|e}:function(e){return 0>e?Math.ceil(e):Math.floor(e)},d.Clear=function(e){e.length=0},d.PI=3.141592653589793,d.PI2=6.283185307179586,d.IntPoint=function(){var e=arguments,t=e.length;this.Y=this.X=0,d.use_xyz?(this.Z=0,3==t?(this.X=e[0],this.Y=e[1],this.Z=e[2]):2==t?(this.X=e[0],this.Y=e[1],this.Z=0):1==t?e[0]instanceof d.DoublePoint?(e=e[0],this.X=d.Clipper.Round(e.X),this.Y=d.Clipper.Round(e.Y),this.Z=0):(void 0===(e=e[0]).Z&&(e.Z=0),this.X=e.X,this.Y=e.Y,this.Z=e.Z):this.Z=this.Y=this.X=0):2==t?(this.X=e[0],this.Y=e[1]):1==t?e[0]instanceof d.DoublePoint?(e=e[0],this.X=d.Clipper.Round(e.X),this.Y=d.Clipper.Round(e.Y)):(e=e[0],this.X=e.X,this.Y=e.Y):this.Y=this.X=0},d.IntPoint.op_Equality=function(e,t){return e.X==t.X&&e.Y==t.Y},d.IntPoint.op_Inequality=function(e,t){return e.X!=t.X||e.Y!=t.Y},d.use_xyz?(d.IntPoint0=function(){this.Z=this.Y=this.X=0},d.IntPoint1=function(e){this.X=e.X,this.Y=e.Y,this.Z=e.Z},d.IntPoint1dp=function(e){this.X=d.Clipper.Round(e.X),this.Y=d.Clipper.Round(e.Y),this.Z=0},d.IntPoint2=function(e,t){this.X=e,this.Y=t,this.Z=0},d.IntPoint3=function(e,t,r){this.X=e,this.Y=t,this.Z=r}):(d.IntPoint0=function(){this.Y=this.X=0},d.IntPoint1=function(e){this.X=e.X,this.Y=e.Y},d.IntPoint1dp=function(e){this.X=d.Clipper.Round(e.X),this.Y=d.Clipper.Round(e.Y)},d.IntPoint2=function(e,t){this.X=e,this.Y=t}),d.IntRect=function(){var e=arguments,t=e.length;4==t?(this.left=e[0],this.top=e[1],this.right=e[2],this.bottom=e[3]):1==t?(this.left=e[0].left,this.top=e[0].top,this.right=e[0].right,this.bottom=e[0].bottom):this.bottom=this.right=this.top=this.left=0},d.IntRect0=function(){this.bottom=this.right=this.top=this.left=0},d.IntRect1=function(e){this.left=e.left,this.top=e.top,this.right=e.right,this.bottom=e.bottom},d.IntRect4=function(e,t,r,n){this.left=e,this.top=t,this.right=r,this.bottom=n},d.ClipType={ctIntersection:0,ctUnion:1,ctDifference:2,ctXor:3},d.PolyType={ptSubject:0,ptClip:1},d.PolyFillType={pftEvenOdd:0,pftNonZero:1,pftPositive:2,pftNegative:3},d.JoinType={jtSquare:0,jtRound:1,jtMiter:2},d.EndType={etOpenSquare:0,etOpenRound:1,etOpenButt:2,etClosedLine:3,etClosedPolygon:4},d.EdgeSide={esLeft:0,esRight:1},d.Direction={dRightToLeft:0,dLeftToRight:1},d.TEdge=function(){this.Bot=new d.IntPoint,this.Curr=new d.IntPoint,this.Top=new d.IntPoint,this.Delta=new d.IntPoint,this.Dx=0,this.PolyTyp=d.PolyType.ptSubject,this.Side=d.EdgeSide.esLeft,this.OutIdx=this.WindCnt2=this.WindCnt=this.WindDelta=0,this.PrevInSEL=this.NextInSEL=this.PrevInAEL=this.NextInAEL=this.NextInLML=this.Prev=this.Next=null},d.IntersectNode=function(){this.Edge2=this.Edge1=null,this.Pt=new d.IntPoint},d.MyIntersectNodeSort=function(){},d.MyIntersectNodeSort.Compare=function(e,t){return 0<(e=t.Pt.Y-e.Pt.Y)?1:0>e?-1:0},d.LocalMinima=function(){this.Y=0,this.Next=this.RightBound=this.LeftBound=null},d.Scanbeam=function(){this.Y=0,this.Next=null},d.OutRec=function(){this.Idx=0,this.IsOpen=this.IsHole=!1,this.PolyNode=this.BottomPt=this.Pts=this.FirstLeft=null},d.OutPt=function(){this.Idx=0,this.Pt=new d.IntPoint,this.Prev=this.Next=null},d.Join=function(){this.OutPt2=this.OutPt1=null,this.OffPt=new d.IntPoint},d.ClipperBase=function(){this.m_CurrentLM=this.m_MinimaList=null,this.m_edges=[],this.PreserveCollinear=this.m_HasOpenPaths=this.m_UseFullRange=!1,this.m_CurrentLM=this.m_MinimaList=null,this.m_HasOpenPaths=this.m_UseFullRange=!1},d.ClipperBase.horizontal=-9007199254740992,d.ClipperBase.Skip=-2,d.ClipperBase.Unassigned=-1,d.ClipperBase.tolerance=1e-20,d.ClipperBase.loRange=47453132,d.ClipperBase.hiRange=0xfffffffffffff,d.ClipperBase.near_zero=function(e){return e>-d.ClipperBase.tolerance&&e<d.ClipperBase.tolerance},d.ClipperBase.IsHorizontal=function(e){return 0===e.Delta.Y},d.ClipperBase.prototype.PointIsVertex=function(e,t){var r=t;do{if(d.IntPoint.op_Equality(r.Pt,e))return!0;r=r.Next}while(r!=t);return!1},d.ClipperBase.prototype.PointOnLineSegment=function(t,r,n,i){return i?t.X==r.X&&t.Y==r.Y||t.X==n.X&&t.Y==n.Y||t.X>r.X==t.X<n.X&&t.Y>r.Y==t.Y<n.Y&&e.op_Equality(e.Int128Mul(t.X-r.X,n.Y-r.Y),e.Int128Mul(n.X-r.X,t.Y-r.Y)):t.X==r.X&&t.Y==r.Y||t.X==n.X&&t.Y==n.Y||t.X>r.X==t.X<n.X&&t.Y>r.Y==t.Y<n.Y&&(t.X-r.X)*(n.Y-r.Y)==(n.X-r.X)*(t.Y-r.Y)},d.ClipperBase.prototype.PointOnPolygon=function(e,t,r){for(var n=t;;){if(this.PointOnLineSegment(e,n.Pt,n.Next.Pt,r))return!0;if((n=n.Next)==t)break}return!1},d.ClipperBase.prototype.SlopesEqual=d.ClipperBase.SlopesEqual=function(){var t,r,n=arguments,i=n.length;if(3==i)return i=n[0],t=n[1],n[2]?e.op_Equality(e.Int128Mul(i.Delta.Y,t.Delta.X),e.Int128Mul(i.Delta.X,t.Delta.Y)):d.Cast_Int64(i.Delta.Y*t.Delta.X)==d.Cast_Int64(i.Delta.X*t.Delta.Y);if(4==i)return i=n[0],t=n[1],r=n[2],n[3]?e.op_Equality(e.Int128Mul(i.Y-t.Y,t.X-r.X),e.Int128Mul(i.X-t.X,t.Y-r.Y)):0==d.Cast_Int64((i.Y-t.Y)*(t.X-r.X))-d.Cast_Int64((i.X-t.X)*(t.Y-r.Y));i=n[0],t=n[1],r=n[2];var a=n[3];return n[4]?e.op_Equality(e.Int128Mul(i.Y-t.Y,r.X-a.X),e.Int128Mul(i.X-t.X,r.Y-a.Y)):0==d.Cast_Int64((i.Y-t.Y)*(r.X-a.X))-d.Cast_Int64((i.X-t.X)*(r.Y-a.Y))},d.ClipperBase.SlopesEqual3=function(t,r,n){return n?e.op_Equality(e.Int128Mul(t.Delta.Y,r.Delta.X),e.Int128Mul(t.Delta.X,r.Delta.Y)):d.Cast_Int64(t.Delta.Y*r.Delta.X)==d.Cast_Int64(t.Delta.X*r.Delta.Y)},d.ClipperBase.SlopesEqual4=function(t,r,n,i){return i?e.op_Equality(e.Int128Mul(t.Y-r.Y,r.X-n.X),e.Int128Mul(t.X-r.X,r.Y-n.Y)):0==d.Cast_Int64((t.Y-r.Y)*(r.X-n.X))-d.Cast_Int64((t.X-r.X)*(r.Y-n.Y))},d.ClipperBase.SlopesEqual5=function(t,r,n,i,a){return a?e.op_Equality(e.Int128Mul(t.Y-r.Y,n.X-i.X),e.Int128Mul(t.X-r.X,n.Y-i.Y)):0==d.Cast_Int64((t.Y-r.Y)*(n.X-i.X))-d.Cast_Int64((t.X-r.X)*(n.Y-i.Y))},d.ClipperBase.prototype.Clear=function(){this.DisposeLocalMinimaList();for(var e=0,t=this.m_edges.length;e<t;++e){for(var r=0,n=this.m_edges[e].length;r<n;++r)this.m_edges[e][r]=null;d.Clear(this.m_edges[e])}d.Clear(this.m_edges),this.m_HasOpenPaths=this.m_UseFullRange=!1},d.ClipperBase.prototype.DisposeLocalMinimaList=function(){for(;null!==this.m_MinimaList;){var e=this.m_MinimaList.Next;this.m_MinimaList=null,this.m_MinimaList=e}this.m_CurrentLM=null},d.ClipperBase.prototype.RangeTest=function(e,t){t.Value?(e.X>d.ClipperBase.hiRange||e.Y>d.ClipperBase.hiRange||-e.X>d.ClipperBase.hiRange||-e.Y>d.ClipperBase.hiRange)&&d.Error("Coordinate outside allowed range in RangeTest()."):(e.X>d.ClipperBase.loRange||e.Y>d.ClipperBase.loRange||-e.X>d.ClipperBase.loRange||-e.Y>d.ClipperBase.loRange)&&(t.Value=!0,this.RangeTest(e,t))},d.ClipperBase.prototype.InitEdge=function(e,t,r,n){e.Next=t,e.Prev=r,e.Curr.X=n.X,e.Curr.Y=n.Y,d.use_xyz&&(e.Curr.Z=n.Z),e.OutIdx=-1},d.ClipperBase.prototype.InitEdge2=function(e,t){e.Curr.Y>=e.Next.Curr.Y?(e.Bot.X=e.Curr.X,e.Bot.Y=e.Curr.Y,d.use_xyz&&(e.Bot.Z=e.Curr.Z),e.Top.X=e.Next.Curr.X,e.Top.Y=e.Next.Curr.Y,d.use_xyz&&(e.Top.Z=e.Next.Curr.Z)):(e.Top.X=e.Curr.X,e.Top.Y=e.Curr.Y,d.use_xyz&&(e.Top.Z=e.Curr.Z),e.Bot.X=e.Next.Curr.X,e.Bot.Y=e.Next.Curr.Y,d.use_xyz&&(e.Bot.Z=e.Next.Curr.Z)),this.SetDx(e),e.PolyTyp=t},d.ClipperBase.prototype.FindNextLocMin=function(e){for(var t;;){for(;d.IntPoint.op_Inequality(e.Bot,e.Prev.Bot)||d.IntPoint.op_Equality(e.Curr,e.Top);)e=e.Next;if(e.Dx!=d.ClipperBase.horizontal&&e.Prev.Dx!=d.ClipperBase.horizontal)break;for(;e.Prev.Dx==d.ClipperBase.horizontal;)e=e.Prev;for(t=e;e.Dx==d.ClipperBase.horizontal;)e=e.Next;if(e.Top.Y!=e.Prev.Bot.Y){t.Prev.Bot.X<e.Bot.X&&(e=t);break}}return e},d.ClipperBase.prototype.ProcessBound=function(e,t){var r,n,i=e;if(i.OutIdx==d.ClipperBase.Skip){if(e=i,t){for(;e.Top.Y==e.Next.Bot.Y;)e=e.Next;for(;e!=i&&e.Dx==d.ClipperBase.horizontal;)e=e.Prev}else{for(;e.Top.Y==e.Prev.Bot.Y;)e=e.Prev;for(;e!=i&&e.Dx==d.ClipperBase.horizontal;)e=e.Next}return e==i?i=t?e.Next:e.Prev:(e=t?i.Next:i.Prev,(r=new d.LocalMinima).Next=null,r.Y=e.Bot.Y,r.LeftBound=null,r.RightBound=e,e.WindDelta=0,i=this.ProcessBound(e,t),this.InsertLocalMinima(r)),i}if(e.Dx==d.ClipperBase.horizontal&&((r=t?e.Prev:e.Next).OutIdx!=d.ClipperBase.Skip&&(r.Dx==d.ClipperBase.horizontal?r.Bot.X!=e.Bot.X&&r.Top.X!=e.Bot.X&&this.ReverseHorizontal(e):r.Bot.X!=e.Bot.X&&this.ReverseHorizontal(e))),r=e,t){for(;i.Top.Y==i.Next.Bot.Y&&i.Next.OutIdx!=d.ClipperBase.Skip;)i=i.Next;if(i.Dx==d.ClipperBase.horizontal&&i.Next.OutIdx!=d.ClipperBase.Skip){for(n=i;n.Prev.Dx==d.ClipperBase.horizontal;)n=n.Prev;n.Prev.Top.X==i.Next.Top.X?t||(i=n.Prev):n.Prev.Top.X>i.Next.Top.X&&(i=n.Prev)}for(;e!=i;)e.NextInLML=e.Next,e.Dx==d.ClipperBase.horizontal&&e!=r&&e.Bot.X!=e.Prev.Top.X&&this.ReverseHorizontal(e),e=e.Next;e.Dx==d.ClipperBase.horizontal&&e!=r&&e.Bot.X!=e.Prev.Top.X&&this.ReverseHorizontal(e),i=i.Next}else{for(;i.Top.Y==i.Prev.Bot.Y&&i.Prev.OutIdx!=d.ClipperBase.Skip;)i=i.Prev;if(i.Dx==d.ClipperBase.horizontal&&i.Prev.OutIdx!=d.ClipperBase.Skip){for(n=i;n.Next.Dx==d.ClipperBase.horizontal;)n=n.Next;n.Next.Top.X==i.Prev.Top.X?t||(i=n.Next):n.Next.Top.X>i.Prev.Top.X&&(i=n.Next)}for(;e!=i;)e.NextInLML=e.Prev,e.Dx==d.ClipperBase.horizontal&&e!=r&&e.Bot.X!=e.Next.Top.X&&this.ReverseHorizontal(e),e=e.Prev;e.Dx==d.ClipperBase.horizontal&&e!=r&&e.Bot.X!=e.Next.Top.X&&this.ReverseHorizontal(e),i=i.Prev}return i},d.ClipperBase.prototype.AddPath=function(e,t,r){d.use_lines?r||t!=d.PolyType.ptClip||d.Error("AddPath: Open paths must be subject."):r||d.Error("AddPath: Open paths have been disabled.");var n=e.length-1;if(r)for(;0<n&&d.IntPoint.op_Equality(e[n],e[0]);)--n;for(;0<n&&d.IntPoint.op_Equality(e[n],e[n-1]);)--n;if(r&&2>n||!r&&1>n)return!1;for(var i=[],a=0;a<=n;a++)i.push(new d.TEdge);var o=!0;i[1].Curr.X=e[1].X,i[1].Curr.Y=e[1].Y,d.use_xyz&&(i[1].Curr.Z=e[1].Z);var l={Value:this.m_UseFullRange};for(this.RangeTest(e[0],l),this.m_UseFullRange=l.Value,l.Value=this.m_UseFullRange,this.RangeTest(e[n],l),this.m_UseFullRange=l.Value,this.InitEdge(i[0],i[1],i[n],e[0]),this.InitEdge(i[n],i[0],i[n-1],e[n]),a=n-1;1<=a;--a)l.Value=this.m_UseFullRange,this.RangeTest(e[a],l),this.m_UseFullRange=l.Value,this.InitEdge(i[a],i[a+1],i[a-1],e[a]);for(a=e=n=i[0];;)if(e.Curr!=e.Next.Curr||!r&&e.Next==n){if(e.Prev==e.Next)break;if(r&&d.ClipperBase.SlopesEqual(e.Prev.Curr,e.Curr,e.Next.Curr,this.m_UseFullRange)&&(!this.PreserveCollinear||!this.Pt2IsBetweenPt1AndPt3(e.Prev.Curr,e.Curr,e.Next.Curr))){e==n&&(n=e.Next),a=e=(e=this.RemoveEdge(e)).Prev;continue}if((e=e.Next)==a||!r&&e.Next==n)break}else{if(e==e.Next)break;e==n&&(n=e.Next),a=e=this.RemoveEdge(e)}if(!r&&e==e.Next||r&&e.Prev==e.Next)return!1;r||(this.m_HasOpenPaths=!0,n.Prev.OutIdx=d.ClipperBase.Skip),e=n;do{this.InitEdge2(e,t),e=e.Next,o&&e.Curr.Y!=n.Curr.Y&&(o=!1)}while(e!=n);if(o){if(r)return!1;for(e.Prev.OutIdx=d.ClipperBase.Skip,e.Prev.Bot.X<e.Prev.Top.X&&this.ReverseHorizontal(e.Prev),(t=new d.LocalMinima).Next=null,t.Y=e.Bot.Y,t.LeftBound=null,t.RightBound=e,t.RightBound.Side=d.EdgeSide.esRight,t.RightBound.WindDelta=0;e.Next.OutIdx!=d.ClipperBase.Skip;)e.NextInLML=e.Next,e.Bot.X!=e.Prev.Top.X&&this.ReverseHorizontal(e),e=e.Next;return this.InsertLocalMinima(t),this.m_edges.push(i),!0}for(this.m_edges.push(i),o=null,d.IntPoint.op_Equality(e.Prev.Bot,e.Prev.Top)&&(e=e.Next);(e=this.FindNextLocMin(e))!=o;)null==o&&(o=e),(t=new d.LocalMinima).Next=null,t.Y=e.Bot.Y,e.Dx<e.Prev.Dx?(t.LeftBound=e.Prev,t.RightBound=e,i=!1):(t.LeftBound=e,t.RightBound=e.Prev,i=!0),t.LeftBound.Side=d.EdgeSide.esLeft,t.RightBound.Side=d.EdgeSide.esRight,t.LeftBound.WindDelta=r?t.LeftBound.Next==t.RightBound?-1:1:0,t.RightBound.WindDelta=-t.LeftBound.WindDelta,(e=this.ProcessBound(t.LeftBound,i)).OutIdx==d.ClipperBase.Skip&&(e=this.ProcessBound(e,i)),(n=this.ProcessBound(t.RightBound,!i)).OutIdx==d.ClipperBase.Skip&&(n=this.ProcessBound(n,!i)),t.LeftBound.OutIdx==d.ClipperBase.Skip?t.LeftBound=null:t.RightBound.OutIdx==d.ClipperBase.Skip&&(t.RightBound=null),this.InsertLocalMinima(t),i||(e=n);return!0},d.ClipperBase.prototype.AddPaths=function(e,t,r){for(var n=!1,i=0,a=e.length;i<a;++i)this.AddPath(e[i],t,r)&&(n=!0);return n},d.ClipperBase.prototype.Pt2IsBetweenPt1AndPt3=function(e,t,r){return!(d.IntPoint.op_Equality(e,r)||d.IntPoint.op_Equality(e,t)||d.IntPoint.op_Equality(r,t))&&(e.X!=r.X?t.X>e.X==t.X<r.X:t.Y>e.Y==t.Y<r.Y)},d.ClipperBase.prototype.RemoveEdge=function(e){e.Prev.Next=e.Next,e.Next.Prev=e.Prev;var t=e.Next;return e.Prev=null,t},d.ClipperBase.prototype.SetDx=function(e){e.Delta.X=e.Top.X-e.Bot.X,e.Delta.Y=e.Top.Y-e.Bot.Y,e.Dx=0===e.Delta.Y?d.ClipperBase.horizontal:e.Delta.X/e.Delta.Y},d.ClipperBase.prototype.InsertLocalMinima=function(e){if(null===this.m_MinimaList)this.m_MinimaList=e;else if(e.Y>=this.m_MinimaList.Y)e.Next=this.m_MinimaList,this.m_MinimaList=e;else{for(var t=this.m_MinimaList;null!==t.Next&&e.Y<t.Next.Y;)t=t.Next;e.Next=t.Next,t.Next=e}},d.ClipperBase.prototype.PopLocalMinima=function(){null!==this.m_CurrentLM&&(this.m_CurrentLM=this.m_CurrentLM.Next)},d.ClipperBase.prototype.ReverseHorizontal=function(e){var t=e.Top.X;e.Top.X=e.Bot.X,e.Bot.X=t,d.use_xyz&&(t=e.Top.Z,e.Top.Z=e.Bot.Z,e.Bot.Z=t)},d.ClipperBase.prototype.Reset=function(){if(this.m_CurrentLM=this.m_MinimaList,null!=this.m_CurrentLM)for(var e=this.m_MinimaList;null!=e;){var t=e.LeftBound;null!=t&&(t.Curr.X=t.Bot.X,t.Curr.Y=t.Bot.Y,d.use_xyz&&(t.Curr.Z=t.Bot.Z),t.Side=d.EdgeSide.esLeft,t.OutIdx=d.ClipperBase.Unassigned),null!=(t=e.RightBound)&&(t.Curr.X=t.Bot.X,t.Curr.Y=t.Bot.Y,d.use_xyz&&(t.Curr.Z=t.Bot.Z),t.Side=d.EdgeSide.esRight,t.OutIdx=d.ClipperBase.Unassigned),e=e.Next}},d.Clipper=function(e){void 0===e&&(e=0),this.m_PolyOuts=null,this.m_ClipType=d.ClipType.ctIntersection,this.m_IntersectNodeComparer=this.m_IntersectList=this.m_SortedEdges=this.m_ActiveEdges=this.m_Scanbeam=null,this.m_ExecuteLocked=!1,this.m_SubjFillType=this.m_ClipFillType=d.PolyFillType.pftEvenOdd,this.m_GhostJoins=this.m_Joins=null,this.StrictlySimple=this.ReverseSolution=this.m_UsingPolyTree=!1,d.ClipperBase.call(this),this.m_SortedEdges=this.m_ActiveEdges=this.m_Scanbeam=null,this.m_IntersectList=[],this.m_IntersectNodeComparer=d.MyIntersectNodeSort.Compare,this.m_UsingPolyTree=this.m_ExecuteLocked=!1,this.m_PolyOuts=[],this.m_Joins=[],this.m_GhostJoins=[],this.ReverseSolution=0!=(1&e),this.StrictlySimple=0!=(2&e),this.PreserveCollinear=0!=(4&e),d.use_xyz&&(this.ZFillFunction=null)},d.Clipper.ioReverseSolution=1,d.Clipper.ioStrictlySimple=2,d.Clipper.ioPreserveCollinear=4,d.Clipper.prototype.Clear=function(){0!==this.m_edges.length&&(this.DisposeAllPolyPts(),d.ClipperBase.prototype.Clear.call(this))},d.Clipper.prototype.DisposeScanbeamList=function(){for(;null!==this.m_Scanbeam;){var e=this.m_Scanbeam.Next;this.m_Scanbeam=null,this.m_Scanbeam=e}},d.Clipper.prototype.Reset=function(){d.ClipperBase.prototype.Reset.call(this),this.m_SortedEdges=this.m_ActiveEdges=this.m_Scanbeam=null;for(var e=this.m_MinimaList;null!==e;)this.InsertScanbeam(e.Y),e=e.Next},d.Clipper.prototype.InsertScanbeam=function(e){if(null===this.m_Scanbeam)this.m_Scanbeam=new d.Scanbeam,this.m_Scanbeam.Next=null,this.m_Scanbeam.Y=e;else if(e>this.m_Scanbeam.Y){var t=new d.Scanbeam;t.Y=e,t.Next=this.m_Scanbeam,this.m_Scanbeam=t}else{for(var r=this.m_Scanbeam;null!==r.Next&&e<=r.Next.Y;)r=r.Next;e!=r.Y&&((t=new d.Scanbeam).Y=e,t.Next=r.Next,r.Next=t)}},d.Clipper.prototype.Execute=function(){var e=arguments,t=e.length,r=e[1]instanceof d.PolyTree;if(4==t&&!r){if(t=e[0],i=e[1],r=e[2],e=e[3],this.m_ExecuteLocked)return!1;this.m_HasOpenPaths&&d.Error("Error: PolyTree struct is need for open path clipping."),this.m_ExecuteLocked=!0,d.Clear(i),this.m_SubjFillType=r,this.m_ClipFillType=e,this.m_ClipType=t,this.m_UsingPolyTree=!1;try{var n=this.ExecuteInternal();n&&this.BuildResult(i)}finally{this.DisposeAllPolyPts(),this.m_ExecuteLocked=!1}return n}if(4==t&&r){t=e[0];var i=e[1];if(r=e[2],e=e[3],this.m_ExecuteLocked)return!1;this.m_ExecuteLocked=!0,this.m_SubjFillType=r,this.m_ClipFillType=e,this.m_ClipType=t,this.m_UsingPolyTree=!0;try{(n=this.ExecuteInternal())&&this.BuildResult2(i)}finally{this.DisposeAllPolyPts(),this.m_ExecuteLocked=!1}return n}if(2==t&&!r||2==t&&r)return t=e[0],i=e[1],this.Execute(t,i,d.PolyFillType.pftEvenOdd,d.PolyFillType.pftEvenOdd)},d.Clipper.prototype.FixHoleLinkage=function(e){if(null!==e.FirstLeft&&(e.IsHole==e.FirstLeft.IsHole||null===e.FirstLeft.Pts)){for(var t=e.FirstLeft;null!==t&&(t.IsHole==e.IsHole||null===t.Pts);)t=t.FirstLeft;e.FirstLeft=t}},d.Clipper.prototype.ExecuteInternal=function(){try{if(this.Reset(),null===this.m_CurrentLM)return!1;var e=this.PopScanbeam();do{if(this.InsertLocalMinimaIntoAEL(e),d.Clear(this.m_GhostJoins),this.ProcessHorizontals(!1),null===this.m_Scanbeam)break;var t=this.PopScanbeam();if(!this.ProcessIntersections(t))return!1;this.ProcessEdgesAtTopOfScanbeam(t),e=t}while(null!==this.m_Scanbeam||null!==this.m_CurrentLM);e=0;for(var r=this.m_PolyOuts.length;e<r;e++){var n=this.m_PolyOuts[e];null===n.Pts||n.IsOpen||(n.IsHole^this.ReverseSolution)==0<this.Area(n)&&this.ReversePolyPtLinks(n.Pts)}for(this.JoinCommonEdges(),e=0,r=this.m_PolyOuts.length;e<r;e++)null===(n=this.m_PolyOuts[e]).Pts||n.IsOpen||this.FixupOutPolygon(n);return this.StrictlySimple&&this.DoSimplePolygons(),!0}finally{d.Clear(this.m_Joins),d.Clear(this.m_GhostJoins)}},d.Clipper.prototype.PopScanbeam=function(){var e=this.m_Scanbeam.Y;return this.m_Scanbeam=this.m_Scanbeam.Next,e},d.Clipper.prototype.DisposeAllPolyPts=function(){for(var e=0,t=this.m_PolyOuts.length;e<t;++e)this.DisposeOutRec(e);d.Clear(this.m_PolyOuts)},d.Clipper.prototype.DisposeOutRec=function(e){this.m_PolyOuts[e].Pts=null,this.m_PolyOuts[e]=null},d.Clipper.prototype.AddJoin=function(e,t,r){var n=new d.Join;n.OutPt1=e,n.OutPt2=t,n.OffPt.X=r.X,n.OffPt.Y=r.Y,d.use_xyz&&(n.OffPt.Z=r.Z),this.m_Joins.push(n)},d.Clipper.prototype.AddGhostJoin=function(e,t){var r=new d.Join;r.OutPt1=e,r.OffPt.X=t.X,r.OffPt.Y=t.Y,d.use_xyz&&(r.OffPt.Z=t.Z),this.m_GhostJoins.push(r)},d.Clipper.prototype.SetZ=function(e,t,r){null!==this.ZFillFunction&&0==e.Z&&null!==this.ZFillFunction&&(d.IntPoint.op_Equality(e,t.Bot)?e.Z=t.Bot.Z:d.IntPoint.op_Equality(e,t.Top)?e.Z=t.Top.Z:d.IntPoint.op_Equality(e,r.Bot)?e.Z=r.Bot.Z:d.IntPoint.op_Equality(e,r.Top)?e.Z=r.Top.Z:this.ZFillFunction(t.Bot,t.Top,r.Bot,r.Top,e))},d.Clipper.prototype.InsertLocalMinimaIntoAEL=function(e){for(;null!==this.m_CurrentLM&&this.m_CurrentLM.Y==e;){var t=this.m_CurrentLM.LeftBound,r=this.m_CurrentLM.RightBound;this.PopLocalMinima();var n=null;if(null===t?(this.InsertEdgeIntoAEL(r,null),this.SetWindingCount(r),this.IsContributing(r)&&(n=this.AddOutPt(r,r.Bot))):(null==r?(this.InsertEdgeIntoAEL(t,null),this.SetWindingCount(t),this.IsContributing(t)&&(n=this.AddOutPt(t,t.Bot))):(this.InsertEdgeIntoAEL(t,null),this.InsertEdgeIntoAEL(r,t),this.SetWindingCount(t),r.WindCnt=t.WindCnt,r.WindCnt2=t.WindCnt2,this.IsContributing(t)&&(n=this.AddLocalMinPoly(t,r,t.Bot))),this.InsertScanbeam(t.Top.Y)),null!=r&&(d.ClipperBase.IsHorizontal(r)?this.AddEdgeToSEL(r):this.InsertScanbeam(r.Top.Y)),null!=t&&null!=r){if(null!==n&&d.ClipperBase.IsHorizontal(r)&&0<this.m_GhostJoins.length&&0!==r.WindDelta)for(var i=0,a=this.m_GhostJoins.length;i<a;i++){var o=this.m_GhostJoins[i];this.HorzSegmentsOverlap(o.OutPt1.Pt.X,o.OffPt.X,r.Bot.X,r.Top.X)&&this.AddJoin(o.OutPt1,n,o.OffPt)}if(0<=t.OutIdx&&null!==t.PrevInAEL&&t.PrevInAEL.Curr.X==t.Bot.X&&0<=t.PrevInAEL.OutIdx&&d.ClipperBase.SlopesEqual(t.PrevInAEL,t,this.m_UseFullRange)&&0!==t.WindDelta&&0!==t.PrevInAEL.WindDelta&&(i=this.AddOutPt(t.PrevInAEL,t.Bot),this.AddJoin(n,i,t.Top)),t.NextInAEL!=r&&(0<=r.OutIdx&&0<=r.PrevInAEL.OutIdx&&d.ClipperBase.SlopesEqual(r.PrevInAEL,r,this.m_UseFullRange)&&0!==r.WindDelta&&0!==r.PrevInAEL.WindDelta&&(i=this.AddOutPt(r.PrevInAEL,r.Bot),this.AddJoin(n,i,r.Top)),null!==(n=t.NextInAEL)))for(;n!=r;)this.IntersectEdges(r,n,t.Curr,!1),n=n.NextInAEL}}},d.Clipper.prototype.InsertEdgeIntoAEL=function(e,t){if(null===this.m_ActiveEdges)e.PrevInAEL=null,e.NextInAEL=null,this.m_ActiveEdges=e;else if(null===t&&this.E2InsertsBeforeE1(this.m_ActiveEdges,e))e.PrevInAEL=null,e.NextInAEL=this.m_ActiveEdges,this.m_ActiveEdges=this.m_ActiveEdges.PrevInAEL=e;else{for(null===t&&(t=this.m_ActiveEdges);null!==t.NextInAEL&&!this.E2InsertsBeforeE1(t.NextInAEL,e);)t=t.NextInAEL;e.NextInAEL=t.NextInAEL,null!==t.NextInAEL&&(t.NextInAEL.PrevInAEL=e),e.PrevInAEL=t,t.NextInAEL=e}},d.Clipper.prototype.E2InsertsBeforeE1=function(e,t){return t.Curr.X==e.Curr.X?t.Top.Y>e.Top.Y?t.Top.X<d.Clipper.TopX(e,t.Top.Y):e.Top.X>d.Clipper.TopX(t,e.Top.Y):t.Curr.X<e.Curr.X},d.Clipper.prototype.IsEvenOddFillType=function(e){return e.PolyTyp==d.PolyType.ptSubject?this.m_SubjFillType==d.PolyFillType.pftEvenOdd:this.m_ClipFillType==d.PolyFillType.pftEvenOdd},d.Clipper.prototype.IsEvenOddAltFillType=function(e){return e.PolyTyp==d.PolyType.ptSubject?this.m_ClipFillType==d.PolyFillType.pftEvenOdd:this.m_SubjFillType==d.PolyFillType.pftEvenOdd},d.Clipper.prototype.IsContributing=function(e){var t,r;switch(e.PolyTyp==d.PolyType.ptSubject?(t=this.m_SubjFillType,r=this.m_ClipFillType):(t=this.m_ClipFillType,r=this.m_SubjFillType),t){case d.PolyFillType.pftEvenOdd:if(0===e.WindDelta&&1!=e.WindCnt)return!1;break;case d.PolyFillType.pftNonZero:if(1!=Math.abs(e.WindCnt))return!1;break;case d.PolyFillType.pftPositive:if(1!=e.WindCnt)return!1;break;default:if(-1!=e.WindCnt)return!1}switch(this.m_ClipType){case d.ClipType.ctIntersection:switch(r){case d.PolyFillType.pftEvenOdd:case d.PolyFillType.pftNonZero:return 0!==e.WindCnt2;case d.PolyFillType.pftPositive:return 0<e.WindCnt2;default:return 0>e.WindCnt2}case d.ClipType.ctUnion:switch(r){case d.PolyFillType.pftEvenOdd:case d.PolyFillType.pftNonZero:return 0===e.WindCnt2;case d.PolyFillType.pftPositive:return 0>=e.WindCnt2;default:return 0<=e.WindCnt2}case d.ClipType.ctDifference:if(e.PolyTyp==d.PolyType.ptSubject)switch(r){case d.PolyFillType.pftEvenOdd:case d.PolyFillType.pftNonZero:return 0===e.WindCnt2;case d.PolyFillType.pftPositive:return 0>=e.WindCnt2;default:return 0<=e.WindCnt2}else switch(r){case d.PolyFillType.pftEvenOdd:case d.PolyFillType.pftNonZero:return 0!==e.WindCnt2;case d.PolyFillType.pftPositive:return 0<e.WindCnt2;default:return 0>e.WindCnt2}case d.ClipType.ctXor:if(0===e.WindDelta)switch(r){case d.PolyFillType.pftEvenOdd:case d.PolyFillType.pftNonZero:return 0===e.WindCnt2;case d.PolyFillType.pftPositive:return 0>=e.WindCnt2;default:return 0<=e.WindCnt2}}return!0},d.Clipper.prototype.SetWindingCount=function(e){for(var t=e.PrevInAEL;null!==t&&(t.PolyTyp!=e.PolyTyp||0===t.WindDelta);)t=t.PrevInAEL;if(null===t)e.WindCnt=0===e.WindDelta?1:e.WindDelta,e.WindCnt2=0,t=this.m_ActiveEdges;else{if(0===e.WindDelta&&this.m_ClipType!=d.ClipType.ctUnion)e.WindCnt=1;else if(this.IsEvenOddFillType(e))if(0===e.WindDelta){for(var r=!0,n=t.PrevInAEL;null!==n;)n.PolyTyp==t.PolyTyp&&0!==n.WindDelta&&(r=!r),n=n.PrevInAEL;e.WindCnt=r?0:1}else e.WindCnt=e.WindDelta;else e.WindCnt=0>t.WindCnt*t.WindDelta?1<Math.abs(t.WindCnt)?0>t.WindDelta*e.WindDelta?t.WindCnt:t.WindCnt+e.WindDelta:0===e.WindDelta?1:e.WindDelta:0===e.WindDelta?0>t.WindCnt?t.WindCnt-1:t.WindCnt+1:0>t.WindDelta*e.WindDelta?t.WindCnt:t.WindCnt+e.WindDelta;e.WindCnt2=t.WindCnt2,t=t.NextInAEL}if(this.IsEvenOddAltFillType(e))for(;t!=e;)0!==t.WindDelta&&(e.WindCnt2=0===e.WindCnt2?1:0),t=t.NextInAEL;else for(;t!=e;)e.WindCnt2+=t.WindDelta,t=t.NextInAEL},d.Clipper.prototype.AddEdgeToSEL=function(e){null===this.m_SortedEdges?(this.m_SortedEdges=e,e.PrevInSEL=null,e.NextInSEL=null):(e.NextInSEL=this.m_SortedEdges,e.PrevInSEL=null,this.m_SortedEdges=this.m_SortedEdges.PrevInSEL=e)},d.Clipper.prototype.CopyAELToSEL=function(){var e=this.m_ActiveEdges;for(this.m_SortedEdges=e;null!==e;)e.PrevInSEL=e.PrevInAEL,e=e.NextInSEL=e.NextInAEL},d.Clipper.prototype.SwapPositionsInAEL=function(e,t){if(e.NextInAEL!=e.PrevInAEL&&t.NextInAEL!=t.PrevInAEL){if(e.NextInAEL==t){var r=t.NextInAEL;null!==r&&(r.PrevInAEL=e);var n=e.PrevInAEL;null!==n&&(n.NextInAEL=t),t.PrevInAEL=n,t.NextInAEL=e,e.PrevInAEL=t,e.NextInAEL=r}else t.NextInAEL==e?(null!==(r=e.NextInAEL)&&(r.PrevInAEL=t),null!==(n=t.PrevInAEL)&&(n.NextInAEL=e),e.PrevInAEL=n,e.NextInAEL=t,t.PrevInAEL=e,t.NextInAEL=r):(r=e.NextInAEL,n=e.PrevInAEL,e.NextInAEL=t.NextInAEL,null!==e.NextInAEL&&(e.NextInAEL.PrevInAEL=e),e.PrevInAEL=t.PrevInAEL,null!==e.PrevInAEL&&(e.PrevInAEL.NextInAEL=e),t.NextInAEL=r,null!==t.NextInAEL&&(t.NextInAEL.PrevInAEL=t),t.PrevInAEL=n,null!==t.PrevInAEL&&(t.PrevInAEL.NextInAEL=t));null===e.PrevInAEL?this.m_ActiveEdges=e:null===t.PrevInAEL&&(this.m_ActiveEdges=t)}},d.Clipper.prototype.SwapPositionsInSEL=function(e,t){if(!(null===e.NextInSEL&&null===e.PrevInSEL||null===t.NextInSEL&&null===t.PrevInSEL)){if(e.NextInSEL==t){var r=t.NextInSEL;null!==r&&(r.PrevInSEL=e);var n=e.PrevInSEL;null!==n&&(n.NextInSEL=t),t.PrevInSEL=n,t.NextInSEL=e,e.PrevInSEL=t,e.NextInSEL=r}else t.NextInSEL==e?(null!==(r=e.NextInSEL)&&(r.PrevInSEL=t),null!==(n=t.PrevInSEL)&&(n.NextInSEL=e),e.PrevInSEL=n,e.NextInSEL=t,t.PrevInSEL=e,t.NextInSEL=r):(r=e.NextInSEL,n=e.PrevInSEL,e.NextInSEL=t.NextInSEL,null!==e.NextInSEL&&(e.NextInSEL.PrevInSEL=e),e.PrevInSEL=t.PrevInSEL,null!==e.PrevInSEL&&(e.PrevInSEL.NextInSEL=e),t.NextInSEL=r,null!==t.NextInSEL&&(t.NextInSEL.PrevInSEL=t),t.PrevInSEL=n,null!==t.PrevInSEL&&(t.PrevInSEL.NextInSEL=t));null===e.PrevInSEL?this.m_SortedEdges=e:null===t.PrevInSEL&&(this.m_SortedEdges=t)}},d.Clipper.prototype.AddLocalMaxPoly=function(e,t,r){this.AddOutPt(e,r),0==t.WindDelta&&this.AddOutPt(t,r),e.OutIdx==t.OutIdx?(e.OutIdx=-1,t.OutIdx=-1):e.OutIdx<t.OutIdx?this.AppendPolygon(e,t):this.AppendPolygon(t,e)},d.Clipper.prototype.AddLocalMinPoly=function(e,t,r){var n,i;return d.ClipperBase.IsHorizontal(t)||e.Dx>t.Dx?(n=this.AddOutPt(e,r),t.OutIdx=e.OutIdx,e.Side=d.EdgeSide.esLeft,t.Side=d.EdgeSide.esRight,e=(i=e).PrevInAEL==t?t.PrevInAEL:i.PrevInAEL):(n=this.AddOutPt(t,r),e.OutIdx=t.OutIdx,e.Side=d.EdgeSide.esRight,t.Side=d.EdgeSide.esLeft,e=(i=t).PrevInAEL==e?e.PrevInAEL:i.PrevInAEL),null!==e&&0<=e.OutIdx&&d.Clipper.TopX(e,r.Y)==d.Clipper.TopX(i,r.Y)&&d.ClipperBase.SlopesEqual(i,e,this.m_UseFullRange)&&0!==i.WindDelta&&0!==e.WindDelta&&(r=this.AddOutPt(e,r),this.AddJoin(n,r,i.Top)),n},d.Clipper.prototype.CreateOutRec=function(){var e=new d.OutRec;return e.Idx=-1,e.IsHole=!1,e.IsOpen=!1,e.FirstLeft=null,e.Pts=null,e.BottomPt=null,e.PolyNode=null,this.m_PolyOuts.push(e),e.Idx=this.m_PolyOuts.length-1,e},d.Clipper.prototype.AddOutPt=function(e,t){var r=e.Side==d.EdgeSide.esLeft;if(0>e.OutIdx){var n=this.CreateOutRec();n.IsOpen=0===e.WindDelta;var i=new d.OutPt;n.Pts=i,i.Idx=n.Idx,i.Pt.X=t.X,i.Pt.Y=t.Y,d.use_xyz&&(i.Pt.Z=t.Z),i.Next=i,i.Prev=i,n.IsOpen||this.SetHoleState(e,n),e.OutIdx=n.Idx}else{if(e=(n=this.m_PolyOuts[e.OutIdx]).Pts,r&&d.IntPoint.op_Equality(t,e.Pt))return e;if(!r&&d.IntPoint.op_Equality(t,e.Prev.Pt))return e.Prev;(i=new d.OutPt).Idx=n.Idx,i.Pt.X=t.X,i.Pt.Y=t.Y,d.use_xyz&&(i.Pt.Z=t.Z),i.Next=e,i.Prev=e.Prev,i.Prev.Next=i,e.Prev=i,r&&(n.Pts=i)}return i},d.Clipper.prototype.SwapPoints=function(e,t){var r=new d.IntPoint(e.Value);e.Value.X=t.Value.X,e.Value.Y=t.Value.Y,d.use_xyz&&(e.Value.Z=t.Value.Z),t.Value.X=r.X,t.Value.Y=r.Y,d.use_xyz&&(t.Value.Z=r.Z)},d.Clipper.prototype.HorzSegmentsOverlap=function(e,t,r,n){var i;return e>t&&(i=e,e=t,t=i),r>n&&(i=r,r=n,n=i),e<n&&r<t},d.Clipper.prototype.SetHoleState=function(e,t){var r=!1;for(e=e.PrevInAEL;null!==e;)0<=e.OutIdx&&0!=e.WindDelta&&(r=!r,null===t.FirstLeft&&(t.FirstLeft=this.m_PolyOuts[e.OutIdx])),e=e.PrevInAEL;r&&(t.IsHole=!0)},d.Clipper.prototype.GetDx=function(e,t){return e.Y==t.Y?d.ClipperBase.horizontal:(t.X-e.X)/(t.Y-e.Y)},d.Clipper.prototype.FirstIsBottomPt=function(e,t){for(var r=e.Prev;d.IntPoint.op_Equality(r.Pt,e.Pt)&&r!=e;)r=r.Prev;var n=Math.abs(this.GetDx(e.Pt,r.Pt));for(r=e.Next;d.IntPoint.op_Equality(r.Pt,e.Pt)&&r!=e;)r=r.Next;for(e=Math.abs(this.GetDx(e.Pt,r.Pt)),r=t.Prev;d.IntPoint.op_Equality(r.Pt,t.Pt)&&r!=t;)r=r.Prev;var i=Math.abs(this.GetDx(t.Pt,r.Pt));for(r=t.Next;d.IntPoint.op_Equality(r.Pt,t.Pt)&&r!=t;)r=r.Next;return r=Math.abs(this.GetDx(t.Pt,r.Pt)),n>=i&&n>=r||e>=i&&e>=r},d.Clipper.prototype.GetBottomPt=function(e){for(var t=null,r=e.Next;r!=e;)r.Pt.Y>e.Pt.Y?(e=r,t=null):r.Pt.Y==e.Pt.Y&&r.Pt.X<=e.Pt.X&&(r.Pt.X<e.Pt.X?(t=null,e=r):r.Next!=e&&r.Prev!=e&&(t=r)),r=r.Next;if(null!==t)for(;t!=r;)for(this.FirstIsBottomPt(r,t)||(e=t),t=t.Next;d.IntPoint.op_Inequality(t.Pt,e.Pt);)t=t.Next;return e},d.Clipper.prototype.GetLowermostRec=function(e,t){null===e.BottomPt&&(e.BottomPt=this.GetBottomPt(e.Pts)),null===t.BottomPt&&(t.BottomPt=this.GetBottomPt(t.Pts));var r=e.BottomPt,n=t.BottomPt;return r.Pt.Y>n.Pt.Y?e:r.Pt.Y<n.Pt.Y?t:r.Pt.X<n.Pt.X?e:r.Pt.X>n.Pt.X||r.Next==r?t:n.Next==n||this.FirstIsBottomPt(r,n)?e:t},d.Clipper.prototype.Param1RightOfParam2=function(e,t){do{if((e=e.FirstLeft)==t)return!0}while(null!==e);return!1},d.Clipper.prototype.GetOutRec=function(e){for(e=this.m_PolyOuts[e];e!=this.m_PolyOuts[e.Idx];)e=this.m_PolyOuts[e.Idx];return e},d.Clipper.prototype.AppendPolygon=function(e,t){var r=this.m_PolyOuts[e.OutIdx],n=this.m_PolyOuts[t.OutIdx],i=this.Param1RightOfParam2(r,n)?n:this.Param1RightOfParam2(n,r)?r:this.GetLowermostRec(r,n),a=r.Pts,o=a.Prev,l=n.Pts,s=l.Prev;for(e.Side==d.EdgeSide.esLeft?(t.Side==d.EdgeSide.esLeft?(this.ReversePolyPtLinks(l),l.Next=a,a.Prev=l,o.Next=s,s.Prev=o,r.Pts=s):(s.Next=a,a.Prev=s,l.Prev=o,o.Next=l,r.Pts=l),a=d.EdgeSide.esLeft):(t.Side==d.EdgeSide.esRight?(this.ReversePolyPtLinks(l),o.Next=s,s.Prev=o,l.Next=a,a.Prev=l):(o.Next=l,l.Prev=o,a.Prev=s,s.Next=a),a=d.EdgeSide.esRight),r.BottomPt=null,i==n&&(n.FirstLeft!=r&&(r.FirstLeft=n.FirstLeft),r.IsHole=n.IsHole),n.Pts=null,n.BottomPt=null,n.FirstLeft=r,i=e.OutIdx,o=t.OutIdx,e.OutIdx=-1,t.OutIdx=-1,l=this.m_ActiveEdges;null!==l;){if(l.OutIdx==o){l.OutIdx=i,l.Side=a;break}l=l.NextInAEL}n.Idx=r.Idx},d.Clipper.prototype.ReversePolyPtLinks=function(e){if(null!==e){var t=e;do{var r=t.Next;t.Next=t.Prev,t=t.Prev=r}while(t!=e)}},d.Clipper.SwapSides=function(e,t){var r=e.Side;e.Side=t.Side,t.Side=r},d.Clipper.SwapPolyIndexes=function(e,t){var r=e.OutIdx;e.OutIdx=t.OutIdx,t.OutIdx=r},d.Clipper.prototype.IntersectEdges=function(e,t,r){var n=0<=e.OutIdx,i=0<=t.OutIdx;if(d.use_xyz&&this.SetZ(r,e,t),!d.use_lines||0!==e.WindDelta&&0!==t.WindDelta){if(e.PolyTyp==t.PolyTyp)if(this.IsEvenOddFillType(e)){var a=e.WindCnt;e.WindCnt=t.WindCnt,t.WindCnt=a}else e.WindCnt=0===e.WindCnt+t.WindDelta?-e.WindCnt:e.WindCnt+t.WindDelta,t.WindCnt=0==t.WindCnt-e.WindDelta?-t.WindCnt:t.WindCnt-e.WindDelta;else this.IsEvenOddFillType(t)?e.WindCnt2=0===e.WindCnt2?1:0:e.WindCnt2+=t.WindDelta,this.IsEvenOddFillType(e)?t.WindCnt2=0===t.WindCnt2?1:0:t.WindCnt2-=e.WindDelta;var o,l,s;switch(e.PolyTyp==d.PolyType.ptSubject?(o=this.m_SubjFillType,s=this.m_ClipFillType):(o=this.m_ClipFillType,s=this.m_SubjFillType),t.PolyTyp==d.PolyType.ptSubject?(l=this.m_SubjFillType,a=this.m_ClipFillType):(l=this.m_ClipFillType,a=this.m_SubjFillType),o){case d.PolyFillType.pftPositive:o=e.WindCnt;break;case d.PolyFillType.pftNegative:o=-e.WindCnt;break;default:o=Math.abs(e.WindCnt)}switch(l){case d.PolyFillType.pftPositive:l=t.WindCnt;break;case d.PolyFillType.pftNegative:l=-t.WindCnt;break;default:l=Math.abs(t.WindCnt)}if(n&&i)0!=o&&1!=o||0!=l&&1!=l||e.PolyTyp!=t.PolyTyp&&this.m_ClipType!=d.ClipType.ctXor?this.AddLocalMaxPoly(e,t,r):(this.AddOutPt(e,r),this.AddOutPt(t,r),d.Clipper.SwapSides(e,t),d.Clipper.SwapPolyIndexes(e,t));else if(n)0!==l&&1!=l||(this.AddOutPt(e,r),d.Clipper.SwapSides(e,t),d.Clipper.SwapPolyIndexes(e,t));else if(i)0!==o&&1!=o||(this.AddOutPt(t,r),d.Clipper.SwapSides(e,t),d.Clipper.SwapPolyIndexes(e,t));else if(!(0!=o&&1!=o||0!=l&&1!=l)){switch(s){case d.PolyFillType.pftPositive:n=e.WindCnt2;break;case d.PolyFillType.pftNegative:n=-e.WindCnt2;break;default:n=Math.abs(e.WindCnt2)}switch(a){case d.PolyFillType.pftPositive:i=t.WindCnt2;break;case d.PolyFillType.pftNegative:i=-t.WindCnt2;break;default:i=Math.abs(t.WindCnt2)}if(e.PolyTyp!=t.PolyTyp)this.AddLocalMinPoly(e,t,r);else if(1==o&&1==l)switch(this.m_ClipType){case d.ClipType.ctIntersection:0<n&&0<i&&this.AddLocalMinPoly(e,t,r);break;case d.ClipType.ctUnion:0>=n&&0>=i&&this.AddLocalMinPoly(e,t,r);break;case d.ClipType.ctDifference:(e.PolyTyp==d.PolyType.ptClip&&0<n&&0<i||e.PolyTyp==d.PolyType.ptSubject&&0>=n&&0>=i)&&this.AddLocalMinPoly(e,t,r);break;case d.ClipType.ctXor:this.AddLocalMinPoly(e,t,r)}else d.Clipper.SwapSides(e,t)}}else 0==e.WindDelta&&0==t.WindDelta||(e.PolyTyp==t.PolyTyp&&e.WindDelta!=t.WindDelta&&this.m_ClipType==d.ClipType.ctUnion?0===e.WindDelta?i&&(this.AddOutPt(e,r),n&&(e.OutIdx=-1)):n&&(this.AddOutPt(t,r),i&&(t.OutIdx=-1)):e.PolyTyp!=t.PolyTyp&&(0!==e.WindDelta||1!=Math.abs(t.WindCnt)||this.m_ClipType==d.ClipType.ctUnion&&0!==t.WindCnt2?0!==t.WindDelta||1!=Math.abs(e.WindCnt)||this.m_ClipType==d.ClipType.ctUnion&&0!==e.WindCnt2||(this.AddOutPt(t,r),i&&(t.OutIdx=-1)):(this.AddOutPt(e,r),n&&(e.OutIdx=-1))))},d.Clipper.prototype.DeleteFromAEL=function(e){var t=e.PrevInAEL,r=e.NextInAEL;null===t&&null===r&&e!=this.m_ActiveEdges||(null!==t?t.NextInAEL=r:this.m_ActiveEdges=r,null!==r&&(r.PrevInAEL=t),e.NextInAEL=null,e.PrevInAEL=null)},d.Clipper.prototype.DeleteFromSEL=function(e){var t=e.PrevInSEL,r=e.NextInSEL;null===t&&null===r&&e!=this.m_SortedEdges||(null!==t?t.NextInSEL=r:this.m_SortedEdges=r,null!==r&&(r.PrevInSEL=t),e.NextInSEL=null,e.PrevInSEL=null)},d.Clipper.prototype.UpdateEdgeIntoAEL=function(e){null===e.NextInLML&&d.Error("UpdateEdgeIntoAEL: invalid call");var t=e.PrevInAEL,r=e.NextInAEL;return e.NextInLML.OutIdx=e.OutIdx,null!==t?t.NextInAEL=e.NextInLML:this.m_ActiveEdges=e.NextInLML,null!==r&&(r.PrevInAEL=e.NextInLML),e.NextInLML.Side=e.Side,e.NextInLML.WindDelta=e.WindDelta,e.NextInLML.WindCnt=e.WindCnt,e.NextInLML.WindCnt2=e.WindCnt2,(e=e.NextInLML).Curr.X=e.Bot.X,e.Curr.Y=e.Bot.Y,d.use_xyz&&(e.Curr.Z=e.Bot.Z),e.PrevInAEL=t,e.NextInAEL=r,d.ClipperBase.IsHorizontal(e)||this.InsertScanbeam(e.Top.Y),e},d.Clipper.prototype.ProcessHorizontals=function(e){for(var t=this.m_SortedEdges;null!==t;)this.DeleteFromSEL(t),this.ProcessHorizontal(t,e),t=this.m_SortedEdges},d.Clipper.prototype.GetHorzDirection=function(e,t){e.Bot.X<e.Top.X?(t.Left=e.Bot.X,t.Right=e.Top.X,t.Dir=d.Direction.dLeftToRight):(t.Left=e.Top.X,t.Right=e.Bot.X,t.Dir=d.Direction.dRightToLeft)},d.Clipper.prototype.ProcessHorizontal=function(e,t){var r={Dir:null,Left:null,Right:null};this.GetHorzDirection(e,r);for(var n=r.Dir,i=r.Left,a=r.Right,o=e,l=null;null!==o.NextInLML&&d.ClipperBase.IsHorizontal(o.NextInLML);)o=o.NextInLML;for(null===o.NextInLML&&(l=this.GetMaximaPair(o));;){for(var s=e==o,u=this.GetNextInAEL(e,n);null!==u&&!(u.Curr.X==e.Top.X&&null!==e.NextInLML&&u.Dx<e.NextInLML.Dx);){if(r=this.GetNextInAEL(u,n),n==d.Direction.dLeftToRight&&u.Curr.X<=a||n==d.Direction.dRightToLeft&&u.Curr.X>=i){if(u==l&&s){if(0<=e.OutIdx){for(n=this.AddOutPt(e,e.Top),r=this.m_SortedEdges;null!==r;)0<=r.OutIdx&&this.HorzSegmentsOverlap(e.Bot.X,e.Top.X,r.Bot.X,r.Top.X)&&(i=this.AddOutPt(r,r.Bot),this.AddJoin(i,n,r.Top)),r=r.NextInSEL;this.AddGhostJoin(n,e.Bot),this.AddLocalMaxPoly(e,l,e.Top)}return this.DeleteFromAEL(e),void this.DeleteFromAEL(l)}if(n==d.Direction.dLeftToRight){var c=new d.IntPoint(u.Curr.X,e.Curr.Y);this.IntersectEdges(e,u,c)}else c=new d.IntPoint(u.Curr.X,e.Curr.Y),this.IntersectEdges(u,e,c);this.SwapPositionsInAEL(e,u)}else if(n==d.Direction.dLeftToRight&&u.Curr.X>=a||n==d.Direction.dRightToLeft&&u.Curr.X<=i)break;u=r}if(null===e.NextInLML||!d.ClipperBase.IsHorizontal(e.NextInLML))break;0<=(e=this.UpdateEdgeIntoAEL(e)).OutIdx&&this.AddOutPt(e,e.Bot),r={Dir:n,Left:i,Right:a},this.GetHorzDirection(e,r),n=r.Dir,i=r.Left,a=r.Right}null!==e.NextInLML?0<=e.OutIdx?(n=this.AddOutPt(e,e.Top),t&&this.AddGhostJoin(n,e.Bot),0!==(e=this.UpdateEdgeIntoAEL(e)).WindDelta&&(l=e.PrevInAEL,r=e.NextInAEL,null!==l&&l.Curr.X==e.Bot.X&&l.Curr.Y==e.Bot.Y&&0!==l.WindDelta&&0<=l.OutIdx&&l.Curr.Y>l.Top.Y&&d.ClipperBase.SlopesEqual(e,l,this.m_UseFullRange)?(i=this.AddOutPt(l,e.Bot),this.AddJoin(n,i,e.Top)):null!==r&&r.Curr.X==e.Bot.X&&r.Curr.Y==e.Bot.Y&&0!==r.WindDelta&&0<=r.OutIdx&&r.Curr.Y>r.Top.Y&&d.ClipperBase.SlopesEqual(e,r,this.m_UseFullRange)&&(i=this.AddOutPt(r,e.Bot),this.AddJoin(n,i,e.Top)))):this.UpdateEdgeIntoAEL(e):(0<=e.OutIdx&&this.AddOutPt(e,e.Top),this.DeleteFromAEL(e))},d.Clipper.prototype.GetNextInAEL=function(e,t){return t==d.Direction.dLeftToRight?e.NextInAEL:e.PrevInAEL},d.Clipper.prototype.IsMinima=function(e){return null!==e&&e.Prev.NextInLML!=e&&e.Next.NextInLML!=e},d.Clipper.prototype.IsMaxima=function(e,t){return null!==e&&e.Top.Y==t&&null===e.NextInLML},d.Clipper.prototype.IsIntermediate=function(e,t){return e.Top.Y==t&&null!==e.NextInLML},d.Clipper.prototype.GetMaximaPair=function(e){var t=null;return d.IntPoint.op_Equality(e.Next.Top,e.Top)&&null===e.Next.NextInLML?t=e.Next:d.IntPoint.op_Equality(e.Prev.Top,e.Top)&&null===e.Prev.NextInLML&&(t=e.Prev),null===t||-2!=t.OutIdx&&(t.NextInAEL!=t.PrevInAEL||d.ClipperBase.IsHorizontal(t))?t:null},d.Clipper.prototype.ProcessIntersections=function(e){if(null==this.m_ActiveEdges)return!0;try{if(this.BuildIntersectList(e),0==this.m_IntersectList.length)return!0;if(1!=this.m_IntersectList.length&&!this.FixupIntersectionOrder())return!1;this.ProcessIntersectList()}catch(e){this.m_SortedEdges=null,this.m_IntersectList.length=0,d.Error("ProcessIntersections error")}return this.m_SortedEdges=null,!0},d.Clipper.prototype.BuildIntersectList=function(e){if(null!==this.m_ActiveEdges){var t=this.m_ActiveEdges;for(this.m_SortedEdges=t;null!==t;)t.PrevInSEL=t.PrevInAEL,t.NextInSEL=t.NextInAEL,t.Curr.X=d.Clipper.TopX(t,e),t=t.NextInAEL;for(var r=!0;r&&null!==this.m_SortedEdges;){for(r=!1,t=this.m_SortedEdges;null!==t.NextInSEL;){e=t.NextInSEL;var n=new d.IntPoint;t.Curr.X>e.Curr.X?(this.IntersectPoint(t,e,n),(r=new d.IntersectNode).Edge1=t,r.Edge2=e,r.Pt.X=n.X,r.Pt.Y=n.Y,d.use_xyz&&(r.Pt.Z=n.Z),this.m_IntersectList.push(r),this.SwapPositionsInSEL(t,e),r=!0):t=e}if(null===t.PrevInSEL)break;t.PrevInSEL.NextInSEL=null}this.m_SortedEdges=null}},d.Clipper.prototype.EdgesAdjacent=function(e){return e.Edge1.NextInSEL==e.Edge2||e.Edge1.PrevInSEL==e.Edge2},d.Clipper.IntersectNodeSort=function(e,t){return t.Pt.Y-e.Pt.Y},d.Clipper.prototype.FixupIntersectionOrder=function(){this.m_IntersectList.sort(this.m_IntersectNodeComparer),this.CopyAELToSEL();for(var e=this.m_IntersectList.length,t=0;t<e;t++){if(!this.EdgesAdjacent(this.m_IntersectList[t])){for(var r=t+1;r<e&&!this.EdgesAdjacent(this.m_IntersectList[r]);)r++;if(r==e)return!1;var n=this.m_IntersectList[t];this.m_IntersectList[t]=this.m_IntersectList[r],this.m_IntersectList[r]=n}this.SwapPositionsInSEL(this.m_IntersectList[t].Edge1,this.m_IntersectList[t].Edge2)}return!0},d.Clipper.prototype.ProcessIntersectList=function(){for(var e=0,t=this.m_IntersectList.length;e<t;e++){var r=this.m_IntersectList[e];this.IntersectEdges(r.Edge1,r.Edge2,r.Pt),this.SwapPositionsInAEL(r.Edge1,r.Edge2)}this.m_IntersectList.length=0},b=function(e){return 0>e?Math.ceil(e-.5):Math.round(e)},P=function(e){return 0>e?Math.ceil(e-.5):Math.floor(e+.5)},C=function(e){return 0>e?-Math.round(Math.abs(e)):Math.round(e)},_=function(e){return 0>e?-2147483648>(e-=.5)?Math.ceil(e):0|e:2147483647<(e+=.5)?Math.floor(e):0|e},d.Clipper.Round=y?b:m?C:x?_:P,d.Clipper.TopX=function(e,t){return t==e.Top.Y?e.Top.X:e.Bot.X+d.Clipper.Round(e.Dx*(t-e.Bot.Y))},d.Clipper.prototype.IntersectPoint=function(e,t,r){var n,i;if(r.X=0,r.Y=0,e.Dx==t.Dx)r.Y=e.Curr.Y,r.X=d.Clipper.TopX(e,r.Y);else{if(0===e.Delta.X)r.X=e.Bot.X,d.ClipperBase.IsHorizontal(t)?r.Y=t.Bot.Y:(i=t.Bot.Y-t.Bot.X/t.Dx,r.Y=d.Clipper.Round(r.X/t.Dx+i));else if(0===t.Delta.X)r.X=t.Bot.X,d.ClipperBase.IsHorizontal(e)?r.Y=e.Bot.Y:(n=e.Bot.Y-e.Bot.X/e.Dx,r.Y=d.Clipper.Round(r.X/e.Dx+n));else{n=e.Bot.X-e.Bot.Y*e.Dx;var a=((i=t.Bot.X-t.Bot.Y*t.Dx)-n)/(e.Dx-t.Dx);r.Y=d.Clipper.Round(a),r.X=Math.abs(e.Dx)<Math.abs(t.Dx)?d.Clipper.Round(e.Dx*a+n):d.Clipper.Round(t.Dx*a+i)}if(r.Y<e.Top.Y||r.Y<t.Top.Y){if(e.Top.Y>t.Top.Y)return r.Y=e.Top.Y,r.X=d.Clipper.TopX(t,e.Top.Y),r.X<e.Top.X;r.Y=t.Top.Y,r.X=Math.abs(e.Dx)<Math.abs(t.Dx)?d.Clipper.TopX(e,r.Y):d.Clipper.TopX(t,r.Y)}r.Y>e.Curr.Y&&(r.Y=e.Curr.Y,r.X=Math.abs(e.Dx)>Math.abs(t.Dx)?d.Clipper.TopX(t,r.Y):d.Clipper.TopX(e,r.Y))}},d.Clipper.prototype.ProcessEdgesAtTopOfScanbeam=function(e){for(var t=this.m_ActiveEdges;null!==t;){var r=this.IsMaxima(t,e);if(r&&(r=null===(r=this.GetMaximaPair(t))||!d.ClipperBase.IsHorizontal(r)),r){var n=t.PrevInAEL;this.DoMaxima(t),t=null===n?this.m_ActiveEdges:n.NextInAEL}else{if(this.IsIntermediate(t,e)&&d.ClipperBase.IsHorizontal(t.NextInLML)?(0<=(t=this.UpdateEdgeIntoAEL(t)).OutIdx&&this.AddOutPt(t,t.Bot),this.AddEdgeToSEL(t)):(t.Curr.X=d.Clipper.TopX(t,e),t.Curr.Y=e),this.StrictlySimple&&(n=t.PrevInAEL,0<=t.OutIdx&&0!==t.WindDelta&&null!==n&&0<=n.OutIdx&&n.Curr.X==t.Curr.X&&0!==n.WindDelta)){var i=new d.IntPoint(t.Curr);d.use_xyz&&this.SetZ(i,n,t),r=this.AddOutPt(n,i),n=this.AddOutPt(t,i),this.AddJoin(r,n,i)}t=t.NextInAEL}}for(this.ProcessHorizontals(!0),t=this.m_ActiveEdges;null!==t;)this.IsIntermediate(t,e)&&(r=null,0<=t.OutIdx&&(r=this.AddOutPt(t,t.Top)),n=(t=this.UpdateEdgeIntoAEL(t)).PrevInAEL,i=t.NextInAEL,null!==n&&n.Curr.X==t.Bot.X&&n.Curr.Y==t.Bot.Y&&null!==r&&0<=n.OutIdx&&n.Curr.Y>n.Top.Y&&d.ClipperBase.SlopesEqual(t,n,this.m_UseFullRange)&&0!==t.WindDelta&&0!==n.WindDelta?(n=this.AddOutPt(n,t.Bot),this.AddJoin(r,n,t.Top)):null!==i&&i.Curr.X==t.Bot.X&&i.Curr.Y==t.Bot.Y&&null!==r&&0<=i.OutIdx&&i.Curr.Y>i.Top.Y&&d.ClipperBase.SlopesEqual(t,i,this.m_UseFullRange)&&0!==t.WindDelta&&0!==i.WindDelta&&(n=this.AddOutPt(i,t.Bot),this.AddJoin(r,n,t.Top))),t=t.NextInAEL},d.Clipper.prototype.DoMaxima=function(e){var t=this.GetMaximaPair(e);if(null===t)0<=e.OutIdx&&this.AddOutPt(e,e.Top),this.DeleteFromAEL(e);else{for(var r=e.NextInAEL;null!==r&&r!=t;)this.IntersectEdges(e,r,e.Top),this.SwapPositionsInAEL(e,r),r=e.NextInAEL;-1==e.OutIdx&&-1==t.OutIdx?(this.DeleteFromAEL(e),this.DeleteFromAEL(t)):0<=e.OutIdx&&0<=t.OutIdx?(0<=e.OutIdx&&this.AddLocalMaxPoly(e,t,e.Top),this.DeleteFromAEL(e),this.DeleteFromAEL(t)):d.use_lines&&0===e.WindDelta?(0<=e.OutIdx&&(this.AddOutPt(e,e.Top),e.OutIdx=-1),this.DeleteFromAEL(e),0<=t.OutIdx&&(this.AddOutPt(t,e.Top),t.OutIdx=-1),this.DeleteFromAEL(t)):d.Error("DoMaxima error")}},d.Clipper.ReversePaths=function(e){for(var t=0,r=e.length;t<r;t++)e[t].reverse()},d.Clipper.Orientation=function(e){return 0<=d.Clipper.Area(e)},d.Clipper.prototype.PointCount=function(e){if(null===e)return 0;var t=0,r=e;do{t++,r=r.Next}while(r!=e);return t},d.Clipper.prototype.BuildResult=function(e){d.Clear(e);for(var t=0,r=this.m_PolyOuts.length;t<r;t++){var n=this.m_PolyOuts[t];if(null!==n.Pts){n=n.Pts.Prev;var i=this.PointCount(n);if(!(2>i)){for(var a=Array(i),o=0;o<i;o++)a[o]=n.Pt,n=n.Prev;e.push(a)}}}},d.Clipper.prototype.BuildResult2=function(e){e.Clear();for(var t=0,r=this.m_PolyOuts.length;t<r;t++){var n=this.m_PolyOuts[t],i=this.PointCount(n.Pts);if(!(n.IsOpen&&2>i||!n.IsOpen&&3>i)){this.FixHoleLinkage(n);var a=new d.PolyNode;e.m_AllPolys.push(a),n.PolyNode=a,a.m_polygon.length=i,n=n.Pts.Prev;for(var o=0;o<i;o++)a.m_polygon[o]=n.Pt,n=n.Prev}}for(t=0,r=this.m_PolyOuts.length;t<r;t++)null!==(n=this.m_PolyOuts[t]).PolyNode&&(n.IsOpen?(n.PolyNode.IsOpen=!0,e.AddChild(n.PolyNode)):null!==n.FirstLeft&&null!=n.FirstLeft.PolyNode?n.FirstLeft.PolyNode.AddChild(n.PolyNode):e.AddChild(n.PolyNode))},d.Clipper.prototype.FixupOutPolygon=function(e){var t=null;e.BottomPt=null;for(var r=e.Pts;;){if(r.Prev==r||r.Prev==r.Next)return void(e.Pts=null);if(d.IntPoint.op_Equality(r.Pt,r.Next.Pt)||d.IntPoint.op_Equality(r.Pt,r.Prev.Pt)||d.ClipperBase.SlopesEqual(r.Prev.Pt,r.Pt,r.Next.Pt,this.m_UseFullRange)&&(!this.PreserveCollinear||!this.Pt2IsBetweenPt1AndPt3(r.Prev.Pt,r.Pt,r.Next.Pt)))t=null,r.Prev.Next=r.Next,r=r.Next.Prev=r.Prev;else{if(r==t)break;null===t&&(t=r),r=r.Next}}e.Pts=r},d.Clipper.prototype.DupOutPt=function(e,t){var r=new d.OutPt;return r.Pt.X=e.Pt.X,r.Pt.Y=e.Pt.Y,d.use_xyz&&(r.Pt.Z=e.Pt.Z),r.Idx=e.Idx,t?(r.Next=e.Next,r.Prev=e,e.Next.Prev=r,e.Next=r):(r.Prev=e.Prev,r.Next=e,e.Prev.Next=r,e.Prev=r),r},d.Clipper.prototype.GetOverlap=function(e,t,r,n,i){return e<t?r<n?(i.Left=Math.max(e,r),i.Right=Math.min(t,n)):(i.Left=Math.max(e,n),i.Right=Math.min(t,r)):r<n?(i.Left=Math.max(t,r),i.Right=Math.min(e,n)):(i.Left=Math.max(t,n),i.Right=Math.min(e,r)),i.Left<i.Right},d.Clipper.prototype.JoinHorz=function(e,t,r,n,i,a){var o=e.Pt.X>t.Pt.X?d.Direction.dRightToLeft:d.Direction.dLeftToRight;if(o==(n=r.Pt.X>n.Pt.X?d.Direction.dRightToLeft:d.Direction.dLeftToRight))return!1;if(o==d.Direction.dLeftToRight){for(;e.Next.Pt.X<=i.X&&e.Next.Pt.X>=e.Pt.X&&e.Next.Pt.Y==i.Y;)e=e.Next;a&&e.Pt.X!=i.X&&(e=e.Next),t=this.DupOutPt(e,!a),d.IntPoint.op_Inequality(t.Pt,i)&&((e=t).Pt.X=i.X,e.Pt.Y=i.Y,d.use_xyz&&(e.Pt.Z=i.Z),t=this.DupOutPt(e,!a))}else{for(;e.Next.Pt.X>=i.X&&e.Next.Pt.X<=e.Pt.X&&e.Next.Pt.Y==i.Y;)e=e.Next;a||e.Pt.X==i.X||(e=e.Next),t=this.DupOutPt(e,a),d.IntPoint.op_Inequality(t.Pt,i)&&((e=t).Pt.X=i.X,e.Pt.Y=i.Y,d.use_xyz&&(e.Pt.Z=i.Z),t=this.DupOutPt(e,a))}if(n==d.Direction.dLeftToRight){for(;r.Next.Pt.X<=i.X&&r.Next.Pt.X>=r.Pt.X&&r.Next.Pt.Y==i.Y;)r=r.Next;a&&r.Pt.X!=i.X&&(r=r.Next),n=this.DupOutPt(r,!a),d.IntPoint.op_Inequality(n.Pt,i)&&((r=n).Pt.X=i.X,r.Pt.Y=i.Y,d.use_xyz&&(r.Pt.Z=i.Z),n=this.DupOutPt(r,!a))}else{for(;r.Next.Pt.X>=i.X&&r.Next.Pt.X<=r.Pt.X&&r.Next.Pt.Y==i.Y;)r=r.Next;a||r.Pt.X==i.X||(r=r.Next),n=this.DupOutPt(r,a),d.IntPoint.op_Inequality(n.Pt,i)&&((r=n).Pt.X=i.X,r.Pt.Y=i.Y,d.use_xyz&&(r.Pt.Z=i.Z),n=this.DupOutPt(r,a))}return o==d.Direction.dLeftToRight==a?(e.Prev=r,r.Next=e,t.Next=n,n.Prev=t):(e.Next=r,r.Prev=e,t.Prev=n,n.Next=t),!0},d.Clipper.prototype.JoinPoints=function(e,t,r){var n,i=e.OutPt1;new d.OutPt;var a,o=e.OutPt2;if(new d.OutPt,(a=e.OutPt1.Pt.Y==e.OffPt.Y)&&d.IntPoint.op_Equality(e.OffPt,e.OutPt1.Pt)&&d.IntPoint.op_Equality(e.OffPt,e.OutPt2.Pt)){if(t!=r)return!1;for(n=e.OutPt1.Next;n!=i&&d.IntPoint.op_Equality(n.Pt,e.OffPt);)n=n.Next;for(n=n.Pt.Y>e.OffPt.Y,a=e.OutPt2.Next;a!=o&&d.IntPoint.op_Equality(a.Pt,e.OffPt);)a=a.Next;return n!=a.Pt.Y>e.OffPt.Y&&(n?(n=this.DupOutPt(i,!1),a=this.DupOutPt(o,!0),i.Prev=o,o.Next=i,n.Next=a,a.Prev=n):(n=this.DupOutPt(i,!0),a=this.DupOutPt(o,!1),i.Next=o,o.Prev=i,n.Prev=a,a.Next=n),e.OutPt1=i,e.OutPt2=n,!0)}if(a){for(n=i;i.Prev.Pt.Y==i.Pt.Y&&i.Prev!=n&&i.Prev!=o;)i=i.Prev;for(;n.Next.Pt.Y==n.Pt.Y&&n.Next!=i&&n.Next!=o;)n=n.Next;if(n.Next==i||n.Next==o)return!1;for(a=o;o.Prev.Pt.Y==o.Pt.Y&&o.Prev!=a&&o.Prev!=n;)o=o.Prev;for(;a.Next.Pt.Y==a.Pt.Y&&a.Next!=o&&a.Next!=i;)a=a.Next;if(a.Next==o||a.Next==i)return!1;if(r={Left:null,Right:null},!this.GetOverlap(i.Pt.X,n.Pt.X,o.Pt.X,a.Pt.X,r))return!1;t=r.Left;var l=r.Right;return r=new d.IntPoint,i.Pt.X>=t&&i.Pt.X<=l?(r.X=i.Pt.X,r.Y=i.Pt.Y,d.use_xyz&&(r.Z=i.Pt.Z),t=i.Pt.X>n.Pt.X):o.Pt.X>=t&&o.Pt.X<=l?(r.X=o.Pt.X,r.Y=o.Pt.Y,d.use_xyz&&(r.Z=o.Pt.Z),t=o.Pt.X>a.Pt.X):n.Pt.X>=t&&n.Pt.X<=l?(r.X=n.Pt.X,r.Y=n.Pt.Y,d.use_xyz&&(r.Z=n.Pt.Z),t=n.Pt.X>i.Pt.X):(r.X=a.Pt.X,r.Y=a.Pt.Y,d.use_xyz&&(r.Z=a.Pt.Z),t=a.Pt.X>o.Pt.X),e.OutPt1=i,e.OutPt2=o,this.JoinHorz(i,n,o,a,r,t)}for(n=i.Next;d.IntPoint.op_Equality(n.Pt,i.Pt)&&n!=i;)n=n.Next;if(l=n.Pt.Y>i.Pt.Y||!d.ClipperBase.SlopesEqual(i.Pt,n.Pt,e.OffPt,this.m_UseFullRange)){for(n=i.Prev;d.IntPoint.op_Equality(n.Pt,i.Pt)&&n!=i;)n=n.Prev;if(n.Pt.Y>i.Pt.Y||!d.ClipperBase.SlopesEqual(i.Pt,n.Pt,e.OffPt,this.m_UseFullRange))return!1}for(a=o.Next;d.IntPoint.op_Equality(a.Pt,o.Pt)&&a!=o;)a=a.Next;var s=a.Pt.Y>o.Pt.Y||!d.ClipperBase.SlopesEqual(o.Pt,a.Pt,e.OffPt,this.m_UseFullRange);if(s){for(a=o.Prev;d.IntPoint.op_Equality(a.Pt,o.Pt)&&a!=o;)a=a.Prev;if(a.Pt.Y>o.Pt.Y||!d.ClipperBase.SlopesEqual(o.Pt,a.Pt,e.OffPt,this.m_UseFullRange))return!1}return n!=i&&a!=o&&n!=a&&(t!=r||l!=s)&&(l?(n=this.DupOutPt(i,!1),a=this.DupOutPt(o,!0),i.Prev=o,o.Next=i,n.Next=a,a.Prev=n):(n=this.DupOutPt(i,!0),a=this.DupOutPt(o,!1),i.Next=o,o.Prev=i,n.Prev=a,a.Next=n),e.OutPt1=i,e.OutPt2=n,!0)},d.Clipper.GetBounds=function(e){for(var t=0,r=e.length;t<r&&0==e[t].length;)t++;if(t==r)return new d.IntRect(0,0,0,0);var n=new d.IntRect;for(n.left=e[t][0].X,n.right=n.left,n.top=e[t][0].Y,n.bottom=n.top;t<r;t++)for(var i=0,a=e[t].length;i<a;i++)e[t][i].X<n.left?n.left=e[t][i].X:e[t][i].X>n.right&&(n.right=e[t][i].X),e[t][i].Y<n.top?n.top=e[t][i].Y:e[t][i].Y>n.bottom&&(n.bottom=e[t][i].Y);return n},d.Clipper.prototype.GetBounds2=function(e){var t=e,r=new d.IntRect;for(r.left=e.Pt.X,r.right=e.Pt.X,r.top=e.Pt.Y,r.bottom=e.Pt.Y,e=e.Next;e!=t;)e.Pt.X<r.left&&(r.left=e.Pt.X),e.Pt.X>r.right&&(r.right=e.Pt.X),e.Pt.Y<r.top&&(r.top=e.Pt.Y),e.Pt.Y>r.bottom&&(r.bottom=e.Pt.Y),e=e.Next;return r},d.Clipper.PointInPolygon=function(e,t){var r=0,n=t.length;if(3>n)return 0;for(var i=t[0],a=1;a<=n;++a){var o=a==n?t[0]:t[a];if(o.Y==e.Y&&(o.X==e.X||i.Y==e.Y&&o.X>e.X==i.X<e.X))return-1;if(i.Y<e.Y!=o.Y<e.Y)if(i.X>=e.X)if(o.X>e.X)r=1-r;else{var l=(i.X-e.X)*(o.Y-e.Y)-(o.X-e.X)*(i.Y-e.Y);if(0==l)return-1;0<l==o.Y>i.Y&&(r=1-r)}else if(o.X>e.X){if(0==(l=(i.X-e.X)*(o.Y-e.Y)-(o.X-e.X)*(i.Y-e.Y)))return-1;0<l==o.Y>i.Y&&(r=1-r)}i=o}return r},d.Clipper.prototype.PointInPolygon=function(e,t){var r=0,n=t,i=e.X;e=e.Y;var a=t.Pt.X,o=t.Pt.Y;do{var l=(t=t.Next).Pt.X,s=t.Pt.Y;if(s==e&&(l==i||o==e&&l>i==a<i))return-1;if(o<e!=s<e)if(a>=i)if(l>i)r=1-r;else{if(0==(a=(a-i)*(s-e)-(l-i)*(o-e)))return-1;0<a==s>o&&(r=1-r)}else if(l>i){if(0==(a=(a-i)*(s-e)-(l-i)*(o-e)))return-1;0<a==s>o&&(r=1-r)}a=l,o=s}while(n!=t);return r},d.Clipper.prototype.Poly2ContainsPoly1=function(e,t){var r=e;do{var n=this.PointInPolygon(r.Pt,t);if(0<=n)return 0<n;r=r.Next}while(r!=e);return!0},d.Clipper.prototype.FixupFirstLefts1=function(e,t){for(var r=0,n=this.m_PolyOuts.length;r<n;r++){var i=this.m_PolyOuts[r];null!=i.Pts&&null!=i.FirstLeft&&this.ParseFirstLeft(i.FirstLeft)==e&&this.Poly2ContainsPoly1(i.Pts,t.Pts)&&(i.FirstLeft=t)}},d.Clipper.prototype.FixupFirstLefts2=function(e,t){for(var r=0,n=this.m_PolyOuts,i=n.length,a=n[r];r<i;a=n[++r])a.FirstLeft==e&&(a.FirstLeft=t)},d.Clipper.ParseFirstLeft=function(e){for(;null!=e&&null==e.Pts;)e=e.FirstLeft;return e},d.Clipper.prototype.JoinCommonEdges=function(){for(var e=0,t=this.m_Joins.length;e<t;e++){var r=this.m_Joins[e],n=this.GetOutRec(r.OutPt1.Idx),i=this.GetOutRec(r.OutPt2.Idx);if(null!=n.Pts&&null!=i.Pts){var a=n==i?n:this.Param1RightOfParam2(n,i)?i:this.Param1RightOfParam2(i,n)?n:this.GetLowermostRec(n,i);if(this.JoinPoints(r,n,i))if(n==i){if(n.Pts=r.OutPt1,n.BottomPt=null,(i=this.CreateOutRec()).Pts=r.OutPt2,this.UpdateOutPtIdxs(i),this.m_UsingPolyTree){a=0;for(var o=this.m_PolyOuts.length;a<o-1;a++){var l=this.m_PolyOuts[a];null!=l.Pts&&d.Clipper.ParseFirstLeft(l.FirstLeft)==n&&l.IsHole!=n.IsHole&&this.Poly2ContainsPoly1(l.Pts,r.OutPt2)&&(l.FirstLeft=i)}}this.Poly2ContainsPoly1(i.Pts,n.Pts)?(i.IsHole=!n.IsHole,i.FirstLeft=n,this.m_UsingPolyTree&&this.FixupFirstLefts2(i,n),(i.IsHole^this.ReverseSolution)==0<this.Area(i)&&this.ReversePolyPtLinks(i.Pts)):this.Poly2ContainsPoly1(n.Pts,i.Pts)?(i.IsHole=n.IsHole,n.IsHole=!i.IsHole,i.FirstLeft=n.FirstLeft,n.FirstLeft=i,this.m_UsingPolyTree&&this.FixupFirstLefts2(n,i),(n.IsHole^this.ReverseSolution)==0<this.Area(n)&&this.ReversePolyPtLinks(n.Pts)):(i.IsHole=n.IsHole,i.FirstLeft=n.FirstLeft,this.m_UsingPolyTree&&this.FixupFirstLefts1(n,i))}else i.Pts=null,i.BottomPt=null,i.Idx=n.Idx,n.IsHole=a.IsHole,a==i&&(n.FirstLeft=i.FirstLeft),i.FirstLeft=n,this.m_UsingPolyTree&&this.FixupFirstLefts2(i,n)}}},d.Clipper.prototype.UpdateOutPtIdxs=function(e){var t=e.Pts;do{t.Idx=e.Idx,t=t.Prev}while(t!=e.Pts)},d.Clipper.prototype.DoSimplePolygons=function(){for(var e=0;e<this.m_PolyOuts.length;){var t=this.m_PolyOuts[e++],r=t.Pts;if(null!=r&&!t.IsOpen)do{for(var n=r.Next;n!=t.Pts;){if(d.IntPoint.op_Equality(r.Pt,n.Pt)&&n.Next!=r&&n.Prev!=r){var i=r.Prev,a=n.Prev;r.Prev=a,a.Next=r,n.Prev=i,i.Next=n,t.Pts=r,(i=this.CreateOutRec()).Pts=n,this.UpdateOutPtIdxs(i),this.Poly2ContainsPoly1(i.Pts,t.Pts)?(i.IsHole=!t.IsHole,i.FirstLeft=t,this.m_UsingPolyTree&&this.FixupFirstLefts2(i,t)):this.Poly2ContainsPoly1(t.Pts,i.Pts)?(i.IsHole=t.IsHole,t.IsHole=!i.IsHole,i.FirstLeft=t.FirstLeft,t.FirstLeft=i,this.m_UsingPolyTree&&this.FixupFirstLefts2(t,i)):(i.IsHole=t.IsHole,i.FirstLeft=t.FirstLeft,this.m_UsingPolyTree&&this.FixupFirstLefts1(t,i)),n=r}n=n.Next}r=r.Next}while(r!=t.Pts)}},d.Clipper.Area=function(e){var t=e.length;if(3>t)return 0;for(var r=0,n=0,i=t-1;n<t;++n)r+=(e[i].X+e[n].X)*(e[i].Y-e[n].Y),i=n;return.5*-r},d.Clipper.prototype.Area=function(e){var t=e.Pts;if(null==t)return 0;var r=0;do{r+=(t.Prev.Pt.X+t.Pt.X)*(t.Prev.Pt.Y-t.Pt.Y),t=t.Next}while(t!=e.Pts);return.5*r},d.Clipper.SimplifyPolygon=function(e,t){var r=[],n=new d.Clipper(0);return n.StrictlySimple=!0,n.AddPath(e,d.PolyType.ptSubject,!0),n.Execute(d.ClipType.ctUnion,r,t,t),r},d.Clipper.SimplifyPolygons=function(e,t){void 0===t&&(t=d.PolyFillType.pftEvenOdd);var r=[],n=new d.Clipper(0);return n.StrictlySimple=!0,n.AddPaths(e,d.PolyType.ptSubject,!0),n.Execute(d.ClipType.ctUnion,r,t,t),r},d.Clipper.DistanceSqrd=function(e,t){var r=e.X-t.X;return r*r+(e=e.Y-t.Y)*e},d.Clipper.DistanceFromLineSqrd=function(e,t,r){var n=t.Y-r.Y;return r=r.X-t.X,t=n*t.X+r*t.Y,(t=n*e.X+r*e.Y-t)*t/(n*n+r*r)},d.Clipper.SlopesNearCollinear=function(e,t,r,n){return Math.abs(e.X-t.X)>Math.abs(e.Y-t.Y)?e.X>t.X==e.X<r.X?d.Clipper.DistanceFromLineSqrd(e,t,r)<n:t.X>e.X==t.X<r.X?d.Clipper.DistanceFromLineSqrd(t,e,r)<n:d.Clipper.DistanceFromLineSqrd(r,e,t)<n:e.Y>t.Y==e.Y<r.Y?d.Clipper.DistanceFromLineSqrd(e,t,r)<n:t.Y>e.Y==t.Y<r.Y?d.Clipper.DistanceFromLineSqrd(t,e,r)<n:d.Clipper.DistanceFromLineSqrd(r,e,t)<n},d.Clipper.PointsAreClose=function(e,t,r){var n=e.X-t.X;return n*n+(e=e.Y-t.Y)*e<=r},d.Clipper.ExcludeOp=function(e){var t=e.Prev;return t.Next=e.Next,e.Next.Prev=t,t.Idx=0,t},d.Clipper.CleanPolygon=function(e,t){void 0===t&&(t=1.415);var r=e.length;if(0==r)return[];for(var n=Array(r),i=0;i<r;++i)n[i]=new d.OutPt;for(i=0;i<r;++i)n[i].Pt=e[i],n[i].Next=n[(i+1)%r],n[i].Next.Prev=n[i],n[i].Idx=0;for(i=t*t,n=n[0];0==n.Idx&&n.Next!=n.Prev;)d.Clipper.PointsAreClose(n.Pt,n.Prev.Pt,i)?(n=d.Clipper.ExcludeOp(n),r--):d.Clipper.PointsAreClose(n.Prev.Pt,n.Next.Pt,i)?(d.Clipper.ExcludeOp(n.Next),n=d.Clipper.ExcludeOp(n),r-=2):d.Clipper.SlopesNearCollinear(n.Prev.Pt,n.Pt,n.Next.Pt,i)?(n=d.Clipper.ExcludeOp(n),r--):(n.Idx=1,n=n.Next);for(3>r&&(r=0),e=Array(r),i=0;i<r;++i)e[i]=new d.IntPoint(n.Pt),n=n.Next;return e},d.Clipper.CleanPolygons=function(e,t){for(var r=Array(e.length),n=0,i=e.length;n<i;n++)r[n]=d.Clipper.CleanPolygon(e[n],t);return r},d.Clipper.Minkowski=function(e,t,r,n){n=n?1:0;var i=e.length,a=t.length,o=[];if(r)for(r=0;r<a;r++){for(var l=Array(i),s=0,u=e.length,c=e[s];s<u;c=e[++s])l[s]=new d.IntPoint(t[r].X+c.X,t[r].Y+c.Y);o.push(l)}else for(r=0;r<a;r++){for(l=Array(i),s=0,u=e.length,c=e[s];s<u;c=e[++s])l[s]=new d.IntPoint(t[r].X-c.X,t[r].Y-c.Y);o.push(l)}for(e=[],r=0;r<a-1+n;r++)for(s=0;s<i;s++)(t=[]).push(o[r%a][s%i]),t.push(o[(r+1)%a][s%i]),t.push(o[(r+1)%a][(s+1)%i]),t.push(o[r%a][(s+1)%i]),d.Clipper.Orientation(t)||t.reverse(),e.push(t);return e},d.Clipper.MinkowskiSum=function(e,t,r){if(t[0]instanceof Array){o=t,t=new d.Paths;for(var n=new d.Clipper,i=0;i<o.length;++i){var a=d.Clipper.Minkowski(e,o[i],!0,r);n.AddPaths(a,d.PolyType.ptSubject,!0),r&&(a=d.Clipper.TranslatePath(o[i],e[0]),n.AddPath(a,d.PolyType.ptClip,!0))}return n.Execute(d.ClipType.ctUnion,t,d.PolyFillType.pftNonZero,d.PolyFillType.pftNonZero),t}var o=d.Clipper.Minkowski(e,t,!0,r);return(n=new d.Clipper).AddPaths(o,d.PolyType.ptSubject,!0),n.Execute(d.ClipType.ctUnion,o,d.PolyFillType.pftNonZero,d.PolyFillType.pftNonZero),o},d.Clipper.TranslatePath=function(e,t){for(var r=new d.Path,n=0;n<e.length;n++)r.push(new d.IntPoint(e[n].X+t.X,e[n].Y+t.Y));return r},d.Clipper.MinkowskiDiff=function(e,t){return e=d.Clipper.Minkowski(e,t,!1,!0),(t=new d.Clipper).AddPaths(e,d.PolyType.ptSubject,!0),t.Execute(d.ClipType.ctUnion,e,d.PolyFillType.pftNonZero,d.PolyFillType.pftNonZero),e},d.Clipper.PolyTreeToPaths=function(e){var t=[];return d.Clipper.AddPolyNodeToPaths(e,d.Clipper.NodeType.ntAny,t),t},d.Clipper.AddPolyNodeToPaths=function(e,t,r){var n=!0;switch(t){case d.Clipper.NodeType.ntOpen:return;case d.Clipper.NodeType.ntClosed:n=!e.IsOpen}0<e.m_polygon.length&&n&&r.push(e.m_polygon),n=0;for(var i=(e=e.Childs()).length,a=e[n];n<i;a=e[++n])d.Clipper.AddPolyNodeToPaths(a,t,r)},d.Clipper.OpenPathsFromPolyTree=function(e){for(var t=new d.Paths,r=0,n=e.ChildCount();r<n;r++)e.Childs()[r].IsOpen&&t.push(e.Childs()[r].m_polygon);return t},d.Clipper.ClosedPathsFromPolyTree=function(e){var t=new d.Paths;return d.Clipper.AddPolyNodeToPaths(e,d.Clipper.NodeType.ntClosed,t),t},g(d.Clipper,d.ClipperBase),d.Clipper.NodeType={ntAny:0,ntOpen:1,ntClosed:2},d.ClipperOffset=function(e,t){void 0===e&&(e=2),void 0===t&&(t=d.ClipperOffset.def_arc_tolerance),this.m_destPolys=new d.Paths,this.m_srcPoly=new d.Path,this.m_destPoly=new d.Path,this.m_normals=[],this.m_StepsPerRad=this.m_miterLim=this.m_cos=this.m_sin=this.m_sinA=this.m_delta=0,this.m_lowest=new d.IntPoint,this.m_polyNodes=new d.PolyNode,this.MiterLimit=e,this.ArcTolerance=t,this.m_lowest.X=-1},d.ClipperOffset.two_pi=6.28318530717959,d.ClipperOffset.def_arc_tolerance=.25,d.ClipperOffset.prototype.Clear=function(){d.Clear(this.m_polyNodes.Childs()),this.m_lowest.X=-1},d.ClipperOffset.Round=d.Clipper.Round,d.ClipperOffset.prototype.AddPath=function(e,t,r){var n=e.length-1;if(!(0>n)){var i=new d.PolyNode;if(i.m_jointype=t,i.m_endtype=r,r==d.EndType.etClosedLine||r==d.EndType.etClosedPolygon)for(;0<n&&d.IntPoint.op_Equality(e[0],e[n]);)n--;i.m_polygon.push(e[0]);var a=0;t=0;for(var o=1;o<=n;o++)d.IntPoint.op_Inequality(i.m_polygon[a],e[o])&&(a++,i.m_polygon.push(e[o]),e[o].Y>i.m_polygon[t].Y||e[o].Y==i.m_polygon[t].Y&&e[o].X<i.m_polygon[t].X)&&(t=a);r==d.EndType.etClosedPolygon&&2>a||(this.m_polyNodes.AddChild(i),r!=d.EndType.etClosedPolygon)||(0>this.m_lowest.X?this.m_lowest=new d.IntPoint(this.m_polyNodes.ChildCount()-1,t):(e=this.m_polyNodes.Childs()[this.m_lowest.X].m_polygon[this.m_lowest.Y],(i.m_polygon[t].Y>e.Y||i.m_polygon[t].Y==e.Y&&i.m_polygon[t].X<e.X)&&(this.m_lowest=new d.IntPoint(this.m_polyNodes.ChildCount()-1,t))))}},d.ClipperOffset.prototype.AddPaths=function(e,t,r){for(var n=0,i=e.length;n<i;n++)this.AddPath(e[n],t,r)},d.ClipperOffset.prototype.FixOrientations=function(){if(0<=this.m_lowest.X&&!d.Clipper.Orientation(this.m_polyNodes.Childs()[this.m_lowest.X].m_polygon))for(var e=0;e<this.m_polyNodes.ChildCount();e++){var t=this.m_polyNodes.Childs()[e];(t.m_endtype==d.EndType.etClosedPolygon||t.m_endtype==d.EndType.etClosedLine&&d.Clipper.Orientation(t.m_polygon))&&t.m_polygon.reverse()}else for(e=0;e<this.m_polyNodes.ChildCount();e++)(t=this.m_polyNodes.Childs()[e]).m_endtype!=d.EndType.etClosedLine||d.Clipper.Orientation(t.m_polygon)||t.m_polygon.reverse()},d.ClipperOffset.GetUnitNormal=function(e,t){var r=t.X-e.X;return e=t.Y-e.Y,0==r&&0==e?new d.DoublePoint(0,0):(t=1/Math.sqrt(r*r+e*e),new d.DoublePoint(e*t,-r*t))},d.ClipperOffset.prototype.DoOffset=function(e){if(this.m_destPolys=[],this.m_delta=e,d.ClipperBase.near_zero(e))for(var t=0;t<this.m_polyNodes.ChildCount();t++){var r=this.m_polyNodes.Childs()[t];r.m_endtype==d.EndType.etClosedPolygon&&this.m_destPolys.push(r.m_polygon)}else{this.m_miterLim=2<this.MiterLimit?2/(this.MiterLimit*this.MiterLimit):.5;var n=3.14159265358979/Math.acos(1-(0>=this.ArcTolerance?d.ClipperOffset.def_arc_tolerance:this.ArcTolerance>Math.abs(e)*d.ClipperOffset.def_arc_tolerance?Math.abs(e)*d.ClipperOffset.def_arc_tolerance:this.ArcTolerance)/Math.abs(e));for(this.m_sin=Math.sin(d.ClipperOffset.two_pi/n),this.m_cos=Math.cos(d.ClipperOffset.two_pi/n),this.m_StepsPerRad=n/d.ClipperOffset.two_pi,0>e&&(this.m_sin=-this.m_sin),t=0;t<this.m_polyNodes.ChildCount();t++){r=this.m_polyNodes.Childs()[t],this.m_srcPoly=r.m_polygon;var i=this.m_srcPoly.length;if(!(0==i||0>=e&&(3>i||r.m_endtype!=d.EndType.etClosedPolygon))){if(this.m_destPoly=[],1==i)if(r.m_jointype==d.JoinType.jtRound){r=1,i=0;for(var a=1;a<=n;a++){this.m_destPoly.push(new d.IntPoint(d.ClipperOffset.Round(this.m_srcPoly[0].X+r*e),d.ClipperOffset.Round(this.m_srcPoly[0].Y+i*e)));var o=r;r=r*this.m_cos-this.m_sin*i,i=o*this.m_sin+i*this.m_cos}}else for(i=r=-1,a=0;4>a;++a)this.m_destPoly.push(new d.IntPoint(d.ClipperOffset.Round(this.m_srcPoly[0].X+r*e),d.ClipperOffset.Round(this.m_srcPoly[0].Y+i*e))),0>r?r=1:0>i?i=1:r=-1;else{for(a=this.m_normals.length=0;a<i-1;a++)this.m_normals.push(d.ClipperOffset.GetUnitNormal(this.m_srcPoly[a],this.m_srcPoly[a+1]));if(r.m_endtype==d.EndType.etClosedLine||r.m_endtype==d.EndType.etClosedPolygon?this.m_normals.push(d.ClipperOffset.GetUnitNormal(this.m_srcPoly[i-1],this.m_srcPoly[0])):this.m_normals.push(new d.DoublePoint(this.m_normals[i-2])),r.m_endtype==d.EndType.etClosedPolygon)for(o=i-1,a=0;a<i;a++)o=this.OffsetPoint(a,o,r.m_jointype);else if(r.m_endtype==d.EndType.etClosedLine){for(o=i-1,a=0;a<i;a++)o=this.OffsetPoint(a,o,r.m_jointype);for(this.m_destPolys.push(this.m_destPoly),this.m_destPoly=[],o=this.m_normals[i-1],a=i-1;0<a;a--)this.m_normals[a]=new d.DoublePoint(-this.m_normals[a-1].X,-this.m_normals[a-1].Y);for(this.m_normals[0]=new d.DoublePoint(-o.X,-o.Y),o=0,a=i-1;0<=a;a--)o=this.OffsetPoint(a,o,r.m_jointype)}else{for(o=0,a=1;a<i-1;++a)o=this.OffsetPoint(a,o,r.m_jointype);for(r.m_endtype==d.EndType.etOpenButt?(a=i-1,o=new d.IntPoint(d.ClipperOffset.Round(this.m_srcPoly[a].X+this.m_normals[a].X*e),d.ClipperOffset.Round(this.m_srcPoly[a].Y+this.m_normals[a].Y*e)),this.m_destPoly.push(o),o=new d.IntPoint(d.ClipperOffset.Round(this.m_srcPoly[a].X-this.m_normals[a].X*e),d.ClipperOffset.Round(this.m_srcPoly[a].Y-this.m_normals[a].Y*e)),this.m_destPoly.push(o)):(a=i-1,o=i-2,this.m_sinA=0,this.m_normals[a]=new d.DoublePoint(-this.m_normals[a].X,-this.m_normals[a].Y),r.m_endtype==d.EndType.etOpenSquare?this.DoSquare(a,o):this.DoRound(a,o)),a=i-1;0<a;a--)this.m_normals[a]=new d.DoublePoint(-this.m_normals[a-1].X,-this.m_normals[a-1].Y);for(this.m_normals[0]=new d.DoublePoint(-this.m_normals[1].X,-this.m_normals[1].Y),a=(o=i-1)-1;0<a;--a)o=this.OffsetPoint(a,o,r.m_jointype);r.m_endtype==d.EndType.etOpenButt?(o=new d.IntPoint(d.ClipperOffset.Round(this.m_srcPoly[0].X-this.m_normals[0].X*e),d.ClipperOffset.Round(this.m_srcPoly[0].Y-this.m_normals[0].Y*e)),this.m_destPoly.push(o),o=new d.IntPoint(d.ClipperOffset.Round(this.m_srcPoly[0].X+this.m_normals[0].X*e),d.ClipperOffset.Round(this.m_srcPoly[0].Y+this.m_normals[0].Y*e)),this.m_destPoly.push(o)):(this.m_sinA=0,r.m_endtype==d.EndType.etOpenSquare?this.DoSquare(0,1):this.DoRound(0,1))}}this.m_destPolys.push(this.m_destPoly)}}}},d.ClipperOffset.prototype.Execute=function(){var e=arguments;if(e[0]instanceof d.PolyTree)if(t=e[0],r=e[1],t.Clear(),this.FixOrientations(),this.DoOffset(r),(e=new d.Clipper(0)).AddPaths(this.m_destPolys,d.PolyType.ptSubject,!0),0<r)e.Execute(d.ClipType.ctUnion,t,d.PolyFillType.pftPositive,d.PolyFillType.pftPositive);else if(r=d.Clipper.GetBounds(this.m_destPolys),(n=new d.Path).push(new d.IntPoint(r.left-10,r.bottom+10)),n.push(new d.IntPoint(r.right+10,r.bottom+10)),n.push(new d.IntPoint(r.right+10,r.top-10)),n.push(new d.IntPoint(r.left-10,r.top-10)),e.AddPath(n,d.PolyType.ptSubject,!0),e.ReverseSolution=!0,e.Execute(d.ClipType.ctUnion,t,d.PolyFillType.pftNegative,d.PolyFillType.pftNegative),1==t.ChildCount()&&0<t.Childs()[0].ChildCount())for(e=t.Childs()[0],t.Childs()[0]=e.Childs()[0],t.Childs()[0].m_Parent=t,r=1;r<e.ChildCount();r++)t.AddChild(e.Childs()[r]);else t.Clear();else{var t=e[0],r=e[1];if(d.Clear(t),this.FixOrientations(),this.DoOffset(r),(e=new d.Clipper(0)).AddPaths(this.m_destPolys,d.PolyType.ptSubject,!0),0<r)e.Execute(d.ClipType.ctUnion,t,d.PolyFillType.pftPositive,d.PolyFillType.pftPositive);else{r=d.Clipper.GetBounds(this.m_destPolys);var n=new d.Path;n.push(new d.IntPoint(r.left-10,r.bottom+10)),n.push(new d.IntPoint(r.right+10,r.bottom+10)),n.push(new d.IntPoint(r.right+10,r.top-10)),n.push(new d.IntPoint(r.left-10,r.top-10)),e.AddPath(n,d.PolyType.ptSubject,!0),e.ReverseSolution=!0,e.Execute(d.ClipType.ctUnion,t,d.PolyFillType.pftNegative,d.PolyFillType.pftNegative),0<t.length&&t.splice(0,1)}}},d.ClipperOffset.prototype.OffsetPoint=function(e,t,r){if(this.m_sinA=this.m_normals[t].X*this.m_normals[e].Y-this.m_normals[e].X*this.m_normals[t].Y,1>Math.abs(this.m_sinA*this.m_delta)){if(0<this.m_normals[t].X*this.m_normals[e].X+this.m_normals[e].Y*this.m_normals[t].Y)return this.m_destPoly.push(new d.IntPoint(d.ClipperOffset.Round(this.m_srcPoly[e].X+this.m_normals[t].X*this.m_delta),d.ClipperOffset.Round(this.m_srcPoly[e].Y+this.m_normals[t].Y*this.m_delta))),t}else 1<this.m_sinA?this.m_sinA=1:-1>this.m_sinA&&(this.m_sinA=-1);if(0>this.m_sinA*this.m_delta)this.m_destPoly.push(new d.IntPoint(d.ClipperOffset.Round(this.m_srcPoly[e].X+this.m_normals[t].X*this.m_delta),d.ClipperOffset.Round(this.m_srcPoly[e].Y+this.m_normals[t].Y*this.m_delta))),this.m_destPoly.push(new d.IntPoint(this.m_srcPoly[e])),this.m_destPoly.push(new d.IntPoint(d.ClipperOffset.Round(this.m_srcPoly[e].X+this.m_normals[e].X*this.m_delta),d.ClipperOffset.Round(this.m_srcPoly[e].Y+this.m_normals[e].Y*this.m_delta)));else switch(r){case d.JoinType.jtMiter:(r=this.m_normals[e].X*this.m_normals[t].X+this.m_normals[e].Y*this.m_normals[t].Y+1)>=this.m_miterLim?this.DoMiter(e,t,r):this.DoSquare(e,t);break;case d.JoinType.jtSquare:this.DoSquare(e,t);break;case d.JoinType.jtRound:this.DoRound(e,t)}return e},d.ClipperOffset.prototype.DoSquare=function(e,t){var r=Math.tan(Math.atan2(this.m_sinA,this.m_normals[t].X*this.m_normals[e].X+this.m_normals[t].Y*this.m_normals[e].Y)/4);this.m_destPoly.push(new d.IntPoint(d.ClipperOffset.Round(this.m_srcPoly[e].X+this.m_delta*(this.m_normals[t].X-this.m_normals[t].Y*r)),d.ClipperOffset.Round(this.m_srcPoly[e].Y+this.m_delta*(this.m_normals[t].Y+this.m_normals[t].X*r)))),this.m_destPoly.push(new d.IntPoint(d.ClipperOffset.Round(this.m_srcPoly[e].X+this.m_delta*(this.m_normals[e].X+this.m_normals[e].Y*r)),d.ClipperOffset.Round(this.m_srcPoly[e].Y+this.m_delta*(this.m_normals[e].Y-this.m_normals[e].X*r))))},d.ClipperOffset.prototype.DoMiter=function(e,t,r){r=this.m_delta/r,this.m_destPoly.push(new d.IntPoint(d.ClipperOffset.Round(this.m_srcPoly[e].X+(this.m_normals[t].X+this.m_normals[e].X)*r),d.ClipperOffset.Round(this.m_srcPoly[e].Y+(this.m_normals[t].Y+this.m_normals[e].Y)*r)))},d.ClipperOffset.prototype.DoRound=function(e,t){var r=Math.max(d.Cast_Int32(d.ClipperOffset.Round(this.m_StepsPerRad*Math.abs(Math.atan2(this.m_sinA,this.m_normals[t].X*this.m_normals[e].X+this.m_normals[t].Y*this.m_normals[e].Y)))),1),n=this.m_normals[t].X;t=this.m_normals[t].Y;for(var i,a=0;a<r;++a)this.m_destPoly.push(new d.IntPoint(d.ClipperOffset.Round(this.m_srcPoly[e].X+n*this.m_delta),d.ClipperOffset.Round(this.m_srcPoly[e].Y+t*this.m_delta))),i=n,n=n*this.m_cos-this.m_sin*t,t=i*this.m_sin+t*this.m_cos;this.m_destPoly.push(new d.IntPoint(d.ClipperOffset.Round(this.m_srcPoly[e].X+this.m_normals[e].X*this.m_delta),d.ClipperOffset.Round(this.m_srcPoly[e].Y+this.m_normals[e].Y*this.m_delta)))},d.Error=function(e){try{throw Error(e)}catch(e){alert(e.message)}},d.JS={},d.JS.AreaOfPolygon=function(e,t){return t||(t=1),d.Clipper.Area(e)/(t*t)},d.JS.AreaOfPolygons=function(e,t){t||(t=1);for(var r=0,n=0;n<e.length;n++)r+=d.Clipper.Area(e[n]);return r/(t*t)},d.JS.BoundsOfPath=function(e,t){return d.JS.BoundsOfPaths([e],t)},d.JS.BoundsOfPaths=function(e,t){return t||(t=1),(e=d.Clipper.GetBounds(e)).left/=t,e.bottom/=t,e.right/=t,e.top/=t,e},d.JS.Clean=function(e,t){if(!(e instanceof Array))return[];var r=e[0]instanceof Array;if(e=d.JS.Clone(e),"number"!=typeof t||null===t)return d.Error("Delta is not a number in Clean()."),e;if(0===e.length||1==e.length&&0===e[0].length||0>t)return e;r||(e=[e]);for(var n,i,a,o,l,s,u,c=e.length,p=[],f=0;f<c;f++)if(0!==(n=(i=e[f]).length))if(3>n)a=i,p.push(a);else{for(a=i,o=t*t,l=i[0],u=s=1;u<n;u++)(i[u].X-l.X)*(i[u].X-l.X)+(i[u].Y-l.Y)*(i[u].Y-l.Y)<=o||(a[s]=i[u],l=i[u],s++);l=i[s-1],(i[0].X-l.X)*(i[0].X-l.X)+(i[0].Y-l.Y)*(i[0].Y-l.Y)<=o&&s--,s<n&&a.splice(s,n-s),a.length&&p.push(a)}return!r&&p.length?p=p[0]:r||0!==p.length?r&&0===p.length&&(p=[[]]):p=[],p},d.JS.Clone=function(e){if(!(e instanceof Array)||0===e.length)return[];if(1==e.length&&0===e[0].length)return[[]];var t=e[0]instanceof Array;t||(e=[e]);var r,n,i=e.length,a=Array(i);for(r=0;r<i;r++){var o=e[r].length,l=Array(o);for(n=0;n<o;n++)l[n]={X:e[r][n].X,Y:e[r][n].Y};a[r]=l}return t||(a=a[0]),a},d.JS.Lighten=function(e,t){if(!(e instanceof Array))return[];if("number"!=typeof t||null===t)return d.Error("Tolerance is not a number in Lighten()."),d.JS.Clone(e);if(0===e.length||1==e.length&&0===e[0].length||0>t)return d.JS.Clone(e);e[0]instanceof Array||(e=[e]);var r,n,i,a,o,l=e.length,s=t*t,u=[];for(t=0;t<l;t++)if(0!=(a=(n=e[t]).length)){for(i=0;1e6>i;i++){var c=[];n[(a=n.length)-1].X!=n[0].X||n[a-1].Y!=n[0].Y?(o=1,n.push({X:n[0].X,Y:n[0].Y}),a=n.length):o=0;var p=[];for(r=0;r<a-2;r++){var f=n[r],h=n[r+1],v=n[r+2],m=f.X,g=f.Y;f=v.X-m;var y=v.Y-g;if(0!==f||0!==y){var b=((h.X-m)*f+(h.Y-g)*y)/(f*f+y*y);1<b?(m=v.X,g=v.Y):0<b&&(m+=f*b,g+=y*b)}(v=(f=h.X-m)*f+(y=h.Y-g)*y)<=s&&(p[r+1]=1,r++)}for(c.push({X:n[0].X,Y:n[0].Y}),r=1;r<a-1;r++)p[r]||c.push({X:n[r].X,Y:n[r].Y});if(c.push({X:n[a-1].X,Y:n[a-1].Y}),o&&n.pop(),!p.length)break;n=c}c[(a=c.length)-1].X==c[0].X&&c[a-1].Y==c[0].Y&&c.pop(),2<c.length&&u.push(c)}return e[0]instanceof Array||(u=u[0]),void 0===u&&(u=[[]]),u},d.JS.PerimeterOfPath=function(e,t,r){if(void 0===e)return 0;var n=Math.sqrt,i=0,a=e.length;if(2>a)return 0;for(t&&(e[a]=e[0],a++);--a;){var o=e[a],l=o.X;o=o.Y;var s=e[a-1],u=s.X;i+=n((l-u)*(l-u)+(o-(s=s.Y))*(o-s))}return t&&e.pop(),i/r},d.JS.PerimeterOfPaths=function(e,t,r){r||(r=1);for(var n=0,i=0;i<e.length;i++)n+=d.JS.PerimeterOfPath(e[i],t,r);return n},d.JS.ScaleDownPath=function(e,t){var r;for(t||(t=1),r=e.length;r--;){var n=e[r];n.X/=t,n.Y/=t}},d.JS.ScaleDownPaths=function(e,t){var r,n;for(t||(t=1),r=e.length;r--;)for(n=e[r].length;n--;){var i=e[r][n];i.X/=t,i.Y/=t}},d.JS.ScaleUpPath=function(e,t){var r,n=Math.round;for(t||(t=1),r=e.length;r--;){var i=e[r];i.X=n(i.X*t),i.Y=n(i.Y*t)}},d.JS.ScaleUpPaths=function(e,t){var r,n,i=Math.round;for(t||(t=1),r=e.length;r--;)for(n=e[r].length;n--;){var a=e[r][n];a.X=i(a.X*t),a.Y=i(a.Y*t)}},d.ExPolygons=function(){return[]},d.ExPolygon=function(){this.holes=this.outer=null},d.JS.AddOuterPolyNodeToExPolygons=function(e,t){var r=new d.ExPolygon;r.outer=e.Contour();var n,i,a=(e=e.Childs()).length;for(r.holes=Array(a),n=0;n<a;n++){var o=e[n];r.holes[n]=o.Contour();var l=0,s=o.Childs();for(i=s.length;l<i;l++)o=s[l],d.JS.AddOuterPolyNodeToExPolygons(o,t)}t.push(r)},d.JS.ExPolygonsToPaths=function(e){var t,r,n=new d.Paths,i=0;for(t=e.length;i<t;i++){n.push(e[i].outer);var a=0;for(r=e[i].holes.length;a<r;a++)n.push(e[i].holes[a])}return n},d.JS.PolyTreeToExPolygons=function(e){var t,r=new d.ExPolygons,n=0,i=e.Childs();for(t=i.length;n<t;n++)e=i[n],d.JS.AddOuterPolyNodeToExPolygons(e,r);return r}}(),s=function(){var e=Function.call.bind(Function.apply),t=Function.call.bind(Function.call),n=Array.isArray,i=Object.keys,a=function(e){try{return e(),!1}catch(e){return!0}},l=function(e){try{return e()}catch(e){return!1}},s=function(t){return function(){return!e(t,this,arguments)}}(a),u=function(){return!a((function(){return Object.defineProperty({},"x",{get:function(){}})}))},c=!!Object.defineProperty&&u(),p="foo"===function(){}.name,f=Function.call.bind(Array.prototype.forEach),h=Function.call.bind(Array.prototype.reduce),v=Function.call.bind(Array.prototype.filter),d=Function.call.bind(Array.prototype.some),m=function(e,t,r,n){!n&&t in e||(c?Object.defineProperty(e,t,{configurable:!0,enumerable:!1,writable:!0,value:r}):e[t]=r)},g=function(e,t,r){f(i(t),(function(n){m(e,n,t[n],!!r)}))},y=Function.call.bind(Object.prototype.toString),b="function"==typeof/abc/?function(e){return"function"==typeof e&&"[object Function]"===y(e)}:function(e){return"function"==typeof e},x={getter:function(e,t,r){if(!c)throw new TypeError("getters require true ES5 support");Object.defineProperty(e,t,{configurable:!0,enumerable:!1,get:r})},proxy:function(e,t,r){if(!c)throw new TypeError("getters require true ES5 support");var n=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(r,t,{configurable:n.configurable,enumerable:n.enumerable,get:function(){return e[t]},set:function(r){e[t]=r}})},redefine:function(e,t,r){if(c){var n=Object.getOwnPropertyDescriptor(e,t);n.value=r,Object.defineProperty(e,t,n)}else e[t]=r},defineByDescriptor:function(e,t,r){c?Object.defineProperty(e,t,r):"value"in r&&(e[t]=r.value)},preserveToString:function(e,t){t&&b(t.toString)&&m(e,"toString",t.toString.bind(t),!0)}},P=Object.create||function(e,t){var r=function(){};r.prototype=e;var n=new r;return void 0!==t&&i(t).forEach((function(e){x.defineByDescriptor(n,e,t[e])})),n},C=function(e,t){return!!Object.setPrototypeOf&&l((function(){var r=function t(r){return r=new e(r),Object.setPrototypeOf(r,t.prototype),r};return Object.setPrototypeOf(r,e),r.prototype=P(e.prototype,{constructor:{value:r}}),t(r)}))},_=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==r)return r;throw Error("unable to locate global object")}(),w=_.isFinite,S=Function.call.bind(String.prototype.indexOf),T=Function.apply.bind(Array.prototype.indexOf),M=Function.call.bind(Array.prototype.concat),I=Function.call.bind(String.prototype.slice),L=Function.call.bind(Array.prototype.push),E=Function.apply.bind(Array.prototype.push),O=Function.call.bind(Array.prototype.shift),A=Math.max,N=Math.min,k=Math.floor,R=Math.abs,z=Math.exp,j=Math.log,D=Math.sqrt,F=Function.call.bind(Object.prototype.hasOwnProperty),B=function(){},X=_.Map,$=X&&X.prototype.delete,Y=X&&X.prototype.get,q=X&&X.prototype.has,U=X&&X.prototype.set,V=_.Symbol||{},W=V.species||"@@species",G=Number.isNaN||function(e){return e!=e},H=Number.isFinite||function(e){return"number"==typeof e&&w(e)},J=b(Math.sign)?Math.sign:function(e){return 0===(e=Number(e))||G(e)?e:0>e?-1:1},Z=function(e){return-1>(e=Number(e))||G(e)?NaN:0===e||1/0===e?e:-1===e?-1/0:0==1+e-1?e:e*(j(1+e)/(1+e-1))},K=function(e){return"[object Arguments]"===y(e)},Q=function(e){return null!==e&&"object"==typeof e&&"number"==typeof e.length&&0<=e.length&&"[object Array]"!==y(e)&&"[object Function]"===y(e.callee)},ee=K(arguments)?K:Q,te={primitive:function(e){return null===e||"function"!=typeof e&&"object"!=typeof e},string:function(e){return"[object String]"===y(e)},regex:function(e){return"[object RegExp]"===y(e)},symbol:function(e){return"function"==typeof _.Symbol&&"symbol"==typeof e}},re=function(e,t,r){var n=e[t];m(e,t,r,!0),x.preserveToString(e[t],n)},ne="function"==typeof V&&"function"==typeof V.for&&te.symbol(V()),ie=te.symbol(V.iterator)?V.iterator:"_es6-shim iterator_";_.Set&&"function"==typeof(new _.Set)["@@iterator"]&&(ie="@@iterator"),_.Reflect||m(_,"Reflect",{},!0);var ae=_.Reflect,oe=String,le="undefined"!=typeof document&&document?document.all:null,se=null==le?function(e){return null==e}:function(e){return null==e&&e!==le},ue={Call:function(t,r){var n=2<arguments.length?arguments[2]:[];if(!ue.IsCallable(t))throw new TypeError(t+" is not a function");return e(t,r,n)},RequireObjectCoercible:function(e,t){if(se(e))throw new TypeError(t||"Cannot call method on "+e);return e},TypeIsObject:function(e){return null!=e&&!0!==e&&!1!==e&&("function"==typeof e||"object"==typeof e||e===le)},ToObject:function(e,t){return Object(ue.RequireObjectCoercible(e,t))},IsCallable:b,IsConstructor:function(e){return ue.IsCallable(e)},ToInt32:function(e){return ue.ToNumber(e)>>0},ToUint32:function(e){return ue.ToNumber(e)>>>0},ToNumber:function(e){if("[object Symbol]"===y(e))throw new TypeError("Cannot convert a Symbol value to a number");return+e},ToInteger:function(e){return e=ue.ToNumber(e),G(e)?0:0!==e&&H(e)?(0<e?1:-1)*k(R(e)):e},ToLength:function(e){return 0>=(e=ue.ToInteger(e))?0:e>Number.MAX_SAFE_INTEGER?Number.MAX_SAFE_INTEGER:e},SameValue:function(e,t){return e===t?0!==e||1/e==1/t:G(e)&&G(t)},SameValueZero:function(e,t){return e===t||G(e)&&G(t)},IsIterable:function(e){return ue.TypeIsObject(e)&&(void 0!==e[ie]||ee(e))},GetIterator:function(e){if(ee(e))return new Be(e,"value");var t=ue.GetMethod(e,ie);if(!ue.IsCallable(t))throw new TypeError("value is not an iterable");if(e=ue.Call(t,e),!ue.TypeIsObject(e))throw new TypeError("bad iterator");return e},GetMethod:function(e,t){if(e=ue.ToObject(e)[t],!se(e)){if(!ue.IsCallable(e))throw new TypeError("Method not callable: "+t);return e}},IteratorComplete:function(e){return!!e.done},IteratorClose:function(e,t){var r=ue.GetMethod(e,"return");if(void 0!==r){try{var n=ue.Call(r,e)}catch(e){var i=e}if(!t){if(i)throw i;if(!ue.TypeIsObject(n))throw new TypeError("Iterator's return method returned a non-object.")}}},IteratorNext:function(e){var t=1<arguments.length?e.next(arguments[1]):e.next();if(!ue.TypeIsObject(t))throw new TypeError("bad iterator");return t},IteratorStep:function(e){return e=ue.IteratorNext(e),!ue.IteratorComplete(e)&&e},Construct:function(e,t,r,n){return r=void 0===r?e:r,!n&&ae.construct?ae.construct(e,t,r):(n=r.prototype,ue.TypeIsObject(n)||(n=Object.prototype),n=P(n),e=ue.Call(e,n,t),ue.TypeIsObject(e)?e:n)},SpeciesConstructor:function(e,t){if(void 0===(e=e.constructor))return t;if(!ue.TypeIsObject(e))throw new TypeError("Bad constructor");if(e=e[W],se(e))return t;if(!ue.IsConstructor(e))throw new TypeError("Bad @@species");return e},CreateHTML:function(e,t,r,n){e=ue.ToString(e);var i="<"+t;return""!==r&&(i+=" "+r+'="'+(n=ue.ToString(n).replace(/"/g,"&quot;"))+'"'),i+">"+e+"</"+t+">"},IsRegExp:function(e){if(!ue.TypeIsObject(e))return!1;var t=e[V.match];return void 0!==t?!!t:te.regex(e)},ToString:function(e){return oe(e)}};if(c&&ne){var ce=function(e){if(te.symbol(V[e]))return V[e];var t=V.for("Symbol."+e);return Object.defineProperty(V,e,{configurable:!1,enumerable:!1,writable:!1,value:t}),t};if(!te.symbol(V.search)){var pe=ce("search"),fe=String.prototype.search;m(RegExp.prototype,pe,(function(e){return ue.Call(fe,e,[this])})),re(String.prototype,"search",(function(e){var t=ue.RequireObjectCoercible(this);if(!se(e)){var r=ue.GetMethod(e,pe);if(void 0!==r)return ue.Call(r,e,[t])}return ue.Call(fe,t,[ue.ToString(e)])}))}if(!te.symbol(V.replace)){var he=ce("replace"),ve=String.prototype.replace;m(RegExp.prototype,he,(function(e,t){return ue.Call(ve,e,[this,t])})),re(String.prototype,"replace",(function(e,t){var r=ue.RequireObjectCoercible(this);if(!se(e)){var n=ue.GetMethod(e,he);if(void 0!==n)return ue.Call(n,e,[r,t])}return ue.Call(ve,r,[ue.ToString(e),t])}))}if(!te.symbol(V.split)){var de=ce("split"),me=String.prototype.split;m(RegExp.prototype,de,(function(e,t){return ue.Call(me,e,[this,t])})),re(String.prototype,"split",(function(e,t){var r=ue.RequireObjectCoercible(this);if(!se(e)){var n=ue.GetMethod(e,de);if(void 0!==n)return ue.Call(n,e,[r,t])}return ue.Call(me,r,[ue.ToString(e),t])}))}var ge=te.symbol(V.match),ye=ge&&function(){var e={};return e[V.match]=function(){return 42},42!=="a".match(e)}();if(!ge||ye){var be=ce("match"),xe=String.prototype.match;m(RegExp.prototype,be,(function(e){return ue.Call(xe,e,[this])})),re(String.prototype,"match",(function(e){var t=ue.RequireObjectCoercible(this);if(!se(e)){var r=ue.GetMethod(e,be);if(void 0!==r)return ue.Call(r,e,[t])}return ue.Call(xe,t,[ue.ToString(e)])}))}}var Pe=function(e,t,r){x.preserveToString(t,e),Object.setPrototypeOf&&Object.setPrototypeOf(e,t),c?f(Object.getOwnPropertyNames(e),(function(n){n in B||r[n]||x.proxy(e,n,t)})):f(Object.keys(e),(function(n){n in B||r[n]||(t[n]=e[n])})),t.prototype=e.prototype,x.redefine(e.prototype,"constructor",t)},Ce=function(){return this},_e=function(e){c&&!F(e,W)&&x.getter(e,W,Ce)},we=function(e,t){m(e,ie,t=t||function(){return this}),!e[ie]&&te.symbol(ie)&&(e[ie]=t)},Se=function(e,t,r){if(c?Object.defineProperty(e,t,{configurable:!0,enumerable:!0,writable:!0,value:r}):e[t]=r,!ue.SameValue(e[t],r))throw new TypeError("property is nonconfigurable")},Te=function(e,t,r,n){if(!ue.TypeIsObject(e))throw new TypeError("Constructor requires `new`: "+t.name);for(var i in e=t.prototype,ue.TypeIsObject(e)||(e=r),r=P(e),n)F(n,i)&&m(r,i,n[i],!0);return r};if(String.fromCodePoint&&1!==String.fromCodePoint.length){var Me=String.fromCodePoint;re(String,"fromCodePoint",(function(e){return ue.Call(Me,this,arguments)}))}var Ie={fromCodePoint:function(e){for(var t,r=[],n=0,i=arguments.length;n<i;n++){if(t=Number(arguments[n]),!ue.SameValue(t,ue.ToInteger(t))||0>t||1114111<t)throw new RangeError("Invalid code point "+t);65536>t?L(r,String.fromCharCode(t)):(t-=65536,L(r,String.fromCharCode(55296+(t>>10))),L(r,String.fromCharCode(t%1024+56320)))}return r.join("")},raw:function(e){var t=ue.ToObject(e,"bad callSite");t=ue.ToObject(t.raw,"bad raw value");var r=ue.ToLength(t.length);if(0>=r)return"";for(var n,i=[],a=0;a<r&&(n=ue.ToString(a),n=ue.ToString(t[n]),L(i,n),!(a+1>=r));)n=a+1<arguments.length?arguments[a+1]:"",n=ue.ToString(n),L(i,n),a+=1;return i.join("")}};String.raw&&"xy"!==String.raw({raw:{0:"x",1:"y",length:2}})&&re(String,"raw",Ie.raw),g(String,Ie);var Le=function e(t,r){return 1>r?"":r%2?e(t,r-1)+t:(t=e(t,r/2))+t},Ee={repeat:function(e){var t=ue.ToString(ue.RequireObjectCoercible(this));if(0>(e=ue.ToInteger(e))||1/0<=e)throw new RangeError("repeat count must be less than infinity and not overflow maximum string size");return Le(t,e)},startsWith:function(e){var t=ue.ToString(ue.RequireObjectCoercible(this));if(ue.IsRegExp(e))throw new TypeError('Cannot call method "startsWith" with a regex');var r,n=ue.ToString(e);return 1<arguments.length&&(r=arguments[1]),r=A(ue.ToInteger(r),0),I(t,r,r+n.length)===n},endsWith:function(e){var t=ue.ToString(ue.RequireObjectCoercible(this));if(ue.IsRegExp(e))throw new TypeError('Cannot call method "endsWith" with a regex');var r,n=ue.ToString(e),i=t.length;return 1<arguments.length&&(r=arguments[1]),r=void 0===r?i:ue.ToInteger(r),i=N(A(r,0),i),I(t,i-n.length,i)===n},includes:function(e){if(ue.IsRegExp(e))throw new TypeError('"includes" does not accept a RegExp');var t,r=ue.ToString(e);return 1<arguments.length&&(t=arguments[1]),-1!==S(this,r,t)},codePointAt:function(e){var t=ue.ToString(ue.RequireObjectCoercible(this)),r=ue.ToInteger(e),n=t.length;if(0<=r&&r<n)return 55296>(e=t.charCodeAt(r))||56319<e||r+1===n||56320>(t=t.charCodeAt(r+1))||57343<t?e:1024*(e-55296)+(t-56320)+65536}};if(String.prototype.includes&&!1!=="a".includes("a",1/0)&&re(String.prototype,"includes",Ee.includes),String.prototype.startsWith&&String.prototype.endsWith){var Oe=a((function(){return"/a/".startsWith(/a/)})),Ae=l((function(){return!1==="abc".startsWith("a",1/0)}));Oe&&Ae||(re(String.prototype,"startsWith",Ee.startsWith),re(String.prototype,"endsWith",Ee.endsWith))}ne&&(l((function(){var e=/a/;return e[V.match]=!1,"/a/".startsWith(e)}))||re(String.prototype,"startsWith",Ee.startsWith),l((function(){var e=/a/;return e[V.match]=!1,"/a/".endsWith(e)}))||re(String.prototype,"endsWith",Ee.endsWith),l((function(){var e=/a/;return e[V.match]=!1,"/a/".includes(e)}))||re(String.prototype,"includes",Ee.includes)),g(String.prototype,Ee);var Ne=/(^[\t\n\x0B\f\r \u00a0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff]+)|([\t\n\x0B\f\r \u00a0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff]+$)/g,ke=function(){return ue.ToString(ue.RequireObjectCoercible(this)).replace(Ne,"")},Re=/[\u0085\u200b\ufffe]/g,ze=/^[-+]0x[0-9a-f]+$/i;m(String.prototype,"trim",ke,!0);var je=function(e){return{value:e,done:0===arguments.length}},De=function(e){ue.RequireObjectCoercible(e),this._s=ue.ToString(e),this._i=0};De.prototype.next=function(){var e=this._s,t=this._i;if(void 0===e||t>=e.length)return this._s=void 0,je();var r=e.charCodeAt(t);return r=55296>r||56319<r||t+1===e.length||56320>(r=e.charCodeAt(t+1))||57343<r?1:2,this._i=t+r,je(e.substr(t,r))},we(De.prototype),we(String.prototype,(function(){return new De(this)}));var Fe={from:function(e){var r,n,i;if(1<arguments.length&&(r=arguments[1]),void 0===r)var a=!1;else{if(!ue.IsCallable(r))throw new TypeError("Array.from: when provided, the second argument must be a function");2<arguments.length&&(n=arguments[2]),a=!0}if(void 0!==(ee(e)||ue.GetMethod(e,ie))){var o=ue.IsConstructor(this)?Object(new this):[],l=ue.GetIterator(e);for(i=0;;){var s=ue.IteratorStep(l);if(!1===s)break;s=s.value;try{a&&(s=void 0===n?r(s,i):t(r,n,s,i)),o[i]=s}catch(e){throw ue.IteratorClose(l,!0),e}i+=1}l=i}else for(s=ue.ToObject(e),l=ue.ToLength(s.length),o=ue.IsConstructor(this)?Object(new this(l)):Array(l),i=0;i<l;++i){var u=s[i];a&&(u=void 0===n?r(u,i):t(r,n,u,i)),Se(o,i,u)}return o.length=l,o},of:function(){for(var e=arguments.length,t=n(this)||!ue.IsCallable(this)?Array(e):ue.Construct(this,[e]),r=0;r<e;++r)Se(t,r,arguments[r]);return t.length=e,t}};g(Array,Fe),_e(Array);var Be=function(e,t){this.i=0,this.array=e,this.kind=t};g(Be.prototype,{next:function(){var e=this.i,t=this.array;if(!(this instanceof Be))throw new TypeError("Not an ArrayIterator");if(void 0!==t)for(var r=ue.ToLength(t.length);e<r;){var n;return"key"===(r=this.kind)?n=e:"value"===r?n=t[e]:"entry"===r&&(n=[e,t[e]]),this.i=e+1,je(n)}return this.array=void 0,je()}}),we(Be.prototype),Array.of===Fe.of||function(){var e=function(e){this.length=e};e.prototype=[];var t=Array.of.apply(e,[1,2]);return t instanceof e&&2===t.length}()||re(Array,"of",Fe.of);var Xe={copyWithin:function(e,t){var r,n=ue.ToObject(this),i=ue.ToLength(n.length),a=ue.ToInteger(e),o=ue.ToInteger(t);for(a=0>a?A(i+a,0):N(a,i),o=0>o?A(i+o,0):N(o,i),2<arguments.length&&(r=arguments[2]),r=0>(r=void 0===r?i:ue.ToInteger(r))?A(i+r,0):N(r,i),i=N(r-o,i-a),r=1,o<a&&a<o+i&&(r=-1,o+=i-1,a+=i-1);0<i;)o in n?n[a]=n[o]:delete n[a],o+=r,a+=r,--i;return n},fill:function(e){var t,r;1<arguments.length&&(t=arguments[1]),2<arguments.length&&(r=arguments[2]);var n=ue.ToObject(this),i=ue.ToLength(n.length);for(t=ue.ToInteger(void 0===t?0:t),r=ue.ToInteger(void 0===r?i:r),t=0>t?A(i+t,0):N(t,i),r=0>r?i+r:r;t<i&&t<r;++t)n[t]=e;return n},find:function(e){var r=ue.ToObject(this),n=ue.ToLength(r.length);if(!ue.IsCallable(e))throw new TypeError("Array#find: predicate must be a function");for(var i,a=1<arguments.length?arguments[1]:null,o=0;o<n;o++)if(i=r[o],a){if(t(e,a,i,o,r))return i}else if(e(i,o,r))return i},findIndex:function(e){var r=ue.ToObject(this),n=ue.ToLength(r.length);if(!ue.IsCallable(e))throw new TypeError("Array#findIndex: predicate must be a function");for(var i=1<arguments.length?arguments[1]:null,a=0;a<n;a++)if(i){if(t(e,i,r[a],a,r))return a}else if(e(r[a],a,r))return a;return-1},keys:function(){return new Be(this,"key")},values:function(){return new Be(this,"value")},entries:function(){return new Be(this,"entry")}};if(Array.prototype.keys&&!ue.IsCallable([1].keys().next)&&delete Array.prototype.keys,Array.prototype.entries&&!ue.IsCallable([1].entries().next)&&delete Array.prototype.entries,Array.prototype.keys&&Array.prototype.entries&&!Array.prototype.values&&Array.prototype[ie]&&(g(Array.prototype,{values:Array.prototype[ie]}),te.symbol(V.unscopables)&&(Array.prototype[V.unscopables].values=!0)),p&&Array.prototype.values&&"values"!==Array.prototype.values.name){var $e=Array.prototype.values;re(Array.prototype,"values",(function(){return ue.Call($e,this,arguments)})),m(Array.prototype,ie,Array.prototype.values,!0)}g(Array.prototype,Xe),0>1/[!0].indexOf(!0,-0)&&m(Array.prototype,"indexOf",(function(e){var t=T(this,arguments);return 0===t&&0>1/t?0:t}),!0),we(Array.prototype,(function(){return this.values()})),Object.getPrototypeOf&&we(Object.getPrototypeOf([].values()));var Ye=l((function(){return 0===Array.from({length:-1}).length})),qe=function(){var e=Array.from([0].entries());return 1===e.length&&n(e[0])&&0===e[0][0]&&0===e[0][1]}();if(Ye&&qe||re(Array,"from",Fe.from),!l((function(){return Array.from([0],void 0)}))){var Ue=Array.from;re(Array,"from",(function(e){return 1<arguments.length&&void 0!==arguments[1]?ue.Call(Ue,this,arguments):t(Ue,this,e)}))}var Ve=-(Math.pow(2,32)-1),We=function(e,r){var n={length:Ve};return n[r?(n.length>>>0)-1:0]=!0,l((function(){return t(e,n,(function(){throw new RangeError("should not reach here")}),[]),!0}))};if(!We(Array.prototype.forEach)){var Ge=Array.prototype.forEach;re(Array.prototype,"forEach",(function(e){return ue.Call(Ge,0<=this.length?this:[],arguments)}),!0)}if(!We(Array.prototype.map)){var He=Array.prototype.map;re(Array.prototype,"map",(function(e){return ue.Call(He,0<=this.length?this:[],arguments)}),!0)}if(!We(Array.prototype.filter)){var Je=Array.prototype.filter;re(Array.prototype,"filter",(function(e){return ue.Call(Je,0<=this.length?this:[],arguments)}),!0)}if(!We(Array.prototype.some)){var Ze=Array.prototype.some;re(Array.prototype,"some",(function(e){return ue.Call(Ze,0<=this.length?this:[],arguments)}),!0)}if(!We(Array.prototype.every)){var Ke=Array.prototype.every;re(Array.prototype,"every",(function(e){return ue.Call(Ke,0<=this.length?this:[],arguments)}),!0)}if(!We(Array.prototype.reduce)){var Qe=Array.prototype.reduce;re(Array.prototype,"reduce",(function(e){return ue.Call(Qe,0<=this.length?this:[],arguments)}),!0)}if(!We(Array.prototype.reduceRight,!0)){var et=Array.prototype.reduceRight;re(Array.prototype,"reduceRight",(function(e){return ue.Call(et,0<=this.length?this:[],arguments)}),!0)}var tt=8!==Number("0o10"),rt=2!==Number("0b10"),nt=d("​￾",(function(e){return 0===Number(e+0+e)}));if(tt||rt||nt){var it=Number,at=/^0b[01]+$/i,ot=/^0o[0-7]+$/i,lt=at.test.bind(at),st=ot.test.bind(ot),ut=function(e){if("function"==typeof e.valueOf){var t=e.valueOf();if(te.primitive(t))return t}if("function"==typeof e.toString&&(t=e.toString(),te.primitive(t)))return t;throw new TypeError("No default value")},ct=Re.test.bind(Re),pt=ze.test.bind(ze),ft=function(){var e=function(t){var r=0<arguments.length?te.primitive(t)?t:ut(t,"number"):0;"string"==typeof r&&(r=ue.Call(ke,r),lt(r)?r=parseInt(I(r,2),2):st(r)?r=parseInt(I(r,2),8):(ct(r)||pt(r))&&(r=NaN));var n=this,i=l((function(){return it.prototype.valueOf.call(n),!0}));return n instanceof e&&!i?new it(r):it(r)};return e}();Pe(it,ft,{}),g(ft,{NaN:it.NaN,MAX_VALUE:it.MAX_VALUE,MIN_VALUE:it.MIN_VALUE,NEGATIVE_INFINITY:it.NEGATIVE_INFINITY,POSITIVE_INFINITY:it.POSITIVE_INFINITY}),Number=ft,x.redefine(_,"Number",ft)}var ht=Math.pow(2,53)-1;g(Number,{MAX_SAFE_INTEGER:ht,MIN_SAFE_INTEGER:-ht,EPSILON:2220446049250313e-31,parseInt:_.parseInt,parseFloat:_.parseFloat,isFinite:H,isInteger:function(e){return H(e)&&ue.ToInteger(e)===e},isSafeInteger:function(e){return Number.isInteger(e)&&R(e)<=Number.MAX_SAFE_INTEGER},isNaN:G}),m(Number,"parseInt",_.parseInt,Number.parseInt!==_.parseInt),1===[,1].find((function(){return!0}))&&re(Array.prototype,"find",Xe.find),0!==[,1].findIndex((function(){return!0}))&&re(Array.prototype,"findIndex",Xe.findIndex);var vt=Function.bind.call(Function.bind,Object.prototype.propertyIsEnumerable),dt=function(e,t){c&&vt(e,t)&&Object.defineProperty(e,t,{enumerable:!1})},mt=function(){var e=Number(this),t=arguments.length,r=t-e;r=Array(0>r?0:r);for(var n=e;n<t;++n)r[n-e]=arguments[n];return r},gt=function(e){return function(t,r){return t[r]=e[r],t}},yt=function(e,t){var r,n=i(Object(t));return ue.IsCallable(Object.getOwnPropertySymbols)&&(r=v(Object.getOwnPropertySymbols(Object(t)),vt(t))),h(M(n,r||[]),gt(t),e)},bt={assign:function(e,t){var r=ue.ToObject(e,"Cannot convert undefined or null to object");return h(ue.Call(mt,1,arguments),yt,r)},is:function(e,t){return ue.SameValue(e,t)}};if(Object.assign&&Object.preventExtensions&&function(){var e=Object.preventExtensions({1:2});try{Object.assign(e,"xy")}catch(t){return"y"===e[1]}}()&&re(Object,"assign",bt.assign),g(Object,bt),c){var xt={setPrototypeOf:function(e,r){var n=function(e,r){if(!ue.TypeIsObject(e))throw new TypeError("cannot set prototype on a non-object");if(null!==r&&!ue.TypeIsObject(r))throw new TypeError("can only set prototype to an object or null"+r);return t(i,e,r),e};try{var i=e.getOwnPropertyDescriptor(e.prototype,r).set;t(i,{},null)}catch(t){if(e.prototype!=={}[r])return;i=function(e){this[r]=e},n.polyfill=n(n({},null),e.prototype)instanceof e}return n}(Object,"__proto__")};g(Object,xt)}if(Object.setPrototypeOf&&Object.getPrototypeOf&&null!==Object.getPrototypeOf(Object.setPrototypeOf({},null))&&null===Object.getPrototypeOf(Object.create(null))&&function(){var e=Object.create(null),t=Object.getPrototypeOf,r=Object.setPrototypeOf;Object.getPrototypeOf=function(r){return(r=t(r))===e?null:r},Object.setPrototypeOf=function(t,n){return r(t,null===n?e:n)},Object.setPrototypeOf.polyfill=!1}(),a((function(){return Object.keys("foo")}))){var Pt=Object.keys;re(Object,"keys",(function(e){return Pt(ue.ToObject(e))})),i=Object.keys}if(a((function(){return Object.keys(/a/g)}))){var Ct=Object.keys;re(Object,"keys",(function(e){if(te.regex(e)){var t,r=[];for(t in e)F(e,t)&&L(r,t);return r}return Ct(e)})),i=Object.keys}if(Object.getOwnPropertyNames&&a((function(){return Object.getOwnPropertyNames("foo")}))){var _t="object"==typeof window?Object.getOwnPropertyNames(window):[],wt=Object.getOwnPropertyNames;re(Object,"getOwnPropertyNames",(function(e){if(e=ue.ToObject(e),"[object Window]"===y(e))try{return wt(e)}catch(e){return M([],_t)}return wt(e)}))}if(Object.getOwnPropertyDescriptor&&a((function(){return Object.getOwnPropertyDescriptor("foo","bar")}))){var St=Object.getOwnPropertyDescriptor;re(Object,"getOwnPropertyDescriptor",(function(e,t){return St(ue.ToObject(e),t)}))}if(Object.seal&&a((function(){return Object.seal("foo")}))){var Tt=Object.seal;re(Object,"seal",(function(e){return ue.TypeIsObject(e)?Tt(e):e}))}if(Object.isSealed&&a((function(){return Object.isSealed("foo")}))){var Mt=Object.isSealed;re(Object,"isSealed",(function(e){return!ue.TypeIsObject(e)||Mt(e)}))}if(Object.freeze&&a((function(){return Object.freeze("foo")}))){var It=Object.freeze;re(Object,"freeze",(function(e){return ue.TypeIsObject(e)?It(e):e}))}if(Object.isFrozen&&a((function(){return Object.isFrozen("foo")}))){var Lt=Object.isFrozen;re(Object,"isFrozen",(function(e){return!ue.TypeIsObject(e)||Lt(e)}))}if(Object.preventExtensions&&a((function(){return Object.preventExtensions("foo")}))){var Et=Object.preventExtensions;re(Object,"preventExtensions",(function(e){return ue.TypeIsObject(e)?Et(e):e}))}if(Object.isExtensible&&a((function(){return Object.isExtensible("foo")}))){var Ot=Object.isExtensible;re(Object,"isExtensible",(function(e){return!!ue.TypeIsObject(e)&&Ot(e)}))}if(Object.getPrototypeOf&&a((function(){return Object.getPrototypeOf("foo")}))){var At=Object.getPrototypeOf;re(Object,"getPrototypeOf",(function(e){return At(ue.ToObject(e))}))}var Nt=c&&function(){var e=Object.getOwnPropertyDescriptor(RegExp.prototype,"flags");return e&&ue.IsCallable(e.get)}();c&&!Nt&&x.getter(RegExp.prototype,"flags",(function(){if(!ue.TypeIsObject(this))throw new TypeError("Method called on incompatible type: must be an object.");var e="";return this.global&&(e+="g"),this.ignoreCase&&(e+="i"),this.multiline&&(e+="m"),this.unicode&&(e+="u"),this.sticky&&(e+="y"),e}));var kt=c&&l((function(){return"/a/i"===String(new RegExp(/a/g,"i"))})),Rt=ne&&c&&function(){var e=/./;return e[V.match]=!1,RegExp(e)===e}(),zt=l((function(){return"/abc/"===RegExp.prototype.toString.call({source:"abc"})})),jt=zt&&l((function(){return"/a/b"===RegExp.prototype.toString.call({source:"a",flags:"b"})}));if(!zt||!jt){var Dt=RegExp.prototype.toString;m(RegExp.prototype,"toString",(function(){var e=ue.RequireObjectCoercible(this);return te.regex(e)?t(Dt,e):"/"+oe(e.source)+"/"+(e=oe(e.flags))}),!0),x.preserveToString(RegExp.prototype.toString,Dt)}if(c&&(!kt||Rt)){var Ft=Object.getOwnPropertyDescriptor(RegExp.prototype,"flags").get,Bt=Object.getOwnPropertyDescriptor(RegExp.prototype,"source")||{},Xt=function(){return this.source},$t=ue.IsCallable(Bt.get)?Bt.get:Xt,Yt=RegExp,qt=function e(t,r){var n=ue.IsRegExp(t);return this instanceof e||!n||void 0!==r||t.constructor!==e?te.regex(t)?new e(n=ue.Call($t,t),t=void 0===r?ue.Call(Ft,t):r):new Yt(t,r):t};Pe(Yt,qt,{$input:!0}),RegExp=qt,x.redefine(_,"RegExp",qt)}if(c){var Ut={input:"$_",lastMatch:"$&",lastParen:"$+",leftContext:"$`",rightContext:"$'"};f(i(Ut),(function(e){e in RegExp&&!(Ut[e]in RegExp)&&x.getter(RegExp,Ut[e],(function(){return RegExp[e]}))}))}_e(RegExp);var Vt=1/Number.EPSILON,Wt=Math.pow(2,-23),Gt=Math.pow(2,127)*(2-Wt),Ht=Math.pow(2,-126),Jt=Math.E,Zt=Math.LOG2E,Kt=Math.LOG10E,Qt=Number.prototype.clz;delete Number.prototype.clz;var er={acosh:function(e){var t=Number(e);return G(t)||1>e?NaN:1===t?0:1/0===t?t:(e=1/(t*t),2>t?Z(t-1+D(1-e)*t):Z((t/=2)+D(1-e)*t-1)+1/Zt)},asinh:function(e){var t=Number(e);if(0===t||!w(t))return t;var r=(e=R(t))*e;return t=J(t),1>e?t*Z(e+r/(D(r+1)+1)):t*(Z(e/2+D(1+1/r)*e/2-1)+1/Zt)},atanh:function(e){if(0===(e=Number(e)))return e;if(-1===e)return-1/0;if(1===e)return 1/0;if(G(e)||-1>e||1<e)return NaN;var t=R(e);return J(e)*Z(2*t/(1-t))/2},cbrt:function(e){if(0===(e=Number(e)))return e;var t=0>e;if(t&&(e=-e),1/0===e)var r=1/0;else r=(e/((r=z(j(e)/3))*r)+2*r)/3;return t?-r:r},clz32:function(e){return 0===(e=ue.ToUint32(Number(e)))?32:Qt?ue.Call(Qt,e):31-k(j(e+.5)*Zt)},cosh:function(e){return 0===(e=Number(e))?1:G(e)?NaN:w(e)?(e=z(R(e)-1),Jt/2*(e+1/(e*Jt*Jt))):1/0},expm1:function(e){if(-1/0===(e=Number(e)))return-1;if(!w(e)||0===e)return e;if(.5<R(e))return z(e)-1;for(var t=e,r=0,n=1;r+t!==r;)r+=t,t*=e/(n+=1);return r},hypot:function(e,t){for(var r=0,n=0,i=0;i<arguments.length;++i){var a=R(Number(arguments[i]));n<a?(r*=n/a*(n/a),r+=1,n=a):r+=0<a?a/n*(a/n):a}return 1/0===n?1/0:n*D(r)},log2:function(e){return j(e)*Zt},log10:function(e){return j(e)*Kt},log1p:Z,sign:J,sinh:function(e){if(e=Number(e),!w(e)||0===e)return e;var t=R(e);return 1>t?(t=Math.expm1(t),J(e)*t*(1+1/(t+1))/2):(t=z(t-1),J(e)*(t-1/(t*Jt*Jt))*(Jt/2))},tanh:function(e){return e=Number(e),G(e)||0===e?e:20<=e?1:-20>=e?-1:(Math.expm1(e)-Math.expm1(-e))/(z(e)+z(-e))},trunc:function(e){return 0>(e=Number(e))?-k(-e):k(e)},imul:function(e,t){var r=65535&(e=ue.ToUint32(e)),n=65535&(t=ue.ToUint32(t));return r*n+((e>>>16&65535)*n+r*(t>>>16&65535)<<16>>>0)|0},fround:function(e){var t=Number(e);if(0===t||1/0===t||-1/0===t||G(t))return t;if(e=J(t),(t=R(t))<Ht)return e*(t/Ht/Wt+Vt-Vt)*Ht*Wt;var r=(1+Wt/Number.EPSILON)*t;return(t=r-(r-t))>Gt||G(t)?1/0*e:e*t}};g(Math,er),m(Math,"sinh",er.sinh,1/0===Math.sinh(710)),m(Math,"cosh",er.cosh,1/0===Math.cosh(710)),m(Math,"log1p",er.log1p,-1e-17!==Math.log1p(-1e-17)),m(Math,"asinh",er.asinh,Math.asinh(-1e7)!==-Math.asinh(1e7)),m(Math,"asinh",er.asinh,1/0===Math.asinh(1e300)),m(Math,"atanh",er.atanh,0===Math.atanh(1e-300)),m(Math,"tanh",er.tanh,-2e-17!==Math.tanh(-2e-17)),m(Math,"acosh",er.acosh,1/0===Math.acosh(Number.MAX_VALUE)),m(Math,"acosh",er.acosh,!(8>R(1-Math.acosh(1+Number.EPSILON)/Math.sqrt(2*Number.EPSILON))/Number.EPSILON)),m(Math,"cbrt",er.cbrt,!(8>R(1-Math.cbrt(1e-300)/1e-100)/Number.EPSILON)),m(Math,"sinh",er.sinh,-2e-17!==Math.sinh(-2e-17));var tr=Math.expm1(10);m(Math,"expm1",er.expm1,22025.465794806718<tr||22025.465794806718>tr);var rr=Math.round,nr=0===Math.round(.5-Number.EPSILON/4)&&1===Math.round(Number.EPSILON/3.99-.5),ir=[Vt+1,2*Vt-1].every((function(e){return Math.round(e)===e}));m(Math,"round",(function(e){var t=k(e);return.5>e-t?t:-1===t?-0:t+1}),!nr||!ir),x.preserveToString(Math.round,rr);var ar=Math.imul;-5!==Math.imul(4294967295,5)&&(Math.imul=er.imul,x.preserveToString(Math.imul,ar)),2!==Math.imul.length&&re(Math,"imul",(function(e,t){return ue.Call(ar,Math,arguments)}));var or=function(){var e=_.setTimeout;if("function"==typeof e||"object"==typeof e){ue.IsPromise=function(e){return!(!ue.TypeIsObject(e)||void 0===e._promise)};var r,n=function(e){if(!ue.IsConstructor(e))throw new TypeError("Bad promise constructor");var t=this;if(t.resolve=void 0,t.reject=void 0,t.promise=new e((function(e,r){if(void 0!==t.resolve||void 0!==t.reject)throw new TypeError("Bad Promise implementation!");t.resolve=e,t.reject=r})),!ue.IsCallable(t.resolve)||!ue.IsCallable(t.reject))throw new TypeError("Bad promise constructor")};"undefined"!=typeof window&&ue.IsCallable(window.postMessage)&&(r=function(){var e=[];return window.addEventListener("message",(function(t){t.source===window&&"zero-timeout-message"===t.data&&(t.stopPropagation(),0!==e.length&&O(e)())}),!0),function(t){L(e,t),window.postMessage("zero-timeout-message","*")}});var i=ue.IsCallable(_.setImmediate)?_.setImmediate:"object"==typeof o&&o.nextTick?o.nextTick:function(){var e=_.Promise,t=e&&e.resolve&&e.resolve();return t&&function(e){return t.then(e)}}()||(ue.IsCallable(r)?r():function(t){e(t,0)}),a=function(e){return e},l=function(e){throw e},s={},u=function(e,t,r){i((function(){if(t===s)e(r);else{try{var n=e(r),i=t.resolve}catch(e){n=e,i=t.reject}i(n)}}))},c=function(e,t){var r=e._promise,n=r.reactionLength;if(0<n&&(u(r.fulfillReactionHandler0,r.reactionCapability0,t),r.fulfillReactionHandler0=void 0,r.rejectReactions0=void 0,r.reactionCapability0=void 0,1<n))for(var i=1,a=0;i<n;i++,a+=3)u(r[a+0],r[a+2],t),e[a+0]=void 0,e[a+1]=void 0,e[a+2]=void 0;r.result=t,r.state=1,r.reactionLength=0},p=function(e,t){var r=e._promise,n=r.reactionLength;if(0<n&&(u(r.rejectReactionHandler0,r.reactionCapability0,t),r.fulfillReactionHandler0=void 0,r.rejectReactions0=void 0,r.reactionCapability0=void 0,1<n))for(var i=1,a=0;i<n;i++,a+=3)u(r[a+1],r[a+2],t),e[a+0]=void 0,e[a+1]=void 0,e[a+2]=void 0;r.result=t,r.state=2,r.reactionLength=0},f=function(e){var t=!1;return{resolve:function(r){if(!t){if(t=!0,r===e)return p(e,new TypeError("Self resolution"));if(!ue.TypeIsObject(r))return c(e,r);try{var n=r.then}catch(t){return p(e,t)}if(!ue.IsCallable(n))return c(e,r);i((function(){var t=n,i=f(e),a=i.resolve;i=i.reject;try{h(t,r,a,i)}catch(e){i(e)}}))}},reject:function(r){if(!t)return t=!0,p(e,r)}}},h=function(e,r,n,i){e===y?t(e,r,n,i,s):t(e,r,n,i)},v=function(){var e=function(t){if(!(this instanceof e))throw new TypeError('Constructor Promise requires "new"');if(this&&this._promise)throw new TypeError("Bad construction");if(!ue.IsCallable(t))throw new TypeError("not a valid resolver");var r=Te(this,e,d,{_promise:{result:void 0,state:0,reactionLength:0,fulfillReactionHandler0:void 0,rejectReactionHandler0:void 0,reactionCapability0:void 0}}),n=f(r),i=n.reject;try{t(n.resolve,i)}catch(e){i(e)}return r};return e}(),d=v.prototype,m=function(e,t,r,n){var i=!1;return function(a){i||(i=!0,t[e]=a,0==--n.count&&(a=r.resolve)(t))}};g(v,{all:function(e){if(!ue.TypeIsObject(this))throw new TypeError("Promise is not object");var t,r=new n(this);try{for(var i,a,o=ue.GetIterator(e),l=(e=t={iterator:o,done:!1}).iterator,s=[],u={count:1},c=0;;){try{if(!1===(i=ue.IteratorStep(l))){e.done=!0;break}a=i.value}catch(t){throw e.done=!0,t}s[c]=void 0;var p=this.resolve(a),f=m(c,s,r,u);u.count+=1,h(p.then,p,f,r.reject),c+=1}return 0==--u.count&&(0,r.resolve)(s),r.promise}catch(e){if(l=e,t&&!t.done)try{ue.IteratorClose(o,!0)}catch(e){l=e}return(o=r.reject)(l),r.promise}},race:function(e){if(!ue.TypeIsObject(this))throw new TypeError("Promise is not object");var t,r=new n(this);try{for(var i,a,o,l=ue.GetIterator(e),s=(e=t={iterator:l,done:!1}).iterator;;){try{if(!1===(i=ue.IteratorStep(s))){e.done=!0;break}a=i.value}catch(t){throw e.done=!0,t}o=this.resolve(a),h(o.then,o,r.resolve,r.reject)}return r.promise}catch(e){if(s=e,t&&!t.done)try{ue.IteratorClose(l,!0)}catch(e){s=e}return(l=r.reject)(s),r.promise}},reject:function(e){if(!ue.TypeIsObject(this))throw new TypeError("Bad promise constructor");var t=new n(this);return(0,t.reject)(e),t.promise},resolve:function(e){if(!ue.TypeIsObject(this))throw new TypeError("Bad promise constructor");if(ue.IsPromise(e)&&e.constructor===this)return e;var t=new n(this);return(0,t.resolve)(e),t.promise}}),g(d,{catch:function(e){return this.then(null,e)},then:function(e,t){if(!ue.IsPromise(this))throw new TypeError("not a promise");var r=ue.SpeciesConstructor(this,v);r=2<arguments.length&&arguments[2]===s&&r===v?s:new n(r);var i=ue.IsCallable(e)?e:a,o=ue.IsCallable(t)?t:l,c=this._promise;if(0===c.state){if(0===c.reactionLength)c.fulfillReactionHandler0=i,c.rejectReactionHandler0=o,c.reactionCapability0=r;else{var p=3*(c.reactionLength-1);c[p+0]=i,c[p+1]=o,c[p+2]=r}c.reactionLength+=1}else if(1===c.state)c=c.result,u(i,r,c);else{if(2!==c.state)throw new TypeError("unexpected Promise state");c=c.result,u(o,r,c)}return r.promise}}),s=new n(v);var y=d.then;return v}}();if(_.Promise&&(delete _.Promise.accept,delete _.Promise.defer,delete _.Promise.prototype.chain),"function"==typeof or){g(_,{Promise:or});var lr=C(_.Promise,(function(e){return e.resolve(42).then((function(){}))instanceof e})),sr=!a((function(){return _.Promise.reject(42).then(null,5).then(null,B)})),ur=a((function(){return _.Promise.call(3,B)})),cr=function(e){var t=e.resolve(5);t.constructor={},e=e.resolve(t);try{e.then(null,B).then(null,B)}catch(e){return!0}return t===e}(_.Promise),pr=c&&function(){var e=0,t=Object.defineProperty({},"then",{get:function(){e+=1}});return Promise.resolve(t),1===e}(),fr=function e(t){var r=new Promise(t);t(3,(function(){})),this.then=r.then,this.constructor=e};fr.prototype=Promise.prototype,fr.all=Promise.all;var hr=l((function(){return!!fr.all([1,2])}));if(lr&&sr&&ur&&!cr&&pr&&!hr||(Promise=or,re(_,"Promise",or)),1!==Promise.all.length){var vr=Promise.all;re(Promise,"all",(function(e){return ue.Call(vr,this,arguments)}))}if(1!==Promise.race.length){var dr=Promise.race;re(Promise,"race",(function(e){return ue.Call(dr,this,arguments)}))}if(1!==Promise.resolve.length){var mr=Promise.resolve;re(Promise,"resolve",(function(e){return ue.Call(mr,this,arguments)}))}if(1!==Promise.reject.length){var gr=Promise.reject;re(Promise,"reject",(function(e){return ue.Call(gr,this,arguments)}))}dt(Promise,"all"),dt(Promise,"race"),dt(Promise,"resolve"),dt(Promise,"reject"),_e(Promise)}var yr=function(e){var t=i(h(e,(function(e,t){return e[t]=!0,e}),{}));return e.join(":")===t.join(":")},br=yr(["z","a","bb"]),xr=yr(["z",1,"a","3",2]);if(c){var Pr=function(e,t){return t||br?se(e)?"^"+ue.ToString(e):"string"==typeof e?"$"+e:"number"==typeof e?xr?e:"n"+e:"boolean"==typeof e?"b"+e:null:null},Cr=function(){return Object.create?Object.create(null):{}},_r=function(e,r,i){if(n(i)||te.string(i))f(i,(function(e){if(!ue.TypeIsObject(e))throw new TypeError("Iterator value "+e+" is not an entry object");r.set(e[0],e[1])}));else if(i instanceof e)t(e.prototype.forEach,i,(function(e,t){r.set(t,e)}));else{if(!se(i)){var a=r.set;if(!ue.IsCallable(a))throw new TypeError("bad map");var o=ue.GetIterator(i)}if(void 0!==o)for(;!1!==(e=ue.IteratorStep(o));){e=e.value;try{if(!ue.TypeIsObject(e))throw new TypeError("Iterator value "+e+" is not an entry object");t(a,r,e[0],e[1])}catch(e){throw ue.IteratorClose(o,!0),e}}}},wr=function(e,r,i){if(n(i)||te.string(i))f(i,(function(e){r.add(e)}));else if(i instanceof e)t(e.prototype.forEach,i,(function(e){r.add(e)}));else{if(!se(i)){var a=r.add;if(!ue.IsCallable(a))throw new TypeError("bad set");var o=ue.GetIterator(i)}if(void 0!==o)for(;!1!==(e=ue.IteratorStep(o));){e=e.value;try{t(a,r,e)}catch(e){throw ue.IteratorClose(o,!0),e}}}},Sr={Map:function(){var e={},r=function(e,t){this.key=e,this.value=t,this.prev=this.next=null};r.prototype.isRemoved=function(){return this.key===e};var n=function(e,t){if(!ue.TypeIsObject(e)||!e._es6map)throw new TypeError("Method Map.prototype."+t+" called on incompatible receiver "+ue.ToString(e))},i=function(e,t){n(e,"[[MapIterator]]"),this.i=this.head=e._head,this.kind=t};we(i.prototype={isMapIterator:!0,next:function(){if(!this.isMapIterator)throw new TypeError("Not a MapIterator");var e=this.i,t=this.kind,r=this.head;if(void 0===this.i)return je();for(;e.isRemoved()&&e!==r;)e=e.prev;for(;e.next!==r;)if(!(e=e.next).isRemoved())return t="key"===t?e.key:"value"===t?e.value:[e.key,e.value],this.i=e,je(t);return this.i=void 0,je()}});var a=function e(){if(!(this instanceof e))throw new TypeError('Constructor Map requires "new"');if(this&&this._es6map)throw new TypeError("Bad construction");var t=Te(this,e,o,{_es6map:!0,_head:null,_map:X?new X:null,_size:0,_storage:Cr()}),n=new r(null,null);return n.next=n.prev=n,t._head=n,0<arguments.length&&_r(e,t,arguments[0]),t},o=a.prototype;return x.getter(o,"size",(function(){if(void 0===this._size)throw new TypeError("size method called on incompatible Map");return this._size})),g(o,{get:function(e){n(this,"get");var t=Pr(e,!0);if(null!==t){if(e=this._storage[t])return e.value}else if(this._map){if(e=Y.call(this._map,e))return e.value}else for(var r=t=this._head;(r=r.next)!==t;)if(ue.SameValueZero(r.key,e))return r.value},has:function(e){n(this,"has");var t=Pr(e,!0);if(null!==t)return void 0!==this._storage[t];if(this._map)return q.call(this._map,e);for(var r=t=this._head;(r=r.next)!==t;)if(ue.SameValueZero(r.key,e))return!0;return!1},set:function(e,t){n(this,"set");var i=this._head,a=i,o=Pr(e,!0);if(null!==o){if(void 0!==this._storage[o])return this._storage[o].value=t,this;var l=this._storage[o]=new r(e,t);a=i.prev}else this._map&&(q.call(this._map,e)?Y.call(this._map,e).value=t:(l=new r(e,t),U.call(this._map,e,l),a=i.prev));for(;(a=a.next)!==i;)if(ue.SameValueZero(a.key,e))return a.value=t,this;return l=l||new r(e,t),ue.SameValue(-0,e)&&(l.key=0),l.next=this._head,l.prev=this._head.prev,l.prev.next=l,l.next.prev=l,this._size+=1,this},delete:function(t){n(this,"delete");var r=this._head,i=r,a=Pr(t,!0);if(null!==a){if(void 0===this._storage[a])return!1;i=this._storage[a].prev,delete this._storage[a]}else if(this._map){if(!q.call(this._map,t))return!1;i=Y.call(this._map,t).prev,$.call(this._map,t)}for(;(i=i.next)!==r;)if(ue.SameValueZero(i.key,t))return i.key=e,i.value=e,i.prev.next=i.next,i.next.prev=i.prev,--this._size,!0;return!1},clear:function(){n(this,"clear"),this._map=X?new X:null,this._size=0,this._storage=Cr();for(var t,r=this._head,i=r.next;(t=i)!==r;)t.key=e,t.value=e,i=t.next,t.next=t.prev=r;r.next=r.prev=r},keys:function(){return n(this,"keys"),new i(this,"key")},values:function(){return n(this,"values"),new i(this,"value")},entries:function(){return n(this,"entries"),new i(this,"key+value")},forEach:function(e){n(this,"forEach");for(var r=1<arguments.length?arguments[1]:null,i=this.entries(),a=i.next();!a.done;a=i.next())r?t(e,r,a.value[1],a.value[0],this):e(a.value[1],a.value[0],this)}}),we(o,o.entries),a}(),Set:function(){var e=function(e,t){if(!ue.TypeIsObject(e)||!e._es6set||void 0===e._storage)throw new TypeError("Set.prototype."+t+" called on incompatible receiver "+ue.ToString(e))},r=function e(){if(!(this instanceof e))throw new TypeError('Constructor Set requires "new"');if(this&&this._es6set)throw new TypeError("Bad construction");var t=Te(this,e,n,{_es6set:!0,"[[SetData]]":null,_storage:Cr()});if(!t._es6set)throw new TypeError("bad set");return 0<arguments.length&&wr(e,t,arguments[0]),t},n=r.prototype,a=function(e){if(!e["[[SetData]]"]){var t=new Sr.Map;e["[[SetData]]"]=t,f(i(e._storage),(function(e){if("^null"===e)e=null;else if("^undefined"!==e){var r=e.charAt(0);e="$"===r?I(e,1):"n"===r?+I(e,1):"b"===r?"btrue"===e:+e}else e=void 0;t.set(e,e)})),e["[[SetData]]"]=t}e._storage=null};x.getter(r.prototype,"size",(function(){return e(this,"size"),this._storage?i(this._storage).length:(a(this),this["[[SetData]]"].size)})),g(r.prototype,{has:function(t){var r;return e(this,"has"),this._storage&&null!==(r=Pr(t))?!!this._storage[r]:(a(this),this["[[SetData]]"].has(t))},add:function(t){var r;return e(this,"add"),this._storage&&null!==(r=Pr(t))?(this._storage[r]=!0,this):(a(this),this["[[SetData]]"].set(t,t),this)},delete:function(t){var r;return e(this,"delete"),this._storage&&null!==(r=Pr(t))?(t=F(this._storage,r),delete this._storage[r]&&t):(a(this),this["[[SetData]]"].delete(t))},clear:function(){e(this,"clear"),this._storage&&(this._storage=Cr()),this["[[SetData]]"]&&this["[[SetData]]"].clear()},values:function(){return e(this,"values"),a(this),new o(this["[[SetData]]"].values())},entries:function(){return e(this,"entries"),a(this),new o(this["[[SetData]]"].entries())},forEach:function(r){e(this,"forEach");var n=1<arguments.length?arguments[1]:null,i=this;a(i),this["[[SetData]]"].forEach((function(e,a){n?t(r,n,a,a,i):r(a,a,i)}))}}),m(r.prototype,"keys",r.prototype.values,!0),we(r.prototype,r.prototype.values);var o=function(e){this.it=e};return o.prototype={isSetIterator:!0,next:function(){if(!this.isSetIterator)throw new TypeError("Not a SetIterator");return this.it.next()}},we(o.prototype),r}()};if(_.Set&&!Set.prototype.delete&&Set.prototype.remove&&Set.prototype.items&&Set.prototype.map&&Array.isArray((new Set).keys)&&(_.Set=Sr.Set),_.Map||_.Set){l((function(){return 2===new Map([[1,2]]).get(1)}))||(_.Map=function e(){if(!(this instanceof e))throw new TypeError('Constructor Map requires "new"');var t=new X;return 0<arguments.length&&_r(e,t,arguments[0]),delete t.constructor,Object.setPrototypeOf(t,_.Map.prototype),t},_.Map.prototype=P(X.prototype),m(_.Map.prototype,"constructor",_.Map,!0),x.preserveToString(_.Map,X));var Tr=new Map,Mr=function(){var e=new Map([[1,0],[2,0],[3,0],[4,0]]);return e.set(-0,e),e.get(0)===e&&e.get(-0)===e&&e.has(0)&&e.has(-0)}(),Ir=Tr.set(1,2)===Tr;Mr&&Ir||re(Map.prototype,"set",(function(e,r){return t(U,this,0===e?0:e,r),this})),Mr||(g(Map.prototype,{get:function(e){return t(Y,this,0===e?0:e)},has:function(e){return t(q,this,0===e?0:e)}},!0),x.preserveToString(Map.prototype.get,Y),x.preserveToString(Map.prototype.has,q));var Lr=new Set,Er=Set.prototype.delete&&Set.prototype.add&&Set.prototype.has&&function(e){return e.delete(0),e.add(-0),!e.has(0)}(Lr),Or=Lr.add(1)===Lr;if(!Er||!Or){var Ar=Set.prototype.add;Set.prototype.add=function(e){return t(Ar,this,0===e?0:e),this},x.preserveToString(Set.prototype.add,Ar)}if(!Er){var Nr=Set.prototype.has;Set.prototype.has=function(e){return t(Nr,this,0===e?0:e)},x.preserveToString(Set.prototype.has,Nr);var kr=Set.prototype.delete;Set.prototype.delete=function(e){return t(kr,this,0===e?0:e)},x.preserveToString(Set.prototype.delete,kr)}var Rr=C(_.Map,(function(e){var t=new e([]);return t.set(42,42),t instanceof e})),zr=Object.setPrototypeOf&&!Rr;try{var jr=!(_.Map()instanceof _.Map)}catch(e){jr=e instanceof TypeError}0===_.Map.length&&!zr&&jr||(_.Map=function e(){if(!(this instanceof e))throw new TypeError('Constructor Map requires "new"');var t=new X;return 0<arguments.length&&_r(e,t,arguments[0]),delete t.constructor,Object.setPrototypeOf(t,e.prototype),t},_.Map.prototype=X.prototype,m(_.Map.prototype,"constructor",_.Map,!0),x.preserveToString(_.Map,X));var Dr=C(_.Set,(function(e){var t=new e([]);return t.add(42,42),t instanceof e})),Fr=Object.setPrototypeOf&&!Dr;try{var Br=!(_.Set()instanceof _.Set)}catch(e){Br=e instanceof TypeError}if(0!==_.Set.length||Fr||!Br){var Xr=_.Set;_.Set=function e(){if(!(this instanceof e))throw new TypeError('Constructor Set requires "new"');var t=new Xr;return 0<arguments.length&&wr(e,t,arguments[0]),delete t.constructor,Object.setPrototypeOf(t,e.prototype),t},_.Set.prototype=Xr.prototype,m(_.Set.prototype,"constructor",_.Set,!0),x.preserveToString(_.Set,Xr)}var $r=new _.Map,Yr=!l((function(){return $r.keys().next().done}));if(("function"!=typeof _.Map.prototype.clear||0!==(new _.Set).size||0!==$r.size||"function"!=typeof _.Map.prototype.keys||"function"!=typeof _.Set.prototype.keys||"function"!=typeof _.Map.prototype.forEach||"function"!=typeof _.Set.prototype.forEach||s(_.Map)||s(_.Set)||"function"!=typeof $r.keys().next||Yr||!Rr)&&g(_,{Map:Sr.Map,Set:Sr.Set},!0),_.Set.prototype.keys!==_.Set.prototype.values&&m(_.Set.prototype,"keys",_.Set.prototype.values,!0),we(Object.getPrototypeOf((new _.Map).keys())),we(Object.getPrototypeOf((new _.Set).keys())),p&&"has"!==_.Set.prototype.has.name){var qr=_.Set.prototype.has;re(_.Set.prototype,"has",(function(e){return t(qr,this,e)}))}}g(_,Sr),_e(_.Map),_e(_.Set)}var Ur=function(e){if(!ue.TypeIsObject(e))throw new TypeError("target must be an object")},Vr={apply:function(){return ue.Call(ue.Call,null,arguments)},construct:function(e,t){if(!ue.IsConstructor(e))throw new TypeError("First argument must be a constructor.");var r=2<arguments.length?arguments[2]:e;if(!ue.IsConstructor(r))throw new TypeError("new.target must be a constructor.");return ue.Construct(e,t,r,"internal")},deleteProperty:function(e,t){if(Ur(e),c){var r=Object.getOwnPropertyDescriptor(e,t);if(r&&!r.configurable)return!1}return delete e[t]},has:function(e,t){return Ur(e),t in e}};if(Object.getOwnPropertyNames&&Object.assign(Vr,{ownKeys:function(e){Ur(e);var t=Object.getOwnPropertyNames(e);return ue.IsCallable(Object.getOwnPropertySymbols)&&E(t,Object.getOwnPropertySymbols(e)),t}}),Object.preventExtensions&&Object.assign(Vr,{isExtensible:function(e){return Ur(e),Object.isExtensible(e)},preventExtensions:function(e){return Ur(e),!a((function(){return Object.preventExtensions(e)}))}}),c){var Wr=function(e,t,r){var n=Object.getOwnPropertyDescriptor(e,t);return n?"value"in n?n.value:n.get?ue.Call(n.get,r):void 0:null===(e=Object.getPrototypeOf(e))?void 0:Wr(e,t,r)},Gr=function(e,r,n,i){var a=Object.getOwnPropertyDescriptor(e,r);if(!a){if(null!==(e=Object.getPrototypeOf(e)))return Gr(e,r,n,i);a={value:void 0,writable:!0,enumerable:!0,configurable:!0}}return"value"in a?!(!a.writable||!ue.TypeIsObject(i))&&(Object.getOwnPropertyDescriptor(i,r)?ae.defineProperty(i,r,{value:n}):ae.defineProperty(i,r,{value:n,writable:!0,enumerable:!0,configurable:!0})):!!a.set&&(t(a.set,i,n),!0)};Object.assign(Vr,{defineProperty:function(e,t,r){return Ur(e),!a((function(){return Object.defineProperty(e,t,r)}))},getOwnPropertyDescriptor:function(e,t){return Ur(e),Object.getOwnPropertyDescriptor(e,t)},get:function(e,t){return Ur(e),Wr(e,t,2<arguments.length?arguments[2]:e)},set:function(e,t,r){return Ur(e),Gr(e,t,r,3<arguments.length?arguments[3]:e)}})}if(Object.getPrototypeOf){var Hr=Object.getPrototypeOf;Vr.getPrototypeOf=function(e){return Ur(e),Hr(e)}}Object.setPrototypeOf&&Vr.getPrototypeOf&&Object.assign(Vr,{setPrototypeOf:function(e,t){if(Ur(e),null!==t&&!ue.TypeIsObject(t))throw new TypeError("proto must be an object or null");if(t===ae.getPrototypeOf(e))return!0;if(ae.isExtensible&&!ae.isExtensible(e))return!1;var r;e:{for(r=t;r;){if(e===r){r=!0;break e}r=Vr.getPrototypeOf(r)}r=!1}return!r&&(Object.setPrototypeOf(e,t),!0)}});var Jr=function(e,t){ue.IsCallable(_.Reflect[e])?l((function(){return _.Reflect[e](1),_.Reflect[e](NaN),_.Reflect[e](!0),!0}))&&re(_.Reflect,e,t):m(_.Reflect,e,t)};Object.keys(Vr).forEach((function(e){Jr(e,Vr[e])}));var Zr=_.Reflect.getPrototypeOf;if(p&&Zr&&"getPrototypeOf"!==Zr.name&&re(_.Reflect,"getPrototypeOf",(function(e){return t(Zr,_.Reflect,e)})),_.Reflect.setPrototypeOf&&l((function(){return _.Reflect.setPrototypeOf(1,{}),!0}))&&re(_.Reflect,"setPrototypeOf",Vr.setPrototypeOf),_.Reflect.defineProperty&&(l((function(){var e=!_.Reflect.defineProperty(1,"test",{value:1}),t="function"!=typeof Object.preventExtensions||!_.Reflect.defineProperty(Object.preventExtensions({}),"test",{});return e&&t}))||re(_.Reflect,"defineProperty",Vr.defineProperty)),_.Reflect.construct&&(l((function(){var e=function(){};return _.Reflect.construct((function(){}),[],e)instanceof e}))||re(_.Reflect,"construct",Vr.construct)),"Invalid Date"!==String(new Date(NaN))){var Kr=Date.prototype.toString;re(Date.prototype,"toString",(function(){var e=+this;return e!=e?"Invalid Date":ue.Call(Kr,this)}))}var Qr={anchor:function(e){return ue.CreateHTML(this,"a","name",e)},big:function(){return ue.CreateHTML(this,"big","","")},blink:function(){return ue.CreateHTML(this,"blink","","")},bold:function(){return ue.CreateHTML(this,"b","","")},fixed:function(){return ue.CreateHTML(this,"tt","","")},fontcolor:function(e){return ue.CreateHTML(this,"font","color",e)},fontsize:function(e){return ue.CreateHTML(this,"font","size",e)},italics:function(){return ue.CreateHTML(this,"i","","")},link:function(e){return ue.CreateHTML(this,"a","href",e)},small:function(){return ue.CreateHTML(this,"small","","")},strike:function(){return ue.CreateHTML(this,"strike","","")},sub:function(){return ue.CreateHTML(this,"sub","","")},sup:function(){return ue.CreateHTML(this,"sup","","")}};f(Object.keys(Qr),(function(e){var r=String.prototype[e];if(ue.IsCallable(r)){r=t(r,"",' " ');var n=M([],r.match(/"/g)).length;r=r!==r.toLowerCase()||2<n}else r=!0;r&&re(String.prototype,e,Qr[e])}));var en=function(){if(!ne)return!1;var e="object"==typeof JSON&&"function"==typeof JSON.stringify?JSON.stringify:null;if(!e)return!1;if(void 0!==e(V())||"[null]"!==e([V()]))return!0;var t={a:V()};return t[V()]=!0,"{}"!==e(t)}(),tn=l((function(){return!ne||"{}"===JSON.stringify(Object(V()))&&"[{}]"===JSON.stringify([Object(V())])}));if(en||!tn){var rn=JSON.stringify;re(JSON,"stringify",(function(e){if("symbol"!=typeof e){var r;1<arguments.length&&(r=arguments[1]);var i=[e];if(n(r))i.push(r);else{var a=ue.IsCallable(r)?r:null;i.push((function(e,r){if("symbol"!=typeof(e=a?t(a,this,e,r):r))return te.symbol(e)?gt({})(e):e}))}return 2<arguments.length&&i.push(arguments[2]),rn.apply(this,i)}}))}return _},"function"==typeof define&&define.amd?define(s):a=s();var c=function(){function e(e){return 0===r?(console.error("Waiting for "+e+" after we finished waiting."),function(){}):(0>r&&(r=0),++r,function(){if(0>--r&&console.error("Wait count mismatch: "+e),0===r)for(var t=0,i=n.length;t<i;)n[t++].startup()})}function t(e){var i=t.newInstance(e);return 0>=r?i.startup():!1!==e.autostart&&n.push(i),i}var r=-1,n=[];Math.sign||(Math.sign=function(e){return(0<e)-(0>e)||+e}),"undefined"==typeof document||"undefined"==typeof window||void 0===document.addEventListener||void 0!==window.cindyDontWait&&!0===window.cindyDontWait||document.addEventListener("DOMContentLoaded",e("DOMContentLoaded"));var i=null,s=null,c={};t.getBaseDir=function(){if(null!==i)return i;for(var e=document.getElementsByTagName("script"),t=0;t<e.length;++t){var r=e[t],n=r.src;if(n){var a=/Cindy\.js$/.exec(n);if(a)return i=n.substr(0,a.index),console.log("Will load extensions from "+i),s=r,i}}return console.error("Could not find <script> tag for Cindy.js"),i=s=!1},t.addNewScript=function(e,r){r||console.error.bind(console);var n=t.getBaseDir();return!1!==n&&((r=document.createElement("script")).src=n+e,e=s.nextSibling,n=s.parentElement,e?n.insertBefore(r,e):n.appendChild(r),r)},t.loadScript=function(e,r,n,i){for(var a=String(e).split("."),o=window;a.length&&"object"==typeof o&&null!==o;)o=o[a.shift()];if(o&&!a.length)return n(),!0;if(i||(i=console.error.bind(console)),!(a=c[e])){if(!1===(a=t.addNewScript(r,i)))return i("Can't load additional components."),!1;c[e]=a}return a.addEventListener("load",n),a.addEventListener("error",i),null},t._autoLoadingPlugin={},t.autoLoadPlugin=function(e,r,n){if(t._pluginRegistry[e])return n(),!0;var i=t._autoLoadingPlugin[e];if(!i){if(r||(r=e+"-plugin.js"),i=t._autoLoadingPlugin[e]=[],!1===(e=t.addNewScript(r)))return!1;e.addEventListener("error",console.error.bind(console))}return i.push(n),null};var p={ctype:"undefined"};t.waitFor=e,t._pluginRegistry={},t.instances=[],t.registerPlugin=function(e,r,n){if(1!==e)return console.error("Plugin API version "+e+" not supported"),!1;t._pluginRegistry[r]=n,(t._autoLoadingPlugin[r]||[]).forEach((function(e){e()}))};var f=0;return t.dumpState=function(e){e=t.instances[e||0].saveState(),console.log(JSON.stringify(e))},t.debugState=function(e){t.instances.map((function(e){var t=e.config;t=JSON.parse(JSON.stringify(t));var r=e.saveState();for(var n in console.log(JSON.stringify(r)),r)t[n]=r[n];return e.shutdown(),t})).forEach((function(e){t(e)}))},t.newInstance=function(e){function t(){if(Tt.width=Et=Tt.clientWidth,Tt.height=Ot=Tt.clientHeight,Kt=1,(Jt||Zt)&&(Kt=Math.max(Jt?Jt/Tt.width:0,Zt?Zt/Tt.height:0),Et=Kt*Tt.clientWidth,Ot=Kt*Tt.clientHeight),Lt.setTransform(1/Kt,0,0,1/Kt,0,0),In.setMat(25,0,0,25,250.5,250.5),Mt)for(var e=0;e<Mt.length;e++){var t=Mt[e],r=Object.keys(t)[0];"scale"===r&&(qt=t.scale,In[r](t.scale)),"translate"===r&&In[r](t.translate[0],t.translate[1]),"scaleAndOrigin"===r&&(qt=t[r][0]/25,In[r].apply(null,t[r])),"visibleRect"===r&&(In[r].apply(null,t[r]),qt=In.drawingstate.initialmatrix.a/25)}In.createnewbackup(),In.greset(),e=1,"undefined"!=typeof window&&window.devicePixelRatio&&(e=window.devicePixelRatio),e!==(t=Lt.webkitBackingStorePixelRatio||Lt.mozBackingStorePixelRatio||Lt.msBackingStorePixelRatio||Lt.oBackingStorePixelRatio||Lt.backingStorePixelRatio||1)&&(e/=t,Tt.width=Et*e,Tt.height=Ot*e,Lt.scale(e,e))}function r(e){if("canvas"!==e.tagName.toLowerCase()){var t=e;for(Tt=document.createElement("canvas");t.firstChild;)t.removeChild(t.firstChild)}else{Tt=e,t=document.createElement("div");var r=null,n=null;Array.prototype.slice.call(Tt.attributes).forEach((function(e){"width"===e.name?r=e.value:"height"===e.name?n=e.value:t.setAttributeNodeNS(Tt.removeAttributeNode(e))})),null===r||t.style.width||(t.style.width=r+"px"),null===n||t.style.height||(t.style.height=n+"px"),Tt.parentNode.replaceChild(t,Tt)}return t.classList.add("CindyJS-widget"),(e=Tt.style).position="absolute",e.border="none",e.margin=e.padding=e.left=e.top="0px",e.width=e.height="100%",e="static",window.getComputedStyle&&(e=window.getComputedStyle(t).getPropertyValue("position"),e=String(e||"static")),"static"===e&&(t.style.position="relative"),t.appendChild(Tt),Tt}function n(){var t=e.cinderella;if(!t||!t.version)return!1;for(var r=0;r<arguments.length;++r){var n=t.version[r],i=arguments[r];if(n!==i)return typeof n==typeof i&&n<i}return!1}function i(){if(cr=!0,0===pr){if(e.exclusive)for(u=kt.instances.length;0<u;)kt.instances[--u].shutdown();void 0!==e.csconsole&&(St=e.csconsole),St=null===St?new _:!0===St?new P:"string"==typeof St||"object"==typeof St&&"function"==typeof St.appendChild?new C(St):new _,It=[100,100];var i=null;if(Mt=e.transform,e.ports&&0<e.ports.length){(i=(u=e.ports[0]).element)||(i=document.getElementById(u.id));var a=(i=r(i)).parentNode.style;"window"===u.fill?(a.width="100vw",a.height="100vh"):"parent"===u.fill?(a.width="100%",a.height="100%"):u.width&&u.height&&(a.width=u.width+"px",a.height=u.height+"px"),u.virtualwidth&&(Jt=u.virtualwidth),u.virtualheight&&(Zt=u.virtualheight),u.background&&(i.style.backgroundColor=u.background),void 0!==u.transform&&(Mt=u.transform),Qt(u.grid)&&0<u.grid&&(Ut=u.grid),Qt(u.tgrid)&&0<u.tgrid&&(Vt=u.tgrid),u.snap&&(Wt=!0),Number.isFinite(u.snapdistance)&&(Gt=Math.max(u.snapdistance,0)),u.axes&&(Ht=!0)}i||((i=e.canvas)||"undefined"==typeof document||(i=document.getElementById(e.canvasname))&&(i=r(i))),i&&(Tt=i,Lt=i.getContext("2d"),t(),Lt.setLineDash||(Lt.setLineDash=function(){}),(e.animation?e.animation.controls:e.animcontrols)&&function(e){function t(e,t){var r=document.createElement("button"),n=document.createElement("img");r.appendChild(n),u.appendChild(r),ir(n,e),r.addEventListener("click",t),rr[e]=function(e){e?r.classList.add("CindyJS-active"):r.classList.remove("CindyJS-active")}}function r(e){if(p){var t=l.getBoundingClientRect();c(o*(e.clientX-t.left-l.clientLeft+.5)/t.width+i)}}var n=document.createElement("div");n.className="CindyJS-animcontrols",Tt.parentNode.appendChild(n);var i=0,a=1,o=1;e.animation&&e.animation.speedRange&&Qt(e.animation.speedRange[0])&&Qt(e.animation.speedRange[1])&&(i=e.animation.speedRange[0],a=e.animation.speedRange[1],o=a-i);var l=document.createElement("div");l.className="CindyJS-animspeed",n.appendChild(l);var s=document.createElement("div");l.appendChild(s),w(l,"mousedown",(function(e){p=!0,r(e)})),w(l,"mousemove",r),w(Tt.parentNode,"mouseup",(function(e){p=!1}),!0);var u=document.createElement("div");u.className="CindyJS-animbuttons",n.appendChild(u),t("play",m),t("pause",g),t("stop",y),rr.stop(!0),nr=function(e){e=(e-i)/o,e=Math.max(0,Math.min(1,e)),e=.1*Math.round(1e3*e),s.style.width=e+"%"};var p=!1}(e),e.animation&&Qt(e.animation.speed)&&(void 0===e.animation.accuracy&&n(2,9,1875)?c(.5*e.animation.speed):c(e.animation.speed)),e.animation&&Qt(e.animation.accuracy)&&(Xt=e.animation.accuracy)),e.statusbar&&($r="string"==typeof e.statusbar?document.getElementById(e.statusbar):e.statusbar);var o=e.scripts,l=null;"string"==typeof o&&o.search(/\*/)&&(l=o),"object"!=typeof o&&(o=null),"move keydown keyup keytyped keytype mousedown mouseup mousedrag mousemove mouseclick multidown multiup multidrag init tick draw simulationstep simulationstart simulationstop ondrop".split(" ").forEach((function(t){if(null!==o&&o[t])var r=o[t];else{if(e[r=t+"script"])r=document.getElementById(e[r]);else{if(!l)return;if(!(r=document.getElementById(l.replace(/\*/,t))))return}r=r.text}"error"===(r=me(r)).ctype?console.error("Error compiling "+t+" script: "+r.message):Rt[t]=function(e,t){return{ctype:"infix",args:[],impl:function(){pn=[{oper:t}];var r=he(e);return pn=[],r}}}(r,t)})),n(2,9,1888)&&!Rt.keydown&&(Rt.keydown=Rt.keytyped,Rt.keytyped=Rt.keytype,Rt.keytype=void 0),Qt(e.grid)&&0<e.grid&&(Ut=e.grid),e.snap&&(Wt=!0),Number.isFinite(e.snapdistance)&&(Gt=Math.max(e.snapdistance,0)),At={};var u=0;for(var f in Nt={},e.geometry||(e.geometry=[]),function(e){Object.keys(Gn).forEach((function(e){var t=Gn[e];Je(t.signature||"_helper"===e,e+" has no signature"),void 0!==t.updatePosition&&void 0===t.stateSize&&(t.stateSize=0)})),At.gslp=[],At.csnames={},At.points=[],At.lines=[],At.conics=[],At.texts=[],At.free=[],At.polygons=[],At.ifs=[],At.sets={points:[],lines:[],conics:[]},e.forEach(qe),bt()}(e.geometry),e.behavior||(e.behavior=[]),wt(e.behavior),e.images)(u=s(e.images[f],!1))!==p&&(Nt[f]=u);for(var h in e.videos)(f=s(e.videos[h],!0))!==p&&(Nt[h]=f);ur.canvas=i,e.oninit&&e.oninit(ur),kt.instances.push(ur),e.use&&e.use.forEach((function(e){kr.use$1([Or.wrap(e)],{})})),cn.convexhull3d$1&&v("QuickHull3D","QuickHull3D.js"),(cn.colorplot$1||cn.colorplot$2||cn.colorplot$3||cn.colorplot$4)&&v("CindyGL","CindyGL.js"),(cn.playtone$1||cn.playmelody$1)&&v("midi","midi-plugin.js"),d()}}function s(e,t){if("string"==typeof e){if(t){var r=document.createElement("video");r.preload="auto",r.loop=!0,r.setAttribute("playsinline",""),u(r)}else r=new Image;r.src=e}else r=e;if(!r.tagName)return console.error("Not a valid image element",r),p;var n={img:r,width:NaN,height:NaN,ready:!0,live:!1,generation:0,whenReady:h};e=r.tagName.toLowerCase();var i=[];if("img"===e)r.complete?(n.width=r.width,n.height=r.height):(n.ready=!1,r.addEventListener("load",(function(){n.width=r.width,n.height=r.height,n.ready=!0,n.whenReady=h,i.forEach(h),M()})),n.whenReady=i.push.bind(i));else if("video"===e)n.live=!0,r.readyState>=r.HAVE_METADATA?(n.width=r.videoWidth,n.height=r.videoHeight):(n.ready=!1,r.addEventListener("loadedmetadata",(function(){n.width=r.videoWidth,n.height=r.videoHeight,n.ready=!0,n.whenReady=h,i.forEach(h),M()})),n.whenReady=i.push.bind(i));else{if("canvas"!==e)return console.error("Not a valid image element",e,r),p;n.width=r.width,n.height=r.height}return{ctype:"image",value:n}}function c(e){Ft=e,nr&&nr(e)}function h(e){return e()}function v(t,r,n){var i=null;e.plugins&&(i=e.plugins[t]),i||(i=kt._pluginRegistry[t]),i?kr.use$1([Or.wrap(t)],{}):(++ar,kt.autoLoadPlugin(t,r,(function(){kr.use$1([Or.wrap(t)],{}),d(n)})))}function d(r){0==--ar&&(r?M():(he(Rt.init),(e.animation||e).autoplay&&m(),ur.canvas&&function(e,r){function n(t,r){for(var n=0;n<t.changedTouches.length;n++){var i=t.changedTouches[n],o=a(i.identifier);if(r||gr[o]){var l=e.getBoundingClientRect();i=In.to(i.clientX-l.left-e.clientLeft+.5,i.clientY-l.top-e.clientTop+.5),gr[o]=[i[0],i[1]]}}M()}function i(t){var r=e.getBoundingClientRect();t=In.to(t.clientX-r.left-e.clientLeft+.5,t.clientY-r.top-e.clientTop+.5),hr.prevx=hr.x,hr.prevy=hr.y,hr.x=t[0],hr.y=t[1],It[0]=hr.x,It[1]=hr.y,M()}function a(e){if(yr.hasOwnProperty(e))return yr[e];var t=Object.values(yr);t=t.sort((function(e,t){return e-t}));var r,n=!1;for(r in t)!n&&t[r]>1+(0|r)&&(yr[e]=1+(0|r),n=!0);return n||(yr[e]=t.length+1),yr[e]}function o(e){var t=e.changedTouches;n(e,!1);for(var r=0;r<e.changedTouches.length;r++)A(mr=a(e.changedTouches[r].identifier)),delete yr[e.changedTouches[r].identifier];r=!1;for(var i=0;i<t.length;i++)t[i].identifier===f&&(r=!0);r&&(f=-1,hr.down=!1,fr=void 0,he(Rt.mouseup),Me("mouseup"),c||he(Rt.mouseclick),M(),e.preventDefault())}var l=null,u=null,c=!1;"undefined"!=typeof MutationObserver&&(l=MutationObserver),l||"undefined"==typeof WebKitMutationObserver||(l=WebKitMutationObserver),l?((l=new l((function(t){document.body.contains(e)||b()}))).observe(document.documentElement,{childList:!0,subtree:!0}),lr.push((function(){l.disconnect()}))):(w(e,"DOMNodeRemovedFromDocument",b),w(e,"DOMNodeRemoved",b)),!0===r.keylistener?(w(document,"keydown",(function(e){return E(e,Rt.keydown),!1})),w(document,"keyup",(function(e){return E(e,Rt.keyup),!1})),w(document,"keypress",(function(e){return E(e,Rt.keytyped),!1}))):(Rt.keydown||Rt.keyup||Rt.keytyped)&&(e.setAttribute("tabindex","0"),w(e,"mousedown",(function(){e.focus()})),w(e,"keydown",(function(e){9!==e.keyCode&&(E(e,Rt.keydown),Rt.keytyped||e.preventDefault())})),w(e,"keyup",(function(e){E(e,Rt.keyup),e.preventDefault()})),w(e,"keypress",(function(e){9!==e.keyCode&&(E(e,Rt.keytyped),e.preventDefault())})));w(e,"mousedown",(function(e){u=e,c=!1,hr.button=e.which,i(e),O(0),he(Rt.mousedown),Me("mousedown"),hr.down=!0,e.preventDefault()})),w(e,"mouseup",(function(e){hr.down=!1,fr=void 0,he(Rt.mouseup),A(0),Me("mouseup"),delete gr[0],M(),e.preventDefault()})),w(e,"mousemove",(function(e){i(e),hr.down?(u&&(2<Math.abs(u.clientX-e.clientX)||2<Math.abs(u.clientY-e.clientY))&&(c=!0),he(Rt.mousedrag),gr[0]&&(mr=0,he(Rt.multidrag),mr=0)):he(Rt.mousemove),Me("mousemove"),e.preventDefault()})),w(e,"click",(function(e){i(e),c||he(Rt.mouseclick),e.preventDefault()})),w(e,"dragenter",(function(e){e.preventDefault()})),w(e,"dragover",(function(e){e.preventDefault()})),w(e,"drop",(function(t){function r(e,t){function r(){s.readyState===XMLHttpRequest.DONE&&(200!==s.status?(console.error("GET request for "+e+" failed: "+(s.responseText||"(no error message)")),o(t,p)):i(t,s.responseText))}var l=e.replace(/[?#][^]*/,"");l=l.replace(/[^]*\/([^\/])/,"$1"),u[t]={type:"",name:l};var s=new XMLHttpRequest;s.onreadystatechange=function(){if(s.readyState===XMLHttpRequest.DONE)if(200!==s.status)console.error("HEAD request for "+e+" failed: "+(s.responseText||"(no error message)")),o(t,p);else{var i=s.getResponseHeader("Content-Type");u[t].type=i,/^image\//.test(i)?a(t,e):n(i)?((s=new XMLHttpRequest).onreadystatechange=r,s.open("GET",e),s.send()):o(t,p)}},s.open("HEAD",e),s.send()}function n(e){return e=e.replace(/;[^]*/,""),/^text\//.test(e)?1:"application/json"===e?2:0}function i(e,t){switch(n(u[e].type)){case 1:o(e,Or.string(t));break;case 2:try{var r=JSON.parse(t),i=Or.wrapJSON(r)}catch(e){console.error(e),i=p}o(e,i);break;default:o(e,p)}}function a(e,t){var r=new Image,n=!1;r.onload=function(){n||(n=!0,o(e,s(r,!1)))},r.onerror=function(t){n||(n=!0,console.error(t),o(e,p))},r.src=t}function o(e,t,r){c[e]=Ir.turnIntoCSList([t,Or.string(r||t.ctype),Or.string(u[e].type),Or.string(u[e].name)]),0==--f&&(e=v,er=Ir.turnIntoCSList(c),tr=e,he(Rt.ondrop),tr=er=p,M())}t.preventDefault();var l=t.dataTransfer,u=l.files,c=Array(u.length),f=u.length,h=t.currentTarget.getBoundingClientRect(),v=Ir.realVector(In.to(t.clientX-h.left-e.clientLeft+.5,t.clientY-h.top-e.clientTop+.5));0<u.length?Array.prototype.forEach.call(u,(function(e,t){var r=new FileReader;n(e.type)?(r.onload=function(){i(t,r.result)},r.readAsText(e)):/^image\//.test(e.type)?(r.onload=function(){a(t,r.result)},r.readAsDataURL(e)):(console.log("Unknown MIME type: "+e.type),o(t,p))})):(t=l.getData("text/uri-list"))&&(t=t.split("\n").filter((function(e){return!/^\s*(#|$)/.test(e)})),f=t.length,c=Array(f),u=Array(f),t.forEach(r))}));var f=-1;w(e,"touchstart",(function(e){n(e,!0);for(var t=0;t<e.changedTouches.length;t++)O(a(e.changedTouches[t].identifier));-1===f&&(0!==(t=e.changedTouches).length&&(f=t[0].identifier,i(e.targetTouches[0]),he(Rt.mousedown),hr.down=!0,u=e.targetTouches[0],c=!1,Me("mousedown"),e.preventDefault()))}),!1),w(e,"touchmove",(function(e){n(e,!1);for(var t=0;t<e.changedTouches.length;t++)mr=a(e.changedTouches[t].identifier),he(Rt.multidrag),mr=0;t=e.changedTouches;for(var r=!1,o=0;o<t.length;o++)t[o].identifier===f&&(r=!0);r&&(i(e.targetTouches[0]),hr.down?(u&&(2<Math.abs(u.clientX-e.targetTouches[0].clientX)||2<Math.abs(u.clientY-e.targetTouches[0].clientY))&&(c=!0),mr=a(f),he(Rt.mousedrag)):he(Rt.mousemove),Me("mousemove"),e.preventDefault())}),!0),w(e,"touchend",o,!1),"undefined"!=typeof document&&document.body&&w(document.body,"touchcancel",o,!1),"undefined"!=typeof window&&w(window,"resize",(function(){br((function(){t(),M()}))}),!1),T(e.parentNode),M()}(ur.canvas,e)))}function m(){if(!zt){if(jt){var e=kn.backup;e.set(Bn);for(var t={},r=0;r<At.points.length;r++){var n=At.points[r];void 0!==n.behavior&&(t[n.name]=[n.behavior.vx,n.behavior.vy,n.behavior.vz])}or={state:e,speeds:t},Dt=0,jt=!1,rr.stop(!1)}else rr.pause(!1);Bt=Date.now(),rr.play(!0),li&&Qn.forEach((function(e){var t=(e.geo||[]).map((function(e){return At.csnames[e]}));si[e.type].reset(e,t[0],t)})),zt=!0,he(Rt.simulationstart),M()}}function g(){zt&&(rr.play(!1),rr.pause(!0),zt=!1)}function y(){jt||(zt?(he(Rt.simulationstop),zt=!1,rr.play(!1)):rr.pause(!1),rr.stop(!0),jt=!0,null!==or&&(Bn.set(or.state),Object.keys(or.speeds).forEach((function(e){var t=At.csnames[e];void 0!==t.behavior&&(e=or.speeds[e],t.behavior.vx=e[0],t.behavior.vy=e[1],t.behavior.vz=e[2],t.behavior.fx=0,t.behavior.fy=0,t.behavior.fz=0)})),rt()))}function b(){if(!sr){sr=!0;for(var e=kt.instances.length;0<e;)if(kt.instances[--e]===ur){kt.instances.splice(e,1);break}for(e=lr.length;0<e;)try{lr[--e]()}catch(e){console.error(e)}}}function x(e){this.in=function(e,t){console.log(e),t?this.append(this.createTextNode("span","blue",e)):this.append(this.createTextNode("p","blue",e))},this.out=function(e,t){console.log(e),t?this.append(this.createTextNode("span","red",e)):this.append(this.createTextNode("p","red",e))},this.err=function(e,t){console.log(e),t?this.append(this.createTextNode("span","red",e)):this.append(this.createTextNode("p","red",e))},this.createTextNode=function(e,t,r){return"undefined"!=typeof document?((e=document.createElement(e)).appendChild(document.createTextNode(r)),e.style.color=t,e):r+"\n"}}function P(){var e=this,t=document.createElement("div");t.innerHTML='<div id="console" style="border-top: 1px solid #333333; bottom: 0px; position: absolute; width: 100%;"><div id="log" style="height: 150px; overflow-y: auto;"></div><input id="cmd" type="text" style="box-sizing: border-box; height: 30px; width: 100%;"></div>',document.body.appendChild(t);var r=document.getElementById("cmd"),n=document.getElementById("log");r.onkeydown=function(t){13===t.keyCode&&""!==r.value&&(e.in(r.value),t=he(t=kr.parse$1([Or.wrap(r.value)],[])),console.log(R(t)),"undefined"!==t.ctype&&St.out(R(t)),r.value="",n.scrollTop=n.scrollHeight)},this.append=function(e){n.appendChild(e)},this.clear=function(){n.innerHTML=""}}function C(e){var t=e;"string"==typeof e&&(t=document.getElementById(e)),this.append=function(e){t.appendChild(e)},this.clear=function(){t.innerHTML=""}}function _(){this.append=function(e){},this.clear=function(){}}function w(e,t,r,n){void 0===n&&(n=!1),lr.push((function(){e.removeEventListener(t,r,n)})),e.addEventListener(t,r,n)}function S(e,t){var r=document.createElement("div");return r.setAttribute("style",t),e.appendChild(r),r}function T(e){function r(){i.scrollLeft=i.scrollTop=a.scrollLeft=a.scrollTop=1e5}function n(){o===e.clientWidth&&l===e.clientHeight||(o=e.clientWidth,l=e.clientHeight,s||(s=!0,br((function(){s=!1,t(),M()})))),r()}if("undefined"!=typeof document){var i=S(e,"position: absolute; transition: 0s; left: 0; top: 0; right: 0; bottom: 0; overflow: hidden; z-index: -1; visibility: hidden;");S(i,"position: absolute; transition: 0s; left: 0; top: 0; width: 100000px; height: 100000px");var a=S(e,"position: absolute; transition: 0s; left: 0; top: 0; right: 0; bottom: 0; overflow: hidden; z-index: -1; visibility: hidden;");S(a,"position: absolute; transition: 0s; left: 0; top: 0; width: 200%; height: 200%"),r();var o=e.clientWidth,l=e.clientHeight,s=!1;i.addEventListener("scroll",n),a.addEventListener("scroll",n)}}function M(){xr||(xr=br(I))}function I(){if(xr=null,!sr){if(zt){var e=Date.now(),t=Math.min(50,e-Bt)*Ft*Yt;Bt=e,e=Dt+t,li&&void 0!==ei&&ei.tick(t),Dt=e,zt&&he(Rt.tick)}L(),zt&&M()}}function L(){In.reset(),Lt.save(),Lt.clearRect(0,0,Et,Ot);var e,t,r=In.drawingstate.matrix;if(0!==Ut){Lt.beginPath(),Lt.strokeStyle="rgba(0,0,0,0.1)",Lt.lineWidth=1,Lt.lineCap="butt";var n=Ut*r.a;for(e=Math.ceil(-r.tx/n);(t=e*n+r.tx)<Et;)!e&&Ht||(Lt.moveTo(t,0),Lt.lineTo(t,Ot)),e++;for(e=Math.floor(r.ty/n);(t=e*n-r.ty)<Ot;)!e&&Ht||(Lt.moveTo(0,t),Lt.lineTo(Et,t)),e++;Lt.stroke()}if(0!==Vt){Lt.beginPath(),Lt.strokeStyle="rgba(0,0,0,0.1)",Lt.lineWidth=1,Lt.lineCap="butt",n=Vt*r.a;var i=Math.sqrt(3),a=r.ty/i,o=(Ot+r.ty)/i;for(e=Math.ceil(-(r.tx+o)/n);(t=e*n+r.tx)+a<Et;)Lt.moveTo(t+a,0),Lt.lineTo(t+o,Ot),e++;for(e=Math.ceil(-(r.tx-a)/n);(t=e*n+r.tx)-o<Et;)Lt.moveTo(t-a,0),Lt.lineTo(t-o,Ot),e++;for(n*=.5*i,e=Math.floor(r.ty/n);(t=e*n-r.ty)<Ot;)!e&&Ht||(Lt.moveTo(0,t),Lt.lineTo(Et,t)),e++;Lt.stroke()}for(Ht&&(Lt.beginPath(),Lt.strokeStyle="rgba(0,0,0,0.2)",Lt.lineWidth=3,Lt.lineCap="butt",Lt.lineJoin="miter",Lt.miterLimit=10,Lt.beginPath(),Lt.moveTo(0,-r.ty),Lt.lineTo(Et-6,-r.ty),Lt.moveTo(Et-13,-5-r.ty),Lt.lineTo(Et-3,-r.ty),Lt.lineTo(Et-13,5-r.ty),Lt.moveTo(r.tx,Ot),Lt.lineTo(r.tx,6),Lt.moveTo(r.tx-5,13),Lt.lineTo(r.tx,3),Lt.lineTo(r.tx+5,13),Lt.stroke()),function(){if(Vn&&(Vn.currentMouseAndScripts=[]),Yn=!0,fr){tt(fr.mover,Ir.realVector([hr.x+fr.offset.x,hr.y+fr.offset.y,1]),"mouse"),fr.prev.x=hr.x,fr.prev.y=hr.y}he(Rt.move),he(Rt.draw),Dn||Ze(),Yn=!1,Vn&&(Vn.fullLog.push(Ir.turnIntoCSList([Ir.turnIntoCSList(Vn.currentMouseAndScripts)])),Vn.length>Vn.logLength&&Vn.splice(0,Vn.length-Vn.logLength),Vn.currentMouseAndScripts=null,Vn.postMouseHooks.forEach((function(e){e()})))}(),In.greset(),function(){function e(){var e=l++/r._traces.length,t=r._traces[o];t&&(e*=n*e*e,kr.draw$1([t],{size:Cr.real(i),color:r.color,alpha:Cr.real(e)})),i*=a}for(var t=0;t<At.points.length;t++){var r=At.points[t];if(r.drawtrace){r._traces_tick===r.traceskip?(r._traces[r._traces_index]=r.homog,r._traces_index=(r._traces_index+1)%r._traces.length,r._traces_tick=0):r._traces_tick++;var n=r.alpha.value.real,i=r.size.value.real,a=1;1!==r.tracedim&&(i*=r.tracedim,a=Math.pow(r.tracedim,-1/r._traces.length));var o,l=0;for(o=r._traces_index;o<r._traces.length;++o)e();for(o=0;o<r._traces_index;++o)e()}}}(),r=0;r<At.polygons.length;r++)(n=At.polygons[r]).isshowing&&!1!==n.visible&&(a={color:n.color,alpha:n.alpha,fillcolor:n.fillcolor,fillalpha:n.fillalpha,size:n.size,lineJoin:Or.string("miter"),fillrule:Or.string(n.fillrule)},Rr.drawpolygon([n.vertices],a,"D",!0));for(r=0;r<At.conics.length;r++)At.conics[r].isArc?(n=At.conics[r]).isshowing&&!1!==n.visible&&((a={}).color=n.color,a.alpha=n.alpha,a.size=n.size,Rr.drawarc(n,a,n.filled?"F":"D")):(n=At.conics[r]).isshowing&&!1!==n.visible&&((a={}).color=n.color,a.alpha=n.alpha,a.size=n.size,Rr.drawconic(n.matrix,a));for(r=0;r<At.lines.length;r++)e:if(n=At.lines[r],n.isshowing&&!1!==n.visible&&Ir._helper.isAlmostReal(n.homog))if("S"===n.kind)a={overhang:n.overhang,dashtype:n.dashtype,size:n.size,color:n.color,alpha:n.alpha,arrow:n.arrow,arrowsize:n.arrowsize,arrowposition:n.arrowposition,arrowshape:n.arrowshape,arrowsides:n.arrowsides},0<=Cr.mult(n.startpos.value[2],Cr.conjugate(n.endpos.value[2])).value.real?(kr.draw$2([n.startpos,n.endpos],a),n.labeled&&!n.tmp&&(a=n.printname||n.name||"S",o={x:(o=Ir.scalmult(Cr.real(Math.sign(n.startpos.value[2].value.real)*Math.sign(n.endpos.value[2].value.real)),Ir.cross(n.startpos,n.endpos))).value[0].value.real,y:o.value[1].value.real},e=Math.sqrt(o.x*o.x+o.y*o.y),o={x:8*o.x/e-3,y:8*o.y/e-3},o=n.labelpos||o,e=dn.makeColor(Ln.textColor),Ge(n,a,t=Gn._helper.midpoint(Gn._helper.midpoint(n.startpos,n.endpos),n.endpos),o,e))):(dn.handleModifs(a,dn.lineModifs),dn.drawRaySegment(n.startpos,n.endpos));else if("end"===n.clip.value&&"Join"===n.type)e=At.csnames[n.args[0]],a=At.csnames[n.args[1]],kr.draw$2([e.homog,a.homog],{overhang:n.overhang,dashtype:n.dashtype,size:n.size,color:n.color,alpha:n.alpha});else{if("inci"===n.clip.value){for(e=[1e6,0],a=[-1e6,0],t=[1e6,0],o=[-1e6,0],i=0;i<n.incidences.length;i++){var l=At.csnames[n.incidences[i]].homog,s=l.value[0],u=l.value[1],c=l.value[2];Cr._helper.isAlmostZero(c)||(s=Cr.div(s,c),u=Cr.div(u,c),Cr._helper.isAlmostReal(s)&&Cr._helper.isAlmostReal(u)&&(s.value.real<e[0]&&(e=[s.value.real,l]),s.value.real>a[0]&&(a=[s.value.real,l]),u.value.real<t[0]&&(t=[u.value.real,l]),u.value.real>o[0]&&(o=[u.value.real,l])))}if(a[0]-e[0]>o[0]-t[0]?(e=e[1],a=a[1]):(e=t[1],a=o[1]),e!==a){kr.draw$2([e,a],{dashtype:n.dashtype,size:n.size,color:n.color,alpha:n.alpha,overhang:n.overhang});break e}}kr.draw$1([n.homog],{dashtype:n.dashtype,size:n.size,color:n.color,alpha:n.alpha})}for(r=0;r<At.points.length;r++)(n=At.points[r]).isshowing&&!1!==n.visible&&Ir._helper.isAlmostReal(n.homog)&&(a=n.color,n.behavior&&(a=n.color),kr.draw$1([n.homog],{size:n.size,color:a,alpha:n.alpha,noborder:n.noborder,border:n.border}),n.labeled&&!n.tmp)&&(o=n.printname||n.name||"P",e=n.labelpos||{x:3,y:3},t=dn.makeColor(Ln.textColor),!0!==n.noborder.value&&!1!==n.border.value||(t=a),Ge(n,o,n.homog,e,t));for(r=0;r<At.texts.length;r++)He(At.texts[r]);At.ifs.length&&(!Hn.dirty&&Or.deeplyEqual(Hn.mat,In.drawingstate.matrix)||(Gn.IFS.updateParameters(),Hn.dirty=!1),Hn.img&&Lt.drawImage(Hn.img,0,0,Et,Ot)),Lt.restore()}function E(e,t){e=(e=window.event?event:e).charCode?e.charCode:e.keyCode,vr=String.fromCharCode(e),dr=e,he(t),M()}function O(e){mr=e,0===e&&(gr[0]=It),he(Rt.multidown),mr=0}function A(e){mr=e,he(Rt.multiup),delete gr[e],mr=0}function N(e){var t=e.value;e=t[0].value;var r=t[1].value;return t=t[2].value,Ir.turnIntoCSList([e[0],Cr.add(e[1],r[0]),Cr.add(e[2],t[0]),r[1],Cr.add(r[2],t[1]),t[2]])}function k(e){var t=!0;return function(r,n){return t&&(console.error("Operator "+e+" is not supported yet."),t=!1),p}}function R(e,t){if(void 0===e)return"_??_";if(null===e)return"_???_";if("undefined"===e.ctype)return"___";if("number"===e.ctype)return Cr.niceprint(e);if("string"===e.ctype||"boolean"===e.ctype)return e.value;if("list"===e.ctype){t="[";for(var r=0;r<e.value.length;r++)t+=R(he(e.value[r])),r!==e.value.length-1&&(t+=", ");return t+"]"}if("JSON"===e.ctype)try{return Lr.niceprint(e,t)}catch(e){return Lr._helper.handlePrintException(e)}return"dict"===e.ctype?Er.niceprint(e):"function"===e.ctype?"FUNCTION":"infix"===e.ctype?"INFIX":"modifier"===e.ctype?e.key+"->"+R(e.value):"shape"===e.ctype?e.type:"error"===e.ctype?"Error: "+e.message:"variable"===e.ctype?R(zr.getvar(e.name)):"geo"===e.ctype?e.value.name:"image"===e.ctype?"IMAGE":"_?_"}function z(e,t){t="undefined"===e[0].ctype;var r="undefined"===e[1].ctype,n=he(e[1]);return t||r?p:("variable"===e[0].ctype?zr.setvar(e[0].name,n):"infix"===e[0].ctype?"_"===e[0].oper?Rr.assigntake(e[0],n):ge("Can't use infix expression as lvalue"):"field"===e[0].ctype?Rr.assigndot(e[0],n):"userdata"===e[0].ctype?Rr.assigncolon(e[0],n):"function"===e[0].ctype&&"genList"===e[0].oper?"list"===n.ctype?Rr.assignlist(e[0].args,n.value):ge("Expected list in rhs of assignment"):ge("Left hand side of assignment is not a recognized lvalue"),n)}function j(e,t){if(t=he(e[0]),e=he(e[1]),t.ctype===e.ctype){if("number"===t.ctype)return Or.bool(t.value.real===e.value.real&&t.value.imag===e.value.imag);if("string"===t.ctype||"boolean"===t.ctype)return Or.bool(t.value===e.value);if("list"===t.ctype)return Ir.equals(t,e);if("geo"===t.ctype)return Or.bool(t.value===e.value)}return{ctype:"boolean",value:!1}}function D(e,t){return Or.not(j(e,t))}function F(e,t){return t=ve(e[0]),e=ve(e[1]),"number"===t.ctype&&"number"===e.ctype?{ctype:"boolean",value:Cr._helper.isAlmostEqual(t,e)}:"string"===t.ctype&&"string"===e.ctype||"boolean"===t.ctype&&"boolean"===e.ctype?{ctype:"boolean",value:t.value===e.value}:"list"===t.ctype&&"list"===e.ctype?Ir.almostequals(t,e):{ctype:"boolean",value:!1}}function B(e,t){return t=ve(e[0]),e=ve(e[1]),"boolean"===t.ctype&&"boolean"===e.ctype?{ctype:"boolean",value:t.value&&e.value}:p}function X(e,t){return t=ve(e[0]),e=ve(e[1]),"boolean"===t.ctype&&"boolean"===e.ctype?{ctype:"boolean",value:t.value||e.value}:p}function $(e,t){"void"!==(t=e[0]).ctype&&(t=ve(t)),e=ve(e[1]);var r=Or.add(t,e);return"Angle"===t.usage&&"Angle"===e.usage&&(r=Or.withUsage(r,"Angle")),r}function Y(e,t){"void"!==(t=e[0]).ctype&&(t=ve(t)),e=ve(e[1]);var r=Or.sub(t,e);return"Angle"===t.usage&&"Angle"===e.usage&&(r=Or.withUsage(r,"Angle")),r}function q(e,t){t=ve(e[0]),e=ve(e[1]);var r=Or.mult(t,e);return("Angle"!==t.usage||e.usage)&&("Angle"!==e.usage||t.usage)||(r=Or.withUsage(r,"Angle")),r}function U(e,t){t=ve(e[0]),"number"===(e=ve(e[1])).ctype&&Cr._helper.isZero(e)&&ge("WARNING: Division by zero!");var r=Or.div(t,e);return("Angle"!==t.usage||e.usage)&&("Angle"!==e.usage||t.usage)||(r=Or.withUsage(r,"Angle")),r}function V(e,t){return t=ve(e[0]),e=ve(e[1]),"number"===t.ctype&&"number"===e.ctype?Cr.pow(t,e):p}function W(e,t){if(t=de(e[0]),e=de(e[1]),t!==p&&e!==p){var r=Ir.cross(t,e);return"Point"===t.usage&&"Point"===e.usage&&(r=Or.withUsage(r,"Line")),"Line"===t.usage&&"Line"===e.usage&&(r=Or.withUsage(r,"Point")),r}return p}function G(e){var t=e.length;if(0===t)return[];if(1===t)return[0];if(2===t)return e[0][0]+e[1][1]<=e[0][1]+e[1][0]?[0,1]:[1,0];if(4<t)return function(e){function t(){return{matched:-1,prev:-1,start:-1,cost:0,used:!1,leaf:!1}}function r(e){for(var t=0;t<l;++t)0<c[e][t]||u[t].used||(u[t].used=!0,r(u[t].matched))}function n(e){for(var t=0;t<l;++t)0<c[t][e]||s[t].used||(s[t].used=!0,n(s[t].matched))}var i,a,o=Math.abs,l=e.length,s=Array(l),u=Array(l),c=Array(l);for(i=0;i<l;++i)c[i]=Array(l);for(i=0;i<l;++i)for(s[i]=t(),u[i]=t(),s[i].cost=e[i][0],a=1;a<l;++a)s[i].cost>e[i][a]&&(s[i].cost=e[i][a]);for(;;){for(i=0;i<l;++i)for(a=0;a<l;++a)c[i][a]=e[i][a]-s[i].cost-u[a].cost,c[i][a]<1e-14*(o(e[i][a])+o(s[i].cost)+o(u[a].cost))&&(c[i][a]=0);for(i=0;i<l;++i)s[i].matched=u[i].matched=-1;for(var p=0;;){for(i=0;i<l;++i)s[i].used=s[i].leaf=u[i].used=u[i].leaf=!1,-1===s[i].matched&&(s[i].start=i,s[i].used=s[i].leaf=!0,s[i].prev=-1);for(var f=!1,h=!1;!h;){for(i=0;i<l;++i)if(s[i].leaf)for(s[i].leaf=!1,a=0;a<l;++a)if(!(u[a].used||0<c[i][a])&&s[i].matched!==a&&(u[a].prev=i,u[a].start=s[i].start,u[a].used=u[a].leaf=!0,-1===u[a].matched)){s[u[a].start].prev=a,f=!0;break}if(f)break;for(h=!0,a=0;a<l;++a)u[a].leaf&&(u[a].leaf=!1,i=u[a].matched,s[i].used||(s[i].prev=a,s[i].start=u[a].start,s[i].used=s[i].leaf=!0,h=!1))}if(!f)break;for(f=0;f<l;++f)if(-1===s[f].matched&&-1!==s[f].prev){a=s[f].prev;do{i=u[a].prev,u[a].matched=i,s[i].matched=a,a=s[i].prev}while(i!==f);++p}}if(p===l)break;for(i=0;i<l;++i)s[i].used=s[i].leaf=u[i].used=u[i].leaf=!1;for(i=0;i<l;++i)-1===s[i].matched&&r(i);for(a=0;a<l;++a)-1===u[a].matched&&n(a);for(i=0;i<l;++i)-1===s[i].matched||s[i].used||u[s[i].matched].used||(s[i].used=!0);for(p=Number.POSITIVE_INFINITY,i=0;i<l;++i)if(!s[i].used)for(a=0;a<l;++a)u[a].used||p>c[i][a]&&(p=c[i][a]);for(i=0;i<l;++i)s[i].used||(s[i].cost+=p),u[i].used&&(u[i].cost-=p)}for(e=Array(l),i=0;i<l;++i)a=s[i].matched,e[i]=a;return e}(e);for(var r=Fr[t],n=Number.POSITIVE_INFINITY,i=r[0],a=0;a<r.length;++a){for(var o=r[a],l=0,s=0;s<t;++s)l+=e[s][o[s]];l<n&&(n=l,i=o)}return i}function H(e,t){if(t=he(e[0]),e=ve(e[1]),"string"!==t.ctype&&"JSON"!==t.ctype&&(t=Ir.asList(t)),"JSON"!==t.ctype&&"number"===e.ctype)return 0>(e=Math.floor(e.value.real))&&(e=t.value.length+e+1),0<e&&e<t.value.length+1?"list"===t.ctype?t.value[e-1]:{ctype:"string",value:t.value.charAt(e-1)}:(ge("WARNING: Index out of range!"),p);if("JSON"===t.ctype)return e=R(e),-1!==R.errorTypes.indexOf(e)?p:void 0!==(t=t.value[e])&&t.ctype?t:p;if("list"===e.ctype){for(var r=[],n=0;n<e.value.length;n++){var i=ve(e.value[n]);r[n]=H([t,i],[])}return Ir.turnIntoCSList(r)}return p}function J(e,t){return t=he(e[0]),e=he(e[1]),"shape"===t.ctype&&"shape"===e.ctype?Rr.shapeconcat(t,e):(t=Ir.asList(t),e=Ir.asList(e),"list"===t.ctype&&"list"===e.ctype?Ir.concat(t,e):p)}function Z(e,t){return t=he(e[0]),e=he(e[1]),"list"===t.ctype&&"list"===e.ctype?Ir.set(Ir.common(t,e)):"shape"===t.ctype&&"shape"===e.ctype?Rr.shapecommon(t,e):p}function K(e,t){return t=he(e[0]),e=he(e[1]),"list"===t.ctype&&"list"===e.ctype?Ir.remove(t,e):"shape"===t.ctype&&"shape"===e.ctype?Rr.shaperemove(t,e):p}function Q(e,t){return t=he(e[0]),e=he(e[1]),"list"===t.ctype?Ir.append(t,e):p}function ee(e,t){return t=he(e[0]),"list"===(e=he(e[1])).ctype?Ir.prepend(t,e):p}function te(e,t){if(t|=0,0===(e|=0)&&0===t)return 0;for(;0!==t;){var r=e;e=t,t=r%t|0}return e}function re(e){return 1===e?0:1}function ne(e,t,r){var n=t*t-4*e*r;return 0<=n?(n=Math.sqrt(n),0<t&&(n=-n),t=[[n-t,2*e],[2*r,n-t]]):t=null,null===t?null:(e=t[0][0]/t[0][1],(t=t[1][0]/t[1][1])<e?[t,e]:[e,t])}function ie(e){return"image"===e.ctype?e.value:"string"===e.ctype&&Nt.hasOwnProperty(e.value)?Nt[e.value].value:null}function ae(e,t,r,n,i){var a=[];if(e.readPixels)a=e.readPixels(t,r,n,i);else{if(e.img.getContext)var o=e.img.getContext("2d"),l=o.getImageData(t,r,n,i).data;else try{Ur||(Ur=document.createElement("canvas")),Ur.width=n,Ur.height=i,(o=Ur.getContext("2d")).drawImage(e.img,t,r,n,i,0,0,n,i),l=o.getImageData(0,0,n,i).data}catch(e){console.log(e)}for(var s in l)a.push(l[s]/255)}return a}function oe(e){return e.replace(/[^A-Za-z0-9 \u0080-\uffff]/gi,"\\$&")}function le(e,t,r){var n=e;return t&&(n=n+" at "+t.row+":"+t.col),r&&(n=n+": ‘"+r+"’"),(n=Error(n)).name="CindyScriptParseError",n.description=e,n.location=t,n.text=r,n}function se(e){this.input=e,this.re=new RegExp(on,"g");for(var t=[],r=e.indexOf("\n")+1;r;)t.push(r),r=e.indexOf("\n",r)+1;t.push(e.length),this.bols=t,this.bol=this.pos=0,this.line=1}function ue(e){var t=e[e.length-2],r=e[e.length-3],n=e[e.length-1];if(r){if(r.isSuperscript&&t.precedence<=r.precedence)throw le("Operator not allowed after superscript",t.start,t.text);if(n){if(!t.op.infix)throw le("Operator may not be used infix",t.start,t.text)}else if(!t.op.postfix)throw le("Operator may not be used postfix",t.start,t.text)}else if(n){if(!t.op.prefix)throw le("Operator may not be used prefix",t.start,t.text)}else if(!t.op.bare)throw le("Operator without operands",t.start,t.text);t.ctype="infix",t.oper=t.op.sym,t.args=[r,n],e.splice(e.length-3,3,t)}function ce(e,t,r,n){for(1&e.length||e.push(null),r=en[r];3<=e.length&&e[e.length-2].precedence<=r.precedence;)ue(e);e.push({op:r,precedence:r.precedence+(r.rassoc?1:0),start:t.start,end:t.end,text:t.text,rawtext:t.rawtext}),r="";for(var i=t.text,a=0;a<i.length;++a)r+="0123456789+-".charAt(n.indexOf(i.charAt(a)));t.ctype="number",t.value={real:+r,imag:0},e.push(t),ue(e)}function pe(e,t){var r=[],n="}"===t;e:for(;;){var i=e.next();switch(i.toktype){case"OP":var a=en[i.text];for("_"!==a.sym||!r.length||1&r.length||"OP"!==r[r.length-1].toktype||":="!==r[r.length-1].op.sym||(r.pop(),a=en[":=_"],i.text=a.sym),i.op=a,i.precedence=a.precedence,1&r.length||r.push(null);3<=r.length&&r[r.length-2].precedence<=i.precedence;)ue(r);a.rassoc&&i.precedence++,n&&":"===a.sym&&(i.jsonatom=!0,i.precedence=en[","].precedence,n=!1),"}"===t&&","===a.sym&&0<r.length&&r[r.length-1].jsonatom&&(n=!0),r.push(i);break;case"ID":if(i.ctype="variable",i.name=i.text,1&r.length)throw le("Missing operator",i.start,i.text);r.push(i);break;case"NUM":if(i.ctype="number",i.value={real:+i.text,imag:0},1&r.length)throw le("Missing operator",i.start,i.text);r.push(i);break;case"STR":if(i.ctype="string",i.value=i.raw.substring(1,i.raw.length-1),1&r.length)throw le("Missing operator",i.start,i.text);r.push(i);break;case"SUB":ce(r,i,"_","₀₁₂₃₄₅₆₇₈₉₊₋");break;case"SUP":ce(r,i,"^","⁰¹²³⁴⁵⁶⁷⁸⁹⁺⁻"),r[r.length-1].isSuperscript=!0;break;case"BRA":if(a="[](){}||".indexOf(i.text),i.text===t||1&a)break e;var o=pe(e,a="[](){}||".charAt(a+1)),l=o.closedBy;if(l.text!==a)throw le("Opening "+i.text+" at "+i.start.row+":"+i.start.col+" closed by "+(l.text||"EOF")+" at "+l.start.row+":"+l.start.col);if(l=i.text+l.text,a=[],o=o.expr){for(;o&&"infix"===o.ctype&&","===o.oper;)a.push(o.args[0]),o=o.args[1];a.push(o)}if(1&r.length){if("{}"===l)throw le("{…} not yet defined for operators.",i.start);if("variable"!==(o=r[r.length-1]).ctype)throw le("Function name must be an identifier",o.start);if(2<r.length&&r[r.length-2].precedence<Wr)throw le("Function call in indexing construct must be enclosed in parentheses",i.start);o.ctype="function",i=o.args=[],l=o.modifs={};for(var s=0;s<a.length;++s){var u=a[s];if(u&&"infix"===u.ctype&&"->"===u.oper){var c=u.args[0];if("variable"!==c.ctype)throw le("Modifier name must be an identifier",u.start);l[c.name]=u.args[1]}else i.push(u)}o.oper=o.name.toLowerCase()+"$"+o.args.length}else if("||"===l)if(1===a.length)r.push({ctype:"function",oper:"abs_infix",args:a,modifs:{}});else{if(2!==a.length)throw le("Don't support |…| with "+a.length+" arguments",i.start);r.push({ctype:"function",oper:"dist_infix",args:a,modifs:{}})}else"{}"===l?r.push({ctype:"function",oper:"genJSON",args:a,modifs:{}}):"[]"!==l&&1===a.length?r.push({ctype:"paren",args:a}):0===a.length?r.push({ctype:"list",value:[]}):r.push({ctype:"function",oper:"genList",args:a,modifs:{}});break;case"EOF":break e}}for(1&r.length||r.push(null);3<=r.length;)ue(r);return{expr:r[0],closedBy:i}}function fe(e){this.usedFunctions={},this.usedVariables={}}function he(e){if(void 0===e)return p;if("infix"===e.ctype)return e.impl(e.args,{},e);if("variable"===e.ctype)return he(zr.getvar(e.name));if("function"===e.ctype)return pn.push(e),e=Rr.evaluate(e.oper,e.args,e.modifs),pn.pop(),e;if("void"===e.ctype)return p;if("field"===e.ctype){var t=he(e.obj);return"geo"===t.ctype?jr.getField(t.value,e.key):"list"===t.ctype?Ir.getField(t,e.key):"JSON"===t.ctype?Lr.getField(t,e.key):p}return"userdata"===e.ctype?(t=he(e.obj),"_?_"===(e=Or.string(R(he(e.key)))).value&&(e=p),"geo"===t.ctype?jr.getuserData(t.value,e):"list"===t.ctype||"string"===t.ctype?jr.getuserData(t,e):p):e}function ve(e){if("geo"===(e=he(e)).ctype){var t=e.value;if("P"===t.kind)return jr.getField(t,"xy");if("V"===t.kind)return t.value}return e}function de(e){if("geo"===(e=he(e)).ctype){var t=e.value;if("P"===t.kind||"L"===t.kind)return jr.getField(t,"homog")}return Ir._helper.isNumberVecN(e,3)?e:Ir._helper.isNumberVecN(e,2)?(t=Ir.turnIntoCSList([e.value[0],e.value[1],Cr.real(1)]),e.usage&&(t=Or.withUsage(t,e.usage)),t):p}function me(e){var t=new fe;for(var r in t.usedFunctions=cn,t.infixmap=Nr,e=t.parse(e),t.usedVariables)zr.create(r);return e}function ge(e){St.err(e+pn.map((function(e){return"\n  at "+e.oper})).join("\n"))}function ye(){this._path=[],this._defs=["<defs>"],this._imgcache=[],this._body=[],this._saveStack=[""],this._clipIndex=0,this._stroke=this._fill="#000",this._strokeOpacity=this._fillOpacity=null,this.height=this.width=0,this.lineWidth=1,this.lineCap="butt",this.lineJoin="miter",this.miterLimit=10,this.globalAlpha=1}function be(){this._body=[],this._yPos=this._xPos=NaN,this._extGState={Af255:"<< /ca 1 >>",As255:"<< /CA 1 >>"},this._objects=[["%PDF-1.4\n"]],this._offset=this._objects[0][0].length,this._nextIndex=5,this._imgcache=[],this._xobjects={},this._pathUsed=-1,this._fillAlpha=this._strokeAlpha=this._globalAlpha=1,this.height=this.width=0,this.lineWidth=1,this.lineCap="butt",this.lineJoin="miter",this.miterLimit=10}function xe(e,t){var r=e.width,n=e.height,i=document.createElement("canvas");i.setAttribute("width",r),i.setAttribute("height",n),i.setAttribute("style","display:none;");var a=ur.canvas;a.parentNode.insertBefore(i,a.nextSibling);try{return i.getContext("2d").drawImage(e,0,0,r,n),i.toDataURL(t||"image/png")}finally{i.parentNode.removeChild(i)}}function Pe(e,t){var r;if(r=/^rgba\(([0-9.]+), *([0-9.]+), *([0-9.]+), *([0-9.]+)\)$/.exec(e))t(+r[1],+r[2],+r[3],+r[4]);else{if(!(r=/^rgb\(([0-9.]+), *([0-9.]+), *([0-9.]+)\)$/.exec(e)))throw Error("Can't handle color style "+e);t(+r[1],+r[2],+r[3],1)}}function Ce(e,t,r){for(r||(r="0");e.length<t;)e=r+e;return e}function _e(){null!==mn&&(window.URL.revokeObjectURL(mn),mn=null)}function we(e){!function(e){var t=1;Object.keys(Nt).forEach((function(r){var n=Nt[r].value.img;if(void 0===n.cachedDataURL&&n.src)if("data:"===n.src.substr(0,5))n.cachedDataURL=n.src;else{++t,n.cachedDataURL=null;var i=new XMLHttpRequest;i.responseType="blob",i.onreadystatechange=function(){if(i.readyState===XMLHttpRequest.DONE)if(200===i.status){var r=new FileReader;r.onloadend=function(){n.cachedDataURL=r.result,console.log("Cached data for image "+n.src),0==--t&&e()},r.readAsDataURL(i.response)}else console.error("Failed to load "+n.src+": "+i.statusText),0==--t&&e()},i.open("GET",n.src,!0),i.send()}})),0==--t&&e()}((function(){var t=Lt;try{(Lt=new e).width=Et,Lt.height=Ot,L();var r=Lt.toBlob();mn=window.URL.createObjectURL(r),yn(mn)}finally{Lt=t}}))}function Se(e){var t=null,r=1e6;console.log("getElementAtMouse");for(var n=0;n<At.gslp.length;n++){var i=At.gslp[n];if(!i.pinned&&!1!==i.visible&&!0!==i.tmp){var a=In.drawingstate.matrix.sdet;if("P"===i.kind){var o=Ir.normalizeZ(i.homog);if(!Ir._helper.isAlmostReal(o))continue;var l=o.value[0].value.real-e.x,s=o.value[1].value.real-e.y,u=Math.sqrt(l*l+s*s);i.narrow&u>20/a&&(u=1e4)}else"C"===i.kind?(s=At.csnames[i.args[0]],u=0,void 0!==i.radius&&(u=i.radius.value.real),l=Cr.div(s.homog.value[0],s.homog.value[2]).value.real,s=Cr.div(s.homog.value[1],s.homog.value[2]).value.real,l-=e.x,s-=e.y,u=Math.sqrt(l*l+s*s)-u,s=l=0,0>u&&(u=-u),u+=30/a):"L"!==i.kind&&"S"!==i.kind||(l=i.homog,s=(u=Cr).add(u.mult(l.value[0],u.conjugate(l.value[0])),u.mult(l.value[1],u.conjugate(l.value[1]))),s=Ir.scaldiv(u.sqrt(s),l),u=s.value[0].value.real*e.x+s.value[1].value.real*e.y+s.value[2].value.real,l=s.value[0].value.real*u,s=s.value[1].value.real*u,0>u&&(u=-u),u+=1);if(u<r+.2/a){r=u,t=i;var c={x:l,y:s}}}}return null===t?null:{mover:t,offset:c,prev:{x:e.x,y:e.y}}}function Te(){return"P"+Cn++}function Me(e){var t=wn[bn].actions;t[_n].event===e&&t[_n].do()&&(M(),_n===t.length-1?(xn=[],_n=Pn=0):_n++)}function Ie(e){return e&&.5>Math.abs(e.offset.x)&&.5>Math.abs(e.offset.y)&&!e.mover.tmp}function Le(e){return Ie(e)&&"P"===e.mover.kind}function Ee(e){return Ie(e)&&("L"===e.mover.kind||"S"===e.mover.kind)}function Oe(e){fr={mover:e,offset:{x:0,y:0},prev:{x:hr.x,y:hr.y}}}function Ae(){var e=Se(hr);Le(e)?xn[Pn]=e.mover:(xn[Pn]={type:"Free",name:Te(),labeled:!0,pos:[It[0],It[1],1]},Ye(xn[Pn])),Pn++}function Ne(){var e=Se(hr);return!!Ee(e)&&(xn[Pn]=e.mover,Pn++,!0)}function ke(){var e,t=Se(hr);return(e=Ee(t))||(e=Ie(t)&&"C"===t.mover.kind),!!e&&(xn[Pn]=t.mover,Pn++,!0)}function Re(){var e=Se(hr);if(Le(e))for(gn.args[1]=e.mover.name,e=0;e<At.gslp.length;e++){var t=At.gslp[e];!0===t.tmp&&Ue(t.name)}else for(e=0;e<At.gslp.length;e++)!0===(t=At.gslp[e]).tmp&&(t.tmp=!1)}function ze(e){var t={type:"Free",name:Te(),labeled:!0,pos:[It[0],It[1],1],tmp:!0};t=Ye(t),gn=Ye({type:e,name:Te(),labeled:!0,args:[xn[0].name,t.name]}),Oe(t)}function je(e){void 0===e.tracedim&&(e.tracedim=1),void 0===e.tracelength&&(e.tracelength=100),void 0===e.traceskip&&(e.traceskip=1),e._traces=Array(e.tracelength),e._traces_index=0,e._traces_tick=0}function De(e){void 0===e.size&&(e.size=Ln.pointSize),e.size=Cr.real(e.size),!e.movable||e.pinned?(e.color=Ir.realVector(e.color||Ln.pointColor),e.color=Ir.scalmult(Cr.real(Ln.dimDependent),e.color)):e.color=Ir.realVector(e.color||Ln.pointColor),void 0===e.alpha&&(e.alpha=Ln.alpha),e.alpha=Cr.real(e.alpha),"boolean"!=typeof e.noborder&&(e.noborder=Ln.noborder),e.noborder=Or.bool(e.noborder),"boolean"!=typeof e.border&&(e.border=!Ln.noborder),e.border=Or.bool(e.border),e.drawtrace&&je(e)}function Fe(e){void 0===e.size&&(e.size=Ln.lineSize),e.size=Cr.real(e.size),e.color=Ir.realVector(e.color||Ln.lineColor),void 0===e.alpha&&(e.alpha=Ln.alpha),e.alpha=Cr.real(e.alpha),e.clip=Or.string(e.clip||Ln.clip),void 0===e.overhang&&(e.overhang=Ln.overhangLine),e.overhang=Cr.real(e.overhang),e.dashtype&&(e.dashtype=Or.wrap(e.dashtype))}function Be(e){void 0===e.overhang&&(e.overhang=Ln.overhangSeg),e.arrow&&(e.arrow=Or.bool(e.arrow)),e.arrowsize&&(e.arrowsize=Cr.real(e.arrowsize)),e.arrowposition&&(e.arrowposition=Cr.real(e.arrowposition)),e.arrowshape&&(e.arrowshape=Or.string(e.arrowshape)),e.arrowsides&&(e.arrowsides=Or.string(e.arrowsides)),Fe(e),e.clip=Or.string("end")}function Xe(e){e.size=void 0!==e.textsize?e.textsize:void 0!==e.size?e.size:Ln.textsize,e.size=Cr.real(+e.size)}function $e(e){e.filled=void 0!==e.filled?Or.bool(e.filled):Or.bool(!0),e.fillcolor=void 0===e.fillcolor?p:Ir.realVector(e.fillcolor),void 0===e.fillalpha&&(e.fillalpha=0),e.fillalpha=Cr.real(e.fillalpha),Fe(e)}function Ye(e,t){return e=qe(e),bt(),"boolean"==typeof t&&t&&e.Duplicate?(t=e.Duplicate,console.log("duplication detected: removing "+e.name+" (type "+e.kind+") (duplicate of "+t.name+")."),Ue(e.name),t):e}function qe(e){if(void 0!==At.csnames[e.name]){console.log("Element name '"+e.name+"' already exists");var t=At.csnames[e.name];return Gn[t.type].isMovable&&"P"===Gn[t.type].kind&&et(t,e.pos,"homog"),t}for(;Jn.hasOwnProperty(e.type);)e.type=Jn[e.type];if(t=Zn[e.type]){var r=t(e),n=null;for(t=0;t<r.length;++t)n=Ye(r[t]);return n}var i=Gn[e.type];if(r=!1,!i)return console.error(e),console.error("Operation "+e.type+" not implemented yet"),null;if("**"!==i.signature)if(Array.isArray(i.signature)||"*"!==i.signature.charAt(1)){if(i.signature.length!==(e.args?e.args.length:0))return console.error("Wrong number of arguments for "+e.name+" of type "+e.type),"undefined"!=typeof window&&window.alert("Wrong number of arguments for "+e.name),null}else r=!0,e.args.forEach((function(t){if(At.csnames[t].kind!==i.signature.charAt(0))return console.error("Not all elements in set are of same type: "+e.name+" expects "+i.signature+" but "+t+" is of kind "+At.csnames[t].kind),"undefined"!=typeof window&&window.alert("Not all elements in set are of same type: "+e.name),null}));if(e.args)for(t=0;t<e.args.length;++t){if(!At.csnames.hasOwnProperty(e.args[t]))return console.log("Dropping "+e.name+" due to missing argument "+e.args[t]),null;if("**"!==i.signature&&!r&&(n=At.csnames[e.args[t]].kind,i.signature[t]!==n&&("S"!==n||"L"!==i.signature[t])))return window.alert("Wrong argument kind "+n+" as argument "+t+" to element "+e.name+" of type "+e.type),null}i.signatureConstraints&&!i.signatureConstraints(e)&&window.alert("signature constraints violated for element "+e.name),At.gslp.push(e),At.csnames[e.name]=e,t=$n.length,e.kind=i.kind,e.stateIdx=t,t+=i.stateSize,e.incidences=[],e.isshowing=!0,e.movable=!1,i.isMovable&&(e.movable=!0,At.free.push(e)),"P"===e.kind&&(At.points.push(e),De(e)),"L"===e.kind&&(At.lines.push(e),Fe(e)),"C"===e.kind&&(At.conics.push(e),Fe(e)),"S"===e.kind&&(At.lines.push(e),Be(e)),"Text"===e.kind&&(At.texts.push(e),Xe(e)),"Poly"===e.kind&&(At.polygons.push(e),$e(e)),"IFS"===e.kind&&At.ifs.push(e),/^[P|L|S|C]s$/.test(e.kind)&&At.sets[{P:"points",L:"lines",S:"lines",C:"conics"}[e.kind[0]]].push(e),function(e){if(e!==$n.length){var t,r=An.length;if(Nn.length<e*r){var n=2*e;Nn=new Float64Array(r*n)}else n=Nn.length/r|0;for(t=0;t<r;++t)kn[An[t]]=Nn.subarray(t*n,t*n+e);e=$n,Bn=kn.in,Xn=kn.out,($n=kn.good).set(e)}}(t),Bn=Xn=$n,jn=!0,i.initialize&&(Rn=zn=e.stateIdx,e.param=i.initialize(e),Je(zn===e.stateIdx+i.stateSize,"State fully initialized")),Rn=zn=e.stateIdx,i.updatePosition(e,!1),Je(Rn===e.stateIdx+i.stateSize,"State fully consumed"),Je(zn===e.stateIdx+i.stateSize,"State fully updated"),jn=!1,(Bn=kn.in).set($n),Xn=kn.out,We(e,i),En={};try{ht(e),vt(e)}catch(e){console.error(e)}return At.csnames[e.name]}function Ue(e){if(At.csnames.hasOwnProperty(e)){var t={};Object.keys(At.csnames).forEach((function(e){var r=At.csnames[e];r.hasOwnProperty("args")&&r.args.forEach((function(r){t.hasOwnProperty(r)||(t[r]={}),t[r][e]=!0}))}));var r=function(e,n){if(n[e]=!0,!t.hasOwnProperty(e))return n;for(var i in t[e])n[i]||r(i,n);return n};(function(e){var t=Object.keys(e),r=function(e,t){return function(t){return!e[t.name]}},n={};for(var i in t.forEach((function(t){At.csnames[t].incidences.forEach((function(t){n[t]||(At.csnames[t].incidences=At.csnames[t].incidences.filter((function(t){return!e[t]})),n[t]=!0)}))})),"conics free gslp ifs lines points polygons texts".split(" ").map((function(t){At[t]=At[t].filter(r(e,t))})),At.sets)At.sets[i]=At.sets[i].filter(r(e,"set of "+i));t.forEach((function(e){delete At.csnames[e]})),En={}})(e=r(e,{}))}else console.log("removeElement: name "+e+"does not exist.")}function Ve(e,t){var r=At.csnames[t.args[0]].homog,n=At.csnames[t.args[1]].homog;t=e.homog,e=Cr.div(r.value[0],r.value[2]),r=Cr.div(r.value[1],r.value[2]);var i=Cr.div(n.value[0],n.value[2]);n=Cr.div(n.value[1],n.value[2]);var a=Cr.div(t.value[0],t.value[2]);return t=Cr.div(t.value[1],t.value[2]),!!(Cr._helper.isAlmostReal(e)&&Cr._helper.isAlmostReal(r)&&Cr._helper.isAlmostReal(i)&&Cr._helper.isAlmostReal(n)&&Cr._helper.isAlmostReal(a)&&Cr._helper.isAlmostReal(t))&&(e=e.value.real,r=r.value.real,i=i.value.real,n=n.value.real,a=a.value.real,t=t.value.real,1e-15>(e=Math.sqrt((e-i)*(e-i)+(r-n)*(r-n))-Math.sqrt((e-a)*(e-a)+(r-t)*(r-t))-Math.sqrt((i-a)*(i-a)+(n-t)*(n-t)))*e)}function We(e,t){if(e.isshowing=!0,e.args)for(var r=0;r<e.args.length;r++)if(!At.csnames[e.args[r]].isshowing)return void(e.isshowing=!1);t.visiblecheck&&t.visiblecheck(e)}function Ge(e,t,r,n,i){var a=e.textsize||Ln.textsize,o=!0===e.textbold,l=!0===e.textitalics,s=e.text_fontfamily||Ln.fontFamily,u=n.x*n.x+n.y*n.y,c=1;0<u&&(c=1+e.size.value.real/Math.sqrt(u)),e=e.alpha||Cr.real(Ln.alpha),Rr.drawtext([r,Or.wrap(t)],{x_offset:Or.wrap(c*n.x),y_offset:Or.wrap(c*n.y),size:Or.wrap(a),bold:Or.wrap(o),italics:Or.wrap(l),family:Or.wrap(s),color:i,alpha:e})}function He(e){if(e._bbox=null,e.isshowing&&!1!==e.visible){var t={size:e.size},r=e.homog,n=e.text,i=Gn[e.type].getText;if(n=i?i(e):n.replace(/@[$#]"([^"\\]|\\.)*"/g,(function(e){try{var t=JSON.parse(e.substring(2)),r=At.csnames[t];if(!r)return"?"}catch(e){return"?"}switch(e.charAt(1)){case"$":return r.printname||t;case"#":return"V"!==r.kind?"?":R(r.value)}})),i=null,e.html){var a=e._textCache||{text:!1},o=e.html,l=o.parentNode,s=l.parentNode;i=function(t,r,n,i,u){r/=Kt,n/=Kt,u=dn.bold+dn.italics+Math.round(u/Kt*10)/10+"px "+dn.family,a.invisible&&s.style.removeProperty("display"),t===a.text&&u===a.font&&r===a.x&&n===a.y&&i===a.align||(u!==a.font&&(o.style.font=u,o.style.lineHeight=Ln.lineHeight),t!==a.text&&!1!==t&&!1===qr(o,t,u)&&(t=!1),s.style.left=r+"px",s.style.top=n+"px",(i||l.style.transform)&&(l.style.transform="translateX("+-100*i+"%)"),e._textCache={text:t,font:u,x:r,y:n,align:i})}}n=Or.string(n),e.dock&&(e.dock.to?r=At.csnames[e.dock.to].homog:On.hasOwnProperty(e.dock.corner)&&(r=(r=kr.screenbounds$0([],{})).value[On[e.dock.corner]]),t.offset=e.dock.offset),e.align&&(t.align=Or.string(e.align)),r&&(e._bbox=Rr.drawtext([r,n],t,i))}else e.html&&(e.html.parentNode.parentNode.style.display="none",e._textCache={invisible:!0})}function Je(e,t){if(t="Assertion failed: "+t,!e)throw console.log(t),b(),"undefined"!=typeof alert&&alert(t),Error(t)}function Ze(){$n.set(Bn),Dn=!1,nt(!1);for(var e=$n.length,t=Math.abs,r=0;r<e;r+=2)t($n[r])>1e12*t($n[r+1])&&($n[r+1]=0)}function Ke(){if(!Fn)throw qn;Dn=!0}function Qe(e,t,r,n,i){return Or.add(n,Or.mult(r,Or.sub(i,n)))}function et(e,t,r){tt(e,t,r),Yn||Dn||Ze()}function tt(e,t,r){Vn&&Vn.currentMouseAndScripts&&(Vn.currentMover=[]),e===Un?(Bn.set($n),Dn=!1):(Un=e,Ze()),Xn.set(Bn);var n,i=1e4,a=En[e.name];if(!a){var o={},l=0;a=[],o[e.name]=e;for(var s=At.gslp,u=0;u<s.length;++u){var c=s[u],p=c.args;if(p)for(var f=0;f<p.length;++f)o.hasOwnProperty(p[f])&&(o[c.name]=c,a[l++]=c)}En[e.name]=a}for(o=-1,l=.9,u=(s=Gn[e.type]).parameterPath||Qe,Rn=e.stateIdx,c=s.getParamFromState(e),Rn=zn=e.stateIdx,p=s.getParamForInput(e,t,r),f=o+l;o!==f;){var h=f*f,v=.5/(1+h);v=Cr.complex(2*f*v+.5,(1-h)*v),Fn=o+.5*l<=o||0===i,0===i&&console.log("tracing limit Reached"),h=!1,Vn&&Vn.currentMouseAndScripts&&(Vn.currentStep=[]);try{Rn=zn=e.stateIdx;var d=u(e,f,v,c,p);for(Vn&&(Vn.currentParam=d),v=Xn,Xn=Bn,s.putParamToState(e,d),Xn=v,zn=e.stateIdx,Vn&&(Vn.currentElement=e),s.updatePosition(e,!0),Je(Rn===e.stateIdx+s.stateSize,"State fully consumed"),Je(zn===e.stateIdx+s.stateSize,"State fully updated"),n=0;n<a.length;++n){var m=a[n],g=Gn[m.type];Rn=zn=m.stateIdx,Vn&&(Vn.currentElement=m),g.updatePosition(m,!1),Je(Rn===m.stateIdx+g.stateSize,"State fully consumed"),Je(zn===m.stateIdx+g.stateSize,"State fully updated")}Vn&&(Vn.currentElement=null),o=f,1<=(f+=l*=1.25)&&(f=1),Xn=Bn,Bn=v}catch(e){if(e!==qn)throw e;f=o+(l*=.5),--i,h=!0}Vn&&Vn.currentMouseAndScripts&&(Vn.currentMover.push(Ir.turnIntoCSList([Ir.turnIntoCSList(Vn.currentStep),Or.wrap(h),Or.wrap(o),Or.wrap(f),Or.wrap(Vn.currentParam)])),Vn.currentStep=null,Vn.currentParam=null)}for(nt(Dn),n=0;n<a.length;++n)We(m=a[n],g=Gn[m.type]);Vn&&Vn.currentMouseAndScripts&&(Vn.currentMouseAndScripts.push(Ir.turnIntoCSList([Ir.turnIntoCSList(Vn.currentMover),Or.wrap(Dn),Or.wrap(e.name),t,Or.wrap(r),c,p])),Vn.currentMover=null)}function rt(){Ze(),Fn=!0;for(var e=At.gslp,t=0;t<e.length;t++){var r=e[t],n=Gn[r.type];Rn=zn=r.stateIdx,n.updatePosition(r,!1),We(r,n)}e=Xn,Xn=Bn,Bn=e,Ze()}function nt(t){var r=e.tracingStateReport;"string"==typeof r&&(document.getElementById(r).textContent=t?"BAD":"GOOD")}function it(){var e=Rn;return Rn+=2,Cr.complex(Bn[e],Bn[e+1])}function at(e){for(var t=Array(e),r=0;r<e;++r)t[r]=it();return Ir.turnIntoCSList(t)}function ot(e){Xn[zn]=e.value.real,Xn[zn+1]=e.value.imag,zn+=2}function lt(e){for(var t=0,r=e.value.length;t<r;++t)ot(e.value[t])}function st(e,t){return lt((e=ut(e,t,at(3),at(3)))[0]),lt(e[1]),Ir.turnIntoCSList(e)}function ut(e,t,r,n){if(jn)return[e,t];var i=Ir.projectiveDistMinScal(r,e),a=Ir.projectiveDistMinScal(r,t),o=Ir.projectiveDistMinScal(n,e),l=Ir.projectiveDistMinScal(n,t),s=Ir.projectiveDistMinScal(r,n),u=Ir.projectiveDistMinScal(e,t),c=i+l,f=a+o;if(c>f){var h=[t,e];c=f}else h=[e,t];if(f=function(){},Vn&&Vn.currentStep){var v=[Vn.labelTracing2,Or.wrap(Vn.currentElement.name),Ir.turnIntoCSList(h),Ir.turnIntoCSList([r,n]),Ir.realMatrix([[i,a],[o,l]]),Or.wrap(c),Or.wrap(s),Or.wrap(u),p];Vn.currentStep.push(Ir.turnIntoCSList(v)),f=function(e){Vn.hasOwnProperty(e)||(Vn[e]=Or.wrap(e)),v[v.length-1]=Vn[e]}}return Ir._helper.isNaN(e)||Ir._helper.isNaN(t)?(f("Tracing failed due to NaNs."),Dn=!0):s>3*c&&u>3*c?f("Normal case, everything all right."):1e-5>u?1e-5>s?f("Staying inside singularity."):(f("Moved into singularity."),Dn=!0):1e-5>s?f("Moved out of singularity."):(f(Fn?"Reached refinement limit, giving up.":"Need to refine."),Ke()),h}function ct(e,t,r,n){return e=function(e,t,r,n,i,a,o,l){var s=function(){};if(i=[i,a,o,l],e=[e,t,r,n],jn)return e;for(a=0,n=Array(4),r=0;4>r;r++)for(n[r]=Array(4),l=0;4>l;l++)o=Ir.projectiveDistMinScal(i[r],e[l]),n[r][l]=o;for(o=G(n),t=Array(4),r=0;4>r;++r)t[r]=e[o[r]],a+=n[r][o[r]];var u=1*a,c=1/0,f=1/0;for(r=0;4>r;r++){if(Ir._helper.isNaN(e[r]))return s("Tracing failed due to NaNs."),Dn=!0,t;for(l=r+1;4>l;l++)c>(o=Ir.projectiveDistMinScal(i[r],i[l]))&&(c=o),f>(o=Ir.projectiveDistMinScal(t[r],t[l]))&&(f=o)}if(Vn&&Vn.currentStep){var h=[Vn.labelTracing4,Or.wrap(Vn.currentElement.name),Ir.turnIntoCSList(t),Ir.turnIntoCSList(i),Ir.realMatrix(n),Or.wrap(a),Or.wrap(c),Or.wrap(f),p];Vn.currentStep.push(Ir.turnIntoCSList(h)),s=function(e){Vn.hasOwnProperty(e)||(Vn[e]=Or.wrap(e)),h[h.length-1]=Vn[e]}}return c>u&&f>u||(1e-5>f?1e-5>c?s("Staying inside singularity."):(s("Moved into singularity."),Dn=!0):1e-5>c?s("Moved out of singularity."):(s(Fn?"Reached refinement limit, giving up.":"Need to refine."),Ke())),t}(e,t,r,n,at(3),at(3),at(3),at(3)),lt(e[0]),lt(e[1]),lt(e[2]),lt(e[3]),Ir.turnIntoCSList(e)}function pt(e){var t,r,n=e.length;if(jn){for(t=0;t<n;++t)Rn+=2*e[t].value.length,lt(e[t]);return e}var i=Array(n),a=Array(n),o=Array(n),l=99,s=99,u=Array(n);for(t=0;t<n;++t)i[t]=at(e[t].value.length),a[t]=Ir.normSquared(i[t]).value.real,o[t]=Ir.normSquared(e[t]).value.real,u[t]=Array(n);for(t=0;t<n;++t){for(r=0;r<n;++r){var c=Ir.sesquilinearproduct(i[t],e[r]).value;c=(c.real*c.real+c.imag*c.imag)/(a[t]*o[r]),u[t][r]=1-c}for(r=t+1;r<n;++r)l>1-(c=((c=Ir.sesquilinearproduct(i[t],i[r]).value).real*c.real+c.imag*c.imag)/(a[t]*a[r]))&&(l=1-c),s>1-(c=((c=Ir.sesquilinearproduct(e[t],e[r]).value).real*c.real+c.imag*c.imag)/(o[t]*o[r]))&&(s=1-c)}for(c=G(u),r=Array(n),a=0,o=!1,t=0;t<n;++t){a+=u[t][c[t]];var f=r[t]=e[c[t]];lt(f),o|=Ir._helper.isNaN(f)}if(o|=isNaN(a),e=function(){},Vn&&Vn.currentStep){var h=[Vn.labelTracingSesq,Or.wrap(Vn.currentElement.name),Ir.turnIntoCSList(r),Ir.turnIntoCSList(i),Ir.realMatrix(u),Or.wrap(a),Or.wrap(l),Or.wrap(s),p];Vn.currentStep.push(Ir.turnIntoCSList(h)),e=function(e){Vn.hasOwnProperty(e)||(Vn[e]=Or.wrap(e)),h[h.length-1]=Vn[e]}}return o?(e("Tracing failed due to NaNs."),Dn=!0):l>3*a&&s>3*a?e("Normal case, everything all right."):1e-5>s?1e-5>l?e("Staying inside singularity."):(e("Moved into singularity."),Dn=!0):1e-5>l?e("Moved out of singularity."):(e(Fn?"Reached refinement limit, giving up.":"Need to refine."),Ke()),r}function ft(e,t){return lt((t=ut(e=Gn._helper.flattenConicMatrix(e),t=Gn._helper.flattenConicMatrix(t),at(6),at(6)))[0]),lt(t[1]),e=Gn._helper.buildConicMatrix(t[0].value),t=Gn._helper.buildConicMatrix(t[1].value),Ir.turnIntoCSList([e,t])}function ht(e){ht.hasOwnProperty(e.kind)&&ht[e.kind](e)}function vt(e){vt.hasOwnProperty(e.kind)&&(e.incidences=[],vt[e.kind](e))}function dt(e,t){return function(){e.incidences.push(t.name),t.incidences.push(e.name)}}function mt(e,t){return function(){e.Duplicate=t}}function gt(e,t){return{getInvolved:function(){return[e,t]},toString:function(){return"point "+e.name+" incident line "+t.name},apply:dt(e,t),holds:function(){var r=Ir.scaldiv(Ir.abs(e.homog),e.homog),n=Ir.scaldiv(Ir.abs(t.homog),t.homog);return Cr.abs(Ir.scalproduct(r,n)).value.real<Cr.epsbig}}}function yt(e,t){return{getInvolved:function(){return[e,t]},toString:function(){return"point "+e.name+" incident conic "+t.name},apply:dt(e,t),holds:function(){var r=Or.mult(t.matrix,e.homog);return r=Or.mult(e.homog,r),(r=Cr.abs(r)).value.real<Cr.epsbig}}}function bt(){if(0!==Wn.length){kn.prover.set(Bn);var e,t=function(){e={},Wn.forEach((function(t){t.getInvolved().forEach((function(t){e[t.name]||(e[t.name]=!0,r(t,{}).forEach((function(t){e[t]=!0})))}))}))},r=function(e,t){return e.incidences.forEach((function(e){t[e]||(t[e]=!0,r(At.csnames[e],t))})),Object.keys(t)};t();var n=function(e){return e.holds()};Object.keys(e).forEach((function(t){void 0!==(t=At.csnames[t].args)&&t.forEach((function(t){e[t]=!0}))}));for(var i,a=0;3>a;a++){for(var o in e){var l=At.csnames[o];!l.pinned&&Gn[l.type].isMovable&&(et(l,(i=Gn[l.type].getRandomMove(l)).value,i.type),Wn=Wn.filter(n))}t()}for(Bn.set(kn.prover),rt(),t=0;t<Wn.length;++t)Wn[t].apply();Wn=[]}}function xt(t,r,n){var i=document.createElement("div"),a=document.createElement("img");a.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAPoCAQAAAC1v1zVAAAAGklEQVR42u3BMQEAAADCoPVPbQ0PoAAAgHcDC7gAAVI8ZnwAAAAASUVORK5CYII=",i.className="CindyJS-baseline",i.appendChild(a),(a=document.createElement("div")).className="CindyJS-button",i.appendChild(a);for(var o=2;o<arguments.length;++o)a.appendChild(arguments[o]);if(Tt.parentNode.appendChild(i),t.html=arguments[arguments.length-1],Qt(t.fillalpha)||(t.fillalpha=1),t.fillcolor&&(t.html.style.backgroundColor=dn.makeColor(t.fillcolor,t.fillalpha)),Qt(t.alpha)||(t.alpha=1),t.color&&(t.html.style.color=dn.makeColor(t.color,t.alpha)),i=M,t.script){var l=me(t.script);i=function(){he(l),M()}}n.addEventListener(r,i),!e.keylistener&&(Rt.keydown||Rt.keyup||Rt.keytyped)&&(n.addEventListener("keydown",(function(e){9!==e.keyCode&&E(e,Rt.keydown)})),n.addEventListener("keyup",(function(e){E(e,Rt.keyup)})),n.addEventListener("keypress",(function(e){9!==e.keyCode&&E(e,Rt.keytyped)}))),Gn.Text.initialize(t)}function Pt(){}function Ct(e){var t={},r={pinned:!1,movable:!0};if("P"===e.kind&&De(r),"L"===e.kind&&Fe(r),"C"===e.kind&&Fe(r),"S"===e.kind&&Be(r),"Text"===e.kind&&Xe(r),"Poly"===e.kind&&$e(r),Kn.forEach((function(n){if(e.hasOwnProperty(n)){var i=Or.unwrap(e[n]),a=Or.unwrap(r[n]);null!=i&&i!==a&&JSON.stringify(i)!==JSON.stringify(a)&&(t[n]=i)}})),"P"===e.kind&&(!e.movable||e.pinned)&&t.color){var n=Cr.real(1/Ln.dimDependent);t.color=Or.unwrap(Ir.scalmult(n,e.color))}return(n=function(e){if(!/^Select/.test(e.type)&&!Gn[e.type].isMovable)return null;var t=Or.unwrap,r=Cr.add;switch(e.kind){case"P":case"L":case"Text":return t(e.homog);case"C":return{xx:t((e=e.matrix.value)[0].value[0]),yy:t(e[1].value[1]),zz:t(e[2].value[2]),xy:t(r(e[0].value[1],e[1].value[0])),xz:t(r(e[0].value[2],e[2].value[0])),yz:t(r(e[1].value[2],e[2].value[1]))};default:return null}}(e))&&(t.pos=n),e.dock&&(t.dock=function(e){var t={};return t.offset=Or.unwrap(e.offset),e.to&&(t.to=e.to),e.corner&&(t.corner=e.corner),t}(e.dock)),t}function _t(){var e=[];return At.gslp.forEach((function(t){t.tmp||e.push(Ct(t))})),e}function wt(e){li=0!==e.length,Qn=[],ai=[],oi=[],si.Environment.init({}),e.forEach((function(e){e.behavior?(e.name&&(e.behavior.geo=[e.name]),(e=e.behavior).gravity&&(e.gravity=-e.gravity)):t=e.geo;var t=(e.geo||[]).map((function(e){return At.csnames[e]})),r=t[0],n=si[e.type];n?(n.init&&n.init(e,r,t),r&&(r.behavior=e,"Mass"===e.type?ai.push(r):"Spring"===e.type&&oi.push(r)),Qn.push(e)):(console.error(e),console.error("Behavior "+e.type+" not implemented yet"))}))}var St,Tt,Mt,It,Lt,Et,Ot,At,Nt,kt=this,Rt={},zt=!1,jt=!0,Dt=0,Ft=.5,Bt=0,Xt=10,$t=5/360,Yt=.04608,qt=1,Ut=0,Vt=0,Wt=!1,Gt=.2,Ht=!1,Jt=0,Zt=0,Kt=1,Qt=Number.isFinite||function(e){return"number"==typeof e&&isFinite(e)},er=p,tr=p,rr={play:Pt,pause:Pt,stop:Pt},nr=null,ir=function(e,t){var r=[];ir=function(e,t){r.push({img:e,id:t})},ir(e,t);var n=kt.getBaseDir()+"images/Icons.svg",i=new XMLHttpRequest;i.onreadystatechange=function(){if(i.readyState===XMLHttpRequest.DONE)if(200!==i.status)console.error("Failed to load CindyJS Icons.svg from "+n+": "+i.statusText);else{var e,t=i.responseXML,a=t.documentElement,o={};for(e=a.firstChild;e;e=l){var l=e.nextSibling;e.nodeType===Node.ELEMENT_NODE&&"http://www.w3.org/2000/svg"===e.namespaceURI&&"g"===e.localName.toLowerCase()&&(a.removeChild(e),e.setAttribute("style","display:inline"),o[e.getAttribute("id")]=e)}var s=new XMLSerializer;ir=function(e,r){if(o.hasOwnProperty(r)){r=o[r],a.appendChild(r);try{var n=s.serializeToString(t)}finally{a.removeChild(r)}e.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(n)}},r.forEach((function(e){ir(e.img,e.id)})),r=null}},i.responseType="document",i.open("GET",n),i.send()},ar=1,or=null,lr=[],sr=!1,ur={config:e,startup:i,shutdown:b,evokeCS:function(e){he(e=me(e)),M()},play:m,pause:g,stop:y,evalcs:function(e){return he(me(e))},parse:function(e){return me(e)},niceprint:R,canvas:null},cr=!1,pr=0;e.use&&e.use.forEach((function(t){var r=null;e.plugins&&(r=e.plugins[t]),r||(r=kt._pluginRegistry[t]),r||(++pr,console.log("Loading script for plugin "+t),kt.loadScript(t+"-plugin",t+"-plugin.js",(function(){console.log("Successfully loaded plugin "+t),0==--pr&&cr&&i()}),(function(){console.error("Failed to auto-load plugin "+t),0==--pr&&cr&&i()})))})),P.prototype=new x,C.prototype=new x,_.prototype=new x;var fr,hr={},vr="",dr=0,mr=0,gr={},yr={},br=e.isNode?o.nextTick:window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,0)},xr=null,Pr=[0,8,7,501,"g131b593"],Cr={_helper:{}};Cr._helper.roundingfactor=1e4,Cr._helper.angleroundingfactor=10,Cr._helper.niceround=function(e,t){return Math.round(e*t)/t},Cr.niceprint=function(e,t){if(t=t||Cr._helper.roundingfactor,"Angle"===e.usage)return Cr._helper.niceangle(e);var r=Cr._helper.niceround(e.value.real,t);return 0===(e=Cr._helper.niceround(e.value.imag,t))?""+r:0<e?r+" + i*"+e:r+" - i*"+-e};var _r=e.angleUnit||"°",wr=_r.replace(/\s+/g,""),Sr=2*Math.PI,Tr=1/Sr,Mr={rad:Sr,"°":360,deg:360,degree:360,gra:400,grad:400,turn:1,cyc:1,rev:1,rot:1,"π":2,pi:2,quad:4};Cr._helper.niceangle=function(e){var t=Mr[wr];return t?"function"==typeof t?t(e):-1===(e=Cr.niceprint(Cr.realmult(t*Tr,e),200<t?Cr._helper.angleroundingfactor:null)).indexOf("i*")?e+_r:"("+e+")"+_r:Cr.niceprint(Or.withUsage(e,null))},Cr.complex=function(e,t){return{ctype:"number",value:{real:e,imag:t}}},Cr.real=function(e){return{ctype:"number",value:{real:e,imag:0}}},Cr.zero=Cr.real(0),Cr.one=Cr.real(1),Cr.infinity=Cr.complex(1/0,1/0),Cr.nan=Cr.complex(NaN,NaN),Cr._helper.input=function(e){return"object"==typeof e?Cr.complex(+e.r,+e.i):Cr.real(+e)},Cr.argmax=function(e,t){return e.value.real*e.value.real+e.value.imag*e.value.imag<t.value.real*t.value.real+t.value.imag*t.value.imag?t:e},Cr.max=function(e,t){return{ctype:"number",value:{real:Math.max(e.value.real,t.value.real),imag:Math.max(e.value.imag,t.value.imag)}}},Cr.min=function(e,t){return{ctype:"number",value:{real:Math.min(e.value.real,t.value.real),imag:Math.min(e.value.imag,t.value.imag)}}},Cr.add=function(e,t){return{ctype:"number",value:{real:e.value.real+t.value.real,imag:e.value.imag+t.value.imag}}},Cr.sub=function(e,t){return{ctype:"number",value:{real:e.value.real-t.value.real,imag:e.value.imag-t.value.imag}}},Cr.neg=function(e){return{ctype:"number",value:{real:-e.value.real,imag:-e.value.imag}}},Cr.re=function(e){return{ctype:"number",value:{real:e.value.real,imag:0}}},Cr.im=function(e){return{ctype:"number",value:{real:e.value.imag,imag:0}}},Cr.conjugate=function(e){return{ctype:"number",value:{real:e.value.real,imag:-e.value.imag}}},Cr.round=function(e){return{ctype:"number",value:{real:Math.round(e.value.real),imag:Math.round(e.value.imag)}}},Cr.ceil=function(e){return{ctype:"number",value:{real:Math.ceil(e.value.real),imag:Math.ceil(e.value.imag)}}},Cr.floor=function(e){return{ctype:"number",value:{real:Math.floor(e.value.real),imag:Math.floor(e.value.imag)}}},Cr.mult=function(e,t){return{ctype:"number",value:{real:e.value.real*t.value.real-e.value.imag*t.value.imag,imag:e.value.real*t.value.imag+e.value.imag*t.value.real}}},Cr.realmult=function(e,t){return{ctype:"number",value:{real:e*t.value.real,imag:e*t.value.imag}}},Cr.multiMult=function(e){var t=e[0];if("number"!==t.ctype)return p;for(var r=1;r<e.length;r++){if("number"!==e[r].ctype)return p;t=Cr.mult(t,e[r])}return t},Cr.abs2=function(e){return{ctype:"number",value:{real:e.value.real*e.value.real+e.value.imag*e.value.imag,imag:0}}},Cr.abs=function(e){return Cr.sqrt(Cr.abs2(e))},Cr.inv=function(e){var t=e.value.real*e.value.real+e.value.imag*e.value.imag;return{ctype:"number",value:{real:e.value.real/t,imag:-e.value.imag/t}}},Cr.div=function(e,t){var r=e.value.real;e=e.value.imag;var n=t.value.real,i=n*n+(t=t.value.imag)*t;return{ctype:"number",value:{real:(r*n+e*t)/i,imag:(e*n-r*t)/i}}},Cr.eps=1e-10,Cr.epsbig=1e-6,Cr.snap=function(e){var t=e.value.real;return e=e.value.imag,Math.floor(t+Cr.eps)!==Math.floor(t-Cr.eps)&&(t=Math.round(t)),Math.floor(e+Cr.eps)!==Math.floor(e-Cr.eps)&&(e=Math.round(e)),{ctype:"number",value:{real:t,imag:e}}},Cr.exp=function(e){var t=Math.exp(e.value.real);return{ctype:"number",value:{real:t*Math.cos(e.value.imag),imag:t*Math.sin(e.value.imag)}}},Cr.cos=function(e){var t=e.value.real;e=e.value.imag;var r=Math.exp(e),n=r*Math.sin(-t);return{ctype:"number",value:{real:(r*Math.cos(-t)+(r=Math.exp(-e))*Math.cos(t))/2,imag:(n+r*Math.sin(t))/2}}},Cr.sin=function(e){var t=e.value.real;e=e.value.imag;var r=Math.exp(e),n=r*Math.sin(-t),i=r*Math.cos(-t);return{ctype:"number",value:{real:-(n-(r=Math.exp(-e))*Math.sin(t))/2,imag:(i-r*Math.cos(t))/2}}},Cr.tan=function(e){var t=Cr.sin(e);return e=Cr.cos(e),Cr.div(t,e)},Cr.arccos=function(e){var t=Cr.mult(e,Cr.neg(e));return t=Cr.sqrt(Cr.add(Cr.real(1),t)),e=Cr.add(Cr.mult(e,Cr.complex(0,1)),t),e=Cr.add(Cr.mult(Cr.log(e),Cr.complex(0,1)),Cr.real(.5*Math.PI)),Or.withUsage(e,"Angle")},Cr.arcsin=function(e){var t=Cr.mult(e,Cr.neg(e));return t=Cr.sqrt(Cr.add(Cr.real(1),t)),e=Cr.add(Cr.mult(e,Cr.complex(0,1)),t),e=Cr.mult(Cr.log(e),Cr.complex(0,-1)),Or.withUsage(e,"Angle")},Cr.arctan=function(e){var t=Cr.log(Cr.add(Cr.mult(e,Cr.complex(0,-1)),Cr.real(1)));return e=Cr.log(Cr.add(Cr.mult(e,Cr.complex(0,1)),Cr.real(1))),t=Cr.mult(Cr.sub(t,e),Cr.complex(0,.5)),Or.withUsage(t,"Angle")},Cr.arctan2=function(e,t){if(void 0===t)var r=Cr.real(Math.atan2(e.value.imag,e.value.real));else Cr._helper.isReal(e)&&Cr._helper.isReal(t)?r=Cr.real(Math.atan2(t.value.real,e.value.real)):(r=Cr.add(e,Cr.mult(Cr.complex(0,1),t)),e=Cr.sqrt(Cr.add(Cr.mult(e,e),Cr.mult(t,t))),r=Cr.mult(Cr.complex(0,-1),Cr.log(Cr.div(r,e))));return Or.withUsage(r,"Angle")},Cr.sqrt=function(e){var t=e.value.real,r=e.value.imag;return e=Math.sqrt(Math.sqrt(t*t+r*r)),t=Math.atan2(r,t),{ctype:"number",value:{real:e*Math.cos(t/2),imag:e*Math.sin(t/2)}}},Cr.powRealExponent=function(e,t){var r=e.value.real,n=e.value.imag;return e=Math.pow(Math.sqrt(r*r+n*n),t),r=Math.atan2(n,r),{ctype:"number",value:{real:e*Math.cos(r*t),imag:e*Math.sin(r*t)}}},Cr.log=function(e){var t=e.value.real;e=e.value.imag;var r=Math.sqrt(t*t+e*e),n=Math.atan2(e,t);return 0>e&&(n+=2*Math.PI),0===e&&0>t&&(n=Math.PI),n>Math.PI&&(n-=2*Math.PI),Cr.snap({ctype:"number",value:{real:Math.log(r),imag:n}})},Cr.pow=function(e,t){return Cr._helper.isZero(t)?Cr.one:Cr._helper.isZero(e)?Cr.zero:Cr._helper.isReal(t)?Cr.powRealExponent(e,t.value.real):Cr.exp(Cr.mult(Cr.log(e),t))},Cr.mod=function(e,t){var r=e.value.real,n=t.value.real;return e=e.value.imag,t=t.value.imag,r-=Math.floor(r/n)*n,e-=Math.floor(e/t)*t,0===n&&(r=0),0===t&&(e=0),Cr.snap({ctype:"number",value:{real:r,imag:e}})},Cr._helper.seed="NO",Cr._helper.seedrandom=function(e){e-=Math.floor(e),Cr._helper.seed=.8*e+.1},Cr._helper.rand=function(){if("NO"===Cr._helper.seed)return Math.random();var e=Cr._helper.seed;return e=1e3*Math.sin(1e3*e),e-=Math.floor(e),Cr._helper.seed=e},Cr._helper.randnormal=function(){var e=Cr._helper.rand(),t=Cr._helper.rand();return Math.sqrt(-2*Math.log(e))*Math.cos(2*Math.PI*t)},Cr._helper.isEqual=function(e,t){return e.value.real===t.value.real&&e.value.imag===t.value.imag},Cr._helper.isLessThan=function(e,t){return e.value.real<t.value.real||e.value.real===t.value.real&&e.value.imag<t.value.imag},Cr._helper.compare=function(e,t){return Cr._helper.isLessThan(e,t)?-1:Cr._helper.isEqual(e,t)?0:1},Cr._helper.isAlmostEqual=function(e,t,r){var n=Cr.eps;return void 0!==r&&(n=r),r=e.value.real-t.value.real,e=e.value.imag-t.value.imag,r<n&&r>-n&&e<n&&e>-n},Cr._helper.isZero=function(e){return 0===e.value.real&&0===e.value.imag},Cr._helper.isAlmostZero=function(e){var t=e.value.real;return e=e.value.imag,t<Cr.eps&&t>-Cr.eps&&e<Cr.eps&&e>-Cr.eps},Cr._helper.isReal=function(e){return 0===e.value.imag},Cr._helper.isAlmostReal=function(e){return(e=e.value.imag)<Cr.epsbig&&e>-Cr.epsbig},Cr._helper.isNaN=function(e){return isNaN(e.value.real)||isNaN(e.value.imag)},Cr._helper.isFinite=function(e){return isFinite(e.value.real)&&isFinite(e.value.imag)},Cr._helper.isAlmostImag=function(e){return(e=e.value.real)<Cr.epsbig&&e>-Cr.epsbig},Cr._helper.z3a=Cr.complex(-.5,.5*Math.sqrt(3)),Cr._helper.z3b=Cr.complex(-.5,-.5*Math.sqrt(3)),Cr._helper.cub1={ctype:"list",value:[Cr.one,Cr.one,Cr.one]},Cr._helper.cub2={ctype:"list",value:[Cr._helper.z3a,Cr.one,Cr._helper.z3b]},Cr._helper.cub3={ctype:"list",value:[Cr._helper.z3b,Cr.one,Cr._helper.z3a]},Cr.solveCubic=function(e,t,r,n){return e=Cr._helper.solveCubicHelper(e,t,r,n),[Ir.scalproduct(Cr._helper.cub1,e),Ir.scalproduct(Cr._helper.cub2,e),Ir.scalproduct(Cr._helper.cub3,e)]},Cr._helper.solveCubicHelper=function(e,t,r,n){var i=e.value.real;e=e.value.imag;var a=t.value.real;t=t.value.imag;var o=r.value.real,l=r.value.imag,s=n.value.real,u=n.value.imag,c=i*o-e*l,p=4*(r=i*l+e*o)-2*a*t,f=i*a-e*t,h=i*t+e*a,v=(n=4*c-(a*a-t*t))*o-p*l-18*(f*s-h*u);p=n*l+p*o-18*(f*u+h*s);var d=54*e*i,m=(n=27*(i*i-e*e))*s-d*u,g=n*u+d*s,y=a*a-t*t,b=2*a*t,x=y*a-b*t,P=y*t+b*a,C=m+4*x;return n=27*(v*o-p*l+C*s-(d=g+4*P)*u),p=27*(v*l+p*o+C*u+d*s),C=Math.sqrt(Math.sqrt(n*n+p*p)),d=Math.atan2(p,n),p=C*Math.sin(d/2),x=-2*x+9*(f*o-h*l)-m+((n=C*Math.cos(d/2))*i-p*e),P=-2*P+9*(f*l+h*o)-g+(n*e+p*i),n=Math.exp(Math.log(Math.sqrt(x*x+P*P))/3),o=Math.atan2(P,x),d=n*Math.sin(o/3),p=n*Math.cos(o/3),o*=2,c=2*y-6*c,r=2*b-6*r,b=-1.5874010519681996*(a*p-t*d),a=-1.5874010519681996*(a*d+t*p),t=1.2599210498948732*(n*=n)*Math.cos(o/3),o=1.2599210498948732*n*Math.sin(o/3),n=4.762203155904599*(p*i-d*e),d=(-c*(p=4.762203155904599*(p*e+d*i))+r*n)/(i=n*n+p*p),c=(c*n+r*p)/i,r=d,d=(-b*p+a*n)/i,b=(b*n+a*p)/i,a=d,d=(-t*p+o*n)/i,t=(t*n+o*p)/i,o=d,Ir.turnIntoCSList([Cr.complex(c,r),Cr.complex(b,a),Cr.complex(t,o)])},Cr._helper.getRangeRand=function(e,t){return Math.random()*(t-e)+e},Cr.getRandReal=function(e,t){return e=Cr._helper.getRangeRand(e,t),Cr.real(e)},Cr.getRandComplex=function(e,t){var r=Cr._helper.getRangeRand(e,t);return e=Cr._helper.getRangeRand(e,t),Cr.complex(r,e)};var Ir={_helper:{},turnIntoCSList:function(e){return{ctype:"list",value:e}}};Ir.EMPTY=Ir.turnIntoCSList([]),Ir.asList=function(e){return"list"===e.ctype?e:"number"===e.ctype||"boolean"===e.ctype||"geo"===e.ctype?Ir.turnIntoCSList([e]):Ir.EMPTY},Ir.realVector=function(e){for(var t=[],r=0;r<e.length;r++)t[r]={ctype:"number",value:{real:e[r],imag:0}};return{ctype:"list",value:t}},Ir._helper.unitvector=function(e,t){return(e=Ir.zerovector(e)).value[Math.floor(t.value.real-1)]=Cr.real(1),e},Ir.idMatrix=function(e){for(var t=Ir.zeromatrix(e,e),r=Cr.real(1),n=0;n<e.value.real;n++)t.value[n].value[n]=r;return t},Ir._helper.flippedidMatrix=function(e){for(var t=Ir.zeromatrix(e,e),r=Cr.real(1),n=0;n<e.value.real;n++)t.value[n].value[e.value.real-n-1]=r;return t},Ir.println=function(e){for(var t=[],r=0;r<e.value.length;r++)if("number"===e.value[r].ctype)t[r]=Cr.niceprint(e.value[r]);else{if("list"!==e.value[r].ctype)return p;Ir.println(e.value[r])}"number"===e.value[0].ctype&&console.log(t)},Ir.matrix=function(e){return Ir.turnIntoCSList(e.map(Ir.turnIntoCSList))},Ir.realMatrix=function(e){for(var t=e.length,r=Array(t),n=0;n<t;n++)r[n]=Ir.realVector(e[n]);return Ir.turnIntoCSList(r)},Ir.ex=Ir.realVector([1,0,0]),Ir.ey=Ir.realVector([0,1,0]),Ir.ez=Ir.realVector([0,0,1]),Ir.linfty=Ir.realVector([0,0,1]),Ir.ii=Ir.turnIntoCSList([Cr.complex(1,0),Cr.complex(0,1),Cr.complex(0,0)]),Ir.jj=Ir.turnIntoCSList([Cr.complex(1,0),Cr.complex(0,-1),Cr.complex(0,0)]),Ir.fundDual=Ir.realMatrix([[1,0,0],[0,1,0],[0,0,0]]),Ir.fund=Ir.realMatrix([[0,0,0],[0,0,0],[0,0,1]]),Ir.sequence=function(e,t){var r=[],n=0;for(e=Math.round(e.value.real);e<Math.round(t.value.real)+1;e++)r[n]={ctype:"number",value:{real:e,imag:0}},n++;return{ctype:"list",value:r}},Ir.pairs=function(e){for(var t=[],r=0;r<e.value.length-1;r++)for(var n=r+1;n<e.value.length;n++)t.push({ctype:"list",value:[e.value[r],e.value[n]]});return{ctype:"list",value:t}},Ir.triples=function(e){for(var t=[],r=0;r<e.value.length-2;r++)for(var n=r+1;n<e.value.length-1;n++)for(var i=n+1;i<e.value.length;i++)t.push({ctype:"list",value:[e.value[r],e.value[n],e.value[i]]});return{ctype:"list",value:t}},Ir.cycle=function(e){for(var t=[],r=0;r<e.value.length-1;r++)t[r]={ctype:"list",value:[e.value[r],e.value[r+1]]};return t.push({ctype:"list",value:[e.value[e.value.length-1],e.value[0]]}),{ctype:"list",value:t}},Ir.consecutive=function(e){for(var t=[],r=0;r<e.value.length-1;r++)t[r]={ctype:"list",value:[e.value[r],e.value[r+1]]};return{ctype:"list",value:t}},Ir.reverse=function(e){for(var t=Array(e.value.length),r=e.value.length-1,n=0;0<=r;r--,n++)t[n]=e.value[r];return{ctype:"list",value:t}},Ir.directproduct=function(e,t){for(var r=[],n=0;n<e.value.length;n++)for(var i=0;i<t.value.length;i++)r.push({ctype:"list",value:[e.value[n],t.value[i]]});return{ctype:"list",value:r}},Ir.concat=function(e,t){for(var r=[],n=0;n<e.value.length;n++)r.push(e.value[n]);for(e=0;e<t.value.length;e++)r.push(t.value[e]);return{ctype:"list",value:r}},Ir.prepend=function(e,t){var r=[];for(r[0]=e,e=0;e<t.value.length;e++)r[e+1]=t.value[e];return{ctype:"list",value:r}},Ir.append=function(e,t){for(var r=[],n=0;n<e.value.length;n++)r[n]=e.value[n];return r.push(t),{ctype:"list",value:r}},Ir.contains=function(e,t){for(var r=0;r<e.value.length;r++)if(Rr.equals(e.value[r],t).value)return{ctype:"boolean",value:!0};return{ctype:"boolean",value:!1}},Ir.common=function(e,t){for(var r=[],n=0,i=0;i<e.value.length;i++){for(var a=!1,o=e.value[i],l=0;l<t.value.length;l++)a=a||Rr.equals(o,t.value[l]).value;a&&(r[n]=e.value[i],n++)}return{ctype:"list",value:r}},Ir.remove=function(e,t){for(var r=[],n=0,i=0;i<e.value.length;i++){for(var a=!1,o=e.value[i],l=0;l<t.value.length;l++)a=a||Rr.equals(o,t.value[l]).value;a||(r[n]=e.value[i],n++)}return{ctype:"list",value:r}},Ir.sort1=function(e){return(e=e.value.slice()).sort(Or.compare),Ir.turnIntoCSList(e)},Ir._helper.isEqual=function(e,t){return Ir.equals(e,t).value},Ir._helper.isLessThan=function(e,t){for(var r=e.value.length,n=t.value.length,i=0;!(i>=r||i>=n)&&Or.isEqual(e.value[i],t.value[i]);)i++;return i===r&&i<n||!(i===n&&i<r||i===r&&i===n)&&Or.isLessThan(e.value[i],t.value[i])},Ir._helper.compare=function(e,t){return Ir._helper.isLessThan(e,t)?-1:Ir._helper.isEqual(e,t)?0:1},Ir.equals=function(e,t){if(e.value.length!==t.value.length)return{ctype:"boolean",value:!1};for(var r=!0,n=0;n<e.value.length;n++){var i=e.value[n],a=t.value[n];r="list"===i.ctype&&"list"===a.ctype?r&&Ir.equals(i,a).value:r&&j([i,a],[]).value}return{ctype:"boolean",value:r}},Ir.almostequals=function(e,t){if(e.value.length!==t.value.length)return{ctype:"boolean",value:!1};for(var r=!0,n=0;n<e.value.length;n++){var i=e.value[n],a=t.value[n];r="list"===i.ctype&&"list"===a.ctype?r&&Ir.almostequals(i,a).value:r&&F([i,a],[]).value}return{ctype:"boolean",value:r}},Ir._helper.isAlmostReal=function(e){for(var t=!0,r=0;r<e.value.length;r++){var n=e.value[r];t="list"===n.ctype?t&&Ir._helper.isAlmostReal(n):t&&Cr._helper.isAlmostReal(n)}return t},Ir._helper.isAlmostZero=function(e){for(var t=0;t<e.value.length;t++){var r=e.value[t];if("list"===r.ctype){if(!Ir._helper.isAlmostZero(r))return!1}else if(!Cr._helper.isAlmostZero(r))return!1}return!0},Ir._helper.isNaN=function(e){for(var t=!1,r=0;r<e.value.length;r++){var n=e.value[r];t="list"===n.ctype?t||Ir._helper.isNaN(n):t||Cr._helper.isNaN(n)}return t},Ir.set=function(e){var t=[],r=0;(e=e.value.slice()).sort(Or.compare);for(var n=0;n<e.length;n++)0!==n&&j([t[t.length-1],e[n]],[]).value||(t[r]=e[n],r++);return{ctype:"list",value:t}},Ir.maxval=function(e){for(var t=Cr.zero,r=0;r<e.value.length;r++){var n=e.value[r];"number"===n.ctype&&(t=Cr.argmax(t,n)),"list"===n.ctype&&(t=Cr.argmax(t,Ir.maxval(n)))}return t},Ir.maxIndex=function(e,t,r){var n=0;void 0!==r&&(n=r),r=n;for(var i=t(e.value[n]).value.real;n<e.value.length;++n){var a=t(e.value[n]).value.real;a>i&&(r=n,i=a)}return r},Ir.normalizeMax=function(e){var t=Cr.inv(Ir.maxval(e));return Cr._helper.isFinite(t)?Ir.scalmult(t,e):e},Ir.normalizeZ=function(e){var t=Cr.inv(e.value[2]);return Ir.scalmult(t,e)},Ir.dehom=function(e){var t=(e=e.value.slice()).length-1,r=Cr.inv(e[t]);e.length=t;for(var n=0;n<t;++n)e[n]=Cr.mult(r,e[n]);return Ir.turnIntoCSList(e)},Ir.normalizeAbs=function(e){var t=Cr.inv(Ir.abs(e));return Ir.scalmult(t,e)},Ir.max=function(e,t){if(e.value.length!==t.value.length)return p;for(var r=[],n=0;n<e.value.length;n++)r[n]=Or.max(e.value[n],t.value[n]);return{ctype:"list",value:r}},Ir.min=function(e,t){if(e.value.length!==t.value.length)return p;for(var r=[],n=0;n<e.value.length;n++)r[n]=Or.min(e.value[n],t.value[n]);return{ctype:"list",value:r}},Ir.scaldiv=function(e,t){if("number"!==e.ctype)return p;for(var r=[],n=0;n<t.value.length;n++){var i=t.value[n];r[n]="number"===i.ctype?Or.div(i,e):"list"===i.ctype?Ir.scaldiv(e,i):p}return{ctype:"list",value:r}},Ir.scalmult=function(e,t){if("number"!==e.ctype)return p;for(var r=[],n=0;n<t.value.length;n++){var i=t.value[n];r[n]="number"===i.ctype?Or.mult(i,e):"list"===i.ctype?Ir.scalmult(e,i):p}return{ctype:"list",value:r}},Ir.add=function(e,t){if(e.value.length!==t.value.length)return p;for(var r=[],n=0;n<e.value.length;n++){var i=e.value[n],a=t.value[n];r[n]="number"===i.ctype&&"number"===a.ctype?Or.add(i,a):"list"===i.ctype&&"list"===a.ctype?Ir.add(i,a):p}return{ctype:"list",value:r}},Ir.sub=function(e,t){if(e.value.length!==t.value.length)return p;for(var r=[],n=0;n<e.value.length;n++){var i=e.value[n],a=t.value[n];r[n]="number"===i.ctype&&"number"===a.ctype?Cr.sub(i,a):"list"===i.ctype&&"list"===a.ctype?Ir.sub(i,a):p}return{ctype:"list",value:r}},Ir.abs2=function(e){for(var t=0,r=0;r<e.value.length;r++){var n=e.value[r];if("number"===n.ctype)t+=Cr.abs2(n).value.real;else{if("list"!==n.ctype)return p;t+=Ir.abs2(n).value.real}}return{ctype:"number",value:{real:t,imag:0}}},Ir.abs=function(e){return Cr.sqrt(Ir.abs2(e))},Ir.normalizeMaxXX=function(e){for(var t=-1e4,r=Cr.real(1),n=0;n<e.value.length;n++){var i=Cr.abs(e.value[n]);i.value.real>t&&(r=e.value[n],t=i.value.real)}return Ir.scaldiv(r,e)},Ir.recursive=function(e,t){for(var r=[],n=0;n<e.value.length;n++){var i=ve(e.value[n]);r[n]="number"===i.ctype?Cr[t](i):"list"===i.ctype?Ir[t](i):p}return{ctype:"list",value:r}},Ir.re=function(e){return Ir.recursive(e,"re")},Ir.neg=function(e){return Ir.recursive(e,"neg")},Ir.im=function(e){return Ir.recursive(e,"im")},Ir.conjugate=function(e){return Ir.recursive(e,"conjugate")},Ir.transjugate=function(e){return Ir.transpose(Ir.conjugate(e))},Ir.round=function(e){return Ir.recursive(e,"round")},Ir.ceil=function(e){return Ir.recursive(e,"ceil")},Ir.floor=function(e){return Ir.recursive(e,"floor")},Ir._helper.colNumb=function(e){if("list"!==e.ctype)return-1;for(var t=-1,r=0;r<e.value.length;r++){if("list"!==e.value[r].ctype)return-1;if(0===r)t=e.value[r].value.length;else if(t!==e.value[r].value.length)return-1}return t},Ir._helper.isNumberVecN=function(e,t){if("list"!==e.ctype||e.value.length!==t)return!1;for(t=0;t<e.value.length;t++)if("number"!==e.value[t].ctype)return!1;return!0},Ir.isNumberVector=function(e){if("list"!==e.ctype)return{ctype:"boolean",value:!1};for(var t=0;t<e.value.length;t++)if("number"!==e.value[t].ctype)return{ctype:"boolean",value:!1};return{ctype:"boolean",value:!0}},Ir.isNumberVectorN=function(e,t){if("list"!==e.ctype)return{ctype:"boolean",value:!1};if(e.value)for(t=0;t<e.value.length;t++)if("number"!==e.value[t].ctype)return{ctype:"boolean",value:!1};return{ctype:"boolean",value:!0}},Ir.isNumberMatrix=function(e){if(-1===Ir._helper.colNumb(e))return{ctype:"boolean",value:!1};for(var t=0;t<e.value.length;t++)if(!Ir.isNumberVector(e.value[t]).value)return{ctype:"boolean",value:!1};return{ctype:"boolean",value:!0}},Ir._helper.isNumberMatrixMN=function(e,t,r){return Ir.isNumberMatrix(e).value&&e.value.length===t&&e.value[0].value.length===r},Ir.scalproduct=function(e,t){if(e.value.length!==t.value.length)return p;for(var r={ctype:"number",value:{real:0,imag:0}},n=0;n<t.value.length;n++){var i=e.value[n],a=t.value[n];if("number"!==i.ctype||"number"!==a.ctype)return p;r=Cr.add(Cr.mult(i,a),r)}return r},Ir.sesquilinearproduct=function(e,t){if(e.value.length!==t.value.length)return p;for(var r=0,n=0,i=0;i<t.value.length;i++){var a=e.value[i].value,o=t.value[i].value;r+=a.real*o.real+a.imag*o.imag,n+=a.real*o.imag-a.imag*o.real}return Cr.complex(r,n)},Ir.normSquared=function(e){for(var t=0,r=0;r<e.value.length;r++){var n=e.value[r].value;t+=n.real*n.real+n.imag*n.imag}return Cr.real(t)},Ir.productMV=function(e,t){if(e.value[0].value.length!==t.value.length)return p;for(var r=[],n=0;n<e.value.length;n++){for(var i={ctype:"number",value:{real:0,imag:0}},a=e.value[n],o=0;o<t.value.length;o++){var l=a.value[o],s=t.value[o];if("number"!==l.ctype||"number"!==s.ctype)return p;i=Cr.add(Cr.mult(l,s),i)}r[n]=i}return Ir.turnIntoCSList(r)},Ir.productVM=function(e,t){if(e.value.length!==t.value.length)return p;for(var r=[],n=0;n<t.value[0].value.length;n++){for(var i={ctype:"number",value:{real:0,imag:0}},a=0;a<e.value.length;a++){var o=e.value[a],l=t.value[a].value[n];if("number"!==o.ctype||"number"!==l.ctype)return p;i=Cr.add(Cr.mult(o,l),i)}r[n]=i}return Ir.turnIntoCSList(r)},Ir.productMM=function(e,t){if(e.value[0].value.length!==t.value.length)return p;for(var r=[],n=0;n<e.value.length;n++){var i=Ir.productVM(e.value[n],t);r[n]=i}return Ir.turnIntoCSList(r)},Ir.mult=function(e,t){return e.value.length===t.value.length&&Ir.isNumberVector(e).value&&Ir.isNumberVector(t).value?Ir.scalproduct(e,t):Ir.isNumberMatrix(e).value&&t.value.length===e.value[0].value.length&&Ir.isNumberVector(t).value?Ir.productMV(e,t):Ir.isNumberMatrix(t).value&&e.value.length===t.value.length&&Ir.isNumberVector(e).value?Ir.productVM(e,t):Ir.isNumberMatrix(e).value&&Ir.isNumberMatrix(t).value&&t.value.length===e.value[0].value.length?Ir.productMM(e,t):p},Ir.projectiveDistMinScal=function(e,t){var r=Ir.abs(e),n=Ir.abs(t);if(0===r.value.real||0===n.value.real)return 0;var i=Ir.conjugate(t);return i=Ir.scalproduct(e,i),i=Cr._helper.isAlmostZero(i)?Cr.real(1):Cr.div(i,Cr.abs(i)),e=Ir.scaldiv(r,e),t=Ir.scaldiv(n,t),t=Ir.scalmult(i,t),n=Ir.abs(Ir.add(e,t)),t=Ir.abs(Ir.sub(e,t)),Math.min(n.value.real,t.value.real)},Ir.conicDist=function(e,t){return e=N(e),t=N(t),Ir.projectiveDistMinScal(e,t)},Ir.crossOperator=function(e){var t=e.value[0],r=e.value[1];return e=e.value[2],Ir.turnIntoCSList([Ir.turnIntoCSList([Cr.zero,Cr.neg(e),r]),Ir.turnIntoCSList([e,Cr.zero,Cr.neg(t)]),Ir.turnIntoCSList([Cr.neg(r),t,Cr.zero])])},Ir.cross=function(e,t){var r=Cr.sub(Cr.mult(e.value[1],t.value[2]),Cr.mult(e.value[2],t.value[1])),n=Cr.sub(Cr.mult(e.value[2],t.value[0]),Cr.mult(e.value[0],t.value[2]));return e=Cr.sub(Cr.mult(e.value[0],t.value[1]),Cr.mult(e.value[1],t.value[0])),Ir.turnIntoCSList([r,n,e])},Ir.crossratio3harm=function(e,t,r,n,i){var a=Ir.det3(e,r,i),o=Ir.det3(t,n,i);return e=Ir.det3(e,n,i),t=Ir.det3(t,r,i),a=Cr.mult(a,o),o=Cr.mult(e,t),Ir.turnIntoCSList([a,o])},Ir.crossratio3=function(e,t,r,n,i){return e=Ir.crossratio3harm(e,t,r,n,i),Cr.div(e.value[0],e.value[1])},Ir.veronese=function(e){var t=Cr.mult(e.value[0],e.value[0]),r=Cr.mult(e.value[1],e.value[1]),n=Cr.mult(e.value[2],e.value[2]),i=Cr.mult(e.value[0],e.value[1]),a=Cr.mult(e.value[0],e.value[2]);return e=Cr.mult(e.value[1],e.value[2]),Ir.turnIntoSCList([t,r,n,i,a,e])},Ir.matrixFromVeronese=function(e){var t=e.value[0],r=e.value[1],n=e.value[2],i=Cr.realmult(.5,e.value[3]),a=Cr.realmult(.5,e.value[4]);return e=Cr.realmult(.5,e.value[5]),Ir.turnIntoCSList([Ir.turnIntoCSList([t,i,a]),Ir.turnIntoCSList([i,r,e]),Ir.turnIntoCSList([a,e,n])])},Ir.det2=function(e,t){var r=Cr.mult(e.value[0],t.value[1]);return Cr.sub(r,Cr.mult(e.value[1],t.value[0]))},Ir.det3=function(e,t,r){return Cr.complex(e.value[0].value.real*t.value[1].value.real*r.value[2].value.real-e.value[0].value.imag*t.value[1].value.imag*r.value[2].value.real-e.value[0].value.imag*t.value[1].value.real*r.value[2].value.imag-e.value[0].value.real*t.value[1].value.imag*r.value[2].value.imag+e.value[2].value.real*t.value[0].value.real*r.value[1].value.real-e.value[2].value.imag*t.value[0].value.imag*r.value[1].value.real-e.value[2].value.imag*t.value[0].value.real*r.value[1].value.imag-e.value[2].value.real*t.value[0].value.imag*r.value[1].value.imag+e.value[1].value.real*t.value[2].value.real*r.value[0].value.real-e.value[1].value.imag*t.value[2].value.imag*r.value[0].value.real-e.value[1].value.imag*t.value[2].value.real*r.value[0].value.imag-e.value[1].value.real*t.value[2].value.imag*r.value[0].value.imag-e.value[0].value.real*t.value[2].value.real*r.value[1].value.real+e.value[0].value.imag*t.value[2].value.imag*r.value[1].value.real+e.value[0].value.imag*t.value[2].value.real*r.value[1].value.imag+e.value[0].value.real*t.value[2].value.imag*r.value[1].value.imag-e.value[2].value.real*t.value[1].value.real*r.value[0].value.real+e.value[2].value.imag*t.value[1].value.imag*r.value[0].value.real+e.value[2].value.imag*t.value[1].value.real*r.value[0].value.imag+e.value[2].value.real*t.value[1].value.imag*r.value[0].value.imag-e.value[1].value.real*t.value[0].value.real*r.value[2].value.real+e.value[1].value.imag*t.value[0].value.imag*r.value[2].value.real+e.value[1].value.imag*t.value[0].value.real*r.value[2].value.imag+e.value[1].value.real*t.value[0].value.imag*r.value[2].value.imag,-e.value[0].value.imag*t.value[1].value.imag*r.value[2].value.imag+e.value[0].value.imag*t.value[1].value.real*r.value[2].value.real+e.value[0].value.real*t.value[1].value.real*r.value[2].value.imag+e.value[0].value.real*t.value[1].value.imag*r.value[2].value.real-e.value[2].value.imag*t.value[0].value.imag*r.value[1].value.imag+e.value[2].value.imag*t.value[0].value.real*r.value[1].value.real+e.value[2].value.real*t.value[0].value.real*r.value[1].value.imag+e.value[2].value.real*t.value[0].value.imag*r.value[1].value.real-e.value[1].value.imag*t.value[2].value.imag*r.value[0].value.imag+e.value[1].value.imag*t.value[2].value.real*r.value[0].value.real+e.value[1].value.real*t.value[2].value.real*r.value[0].value.imag+e.value[1].value.real*t.value[2].value.imag*r.value[0].value.real+e.value[0].value.imag*t.value[2].value.imag*r.value[1].value.imag-e.value[0].value.imag*t.value[2].value.real*r.value[1].value.real-e.value[0].value.real*t.value[2].value.real*r.value[1].value.imag-e.value[0].value.real*t.value[2].value.imag*r.value[1].value.real+e.value[2].value.imag*t.value[1].value.imag*r.value[0].value.imag-e.value[2].value.imag*t.value[1].value.real*r.value[0].value.real-e.value[2].value.real*t.value[1].value.real*r.value[0].value.imag-e.value[2].value.real*t.value[1].value.imag*r.value[0].value.real+e.value[1].value.imag*t.value[0].value.imag*r.value[2].value.imag-e.value[1].value.imag*t.value[0].value.real*r.value[2].value.real-e.value[1].value.real*t.value[0].value.real*r.value[2].value.imag-e.value[1].value.real*t.value[0].value.imag*r.value[2].value.real)},Ir.det4m=function(e){var t=e.value,r=t[0].value,n=r[0].value,i=+n.real,a=+n.imag,o=+(n=r[1].value).real,l=+n.imag,s=+(n=r[2].value).real,u=+n.imag,c=+(n=r[3].value).real,p=+n.imag,f=+(n=(r=t[1].value)[0].value).real,h=+n.imag,v=+(n=r[1].value).real,d=+n.imag,m=+(n=r[2].value).real,g=+n.imag;e=i*v-a*d-o*f+l*h;var y=i*d+a*v-o*h-l*f,b=i*m-a*g-s*f+u*h,x=i*g+a*m-s*h-u*f,P=i*(r=+(n=r[3].value).real)-a*(n=+n.imag)-c*f+p*h,C=i*n+a*r-c*h-p*f,_=o*m-l*g-s*v+u*d,w=o*g+l*m-s*d-u*v,S=o*r-l*n-c*v+p*d,T=o*n+l*r-c*d-p*v,M=s*r-u*n-c*m+p*g,I=s*n+u*r-c*g-p*m;i=+(n=(r=t[2].value)[0].value).real,a=+n.imag,o=+(n=r[1].value).real,l=+n.imag,s=+(n=r[2].value).real,u=+n.imag,c=+(n=r[3].value).real,p=+n.imag,f=+(n=(r=t[3].value)[0].value).real,h=+n.imag,t=i*(v=+(n=r[1].value).real)-a*(d=+n.imag)-o*f+l*h;var L=i*d+a*v-o*h-l*f,E=i*(m=+(n=r[2].value).real)-a*(g=+n.imag)-s*f+u*h,O=i*g+a*m-s*h-u*f,A=i*(r=+(n=r[3].value).real)-a*(n=+n.imag)-c*f+p*h;return i=i*n+a*r-c*h-p*f,a=o*m-l*g-s*v+u*d,f=o*g+l*m-s*d-u*v,h=o*r-l*n-c*v+p*d,o=o*n+l*r-c*d-p*v,l=s*r-u*n-c*m+p*g,s=s*n+u*r-c*g-p*m,Cr.complex(e*l-y*s-b*h+x*o+P*a-C*f+_*A-w*i-S*E+T*O+M*t-I*L,e*s+y*l-b*o-x*h+P*f+C*a+_*i+w*A-S*O-T*E+M*L+I*t)},Ir.eucangle=function(e,t){var r=Ir.cross(e,Ir.linfty);e=Ir.cross(t,Ir.linfty),t=Ir.det3(Ir.ez,r,Ir.ii),r=Ir.det3(Ir.ez,r,Ir.jj);var n=Ir.det3(Ir.ez,e,Ir.ii);return e=Ir.det3(Ir.ez,e,Ir.jj),t=Cr.div(Cr.mult(t,e),Cr.mult(n,r)),t=Cr.log(t),Cr.mult(t,Cr.complex(0,.5))},Ir.zerovector=function(e){e=Math.floor(e.value.real);for(var t=Array(e),r=0;r<e;r++)t[r]=0;return Ir.realVector(t)},Ir.zeromatrix=function(e,t){e=Math.floor(e.value.real);for(var r=Array(e),n=0;n<e;n++)r[n]=Ir.zerovector(t);return Ir.turnIntoCSList(r)},Ir.vandermonde=function(e){for(var t=e.value.length,r=Ir.zeromatrix(t,t),n=0;n<t;n++)for(var i=0;i<t;i++)r.value[n].value[i]=Cr.pow(e.value[n],Cr.real(i-1));return r},Ir.transpose=function(e){for(var t=[],r=e.value[0].value.length,n=e.value.length,i=0;i<r;i++){for(var a=[],o=0;o<n;o++)a[o]=e.value[o].value[i];t[i]=Ir.turnIntoCSList(a)}return Ir.turnIntoCSList(t)},Ir.column=function(e,t){var r=[],n=e.value.length;t=Math.floor(t.value.real-1);for(var i=0;i<n;i++)r[i]=e.value[i].value[t];return Ir.turnIntoCSList(r)},Ir.row=function(e,t){var r=[],n=e.value[0].value.length;t=Math.floor(t.value.real-1);for(var i=0;i<n;i++)r[i]=e.value[t].value[i];return Ir.turnIntoCSList(r)},Ir.adjoint2=function(e){var t=e.value[0].value[0],r=e.value[1].value[0],n=Array(2);return n[0]=Ir.turnIntoCSList([e.value[1].value[1],Cr.neg(e.value[0].value[1])]),n[1]=Ir.turnIntoCSList([Cr.neg(r),t]),Ir.turnIntoCSList(n)},Ir.adjoint3=function(e){var t=e.value[0].value,r=t[0].value,n=r.real,i=r.imag,a=(r=t[1].value).real,o=r.imag,l=(r=t[2].value).real,s=r.imag,u=(r=(t=e.value[1].value)[0].value).real,c=r.imag,p=(r=t[1].value).real,f=r.imag,h=(r=t[2].value).real,v=r.imag;e=(r=(t=e.value[2].value)[0].value).real;var d=r.imag,m=(r=t[1].value).real,g=r.imag;return{ctype:"list",value:[{ctype:"list",value:[{ctype:"number",value:{real:p*(t=(r=t[2].value).real)-h*m-f*(r=r.imag)+v*g,imag:p*r-h*g-m*v+t*f}},{ctype:"number",value:{real:-a*t+l*m+o*r-s*g,imag:-a*r+l*g+m*s-t*o}},{ctype:"number",value:{real:a*h-l*p-o*v+s*f,imag:a*v-l*f-p*s+h*o}}]},{ctype:"list",value:[{ctype:"number",value:{real:-u*t+h*e+c*r-v*d,imag:-u*r+h*d+e*v-t*c}},{ctype:"number",value:{real:n*t-l*e-i*r+s*d,imag:n*r-l*d-e*s+t*i}},{ctype:"number",value:{real:-n*h+l*u+i*v-s*c,imag:-n*v+l*c+u*s-h*i}}]},{ctype:"list",value:[{ctype:"number",value:{real:u*m-p*e-c*g+f*d,imag:u*g-p*d-e*f+m*c}},{ctype:"number",value:{real:-n*m+a*e+i*g-o*d,imag:-n*g+a*d+e*o-m*i}},{ctype:"number",value:{real:n*p-a*u-i*f+o*c,imag:n*f-a*c-u*o+p*i}}]}]}},Ir.inverse=function(e){var t=e.value.length;if(t!==e.value[0].value.length)return console.log("Inverse works only for square matrices"),p;if(2===t)return Ir.scaldiv(Ir.det(e),Ir.adjoint2(e));if(3===t)return Ir.scaldiv(Ir.det(e),Ir.adjoint3(e));t=Ir.LUdecomp(e),e=e.value.length;var r=Cr.real(0),n=Cr.real(1),i=Ir.zerovector(Cr.real(e));i.value[0]=n;for(var a=Array(e),o=0;o<e;o++)a[o]=Ir._helper.LUsolve(t,i),i.value[o]=r,i.value[o+1]=n;return a=Ir.turnIntoCSList(a),Ir.transpose(a)},Ir.linearsolve=function(e,t){return 2===e.value.length?Ir.linearsolveCramer2(e,t):3===e.value.length?Ir.linearsolveCramer3(e,t):Ir.LUsolve(e,t)},Ir.getDiag=function(e){if(e.value.length!==e.value[0].value.length)return p;for(var t=Array(e.value.length),r=0;r<e.value.length;r++)t[r]=e.value[r].value[r];return Ir.turnIntoCSList(t)},Ir.getSubDiag=function(e){if(e.value.length!==e.value[0].value.length)return p;for(var t=Array(e.value.length-1),r=0;r<e.value.length-1;r++)t[r]=e.value[r+1].value[r];return Ir.turnIntoCSList(t)},Ir.eig2=function(e){var t=Cr.add(e.value[0].value[0],e.value[1].value[1]);e=Ir.det2(e.value[0],e.value[1]);var r=Cr.mult(t,t),n=t=Cr.mult(t,Cr.real(.5));return e=Cr.sqrt(Cr.sub(Cr.div(r,Cr.real(4)),e)),t=Cr.add(t,e),n=Cr.sub(n,e),Ir.turnIntoCSList([t,n])},Ir.eig=function(e,t){var r=t||!0,n=e,i=Cr.real(n.value.length);t=i.value.real,Cr.real(0),n=Ir._helper.QRIteration(n)[0],n=Ir.getDiag(n),n=Ir.sort1(n),i=Ir.idMatrix(i,i);var a=Array(t);if(a=Ir.turnIntoCSList(a),r){var o,l=0,s=!1;for(r=0;r<t;r++){if(s)var u=c.value[l];else{var c=n.value[r];c=Ir.sub(e,Ir.scalmult(c,i)),void 0!==(u=(c=Ir.nullSpace(c)).value[0])&&(o=u)}void 0===u&&(u=o),1e-8>Ir.abs(u).value.real&&0===l&&(u=Ir._helper.inverseIteration(e,n.value[r])),a.value[r]=Ir._helper.isAlmostZeroVec(u)?u:Ir.scaldiv(Ir.abs(u),u),r<t-1&&((s=1e-6>Cr.abs(Cr.sub(n.value[r],n.value[r+1])).value.real)?l++:l=0)}a=Ir.transpose(a)}return Ir.turnIntoCSList([n,a])},Ir._helper.isNormalMatrix=function(e){return 1e-10>Ir.abs(Ir.sub(e,Ir.transjugate(e))).value.real},Ir._helper.QRIteration=function(e,t){var r=Cr.real(e.value.length),n=r.value.real,i=r.value.real;Cr.real(0),Ir.idMatrix(r,r);var a=Ir.zeromatrix(r,r);r=Ir.idMatrix(r,r);var o=t||2500,l=0,s=Array(i);for(t=0;t<o;t++){var u=Ir._helper.getBlock(e,[i-2,i-1],[i-2,i-1]),c=Ir.eig2(u);u=c.value[0],c=c.value[1],Ir.abs(u),Ir.abs(c);var p=e.value[i-1].value[i-1];if(c=Cr.abs(Cr.sub(p,u)).value.real<(p=Cr.abs(Cr.sub(p,c)).value.real)?u:c,u=Ir.idMatrix(Cr.real(i),Cr.real(i)),c=Ir.scalmult(c,u),u=Ir.QRdecomp(Ir.sub(e,c)),e=Or.mult(u.R,u.Q),e=Ir.add(e,c),u.Q=Ir._helper.buildBlockMatrix(u.Q,Ir.idMatrix(Cr.real(l),Cr.real(l))),r=Or.mult(r,u.Q),1e-48>Cr.abs2(e.value[e.value.length-1].value[e.value[0].value.length-2]).value.real&&1<i){for(s[n-l-1]=e.value[i-1].value[i-1],t=0;t<i;t++)a.value[i-1].value[t]=e.value[i-1].value[t],a.value[t].value[i-1]=e.value[t].value[i-1];e=Ir._helper.getBlock(e,[0,i-2],[0,i-2]),l++,i--}if(1===i){a.value[0].value[0]=e.value[0].value[0];break}if(Ir._helper.isUpperTriangular(e)){for(t=0;t<i;t++)a.value[t].value[t]=e.value[t].value[t];break}}return[a,r]},Ir.rank=function(e,t){return Ir.RRQRdecomp(e,t).rank},Ir._helper.isAlmostZeroVec=function(e){for(var t=e.value.length,r=0;r<t;r++)if(!Cr._helper.isAlmostZero(e.value[r]))return!1;return!0},Ir._helper.isLowerTriangular=function(e){for(var t=e.value.length,r=e.value[0].value.length,n=0;n<t;n++)for(var i=n+1;i<r;i++)if(!Cr._helper.isAlmostZero(e.value[n].value[i]))return!1;return!0},Ir._helper.isUpperTriangular=function(e){return Ir._helper.isLowerTriangular(Ir.transpose(e))},Ir._helper.isAlmostId=function(e){var t=e.value.length,r=Cr.real(t);if(t!==e.value[0].value.length)return!1;for(e=Ir.sub(e,Ir.idMatrix(r),r),r=0;r<t;r++)for(var n=0;n<t;n++)if(1e-16<Cr.abs(e.value[r].value[n]).value.real)return!1;return!0},Ir.nullSpace=function(e,t){var r=e.value.length;t=Ir.RRQRdecomp(Ir.transjugate(e),t),e=Ir.transpose(t.Q),t=r-t.rank.value.real;var n=Array(t);e.value.reverse();for(var i,a=0;a<t;a++)i=e.value[a],n[a]=Ir.scaldiv(Ir.abs(i),i);return 0<(n=Ir.turnIntoCSList(n)).value.length?n:Ir.turnIntoCSList([Ir.zerovector(Cr.real(r))])},Ir._helper.isAlmostDiagonal=function(e){var t=e.value.length;if(Cr.real(t),Cr.real(0),t!==e.value[0].value.length)return!1;for(var r=0;r<t;r++)for(var n=0;n<t;n++)if(r!==n&&1e-16<Cr.abs(e.value[r].value[n]).value.real)return!1;return!0},Ir._helper.inverseIteration=function(e,t){console.log("warning: code untested");for(var r=e.value.length,n=Array(r),i=0;i<r;i++)n[i]=2*Math.random()-.5;for(n=Ir.realVector(n),r=Ir.idMatrix(Cr.real(r),Cr.real(r)),t=Cr.add(t,Cr.real(.1*Math.random()-.5)),i=0;100>i;i++)n=Ir.scaldiv(Ir.abs(n),n),n=Ir.LUsolve(Ir.sub(e,Ir.scalmult(t,r)),JSON.parse(JSON.stringify(n)));return Ir.scaldiv(Ir.abs(n),n)},Ir._helper.toHessenberg=function(e){var t=JSON.parse(JSON.stringify(e)),r=t.value.length,n=Cr.real(r-1),i=Cr.real(r);if(Cr.real(1),Ir._helper.isUpperTriangular(t))return[Ir.idMatrix(n,n),e];for(e=Ir.idMatrix(i,i),i=1;i<r-1;i++){var a=Ir.column(t,Cr.real(i));a.value=a.value.splice(i),1e-16<Ir.abs2(a).value.real&&(a=Ir._helper.getHouseHolder(a),e=Or.mult(e,a),t=Or.mult(Or.mult(a,t),a)),n.value.real--}return[e,t]},Ir._helper.swapEl=function(e,t,r){if("[object Array]"===Object.prototype.toString.call(e)){var n=e[t];e[t]=e[r],e[r]=n}else"list"===e.ctype&&(n=e.value[t],e.value[t]=e.value[r],e.value[r]=n)},Ir.RRQRdecomp=function(e,t){var r,n=Math.sqrt(Cr.eps);void 0!==t&&(n=.1*t.value.real),t=n*n,n=e.value.length;var i=Cr.real(n),a=Cr.real(1),o=Ir._helper.unitvector(Cr.real(e.value.length),a),l=Ir.idMatrix(i,i),s=JSON.parse(JSON.stringify(e)),u=Ir.transpose(e);for(e=Array(n),r=0;r<n;r++)e[r]=Ir.abs2(u.value[r]);for(e=Ir.turnIntoCSList(e),u=Array(n),r=0;r<n;r++)u[r]=r;r=Ir.maxIndex(e,Cr.abs);for(var c=e.value[r],p=0,f=0;1e-16<Cr.abs2(c).value.real;f++){for(p++,Ir._helper.swapColumn(s,f,r),Ir._helper.swapEl(e,f,r),Ir._helper.swapEl(u,f,r),r=Ir._helper.getBlock(s,[f],[f]),r=Ir.column(r,a),1e-8<(c=Ir.abs2(r).value.real)&&(r=Ir._helper.getHouseHolder(r),r=Ir._helper.buildBlockMatrix(Ir.idMatrix(Cr.real(f),Cr.real(f)),r),l=Or.mult(l,Ir.transjugate(r)),s=Or.mult(r,s)),r=f+1;r<n;r++)e.value[r]=Cr.sub(e.value[r],Cr.mult(s.value[f].value[r],Cr.conjugate(s.value[f].value[r])));if(r=Ir.maxIndex(e,Cr.abs2,f+1),c=e.value[r],f+2===n){Cr.abs(c).value.real>t&&p++;break}i=Cr.sub(i,a),o.value=o.value.splice(0,o.value.length-1)}return{Q:l,R:s,P:Ir.turnIntoCSList(u),rank:Cr.real(p)}},Ir._helper.getHouseHolder=function(e){var t=Cr.real(e.value.length);if(1e-16>Ir.abs2(e))return Ir.idMatrix(t,t);var r=Cr.real(1),n=Ir._helper.unitvector(Cr.real(e.value.length),r),i=Ir._helper.QRgetAlpha(e,0);return i=Ir.sub(e,Ir.scalmult(i,n)),i=Ir.scaldiv(Ir.abs(i),i),e=Cr.div(Ir.sesquilinearproduct(e,i),Ir.sesquilinearproduct(i,e)),t=Ir.idMatrix(t,t),Ir.sub(t,Ir.scalmult(Cr.add(r,e),Ir._helper.transposeMult(i,Ir.conjugate(i))))},Ir._helper.reOrderbyPivots=function(e,t){var r=e.value.length.length;e=Ir.transpose(e),r=Array(r);for(var n=0;n<t.length;n++)r[t[n]]=e.value[n];return r=Ir.turnIntoCSList(r),Ir.transpose(r)},Ir.QRdecomp=function(e){var t=e.value.length,r=Cr.real(t);if(Ir._helper.isUpperTriangular(e))return{Q:Ir.idMatrix(r,r),R:e};var n=Cr.real(1),i=Ir._helper.unitvector(Cr.real(e.value.length),n),a=Ir.idMatrix(r,r);e=JSON.parse(JSON.stringify(e));for(var o=0;;o++){var l=Ir._helper.getBlock(e,[o],[o]);if(l=Ir.column(l,n),1e-8<Ir.abs2(l).value.real&&(l=Ir._helper.getHouseHolder(l),l=Ir._helper.buildBlockMatrix(Ir.idMatrix(Cr.real(o),Cr.real(o)),l),a=Or.mult(a,Ir.transjugate(l)),e=Or.mult(l,e)),o+2===t)break;r=Cr.sub(r,n),i.value=i.value.splice(0,i.value.length-1)}return{Q:a,R:e}},Ir._helper.swapColumn=function(e,t,r){for(var n,i=0;i<e.value.length;i++)n=e.value[i].value[t],e.value[i].value[t]=e.value[i].value[r],e.value[i].value[r]=n},Ir._helper.buildBlockMatrix=function(e,t){if(0===e.value.length)return t;if(0===t.value.length)return e;var r=e.value.length,n=e.value[0].value.length,i=n+t.value[0].value.length;i=Ir.zeromatrix(Cr.real(r+t.value.length),Cr.real(i));for(var a=0;a<e.value.length;a++)for(var o=0;o<e.value[0].value.length;o++)i.value[a].value[o]=e.value[a].value[o];for(e=0;e<t.value.length;e++)for(a=0;a<t.value[0].value.length;a++)i.value[r+e].value[n+a]=t.value[e].value[a];return i},Ir._helper.getBlock=function(e,t,r){e=JSON.parse(JSON.stringify(e));var n=t[0],i=r[0];for(t=void 0===t[1]?e.value.length:t[1],r=void 0===r[1]?e.value[0].value.length:r[1],t++,r++,e.value=e.value.slice(n,t),n=0;n<e.value.length;n++)e.value[n].value=e.value[n].value.slice(i,r);return e},Ir._helper.setBlock=function(e,t,r){e=JSON.parse(JSON.stringify(e));var n=r[0];r=r[1];for(var i=t.value.length,a=t.value[0].value.length,o=0;o<i;o++)for(var l=0;l<a;l++)e.value[n+o].value[r+l]=t.value[o].value[l];return e},Ir._helper.transposeMult=function(e,t){if(e.value.length!==t.value.length)return p;for(var r=e.value.length,n=Array(r),i=0;i<r;i++)n[i]=Ir.scalmult(e.value[i],t);return Ir.turnIntoCSList(n)},Ir._helper.QRgetAlpha=function(e,t){return 0>e.value[t].value.real?Ir.abs(e):Cr.neg(Ir.abs(e))},Ir.LUdecomp=function(e){var t,r,n=0,i=(e=JSON.parse(JSON.stringify(e))).value.length,a=i-1,o=Array(i);for(r=0;r<i;++r){var l=r,s=e.value[r],u=Cr.abs(s.value[r]).value.real;for(t=r+1;t<i;++t){var c=Cr.abs(e.value[t].value[r]);u<c.value.real&&(u=c.value.real,l=t)}for(u<Cr.eps&&console.log("Warning: singular matrix!"),o[r]=l,l!==r&&(e.value[r]=e.value[l],e.value[l]=s,s=e.value[r],n++),t=s.value[r],c=r+1;c<i;++c)e.value[c].value[r]=Cr.div(e.value[c].value[r],t);for(c=r+1;c<i;++c){for(l=e.value[c],t=r+1;t<a;++t)l.value[t]=Cr.sub(l.value[t],Cr.mult(l.value[r],s.value[t])),++t,l.value[t]=Cr.sub(l.value[t],Cr.mult(l.value[r],s.value[t]));t===a&&(l.value[t]=Cr.sub(l.value[t],Cr.mult(l.value[r],s.value[t])))}}return{LU:e,P:o,TransPos:n}},Ir.LUsolve=function(e,t){return e=Ir.LUdecomp(e),Ir._helper.LUsolve(e,t)},Ir._helper.LUsolve=function(e,t){var r=JSON.parse(JSON.stringify(t)),n=(t=e.LU).value.length,i=JSON.parse(JSON.stringify(r)),a=e.P;for(e=n-1;-1!==e;--e)i.value[e]=r.value[e];for(e=0;e<n;++e){if(r=a[e],a[e]!==e){var o=i.value[e];i.value[e]=i.value[r],i.value[r]=o}for(o=t.value[e],r=0;r<e;++r)i.value[e]=Cr.sub(i.value[e],Cr.mult(i.value[r],o.value[r]))}for(e=n-1;0<=e;--e){for(o=t.value[e],r=e+1;r<n;++r)i.value[e]=Cr.sub(i.value[e],Cr.mult(i.value[r],o.value[r]));i.value[e]=Cr.div(i.value[e],o.value[e])}return i},Ir.linearsolveCramer2=function(e,t){var r=Ir.column(e,Cr.real(1)),n=Ir.column(e,Cr.real(2));return e=Ir.det2(r,n),Cr._helper.isZero(e)&&console.log("A is not regular!"),n=Ir.det2(t,n),n=Cr.div(n,e),t=Ir.det2(r,t),t=Cr.div(t,e),Ir.turnIntoCSList([n,t])},Ir.linearsolveCramer3=function(e,t){var r=Ir.column(e,Cr.real(1)),n=Ir.column(e,Cr.real(2)),i=Ir.column(e,Cr.real(3));e=Ir.det3(r,n,i),Cr._helper.isZero(e)&&console.log("A is not regular!");var a=Ir.det3(t,n,i);return i=Ir.det3(r,t,i),t=Ir.det3(r,n,t),t=Ir.turnIntoCSList([a,i,t]),Ir.scaldiv(e,t)},Ir.linearsolveCGNR=function(e,t){var r=Ir.transpose(e);return e=Or.mult(r,e),t=Or.mult(r,t),Ir.linearsolveCG(e,t)},Ir.linearsolveCG=function(e,t){for(var r,n=t,i=t=Ir.sub(t,Or.mult(e,t)),a=Math.ceil(1.2*e.value.length),o=0;o<a;){o++;var l=Or.mult(e,i),s=r=Ir.scalproduct(t,t);if(r=Cr.div(r,Ir.scalproduct(i,l)),n=Ir.add(n,Or.mult(r,i)),t=Ir.sub(t,Or.mult(r,l)),Ir.abs(t).value.real<Cr.eps)break;r=Ir.scalproduct(t,t),r=Cr.div(r,s),i=Ir.add(t,Or.mult(r,i))}return o>=a&&console.log("CG did not converge"),n},Ir.det=function(e){if(1===e.value.length)return e.value[0].value[0];if(2===e.value.length)return Ir.det2(e.value[0],e.value[1]);if(3===e.value.length)return Ir.det3(e.value[0],e.value[1],e.value[2]);if(4===e.value.length)return Ir.det4m(e);var t,r=e.value.length,n=Cr.real(1),i=JSON.parse(JSON.stringify(e));for(e=0;e<r-1;e++){var a=e;for(t=e+1;t<r;t++)Cr.abs(i.value[t].value[e]).value.real>Cr.abs(i.value[a].value[e]).value.real&&(a=t);a!==e&&(t=i.value[a],i.value[a]=i.value[e],i.value[e]=t,n=Cr.neg(n));var o=i.value[e];for(t=e+1;t<r;t++){var l=i.value[t],s=Cr.div(l.value[e],o.value[e]);for(a=e+1;a<r-1;a+=2){var u=a+1;l.value[a]=Cr.sub(l.value[a],Cr.mult(o.value[a],s)),l.value[u]=Cr.sub(l.value[u],Cr.mult(o.value[u],s))}a!==r&&(l.value[a]=Cr.sub(l.value[a],Cr.mult(o.value[a],s)))}if(Cr._helper.isZero(o.value[e]))return Cr.real(0);n=Cr.mult(n,o.value[e])}return Cr.mult(n,i.value[e].value[e])},Ir.LUdet=function(e){for(var t=(e=Ir.LUdecomp(e)).LU,r=t.value.length,n=t.value[0].value[0],i=1;i<r;i++)n=Cr.mult(n,t.value[i].value[i]);return 1==e.TransPos%2&&(n=Cr.neg(n)),n},Ir.getField=function(e,t){if("homog"===t){if(Ir._helper.isNumberVecN(e,3))return e;if(Ir._helper.isNumberVecN(e,2))return Ir.turnIntoCSList([e.value[0],e.value[1],Cr.real(1)])}if("xy"===t){if(Ir._helper.isNumberVecN(e,2))return e;if(Ir._helper.isNumberVecN(e,3))return Ir.turnIntoCSList([Cr.div(e.value[0],e.value[2]),Cr.div(e.value[1],e.value[2])])}if("x"===t&&Ir.isNumberVector(e)){var r=e.value.length;if(0<r&&3!==r)return e.value[0];if(3===r)return"Point"===e.usage?Cr.div(e.value[0],e.value[2]):e.value[0]}if("y"===t&&Ir.isNumberVector(e)){if(1<(r=e.value.length)&&3!==r)return e.value[1];if(3===r)return"Point"===e.usage?Cr.div(e.value[1],e.value[2]):e.value[1]}return"z"===t&&Ir.isNumberVector(e)&&2<(r=e.value.length)?e.value[2]:p},Ir.nil=Ir.turnIntoCSList([]),Ir.ofGeos=function(e){return Ir.turnIntoCSList(e.map((function(e){return{ctype:"geo",value:e}})))},Ir._helper.isAlmostFarpoint=function(e){return e=Ir.normalizeMax(e).value[2],Cr.abs(e).value.real<Cr.eps},Ir.getRandRealVec3=function(e,t){var r=Cr.getRandReal;return Ir.turnIntoCSList([r(e,t),r(e,t),r(e,t)])},Ir.getRandComplexVec3=function(e,t){var r=Cr.getRandComplex;return Ir.turnIntoCSList([r(e,t),r(e,t),r(e,t)])};var Lr={_helper:{},turnIntoCSJson:function(e){return{ctype:"JSON",value:e}}};Lr._helper.ShallowClone=function(e){var t,r=Array.isArray(e)?[]:{};for(t in e){var n=e[t];r[t]=n}return r},Lr.getField=function(e,t){return e.value&&e.value[t]?e.value[t]:p},Lr.setField=function(e,t,r){"undefined"===r.ctype&&e[t]?delete e[t]:e[t]=r},Lr.GenFromUserDataEl=function(e){var t=e.key;return e=e.value,t&&"string"===t.ctype?e?{key:t.value,val:he(e)}:(console.log("Warning: JSON object not defined."),{key:t.value,val:p}):(console.log("Error: JSON keys have to be strings."),p)},Lr._helper.GenJSONAtom=function(e,t){return{ctype:"JSON",value:{key:Or.string(e),value:t}}},Lr._helper.forall=function(e,t,r,n){var i="value";if(void 0!==n.iterator){"string"===(n=he(n.iterator)).ctype&&-1!==["key","value","pair"].indexOf(n.value)&&(i=n.value)}if("value"===i)for(var a in e){zr.setvar(t,e[a]);var o=he(r)}else if("key"===i)for(var l in e)zr.setvar(t,Or.string(l)),o=he(r);else for(var s in e)zr.setvar(t,Lr._helper.GenJSONAtom(s,e[s])),o=he(r);return o},Lr._helper.niceprint=function(e,t,r){return"JSON"===e.ctype?Lr.niceprint(e,t,r):R(e)},Lr.niceprint=function(e,t,r){if(!r&&((r={printedWarning:!1,visitedMap:{}}).visitedMap.tracker=new WeakMap,r.visitedMap.level=0,r.visitedMap.maxLevel=1e3,r.visitedMap.maxElVisit=5e3,t&&t.maxDepth)){var n=he(t.maxDepth);"number"===n.ctype&&(r.visitedMap.maxLevel=n.value.real)}var i=r.visitedMap;return i.newLevel=!0,i.level+=1,"{"+Object.keys(e.value).sort().map((function(n){var a=e.value[n];if(i.tracker.has(a)){if(i[a]>i.maxElVisit||i.level>i.maxLevel)return r.printedWarning||(console.log("Warning: We visited a key-value pair very often or encountered a very deeply nested dictionary. Dictionary is probably cyclic. Output will be probably incomplete."),r.printedWarning=!0),n+":...";i.newLevel&&(i.tracker.set(a,i.tracker.get(a)+1),i.newLevel=!1)}else i.tracker.set(a,1);return n+":"+Lr._helper.niceprint(a,t,r)})).join(", ")+"}"},Lr._helper.handlePrintException=function(e){e instanceof RangeError?console.log("Warning: Dictionary string could not be generated! Probably large cyclic Dictionary!"):e instanceof SyntaxError?console.log("Warning: Dictionary string could not be parsed!"):console.log("Warning: Dictionary printing failed!")};var Er={key:function(e){return"string"===e.ctype?"s"+e.value.length+":"+e.value+";":"number"===e.ctype?"n"+e.value.real+","+e.value.imag+";":"list"===e.ctype?"l"+e.value.length+":"+e.value.map(Er.key).join(",")+";":"boolean"===e.ctype?"b"+e.value+";":"dict"===e.ctype?"d"+(e=Object.keys(e.value).sort()).length+":"+e.join(",")+";":("undefined"!==e.ctype&&St.err("Bad dictionary key: "+R(e)),"undef")},create:function(){return{ctype:"dict",value:{}}},clone:function(e){var t,r=Er.create();for(t in e.value)e.value.hasOwnProperty(t)&&(r.value[t]=e.value[t]);return r},put:function(e,t,r){e.value[Er.key(t)]={key:t,value:r}},get:function(e,t,r){return(e=e.value[Er.key(t)])?e.value:r},niceprint:function(e){return"{"+Object.keys(e.value).sort().map((function(t){return R((t=e.value[t]).key)+":"+R(t.value)})).join(", ")+"}"}},Or={_helper:{},order:{undefined:0,boolean:1,number:2,term:3,atomic:4,variable:5,geo:6,string:7,list:8},string:function(e){return{ctype:"string",value:e}},bool:function(e){return{ctype:"boolean",value:e}},not:function(e){return Or.bool(!e.value)},isLessThan:function(e,t){return-1===Or.compare(e,t)},isEqual:function(e,t){return 0===Or.compare(e,t)},compareResults:function(e,t){return Or.compare(e.result,t.result)},compare:function(e,t){return e.ctype!==t.ctype?Or.order[e.ctype]-Or.order[t.ctype]:"number"===e.ctype?Cr._helper.compare(e,t):"list"===e.ctype?Ir._helper.compare(e,t):"geo"===e.ctype?e.value.name===t.value.name?0:e.value.name<t.value.name?-1:1:"string"===e.ctype?e.value===t.value?0:e.value<t.value?-1:1:"boolean"===e.ctype?e.value===t.value?0:!1===e.value?-1:1:void 0},add:function(e,t){return"void"===e.ctype&&"number"===t.ctype||"void"===e.ctype&&"list"===t.ctype?t:"number"===e.ctype&&"number"===t.ctype?Cr.add(e,t):"string"===e.ctype||"string"===t.ctype?{ctype:"string",value:R(e)+R(t)}:"list"===e.ctype&&"list"===t.ctype?Ir.add(e,t):p},sub:function(e,t){return"void"===e.ctype&&"number"===t.ctype?Cr.neg(t):"void"===e.ctype&&"list"===t.ctype?Ir.neg(t):"number"===e.ctype&&"number"===t.ctype?Cr.sub(e,t):"list"===e.ctype&&"list"===t.ctype?Ir.sub(e,t):p},mult:function(e,t){return"number"===e.ctype&&"number"===t.ctype?Cr.mult(e,t):"number"===e.ctype&&"list"===t.ctype?Ir.scalmult(e,t):"list"===e.ctype&&"number"===t.ctype?Ir.scalmult(t,e):"list"===e.ctype&&"list"===t.ctype?Ir.mult(e,t):p},div:function(e,t){return"number"===e.ctype&&"number"===t.ctype?Cr.div(e,t):"list"===e.ctype&&"number"===t.ctype?Ir.scaldiv(t,e):p},max:function(e,t){return"number"===e.ctype&&"number"===t.ctype?Cr.max(e,t):"list"===e.ctype&&"list"===t.ctype?Ir.max(e,t):p},min:function(e,t){return"number"===e.ctype&&"number"===t.ctype?Cr.min(e,t):"list"===e.ctype&&"list"===t.ctype?Ir.min(e,t):p},wrap:function(e){if("number"==typeof e)return Cr.real(e);if("object"==typeof e&&void 0!==e.length){for(var t=[],r=0;r<e.length;r++)t[r]=Or.wrap(e[r]);return Ir.turnIntoCSList(t)}return"string"==typeof e?{ctype:"string",value:e}:"boolean"==typeof e?{ctype:"boolean",value:e}:p},unwrap:function(e){if("object"!=typeof e||null===e)return e;if(Array.isArray(e))return e.map(Or.unwrap);switch(e.ctype){case"string":case"boolean":return e.value;case"number":return 0===e.value.imag?e.value.real:{r:e.value.real,i:e.value.imag};case"list":return e.value.map(Or.unwrap);default:return null}},withUsage:function(e,t){return{ctype:e.ctype,value:e.value,usage:t}},wrapJSON:function(e){switch(typeof e){case"number":return Cr.real(e);case"string":return Or.string(e);case"boolean":return Or.bool(e);case"object":if(null===e)return p;if(Array.isArray(e))return Ir.turnIntoCSList(e.map(Or.wrapJSON));var t,r=Er.create();for(t in e)Er.put(r,Or.string(t),Or.wrapJSON(e[t]));return r;default:return console.log("Failed to convert "+typeof e+" to CindyJS data type"),p}},identity:function(e){return e},deeplyEqual:function(e,t){if("object"!=typeof e||"object"!=typeof t||null===e||null===t)return e===t;var r,n=0;for(r in e)if(++n,!(r in t)||!Or.deeplyEqual(e[r],t[r]))return!1;for(r in t)--n;return 0===n}},Ar={},Nr={};Nr[":"]=k(":"),Nr["°"]=function(e,t){return"number"===(t=ve(e[0])).ctype&&"void"===e[1].ctype?Or.withUsage(Cr.realmult(Math.PI/180,t),"Angle"):p},Nr._=H,Nr["^"]=V,Nr["√"]=function(e,t){return"void"===e[0].ctype?kr.sqrt$1([e[1]],t):p},Nr["*"]=q,Nr["×"]=W,Nr["/"]=U,Nr["+"]=$,Nr["-"]=Y,Nr["!"]=function(e,t){return t=ve(e[1]),"void"===e[0].ctype&&"boolean"===t.ctype?{ctype:"boolean",value:!t.value}:p},Nr["=="]=j,Nr["~="]=F,Nr["~<"]=function(e,t){return t=ve(e[0]),e=ve(e[1]),"number"===t.ctype&&"number"===e.ctype&&Cr._helper.isAlmostReal(t)&&Cr._helper.isAlmostReal(e)?{ctype:"boolean",value:t.value.real-e.value.real<=-Cr.eps}:p},Nr["~>"]=function(e,t){return t=ve(e[0]),e=ve(e[1]),"number"===t.ctype&&"number"===e.ctype&&Cr._helper.isAlmostReal(t)&&Cr._helper.isAlmostReal(e)?{ctype:"boolean",value:t.value.real-e.value.real>=Cr.eps}:p},Nr["=:="]=k("=:="),Nr[">="]=function(e,t){return t=ve(e[0]),e=ve(e[1]),"number"===t.ctype&&"number"===e.ctype&&Cr._helper.isAlmostReal(t)&&Cr._helper.isAlmostReal(e)?{ctype:"boolean",value:t.value.real>=e.value.real}:"string"===t.ctype&&"string"===e.ctype?{ctype:"boolean",value:t.value>=e.value}:p},Nr["<="]=function(e,t){return t=ve(e[0]),e=ve(e[1]),"number"===t.ctype&&"number"===e.ctype&&Cr._helper.isAlmostReal(t)&&Cr._helper.isAlmostReal(e)?{ctype:"boolean",value:t.value.real<=e.value.real}:"string"===t.ctype&&"string"===e.ctype?{ctype:"boolean",value:t.value<=e.value}:p},Nr["~>="]=function(e,t){return t=ve(e[0]),e=ve(e[1]),"number"===t.ctype&&"number"===e.ctype&&Cr._helper.isAlmostReal(t)&&Cr._helper.isAlmostReal(e)?{ctype:"boolean",value:t.value.real-e.value.real>-Cr.eps}:p},Nr["~<="]=function(e,t){return t=ve(e[0]),e=ve(e[1]),"number"===t.ctype&&"number"===e.ctype&&Cr._helper.isAlmostReal(t)&&Cr._helper.isAlmostReal(e)?{ctype:"boolean",value:t.value.real-e.value.real<Cr.eps}:p},Nr[">"]=function(e,t){return t=ve(e[0]),e=ve(e[1]),"number"===t.ctype&&"number"===e.ctype&&Cr._helper.isAlmostReal(t)&&Cr._helper.isAlmostReal(e)?{ctype:"boolean",value:t.value.real>e.value.real}:"string"===t.ctype&&"string"===e.ctype?{ctype:"boolean",value:t.value>e.value}:p},Nr["<"]=function(e,t){return t=ve(e[0]),e=ve(e[1]),"number"===t.ctype&&"number"===e.ctype&&Cr._helper.isAlmostReal(t)&&Cr._helper.isAlmostReal(e)?{ctype:"boolean",value:t.value.real<e.value.real}:"string"===t.ctype&&"string"===e.ctype?{ctype:"boolean",value:t.value<e.value}:p},Nr["<>"]=D,Nr["∈"]=function(e,t){return t=he(e[0]),"list"===(e=he(e[1])).ctype?Ir.contains(e,t):p},Nr["∉"]=function(e,t){return t=he(e[0]),"list"===(e=he(e[1])).ctype?Or.not(Ir.contains(e,t)):p},Nr["&"]=B,Nr["%"]=X,Nr["!="]=D,Nr["~!="]=function(e,t){return Or.not(F(e,t))},Nr[".."]=function(e,t){return t=he(e[0]),e=he(e[1]),"number"===t.ctype&&"number"===e.ctype?Ir.sequence(t,e):p},Nr["++"]=J,Nr["--"]=K,Nr["~~"]=Z,Nr[":>"]=Q,Nr["<:"]=ee,Nr["="]=z,Nr[":="]=function(e,t,r){if(t="undefined"===e[1].ctype,"undefined"===e[0].ctype||t)return p;if("function"===e[0].ctype){t=e[0].oper;var n=e[0].args,i=e[1],a=1;if(Ar.hasOwnProperty(t)){if((a=Ar[t]).definer===r)return p;a=a.generation+1}Ar[t]={oper:t,body:i,arglist:n,definer:r,generation:a}}return"variable"===e[0].ctype&&zr.setvar(e[0].name,e[1]),p},Nr[":=_"]=function(e,t){return"void"!==e[1].ctype||"function"===e[0].ctype&&delete Ar[e[0].oper],p},Nr["::="]=k("::="),Nr[";"]=function(e,t){t="void"===e[0].ctype;var r="void"===e[1].ctype;return t&&r?p:!t&&r?he(e[0]):(t||r||he(e[0]),r?p:he(e[1]))},R.errorTypes=["_?_","_??_","_???_","___"];var kr={},Rr={evaluate:function(e,t,r){if(Ar.hasOwnProperty(e)){if(void 0===(e=Ar[e]))t=p;else{var n=[];for(r=0;r<e.arglist.length;r++)n[r]=he(t[r]);for(r=0;r<e.arglist.length;r++)zr.newvar(e.arglist[r].name),zr.setvar(e.arglist[r].name,n[r]);for(zr.pushVstack("*"),t=he(e.body),zr.cleanVstack(),r=0;r<e.arglist.length;r++)zr.removevar(e.arglist[r].name)}return t}if(n=kr[e])return n(t,r);var i=e.lastIndexOf("$");return-1!==i&&(i=e.substr(0,i),n=kr[i])?n(t,r):(St.err("Called undefined function "+i+" (as "+e+")"),p)},equals:function(e,t){return"number"===e.ctype&&"number"===t.ctype?{ctype:"boolean",value:e.value.real===t.value.real&&e.value.imag===t.value.imag}:"string"===e.ctype&&"string"===t.ctype||"boolean"===e.ctype&&"boolean"===t.ctype?{ctype:"boolean",value:e.value===t.value}:"list"===e.ctype&&"list"===t.ctype?Ir.equals(e,t):"geo"===e.ctype&&"geo"===t.ctype?{ctype:"boolean",value:e.value===t.value}:{ctype:"boolean",value:!1}}},zr={};zr.vars=function(){var e,t={pi:Cr.real(Math.PI),"π":Cr.real(Math.PI),i:Cr.complex(0,1),true:Or.bool(!0),false:Or.bool(!1),"#":p,nil:Ir.turnIntoCSList([]),newline:Or.string("\n"),tab:Or.string("\t")},r=[];for(e in t)r[e]=[t[e]];return r}(),zr.isVariable=function(e){return this.vars.hasOwnProperty(e)},zr.create=function(e){if(this.vars.hasOwnProperty(e))return this.vars[e];return this.vars[e]=[null]},zr.newvar=function(e){return(e=this.vars[e]).push(p),e},zr.removevar=function(e){var t=this.vars[e];0===t.length&&console.error("Removing non-existing "+e),t.pop(),0===t.length&&console.warn("Removing last "+e)},zr.setvar=function(e,t){var r=this.vars[e];0===r.length&&console.error("Setting non-existing variable "+e),void 0===t&&(console.error("Setting variable "+e+" to undefined value"),t=p),"undefined"===t.ctype?r[r.length-1]=t:(null===(e=t)&&(e=p),r[r.length-1]=e)},zr.undefinedWarning={},zr.getvar=function(e){var t=this.vars[e]||[];return 0===t.length&&console.error("Getting non-existing variable "+e),null===(t=t[t.length-1])?At.csnames.hasOwnProperty(e)?{ctype:"geo",value:At.csnames[e]}:(console&&console.log&&void 0===this.undefinedWarning[e]&&(this.undefinedWarning[e]=!0,console.log("Warning: Accessing undefined variable: "+e)),p):t},zr.dump=function(e){var t=this.vars[e];for(console.log("*** Dump "+e),e=0;e<t.length;e++)console.log(e+":> "+R(t[e]))},zr.vstack=[],zr.pushVstack=function(e){this.vstack.push(e)},zr.popVstack=function(){this.vstack.pop()},zr.cleanVstack=function(){for(var e=this.vstack;0<e.length&&"*"!==e[e.length-1];)this.removevar(e[e.length-1]),e.pop();0<e.length&&e.pop()};var jr={generalFields:{color:"color",colorhsb:"",size:"size",alpha:"alpha",fillcolor:"fillcolor",fillalpha:"fillalpha",isshowing:"isshowing",visible:"visible",name:"name",caption:"caption",trace:"",tracelength:"",selected:"",labeled:"labeled",labelled:"labeled"},getGeoField:function(e,t){return void 0!==At.csnames[e]?jr.getField(At.csnames[e],t):p},setGeoField:function(e,t,r){return void 0!==At.csnames[e]?jr.setField(At.csnames[e],t,r):p},getField:function(e,t){if("P"===e.kind){if("xy"===t)return e=Ir.dehom(e.homog),Or.withUsage(e,"Point");if("homog"===t)return Or.withUsage(e.homog,"Point");if("x"===t)return Cr.div(e.homog.value[0],e.homog.value[2]);if("y"===t)return Cr.div(e.homog.value[1],e.homog.value[2]);if("narrow"===t)return Or.wrap(e.narrow)}if("L"===e.kind||"S"===e.kind){if("homog"===t)return Or.withUsage(e.homog,"Line");if("angle"===t)return e=Ir.eucangle(Ir.ey,e.homog),Or.withUsage(e,"Angle");if("slope"===t)return Cr.neg(Cr.div(e.homog.value[0],e.homog.value[1]))}if("Tr"===e.kind&&"matrix"===t)return e.matrix;if("C"===e.kind){if("radius"===t){var r=e.matrix;e=r.value[0].value[0];var n=r.value[0].value[2];return t=r.value[1].value[2],r=r.value[2].value[2],Cr.mult(e,e),n=Cr.div(n,e),t=Cr.div(t,e),e=Cr.div(r,e),Cr.sqrt(Cr.sub(Cr.add(Cr.mult(n,n),Cr.mult(t,t)),e))}if("size"===t)return e.size;if("matrix"===t)return e.matrix;if("center"===t)return e=Gn._helper.CenterOfConic(e.matrix),e=Ir.dehom(e),Or.withUsage(e,"Point");if("dualMatrix"===t)return Ir.normalizeMax(Ir.adjoint3(e.matrix));if("narrow"===t)return Or.wrap(e.narrow)}if("Text"===e.kind){if("pressed"===t)return e.checkbox?Or.bool(e.checkbox.checked):Or.bool(!1);if("xy"===t)return e=Ir.dehom(e.homog),Or.withUsage(e,"Point");if("homog"===t)return Or.withUsage(e.homog,"Point");if("x"===t)return Cr.div(e.homog.value[0],e.homog.value[2]);if("y"===t)return Cr.div(e.homog.value[1],e.homog.value[2])}if("trace"===t)return Or.bool(!!e.drawtrace);if("pinned"===t)return Or.bool(!!e.pinned);if(jr.generalFields[t])return(e=e[jr.generalFields[t]])&&e.ctype?e:"object"!=typeof e?Or.wrap(e):p;if(e.behavior){if("mass"===t&&"Mass"===e.behavior.type)return Cr.real(e.behavior.mass);if("radius"===t&&"Mass"===e.behavior.type)return Cr.real(e.behavior.radius);if("charge"===t&&"Mass"===e.behavior.type)return Cr.real(e.behavior.charge);if("friction"===t&&"Mass"===e.behavior.type)return Cr.real(e.behavior.friction);if("vx"===t&&"Mass"===e.behavior.type)return Cr.real(e.behavior.vx);if("vy"===t&&"Mass"===e.behavior.type)return Cr.real(e.behavior.vy);if("v"===t&&"Mass"===e.behavior.type)return Ir.realVector([e.behavior.vx,e.behavior.vy]);if("fx"===t&&"Mass"===e.behavior.type)return Cr.real(e.behavior.fx);if("fy"===t&&"Mass"===e.behavior.type)return Cr.real(e.behavior.fy);if("f"===t&&"Mass"===e.behavior.type)return Ir.realVector([e.behavior.fx,e.behavior.fy]);if("ldiff"===t&&"Spring"===e.behavior.type)return Cr.real(e.behavior.ldiff)}return"function"==typeof(t=Gn[e.type]["get_"+t])?t(e):p},setField:function(e,t,r){if("color"===t&&Ir._helper.isNumberVecN(r,3)&&(e.color=r),"size"===t&&"number"===r.ctype&&(e.size=r),"alpha"===t&&"number"===r.ctype&&(e.alpha=r),"fillcolor"===t&&Ir._helper.isNumberVecN(r,3)&&(e.fillcolor=r),"fillalpha"===t&&"number"===r.ctype&&(e.fillalpha=r),"visible"===t&&"boolean"===r.ctype&&(e.visible=r.value),"pinned"===t&&"boolean"===r.ctype&&(e.pinned=r.value),"labeled"!==t&&"labelled"!==t||"boolean"!==r.ctype||(e.labeled=r.value),"printlabel"===t&&(e.printname=R(r)),"trace"===t&&"boolean"===r.ctype&&(r.value&&!e.drawtrace?(e.drawtrace=!0,je(e)):e.drawtrace=r.value),"P"===e.kind&&e.movable&&("xy"===t&&Ir._helper.isNumberVecN(r,2)&&et(e,Ir.turnIntoCSList([r.value[0],r.value[1],Cr.real(1)]),"homog"),"xy"===t&&Ir._helper.isNumberVecN(r,3)&&et(e,r,"homog"),"x"===t&&"number"===r.ctype&&et(e,Ir.turnIntoCSList([Cr.mult(r,e.homog.value[2]),e.homog.value[1],e.homog.value[2]]),"homog"),"y"===t&&"number"===r.ctype&&et(e,Ir.turnIntoCSList([e.homog.value[0],Cr.mult(r,e.homog.value[2]),e.homog.value[2]]),"homog"),"homog"===t&&Ir._helper.isNumberVecN(r,3)&&et(e,r,"homog")),"homog"===t&&"L"===e.kind&&e.movable&&Ir._helper.isNumberVecN(r,3)&&et(e,r,"homog"),"Text"===e.kind&&("pressed"===t&&"boolean"===r.ctype&&e.checkbox&&(e.checkbox.checked=r.value),e.movable&&("xy"===t?Ir._helper.isNumberVecN(r,2)?e.homog=Ir.turnIntoCSList([r.value[0],r.value[1],Cr.real(1)]):Ir._helper.isNumberVecN(r,3)&&(e.homog=r):"homog"===t&&Ir._helper.isNumberVecN(r,3)?e.homog=r:"x"===t&&"number"===r.ctype?e.homog=Ir.turnIntoCSList([Cr.mult(r,e.homog.value[2]),e.homog.value[1],e.homog.value[2]]):"y"===t&&"number"===r.ctype&&(e.homog=Ir.turnIntoCSList([e.homog.value[0],Cr.mult(r,e.homog.value[2]),e.homog.value[2]])))),e.behavior&&("mass"===t&&"Mass"===e.behavior.type&&"number"===r.ctype&&(e.behavior.mass=r.value.real),"mass"===t&&"Sun"===e.behavior.type&&"number"===r.ctype&&(e.behavior.mass=r.value.real),"friction"===t&&"Mass"===e.behavior.type&&"number"===r.ctype&&(e.behavior.friction=r.value.real),"charge"===t&&"Mass"===e.behavior.type&&"number"===r.ctype&&(e.behavior.charge=r.value.real),"radius"===t&&"Mass"===e.behavior.type&&"number"===r.ctype&&(e.behavior.radius=r.value.real),"vx"===t&&"Mass"===e.behavior.type&&"number"===r.ctype&&(e.behavior.vx=r.value.real),"vy"===t&&"Mass"===e.behavior.type&&"number"===r.ctype&&(e.behavior.vy=r.value.real),"v"===t&&"Mass"===e.behavior.type&&Ir._helper.isNumberVecN(r,2)&&(e.behavior.vx=r.value[0].value.real,e.behavior.vy=r.value[1].value.real)),"narrow"===t&&-1!==["P","C"].indexOf(e.kind)&&("boolean"===r.ctype&&(e.narrow=r.value),"number"===r.ctype&&Cr._helper.isAlmostReal(r)&&(e.narrow=r.value.real)),"function"==typeof(t=Gn[e.type]["set_"+t]))return t(e,r)},getuserData:function(e,t){var r;return"string"===t.ctype&&e.userData&&e.userData[t.value]&&(r=e.userData[t.value]),r&&r.ctype?r:"object"!=typeof r?Or.wrap(r):p},setuserData:function(e,t,r){t&&"string"===t.ctype&&e&&r&&(e.userData||(e.userData={}),e.userData[t.value]=r)}};kr.version$0=function(e,t){return e=["CindyJS"].concat(Pr),Ir.turnIntoCSList(e.map(Or.wrap))},kr.clearconsole$0=function(e,t){St.clear()},kr.err$1=function(e,t){return t="","variable"===e[0].ctype?(t=e[0].name,e=zr.getvar(e[0].name)):e=e[0],ge(e=t+" ===> "+R(he(e))),p},kr.errc$1=function(e,t){return"variable"===e[0].ctype?(t=he(zr.getvar(e[0].name)),console.log(e[0].name+" ===> "+R(t))):(t=he(e[0]),console.log(" ===> "+R(t))),p},kr.print$1=function(e,t){return St.out(R(he(e[0]),t),!0),p},kr.println$1=function(e,t){return St.out(R(he(e[0]))),p},kr.assert$2=function(e,t){var r=he(e[0]);if("boolean"===r.ctype){if(!1===r.value)return kr.println$1([e[1]],t)}else ge("Condition for assert is not boolean");return p},kr.dump$1=function(e,t){return console.log(JSON.stringify(e[0])),p},kr.repeat$2=function(e,t){return kr.repeat$3([e[0],null,e[1]],t)},kr.repeat$3=function(e,t){var r=ve(e[0]),n="#";if(null!==e[1]&&"variable"===e[1].ctype&&(n=e[1].name),"number"!==r.ctype)return p;var i=1,a=1,o=(r=Math.round(r.value.real))+1,l=!1,s=!1,u=!1;if(void 0!==t.start){var c=he(t.start);"number"===c.ctype&&(l=!0,a=c.value.real)}for(void 0!==t.step&&("number"===(c=he(t.step)).ctype&&(u=!0,i=c.value.real)),void 0!==t.stop&&("number"===(c=he(t.stop)).ctype&&(s=!0,o=c.value.real)),!l||s||u||(o=i*r+a),l||!s||u||(a=-i*(r-1)+o,o+=i),l||s||!u||(o=i*r+a),l&&s&&!u&&(o+=i=(o-a)/(r-1)),l&&!s&&u&&(o=i*r+a),!l&&s&&u&&(a=-i*(r-1)+o,o+=i),l&&s&&u&&(o+=i),(a<=o&&0<i||a>=o&&0>i)&&l&&s&&u&&(r=Math.floor((o-a)/i)),zr.newvar(n),t=p,o=0;o<r;o++)zr.setvar(n,{ctype:"number",value:{real:o*i+a,imag:0}}),t=he(e[2]);return zr.removevar(n),t},kr.while$2=function(e,t){t=e[1];for(var r=he(e=e[0]),n=p;"list"!==r.ctype&&r.value;)n=he(t),r=he(e);return n},kr.apply$2=function(e,t){return kr.apply$3([e[0],null,e[1]],t)},kr.apply$3=function(e,t){return kr.apply$4([e[0],e[1],null,e[2]],t)},kr.apply$4=function(e,t){if("list"!==(t=ve(e[0])).ctype&&"JSON"!==t.ctype)return p;var r="#";if(null!==e[1]&&"variable"===e[1].ctype&&(r=e[1].name),null!==e[2]&&"variable"===e[2].ctype){var n=e[2].name;zr.newvar(n)}var i=t.value,a="list"===t.ctype?[]:{};if(zr.newvar(r),void 0!==n){if("list"===t.ctype)for(var o=0;o<i.length;o++)zr.setvar(n,Cr.real(o+1)),zr.setvar(r,i[o]),a[o]=he(e[3]);else for(o in i)zr.setvar(n,Or.string(o)),zr.setvar(r,i[o]),a[o]=he(e[3]);zr.removevar(n)}else if("list"===t.ctype)for(a=[],n=0;n<i.length;n++)zr.setvar(r,i[n]),a[n]=he(e[3]);else for(var l in i)zr.setvar(r,i[l]),a[l]=he(e[3]);return zr.removevar(r),"list"===t.ctype?Ir.turnIntoCSList(a):Lr.turnIntoCSJson(a)},kr.forall$2=function(e,t){return kr.forall$3([e[0],null,e[1]],t)},kr.forall$3=function(e,t){var r=ve(e[0]);if("list"!==r.ctype&&"JSON"!==r.ctype)return p;var n="#";null!==e[1]&&"variable"===e[1].ctype&&(n=e[1].name);var i=r.value;if(zr.newvar(n),"list"===r.ctype)for(t=0;t<i.length;t++){zr.setvar(n,i[t]);var a=he(e[2])}else a=Lr._helper.forall(i,n,e[2],t);return zr.removevar(n),a},kr.select$2=function(e,t){return kr.select$3([e[0],null,e[1]],t)},kr.select$3=function(e,t){var r=ve(e[0]);if("list"!==r.ctype&&"JSON"!==r.ctype)return p;t="#",null!==e[1]&&"variable"===e[1].ctype&&(t=e[1].name);var n=r.value;if(zr.newvar(t),"list"===r.ctype){r=[];for(var i=0,a=0;a<n.length;a++){zr.setvar(t,n[a]);var o=he(e[2]);"boolean"===o.ctype&&!0===o.value&&(r[i]=n[a],i++)}e={ctype:"list",value:r}}else{for(i in r={},n)zr.setvar(t,n[i]),"boolean"===(o=he(e[2])).ctype&&!0===o.value&&(r[i]=n[i]);e={ctype:"JSON",value:r}}return zr.removevar(t),e},kr.flatten$1=function(e,t){return"list"!==(e=ve(e[0])).ctype?e:(void 0===(t=t.levels)?t=1:t="number"===(t=he(t)).ctype?t.value.real:"string"===t.ctype&&"all"===t.value?-2:1,{ctype:"list",value:function e(t,r){return-1===r||"list"!==t.ctype?t:[].concat.apply([],t.value.map((function(t){return e(t,r-1)})))}(e,t)})},kr.createvar$1=function(e,t){return"variable"===e[0].ctype&&zr.newvar(e[0].name),p},kr.local=function(e,t){for(t=0;t<e.length;t++)"variable"===e[t].ctype&&zr.newvar(e[t].name);return p},kr.removevar$1=function(e,t){return t=he(e[0]),"variable"===e[0].ctype&&zr.removevar(e[0].name),t},kr.release=function(e,t){if(0===e.length)return p;t=he(e[e.length-1]);for(var r=0;r<e.length;r++)"variable"===e[r].ctype&&zr.removevar(e[r].name);return t},kr.regional=function(e,t){for(t=0;t<e.length;t++)if("variable"===e[t].ctype){var r=e[t].name;zr.newvar(r),zr.pushVstack(r)}return p},kr.genList=function(e,t){return Ir.turnIntoCSList(e.map(he))},kr.genJSON=function(e,t){t={};for(var r=0;r<e.length;r++){var n=Lr.GenFromUserDataEl(e[r]);n.key&&(t[n.key]=n.val)}return{ctype:"JSON",value:t}},Rr.assigntake=function(e,t){var r=e.args[0],n=he(r);e=ve(e.args[1]);var i=p;if("list"===n.ctype||"string"===n.ctype){var a=Math.floor(e.value.real);0>a&&(a=n.value.length+a+1),0<a&&a<=n.value.length&&("list"===n.ctype?((i=n.value.slice())[a-1]=he(t),i=Ir.turnIntoCSList(i),n.userData&&(i.userData=n.userData)):(i=(i=n.value).substring(0,a-1)+R(he(t))+i.substring(a,i.length),i=Or.string(i)))}"JSON"===n.ctype&&(e=R(e),-1===R.errorTypes.indexOf(e)&&((i=Lr._helper.ShallowClone(n)).value[e]=he(t))),z([r,i])},Rr.assigndot=function(e,t){var r=he(e.obj);return e=e.key,"geo"===r.ctype&&"string"==typeof e&&jr.setField(r.value,e,ve(t)),"JSON"===r.ctype&&"string"==typeof e&&Lr.setField(r.value,e,ve(t)),p},Rr.assigncolon=function(e,t){var r=e.obj,n=he(r);if("_?_"===(e=Or.string(R(he(e.key)))).value&&(e=p),"geo"===n.ctype&&e)jr.setuserData(n.value,e,ve(t));else if("list"===n.ctype||"string"===n.ctype&&e){var i,a={};for(i in n)a[i]=n[i];if(a.userData){for(var o in n={},a.userData)n[o]=a.userData[o];a.userData=n}else a.userData={};a.userData[e.value]=ve(t),z([r,a])}else e&&"string"===e.ctype?console.log("User data can only be assigned to geo objects and lists."):console.log("Key is undefined");return p},kr.keys$1=function(e,t){var r=(t=he(e[0])).ctype;return"geo"===r||"list"===r||"JSON"===r?(e=[],(t="geo"===r?t.value.userData:"list"===r?t.userData:t.value)&&(e=Object.keys(t).map(Or.string).sort()),Ir.turnIntoCSList(e)):p},kr.values$1=function(e,t){if("list"===(t=(e=he(e[0])).ctype))return e;if("geo"===t||"JSON"===t){var r,n=[];return(r="geo"===t?e.value.userData:e.value)&&(n=Object.keys(r).sort().map((function(e){return r[e]}))),Ir.turnIntoCSList(n)}return p},Rr.assignlist=function(e,t){var r=e.length,n=t.length;for(n<r&&(r=n),n=0;n<r;n++)z([e[n],t[n]],[])},kr.if$2=function(e,t){return kr.if$3(e,t)},kr.if$3=function(e,t){if("boolean"===(t=ve(e[0])).ctype){if(!0===t.value)return he(e[1]);if(3===e.length)return he(e[2])}else ge("Condition for if is not boolean");return p},kr.and$2=B,kr.or$2=X,kr.xor$2=function(e,t){return t=ve(e[0]),e=ve(e[1]),"boolean"===t.ctype&&"boolean"===e.ctype?{ctype:"boolean",value:t.value!==e.value}:p},kr.not$1=function(e,t){return"boolean"===(e=ve(e[0])).ctype?{ctype:"boolean",value:!e.value}:p},Rr.genericListMathGen=function(e,t,r){kr[e+"$1"]=function(e,n){if("list"!==(e=he(e[0])).ctype)return p;if(0===(e=e.value).length)return r;n=e[0];for(var i=1;i<e.length;i++)n=t(n,e[i]);return n};var n=e+"$3";kr[e+"$2"]=function(e,t){return kr[n]([e[0],null,e[1]])},kr[n]=function(e,n){if("list"!==(n=ve(e[0])).ctype)return p;if(0===(n=n.value).length)return r;var i="#";null!==e[1]&&"variable"===e[1].ctype&&(i=e[1].name),zr.newvar(i),zr.setvar(i,n[0]);for(var a=he(e[2]),o=1;o<n.length;o++){zr.setvar(i,n[o]);var l=he(e[2]);a=t(a,l)}return zr.removevar(i),a}},Rr.genericListMathGen("product",Or.mult,Cr.real(1)),Rr.genericListMathGen("sum",Or.add,Cr.real(0)),Rr.genericListMathGen("max",Or.max,p),Rr.genericListMathGen("min",Or.min,p),kr.max$2=function(e,t){return"list"===(t=ve(e[0])).ctype?kr.max$3([t,null,e[1]]):(e=ve(e[1]),kr.max$1([Ir.turnIntoCSList([t,e])]))},kr.min$2=function(e,t){return"list"===(t=ve(e[0])).ctype?kr.min$3([t,null,e[1]]):(e=ve(e[1]),kr.min$1([Ir.turnIntoCSList([t,e])]))},kr.add$2=$,kr.sub$2=Y,kr.mult$2=q,kr.div$2=U,kr.mod$2=function(e,t){return t=ve(e[0]),e=ve(e[1]),"number"===t.ctype&&"number"===e.ctype?Cr.mod(t,e):p},kr.pow$2=V,kr.exp$1=function(e,t){return"number"===(e=ve(e[0])).ctype?Cr.exp(e):p},kr.sin$1=function(e,t){return"number"===(e=ve(e[0])).ctype?Cr.sin(e):p},kr.sqrt$1=function(e,t){return"number"===(e=ve(e[0])).ctype?Cr.sqrt(e):p},Rr.laguerre=function(e,t,r){if("list"!==e.ctype)return p;var n,i=e.value.length-1;for(n=0;n<=i;n++)if("number"!==e.value[n].ctype)return p;if("number"!==t.ctype)return p;for(var a,o,l,s=[1,.3141,.5926,.5358,.9793,.2385,.6264,.3383,.2795,.0288],u=1;u<=r;u++){for(o=l=Cr.zero,a=e.value[i],n=i-1;0<=n;n--)l=Cr.add(o,Cr.mult(l,t)),o=Cr.add(a,Cr.mult(o,t)),a=Cr.add(e.value[n],Cr.mult(a,t));if(Cr._helper.isLessThan(Cr.abs(a),Cr.real(1e-14)))break;if(n=Cr.div(o,a),o=Cr.mult(n,n),a=Cr.sub(o,Cr.div(Cr.mult(Cr.real(2),l),a)),l=Cr.sqrt(Cr.mult(Cr.real(i-1),Cr.sub(Cr.mult(Cr.real(i),a),o))),a=Cr.add(n,l),n=Cr.sub(n,l),Cr._helper.isLessThan(Cr.abs(a),Cr.abs(n))&&(a=n),n=Cr._helper.isLessThan(Cr.real(1e-14),Cr.abs(a))?Cr.div(Cr.real(i),a):Cr.mult(Cr.add(Cr.abs(t),Cr.one),Cr.complex(Math.cos(u),Math.sin(u))),Cr._helper.isLessThan(Cr.abs(n),Cr.real(1e-14)))break;0==u%20&&u<r-19&&(n=Cr.mult(n,Cr.real(s[Math.floor(u/20)]))),t=Cr.sub(t,n)}return t},Rr.quadratic_roots=function(e){if("list"!==e.ctype)return p;var t=e.value[2],r=e.value[1];if(e=e.value[0],Cr._helper.isZero(e))return[Cr.zero,Cr.neg(Cr.div(r,t))];var n=Cr.sqrt(Cr.sub(Cr.mult(r,r),Cr.mult(Cr.real(4),Cr.mult(t,e))));return 0<=Cr.re(r)&&(n=Cr.neg(n)),[Cr.div(Cr.sub(n,r),Cr.mult(Cr.real(2),t)),Cr.div(Cr.mult(Cr.real(2),e),Cr.sub(n,r))]},Rr.roots=function(e){var t=[],r=e,n=e.value.length-1;if(0>=n)return Ir.turnIntoCSList([]);if(Cr._helper.isZero(e.value[n]))return t=Rr.roots(Ir.turnIntoCSList(e.value.slice(0,n))),Ir.append(t,Cr.infinity);if(1===n)t[0]=Cr.neg(Cr.div(e.value[0],e.value[1]));else if(2===n)t=Rr.quadratic_roots(e);else{for(var i=0;i<n-2;i++){t[i]=Rr.laguerre(e,Cr.zero,200),t[i]=Rr.laguerre(r,t[i],1);var a=[];a[n-i]=e.value[n-i];for(var o=n-i;0<o;o--)a[o-1]=Cr.add(e.value[o-1],Cr.mult(a[o],t[i]));a.shift(),e=Ir.turnIntoCSList(a)}e=Rr.quadratic_roots(e),t[n-2]=e[0],t[n-1]=e[1]}return Ir.turnIntoCSList(t)},kr.roots$1=function(e,t){if("list"===(e=ve(e[0])).ctype){for(t=0;t<e.value.length;t++)if("number"!==e.value[t].ctype)return p;return e=Rr.roots(e),Ir.sort1(e)}return p},kr.autodiff$3=function(e,t){if(t="x","function"===e[0].ctype){var r=Ar[e[0].oper].body;t=e[0].args[0].name}else{if("function"!=typeof e[0].impl)return ge("could not parse function"),p;r=e[0]}var n=ve(e[1]);return 1>(e=ve(e[2])).value.real?(ge("grade cant be < 1"),p):(e=Cr.add(e,Cr.real(1)),vn.autodiff(r,t,n,e))},kr.cos$1=function(e,t){return"number"===(e=ve(e[0])).ctype?Cr.cos(e):p},kr.tan$1=function(e,t){return"number"===(e=ve(e[0])).ctype?Cr.tan(e):p},kr.arccos$1=function(e,t){return"number"===(e=ve(e[0])).ctype?Cr.arccos(e):p},kr.arcsin$1=function(e,t){return"number"===(e=ve(e[0])).ctype?Cr.arcsin(e):p},kr.arctan$1=function(e,t){return"number"===(e=ve(e[0])).ctype?Cr.arctan(e):p},kr.arctan2$2=function(e,t){return t=ve(e[0]),e=ve(e[1]),"number"===t.ctype&&"number"===e.ctype?Cr.arctan2(t,e):p},kr.arctan2$1=function(e,t){if("list"===(e=ve(e[0])).ctype&&2===e.value.length){if("number"===(e=e.value)[0].ctype&&"number"===e[1].ctype)return kr.arctan2$2(e,t)}else if("number"===e.ctype)return Cr.arctan2(e);return p},kr.log$1=function(e,t){return"number"===(e=ve(e[0])).ctype?Cr.log(e):p},Rr.recursiveGen=function(e){var t=Cr[e],r=Ir[e];kr[e+"$1"]=function(e,n){return"number"===(e=ve(e[0])).ctype?t(e):"list"===e.ctype?r(e):p}},Rr.recursiveGen("im"),Rr.recursiveGen("re"),Rr.recursiveGen("conjugate"),Rr.recursiveGen("round"),Rr.recursiveGen("ceil"),Rr.recursiveGen("floor"),Rr.recursiveGen("abs"),kr.abs_infix=kr.abs$1,kr.random$0=function(e,t){return Cr.real(Cr._helper.rand())},kr.random$1=function(e,t){return"number"===(e=ve(e[0])).ctype?Cr.complex(e.value.real*Cr._helper.rand(),e.value.imag*Cr._helper.rand()):p},kr.seedrandom$1=function(e,t){return"number"===(e=ve(e[0])).ctype&&Cr._helper.seedrandom(e.value.real),p},kr.randomnormal$0=function(e,t){return Cr.real(Cr._helper.randnormal())},kr.randominteger$1=function(e,t){return"number"===(t=ve(e[0])).ctype?(e=0|t.value.real,t=0|t.value.imag,e=e*Cr._helper.rand()|0,t=t*Cr._helper.rand()|0,Cr.complex(e,t)):p},kr.randomint$1=kr.randominteger$1,kr.randombool$0=function(e,t){return.5<Cr._helper.rand()?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}},kr.isreal$1=function(e,t){return"number"===(e=he(e[0])).ctype&&Cr._helper.isAlmostReal(e)?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}},kr.isinteger$1=function(e,t){return"number"===(e=he(e[0])).ctype&&Cr._helper.isAlmostReal(e)&&e.value.real===Math.floor(e.value.real)?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}},kr.iseven$1=function(e,t){return"number"===(e=he(e[0])).ctype&&Cr._helper.isAlmostReal(e)&&e.value.real/2===Math.floor(e.value.real/2)?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}},kr.isodd$1=function(e,t){return"number"===(e=he(e[0])).ctype&&Cr._helper.isAlmostReal(e)&&(e.value.real-1)/2===Math.floor((e.value.real-1)/2)?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}},kr.iscomplex$1=function(e,t){return"number"===he(e[0]).ctype?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}},kr.isstring$1=function(e,t){return"string"===he(e[0]).ctype?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}},kr.islist$1=function(e,t){return"list"===he(e[0]).ctype?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}},kr.ismatrix$1=function(e,t){return e=he(e[0]),-1!==Ir._helper.colNumb(e)?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}},kr.iscircle$1=function(e,t){return"geo"===(e=he(e[0])).ctype&&"C"===e.value.kind&&"Circle"===e.value.matrix.usage?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}},kr.isconic$1=function(e,t){return"geo"===(e=he(e[0])).ctype&&"C"===e.value.kind?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}},kr.isline$1=function(e,t){return"geo"===(e=he(e[0])).ctype&&"L"===e.value.kind?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}},kr.ispoint$1=function(e,t){return"geo"===(e=he(e[0])).ctype&&"P"===e.value.kind?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}},kr.isgeometric$1=function(e,t){return"geo"===he(e[0]).ctype?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}},kr.isnumbermatrix$1=function(e,t){return e=he(e[0]),Ir.isNumberMatrix(e)},kr.isnumbervector$1=function(e,t){return e=he(e[0]),Ir.isNumberVector(e)},kr.issun$1=function(e,t){return"geo"===(e=he(e[0])).ctype&&void 0!==e.value.behavior&&"Sun"===e.value.behavior.type?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}},kr.ismass$1=function(e,t){return"geo"===(e=he(e[0])).ctype&&void 0!==e.value.behavior&&"Mass"===e.value.behavior.type?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}},kr.isspring$1=function(e,t){return"geo"===(e=he(e[0])).ctype&&void 0!==e.value.behavior&&"Spring"===e.value.behavior.type?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}},kr.isbouncer$1=function(e,t){return"geo"===(e=he(e[0])).ctype&&void 0!==e.value.behavior&&"Bouncer"===e.value.behavior.type?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}},kr.isundefined$1=function(e,t){return"undefined"===he(e[0]).ctype?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};var Dr={ArcBy3:"Arc",CenterOfConic:"Center",ConicBy1p4l:"Conic1P4L",ConicBy4p1l:"Conic4P1L",ConicBy5lines:"Conic5L",ConicBy2Foci1P:"ConicFoci",ConicFromPrincipalDirections:"ConicPrincipleDirs",Free:"FreePoint",PolarOfLine:"PolarLine",PolarOfPoint:"PolarPoint",PointOnSegment:"PointOnLine",Button:"Text",ToggleButton:"Text",TrReflectionL:"TrReflection",TrReflectionP:"TrReflection",TrReflectionC:"TrReflection",TrTranslation:"TrProjection",TrSimilarity:"TrProjection",TrAffine:"TrProjection",TransformP:"Transform",TransformL:"Transform",TransformSegment:"Transform",TransformS:"Transform",TransformPolygon:"Transform",TransformArc:"Transform",TransformConic:"Transform",TransformC:"Transform",TrMoebiusP:"Transform",TrMoebiusL:"Transform",TrMoebiusSegment:"Transform",TrMoebiusS:"Transform",TrMoebiusPolygon:"Transform",TrMoebiusArc:"Transform",TrMoebiusCircle:"Transform",TrMoebiusC:"Transform",TrInverseMoebius:"TrInverse",Perp:"Orthogonal",Para:"Parallel",AngleBisector:"AngularBisector",IntersectLC:"IntersectionConicLine",IntersectCirCir:"IntersectionCircleCircle",OtherPointOnCircle:"PointOnCircle"};kr.algorithm$1=function(e,t){if("geo"===(e=he(e[0])).ctype){var r=(e=e.value).type;return"string"===(t=ve(t.compatibility)).ctype&&/^cinderella$/i.test(t.value)&&(/^Select/.test(r)&&(r=(e=At.csnames[e.args[0]]).type),Dr.hasOwnProperty(r)?r=Dr[r]:"CircleMr"===r&&(r=e.pinned?"CircleByFixedRadius":"CircleByRadius")),Or.string(r)}return p},kr.inputs$1=function(e,t){if("geo"===(e=he(e[0])).ctype){t=(e=e.value).type;var r=[];if(e.args&&(r=e.args.map((function(e){return{ctype:"geo",value:At.csnames[e]}}))),/^Select/.test(t)||Gn[t].isMovable)switch(e.kind){case"P":case"L":r.push(e.homog);break;case"C":r.push(e.matrix)}return Ir.turnIntoCSList(r)}return p},kr.moveto$2=function(e,t){return t=he(e[0]),e=ve(e[1]),"geo"===t.ctype&&(t=t.value,Ir._helper.isNumberVecN(e,2)?jr.setField(t,"xy",e):Ir._helper.isNumberVecN(e,3)&&jr.setField(t,"homog",e)),p},kr.continuefromhere$0=function(e,t){return Ze(),p},kr.matrixrowcolumn$1=function(e,t){return e=he(e[0]),-1!==Ir._helper.colNumb(e)?Ir.realVector([e.value.length,e.value[0].value.length]):p},kr.rowmatrix$1=function(e,t){return"list"===(e=he(e[0])).ctype?Ir.turnIntoCSList([e]):p},kr.columnmatrix$1=function(e,t){return"list"===(e=he(e[0])).ctype?Ir.turnIntoCSList(e.value.map((function(e){return Ir.turnIntoCSList([e])}))):p},kr.submatrix$3=function(e,t){t=he(e[0]);var r=he(e[1]);if(e=he(e[2]),"list"===t.ctype&&"number"===r.ctype&&"number"===e.ctype){var n=Math.round(r.value.real);e=Math.round(e.value.real),t=t.value.slice(),0<e&&e<=t.length&&t.splice(e-1,1);var i=!0;return t=t.map((function(e){if("list"===e.ctype)return e=e.value.slice(),0<n&&n<=e.length&&e.splice(n-1,1),Ir.turnIntoCSList(e);i=!1})),i?Ir.turnIntoCSList(t):p}return p},kr.complex$1=function(e,t){var r=ve(e[0]);if("list"===r.ctype&&Ir.isNumberVector(r)){if(2===r.value.length)return e=r.value[0],t=r.value[1],Cr.complex(e.value.real-t.value.imag,t.value.real+e.value.imag);if(3===r.value.length)return e=r.value[0],t=r.value[1],r=r.value[2],e=Cr.div(e,r),t=Cr.div(t,r),Cr.complex(e.value.real-t.value.imag,t.value.real+e.value.imag)}return p},kr.gauss$1=function(e,t){return"number"===(e=ve(e[0])).ctype?Ir.realVector([e.value.real,e.value.imag]):p},kr.cross$2=W,kr.crossratio$4=function(e,t){t=he(e[0]);var r=he(e[1]),n=he(e[2]);e=he(e[3]);var i=de(t),a=de(r),o=de(n),l=de(e);return i!==p&&a!==p&&o!==p&&l!==p?Ir.crossratio3(i,a,o,l,Ir.ii):"number"===t.ctype&&"number"===r.ctype&&"number"===n.ctype&&"number"===e.ctype?Cr.div(Cr.mult(Cr.sub(t,n),Cr.sub(r,e)),Cr.mult(Cr.sub(t,e),Cr.sub(r,n))):p},kr.para$2=function(e,t){t=ve(e[0]);var r=ve(e[1]);e=de(t);var n=de(r);if(t!==p&&r!==p){r=r.usage;var i=e,a=n;return"Line"!==t.usage&&"Point"!==r||(i=n,a=e),t=Ir.cross(Ir.cross(Ir.linfty,a),i),Or.withUsage(t,"Line")}return p},kr.perp$2=function(e,t){t=ve(e[0]);var r=ve(e[1]);e=de(t);var n=de(r);if(t!==p&&r!==p){var i=r.usage||n.usage;r=e;var a=n;return"Line"!==(t.usage||e.usage)&&"Point"!==i||(r=n,a=e),t=Ir.turnIntoCSList([a.value[0],a.value[1],Cr.zero]),t=Ir.cross(t,r),Or.withUsage(t,"Line")}return p},kr.perp$1=function(e,t){return e=ve(e[0]),Ir._helper.isNumberVecN(e,2)?Ir.turnIntoCSList([Cr.neg(e.value[1]),e.value[0]]):p},kr.parallel$2=kr.para$2,kr.perpendicular$2=kr.perp$2,kr.perpendicular$1=kr.perp$1,kr.meet$2=function(e,t){return t=de(e[0]),e=de(e[1]),t!==p&&e!==p?(e=Ir.cross(t,e),Or.withUsage(e,"Point")):p},kr.join$2=function(e,t){return t=de(e[0]),e=de(e[1]),t!==p&&e!==p?(e=Ir.cross(t,e),Or.withUsage(e,"Line")):p},kr.dist$2=function(e,t){return e=Y([ve(e[0]),e=ve(e[1])],[]),kr.abs$1([e],[])},kr.dist_infix=kr.dist$2,kr.point$1=function(e,t){return e=he(e[0]),Ir._helper.isNumberVecN(e,3)||Ir._helper.isNumberVecN(e,2)?Or.withUsage(e,"Point"):e},kr.line$1=function(e,t){return e=he(e[0]),Ir._helper.isNumberVecN(e,3)?Or.withUsage(e,"Line"):e},kr.det$3=function(e,t){t=de(e[0]);var r=de(e[1]);if(e=de(e[2]),t!==p&&r!==p&&e!==p)return Ir.det3(t,r,e)},kr.det$1=function(e,t){return"list"===(e=ve(e[0])).ctype&&(-1!==(t=Ir._helper.colNumb(e))&&t===e.value.length)?Ir.det(e):p},kr.eig$1=function(e,t){return"list"===(e=ve(e[0])).ctype&&(-1!==(t=Ir._helper.colNumb(e))&&t===e.value.length)?Ir.eig(e):p},kr.eigenvalues$1=function(e,t){return"list"===(e=ve(e[0])).ctype&&(-1!==(t=Ir._helper.colNumb(e))&&t===e.value.length)?Ir.eig(e,!1).value[0]:p},kr.rank$1=function(e,t){if("list"===(e=ve(e[0])).ctype){var r=Ir._helper.colNumb(e);if(-1!==r&&r===e.value.length)return Ir.rank(e,t.precision)}return p},kr.kernel$1=function(e,t){if("list"===(e=ve(e[0])).ctype){var r=Ir._helper.colNumb(e);if(-1!==r&&r===e.value.length)return t=Ir.nullSpace(e,t.precision),Ir.transpose(t)}return p},kr.eigenvectors$1=function(e,t){return"list"===(e=ve(e[0])).ctype&&(-1!==(t=Ir._helper.colNumb(e))&&t===e.value.length)?Ir.eig(e).value[1]:p},kr.area$3=function(e,t){t=de(e[0]);var r=de(e[1]);if(e=de(e[2]),t!==p&&r!==p&&e!==p){var n=t.value[2],i=r.value[2],a=e.value[2];if(!Cr._helper.isAlmostZero(n)&&!Cr._helper.isAlmostZero(i)&&!Cr._helper.isAlmostZero(a))return t=Ir.scaldiv(n,t),r=Ir.scaldiv(i,r),e=Ir.scaldiv(a,e),t=Ir.det3(t,r,e),Cr.realmult(.5,t)}return p},kr.inverse$1=function(e,t){return"list"===(e=ve(e[0])).ctype&&(-1!==(t=Ir._helper.colNumb(e))&&t===e.value.length)?Ir.inverse(e):p},kr.linearsolve$2=function(e,t){if(t=ve(e[0]),e=ve(e[1]),"list"===t.ctype){var r=Ir._helper.colNumb(t);if(-1!==r&&r===t.value.length&&Ir._helper.isNumberVecN(e,r))return Ir.linearsolve(t,e)}return p};var Fr=[[[]],[[0]],[[0,1],[1,0]],[[0,1,2],[0,2,1],[1,0,2],[1,2,0],[2,0,1],[2,1,0]],[[0,1,2,3],[0,1,3,2],[0,2,1,3],[0,2,3,1],[0,3,1,2],[0,3,2,1],[1,0,2,3],[1,0,3,2],[1,2,0,3],[1,2,3,0],[1,3,0,2],[1,3,2,0],[2,0,1,3],[2,0,3,1],[2,1,0,3],[2,1,3,0],[2,3,0,1],[2,3,1,0],[3,0,1,2],[3,0,2,1],[3,1,0,2],[3,1,2,0],[3,2,0,1],[3,2,1,0]]];kr.mincostmatching$1=function(e,t){var r=he(e[0]);if(Ir.isNumberMatrix(r).value){var n,i,a=(e=r.value.length)<(t=Ir._helper.colNumb(r))?t:e,o=Array(a);for(n=0;n<a;++n)for(o[n]=Array(a),i=0;i<a;++i)o[n][i]=n<e&&i<t?r.value[n].value[i].value.real:0;for(r=G(o),a=Array(e),n=0;n<e;++n)i=r[n],a[n]=i<t?Cr.real(i+1):Cr.real(0);return Ir.turnIntoCSList(a)}return p},kr.take$2=H,kr.length$1=function(e,t){return"list"===(e=he(e[0])).ctype||"string"===e.ctype?Cr.real(e.value.length):p},kr.pairs$1=function(e,t){return"list"===(e=he(e[0])).ctype?Ir.pairs(e):p},kr.triples$1=function(e,t){return"list"===(e=he(e[0])).ctype?Ir.triples(e):p},kr.cycle$1=function(e,t){return"list"===(e=he(e[0])).ctype?Ir.cycle(e):p},kr.consecutive$1=function(e,t){return"list"===(e=he(e[0])).ctype?Ir.consecutive(e):p},kr.reverse$1=function(e,t){return"list"===(e=he(e[0])).ctype?Ir.reverse(e):p},kr.directproduct$2=function(e,t){return t=he(e[0]),e=he(e[1]),"list"===t.ctype&&"list"===e.ctype?Ir.directproduct(t,e):p},kr.concat$2=J,kr.common$2=Z,kr.remove$2=K,kr.append$2=Q,kr.prepend$2=ee,kr.contains$2=function(e,t){return t=he(e[0]),e=he(e[1]),"list"===t.ctype?Ir.contains(t,e):p},kr.sort$2=function(e,t){return kr.sort$3([e[0],null,e[1]],t)},kr.sort$3=function(e,t){var r=ve(e[0]);if("list"!==r.ctype)return p;t="#",null!==e[1]&&"variable"===e[1].ctype&&(t=e[1].name),r=r.value;var n,i=[];for(zr.newvar(t),n=0;n<r.length;n++)zr.setvar(t,r[n]),i[n]={val:r[n],result:he(e[2])};for(zr.removevar(t),i.sort(Or.compareResults),e=[],n=0;n<r.length;n++)e[n]=i[n].val;return{ctype:"list",value:e}},kr.sort$1=function(e,t){return"list"===(e=he(e[0])).ctype?Ir.sort1(e):p},kr.set$1=function(e,t){return"list"===(e=he(e[0])).ctype?Ir.set(e):p},kr.combinations$2=function(e,t){var r=he(e[0]);if("number"===(e=he(e[1])).ctype){var n=0|e.value.real;if("number"===r.ctype){var i=0|r.value.real;if(i-n<n&&(n=i-n),0>n)return Cr.real(0);if(0===n)return Cr.real(1);if(1===n)return r;for(var a=t=e=1;a<=n;++a){var o=i-n+a|0,l=0|a,s=0|te(o,l);o=o/s|0,l=(l=l/s|0)/(s=0|te(e,l))|0,e=(e=e/s|0)*(o=o/(s=0|te(o,t))|0)|0,t=(t=t/s|0)*l|0}return Cr.real(e/t)}if("list"===r.ctype){if(i=r.value.length,0>n||n>i)return Ir.turnIntoCSList([]);if(0===n)return Ir.turnIntoCSList([Ir.turnIntoCSList([])]);if(n===i)return Ir.turnIntoCSList([r]);var u=[],c=Array(n);return function e(t,a){t===n?u.push(Ir.turnIntoCSList(c.slice())):a<i&&(c[t]=r.value[a],e(t+1,a+1),e(t,a+1))}(0,0),Ir.turnIntoCSList(u)}}return p},kr.zeromatrix$2=function(e,t){return t=ve(e[0]),e=ve(e[1]),"number"===t.ctype&&"number"===e.ctype?Ir.zeromatrix(t,e):p},kr.zerovector$1=function(e,t){return"number"===(e=ve(e[0])).ctype?Ir.zerovector(e):p},kr.transpose$1=function(e,t){return"list"===(e=ve(e[0])).ctype&&-1!==Ir._helper.colNumb(e)?Ir.transpose(e):p},kr.row$2=function(e,t){return t=ve(e[0]),"number"===(e=ve(e[1])).ctype&&"list"===t.ctype&&-1!==Ir._helper.colNumb(t)?Ir.row(t,e):p},kr.column$2=function(e,t){return t=ve(e[0]),"number"===(e=ve(e[1])).ctype&&"list"===t.ctype&&-1!==Ir._helper.colNumb(t)?Ir.column(t,e):p},kr.dict$0=function(e,t){for(var r in e=Er.create(),t)t.hasOwnProperty(r)&&Er.put(e,Or.string(r),he(t[r]));return e},kr.put$3=function(e,t){t=he(e[0]);var r=he(e[1]);return e=he(e[2]),"dict"===t.ctype?(t=Er.clone(t),Er.put(t,r,e),t):p},kr.get$2=function(e,t){return t=he(e[0]),e=he(e[1]),"dict"===t.ctype?Er.get(t,e,p):p},kr.red$1=function(e,t){return"number"===(e=he(e[0])).ctype?Ir.realVector([Math.min(1,Math.max(0,e.value.real)),0,0]):p},kr.green$1=function(e,t){return"number"===(e=he(e[0])).ctype?Ir.realVector([0,Math.min(1,Math.max(0,e.value.real)),0]):p},kr.blue$1=function(e,t){return"number"===(e=he(e[0])).ctype?Ir.realVector([0,0,Math.min(1,Math.max(0,e.value.real))]):p},kr.gray$1=function(e,t){return"number"===(e=he(e[0])).ctype?(e=Math.min(1,Math.max(0,e.value.real)),Ir.realVector([e,e,e])):p},kr.grey$1=kr.gray$1,Rr.HSVtoRGB=function(e,t,r){e&&void 0===t&&void 0===r&&(t=e.s,r=e.v,e=e.h);var n=Math.floor(6*e),i=6*e-n;e=r*(1-t);var a=r*(1-i*t);switch(t=r*(1-(1-i)*t),n%6){case 0:var o=r,l=t,s=e;break;case 1:o=a,l=r,s=e;break;case 2:o=e,l=r,s=t;break;case 3:o=e,l=a,s=r;break;case 4:o=t,l=e,s=r;break;case 5:o=r,l=e,s=a}return Ir.realVector([o,l,s])},kr.hue$1=function(e,t){return"number"===(e=he(e[0])).ctype?(e=e.value.real,e-=Math.floor(e),Rr.HSVtoRGB(e,1,1)):p},Rr.shapeconvert=function(e){if("circle"===e.type){var t=e.value.value[0],r=(t=Or.div(t,t.value[2])).value[0].value.real,n=t.value[1].value.real;e=e.value.value[1].value.real;var i=Array(125),a=2*Math.PI/125;for(t=0;125>t;t++)i[t]={X:r+Math.cos(t*a)*e,Y:n+Math.sin(t*a)*e};return[i]}if("polygon"===e.type){for(r=[],t=0;t<e.value.length;t++){for(n=e.value[t],i=[],a=0;a<n.length;a++)i[a]={X:n[a].X,Y:n[a].Y};r[t]=i}return r}},Rr.shapeop=function(e,t,r){e=Rr.shapeconvert(e);var n=Rr.shapeconvert(t);ClipperLib.JS.ScaleUpPaths(e,1e3),ClipperLib.JS.ScaleUpPaths(n,1e3),(t=new ClipperLib.Clipper).AddPaths(e,ClipperLib.PolyType.ptSubject,!0),t.AddPaths(n,ClipperLib.PolyType.ptClip,!0),n=e=ClipperLib.PolyFillType.pftNonZero;var i=new ClipperLib.Paths;return t.Execute(r,i,e,n),ClipperLib.JS.ScaleDownPaths(i,1e3),{ctype:"shape",type:"polygon",value:i}},Rr.shapecommon=function(e,t){return Rr.shapeop(e,t,ClipperLib.ClipType.ctIntersection)},Rr.shaperemove=function(e,t){return Rr.shapeop(e,t,ClipperLib.ClipType.ctDifference)},Rr.shapeconcat=function(e,t){return Rr.shapeop(e,t,ClipperLib.ClipType.ctUnion)},kr.key$0=function(e,t){return{ctype:"string",value:vr}},kr.keycode$0=function(e,t){return Cr.real(dr)},kr.mouse$0=function(e,t){return t.id?"number"===(e=he(t.id)).ctype&&(e=e.value.real,gr[e])?Ir.realVector(gr[e]):p:Ir.realVector(It)},kr.mover$0=function(e,t){return fr&&fr.mover?{ctype:"geo",value:fr.mover}:p},kr.multiid$0=function(e,t){return Cr.real(mr)},kr.multiidlist$0=function(e,t){for(var r in e=[],gr)e.push(r);return Ir.realVector(e)},kr.translate$1=function(e,t){return"list"===(e=ve(e[0])).ctype&&Ir.isNumberVector(e)&&2===e.value.length&&In.translate(e.value[0].value.real,e.value[1].value.real),p},kr.rotate$1=function(e,t){return"number"===(e=ve(e[0])).ctype&&In.rotate(e.value.real),p},kr.scale$1=function(e,t){return"number"===(e=ve(e[0])).ctype&&In.scale(e.value.real),p},kr.greset$0=function(e,t){for(e=Mn.stack.length,In.greset(),t=0;t<e;t++)Lt.restore();return p},kr.gsave$0=function(e,t){return In.gsave(),Lt.save(),p},kr.grestore$0=function(e,t){return In.grestore(),Lt.restore(),p},kr.color$1=function(e,t){return"list"===(e=ve(e[0])).ctype&&Ir.isNumberVector(e).value&&In.setcolor(e),p},kr.linecolor$1=function(e,t){return"list"===(e=ve(e[0])).ctype&&Ir.isNumberVector(e).value&&In.setlinecolor(e),p},kr.pointcolor$1=function(e,t){return"list"===(e=ve(e[0])).ctype&&Ir.isNumberVector(e).value&&In.setpointcolor(e),p},kr.alpha$1=function(e,t){return"number"===(e=ve(e[0])).ctype&&In.setalpha(e),p},kr.pointsize$1=function(e,t){return"number"===(e=ve(e[0])).ctype&&In.setpointsize(e),p},kr.linesize$1=function(e,t){return"number"===(e=ve(e[0])).ctype&&In.setlinesize(e),p},kr.textsize$1=function(e,t){return"number"===(e=ve(e[0])).ctype&&In.settextsize(e),p},kr.playanimation$0=function(e,t){return m(),p},kr.pauseanimation$0=function(e,t){return g(),p},kr.stopanimation$0=function(e,t){return y(),p},kr.text$1=function(e,t){return e=ve(e[0]),Or.string(R(e))},kr.replace$3=function(e,t){var r=he(e[0]);if(t=he(e[1]),e=he(e[2]),"string"===r.ctype&&"string"===t.ctype&&"string"===e.ctype)return r=r.value,t=t.value.replace(/[^A-Za-z0-9]/g,"\\$&"),e=e.value.replace(/\$/g,"$$$$"),{ctype:"string",value:r=r.replace(new RegExp(t,"g"),e)}},kr.replace$2=function(e,t){function r(e,t,r){var i="";n=l=-1;for(var a=0;a<t.length;a++){var o=t[a][0],s=e.indexOf(o,r);-1!==s&&(-1===l||s<l)&&(i=o,l=s,n=a)}return i}var n;t=he(e[0]);var i=he(e[1]);if("string"===t.ctype&&"list"===i.ctype){e=t.value,t=[];for(var a=0;a<i.value.length;a++){var o=i.value[a];"list"===o.ctype&&2===o.value.length&&"string"===o.value[0].ctype&&"string"===o.value[1].ctype&&(t[t.length]=[o.value[0].value,o.value[1].value])}var l=-1;for(i=r(e,t,0);-1!==l;)i=r(e=e.substring(0,l)+t[n][1]+e.substring(l+i.length,e.length),t,i=l+t[n][1].length);return{ctype:"string",value:e}}return p},kr.substring$3=function(e,t){t=he(e[0]);var r=ve(e[1]);return e=ve(e[2]),"string"===t.ctype&&"number"===r.ctype&&"number"===e.ctype?{ctype:"string",value:t.value.substring(Math.floor(r.value.real),Math.floor(e.value.real))}:p},kr.tokenize$2=function(e,t){var r=he(e[0]);if(e=he(e[1]),"string"===r.ctype&&"string"===e.ctype)return kr.tokenize$2([r,Ir.turnIntoCSList([e])],t);if("string"===r.ctype&&"list"===e.ctype){if(r=r.value,0===e.value.length){if(e=!0,void 0!==t.autoconvert){var n=he(t.autoconvert);"boolean"===n.ctype&&(e=n.value)}return e&&""!==r&&(e=Number(r),!isNaN(e))?Cr.real(e):Or.string(r)}n=e.value[0];var i=Ir.turnIntoCSList(e.value.slice(1));return r=r.split(n.value),Ir.turnIntoCSList(r.map((function(e){return kr.tokenize$2([Or.string(e),i],t)})))}return p},kr.indexof$2=function(e,t){return t=he(e[0]),e=he(e[1]),"string"===t.ctype&&"string"===e.ctype?(e=t.value.indexOf(e.value),Cr.real(e+1)):p},kr.indexof$3=function(e,t){t=he(e[0]);var r=he(e[1]);return e=he(e[2]),"string"===t.ctype&&"string"===r.ctype&&"number"===e.ctype?(e=t.value.indexOf(r.value,Math.round(e.value.real)-1),Cr.real(e+1)):p},kr.parse$1=function(e,t){return"string"===(e=he(e[0])).ctype?he(e=me(e.value)):p},kr.unicode$1=function(e,t){e=he(e[0]);var r=16;if(t.base&&("number"===(t=he(t.base)).ctype&&(r=t.value.real)),"string"===e.ctype)t=parseInt(e.value,r);else{if("number"!==e.ctype)return p;t=e.value.real}return void 0!==String.fromCodePoint?t=String.fromCodePoint(t):65535>=t?t=String.fromCharCode(t):(t-=65536,t=String.fromCharCode(55296+(t>>10),56320+(1023&t))),Or.string(t)},kr.international$1=function(e,t){return kr.international$2([e[0],null],t)},kr.international$2=function(t,r){if("string"!==(r=he(t[0])).ctype)return p;var n=(e.translations||{})[e.language||"en"]||{};if(!n.hasOwnProperty(r.value))return r;var i=n[r.value];return"string"==typeof i?Or.string(i):null===t[1]?r:(t="number"===(t=he(t[1])).ctype?t.value.real:0,(t=(n._pluralFormFunction||re)(t))<i.length?Or.string(i[t]):r)},kr.currentlanguage$0=function(t,r){return Or.string(e.language||"en")},Rr.basismap=function(e,t,r,n){var i=Ir.turnIntoCSList([e,t,r]);return i=Ir.adjoint3(Ir.transpose(i)),n=Or.mult(i,n),i=Ir.turnIntoCSList([Or.mult(n.value[0],e),Or.mult(n.value[1],t),Or.mult(n.value[2],r)]),Ir.transpose(i)},kr.map$8=function(e,t){t=de(e[0]);var r=de(e[1]),n=de(e[2]),i=de(e[3]),a=de(e[4]),o=de(e[5]),l=de(e[6]);return e=de(e[7]),a!==p&&o!==p&&l!==p&&e!==p&&t!==p&&r!==p&&n!==p&&i!==p?(e=Rr.basismap(a,o,l,e),t=Rr.basismap(t,r,n,i),t=Or.mult(e,Ir.adjoint3(t)),Ir.normalizeMax(t)):p},kr.map$6=function(e,t){t=de(e[0]);var r=de(e[1]),n=de(e[2]),i=Ir.realVector([0,0,1]),a=Ir.cross,o=a(a(n,a(i,a(t,r))),a(r,a(i,a(t,n)))),l=de(e[3]),s=de(e[4]);return i=a(a(e=de(e[5]),a(i,a(l,s))),a(s,a(i,a(l,e)))),l!==p&&s!==p&&e!==p&&i!==p&&t!==p&&r!==p&&n!==p&&o!==p?(l=Rr.basismap(l,s,e,i),t=Rr.basismap(t,r,n,o),t=Or.mult(l,Ir.adjoint3(t)),Ir.normalizeMax(t)):p},kr.map$4=function(e,t){t=Ir.ii;var r=Ir.jj,n=de(e[0]),i=de(e[1]),a=de(e[2]);return e=de(e[3]),a!==p&&e!==p&&n!==p&&i!==p?(e=Rr.basismap(a,e,t,r),t=Rr.basismap(n,i,t,r),t=Or.mult(e,Ir.adjoint3(t)),Ir.normalizeMax(t)):p},kr.map$2=function(e,t){t=Ir.ii;var r=Ir.jj,n=de(e[0]),i=Or.add(Ir.realVector([1,0,0]),n);e=de(e[1]);var a=Or.add(Ir.realVector([1,0,0]),e);return e!==p&&a!==p&&n!==p&&i!==p?(e=Rr.basismap(e,a,t,r),t=Rr.basismap(n,i,t,r),t=Or.mult(e,Ir.adjoint3(t)),Ir.normalizeMax(t)):p},kr.pointreflect$1=function(e,t){t=Ir.ii;var r=Ir.jj;e=de(e[0]);var n=Or.add(Ir.realVector([1,0,0]),e),i=Or.add(Ir.realVector([-1,0,0]),e);return i!==p&&e!==p&&n!==p?(i=Rr.basismap(e,i,t,r),t=Rr.basismap(e,n,t,r),t=Or.mult(i,Ir.adjoint3(t)),Ir.normalizeMax(t)):p},kr.linereflect$1=function(e,t){t=Ir.ii;var r=Ir.jj;e=de(e[0]);var n=Ir.realVector([Math.random(),Math.random(),Math.random()]),i=Ir.realVector([Math.random(),Math.random(),Math.random()]);return n=Ir.cross(n,e),i=Ir.cross(i,e),e!==p&&n!==p?(e=Rr.basismap(n,i,t,r),t=Rr.basismap(n,i,r,t),t=Or.mult(e,Ir.adjoint3(t)),Ir.normalizeMax(t)):p},Rr.extractPointVec=function(e){var t={ok:!1};if("geo"===e.ctype){var r=e.value;if("P"===r.kind)return t.x=jr.getField(r,"x"),t.y=jr.getField(r,"y"),t.z=Cr.real(1),t.ok=!0,t}if("list"!==e.ctype)return t;var n=e.value;return 2===n.length&&(e=n[0],r=n[1],"number"===e.ctype&&"number"===r.ctype)?(t.x=e,t.y=r,t.z=Cr.real(1),t.ok=!0,t):(3===n.length&&(e=n[0],r=n[1],n=n[2],"number"===e.ctype&&"number"===r.ctype&&"number"===n.ctype&&(t.x=Cr.div(e,n),t.y=Cr.div(r,n),t.z=Cr.real(1),t.ok=!0)),t)},kr.polygon$1=function(e,t){if("list"===(e=he(e[0])).ctype){t=[];for(var r=0;r<e.value.length;r++){var n=Rr.extractPoint(e.value[r]);if(!n.ok)return p;t[r]={X:n.x,Y:n.y}}return{ctype:"shape",type:"polygon",value:[t]}}return p},kr.circle$2=function(e,t){return t=ve(e[0]),e=ve(e[1]),(t=Rr.extractPointVec(t)).ok&&"number"===e.ctype?(t=Ir.turnIntoCSList([t.x,t.y,t.z]),{ctype:"shape",type:"circle",value:Ir.turnIntoCSList([t,e])}):p},kr.screen$0=function(e,t){var r=In.drawingstate.initialmatrix;return e=function(e,t){return e-=r.tx,t+=r.ty,{X:(e*r.d-t*r.b)/r.det,Y:-(-e*r.c+t*r.a)/r.det}},{ctype:"shape",type:"polygon",value:[[e(0,0),e(Et,0),e(Et,Ot),e(0,Ot)]]}},kr.halfplane$2=function(e,t){t=ve(e[0]),e=ve(e[1]);var r=de(t),n=de(e);if(t!==p&&e!==p){var i=e.usage;e=r;var a=n;return"Line"!==t.usage&&"Point"!==i||(e=n,a=r),t=Ir.turnIntoCSList([a.value[0],a.value[1],Cr.zero]),t=Ir.cross(t,e),a=Ir.cross(a,t),a=Or.div(a,a.value[2]),e=Or.div(e,e.value[2]),e=Ir.sub(e,a),t=Ir.abs(e),e=Or.div(e,t),t=a.value[0].value.real,a=a.value[1].value.real,r=1e3*e.value[0].value.real,{ctype:"shape",type:"polygon",value:[[{X:t+(e=1e3*e.value[1].value.real)/2,Y:a-r/2},{X:t+e/2+r,Y:a-r/2+e},{X:t-e/2+r,Y:a+r/2+e},{X:t-e/2,Y:a+r/2}]]}}return p},kr.element$1=function(e,t){return"string"===(e=he(e[0])).ctype&&At.csnames.hasOwnProperty(e.value)?{ctype:"geo",value:At.csnames[e.value]}:p},Rr.all$1=function(e,t){return"geo"===(e=he(e[0])).ctype&&e.value.incidences?Ir.ofGeos(e.value.incidences.map((function(e){return At.csnames[e]})).filter(t)):Ir.nil},kr.allpoints$0=function(e,t){return Ir.ofGeos(At.points)},kr.allpoints$1=function(e,t){return Rr.all$1(e,(function(e){return"P"===e.kind}))},kr.allmasses$0=function(e,t){return Ir.ofGeos(ai)},kr.allmasses$1=function(e,t){return Rr.all$1(e,(function(e){return"P"===e.kind&&e.behavior&&"Mass"===e.behavior.type}))},kr.allsprings$0=function(e,t){return Ir.ofGeos(oi)},kr.allsprings$1=function(e,t){return Rr.all$1(e,(function(e){return"S"===e.kind&&e.behavior&&"Spring"===e.behavior.type}))},kr.alllines$0=function(e,t){return Ir.ofGeos(At.lines)},kr.alllines$1=function(e,t){return Rr.all$1(e,(function(e){return"L"===e.kind||"S"===e.kind}))},kr.allsegments$0=function(e,t){return Ir.ofGeos(At.lines.filter((function(e){return"S"===e.kind})))},kr.allsegments$1=function(e,t){return Rr.all$1(e,(function(e){return"S"===e.kind}))},kr.allconics$0=function(e,t){return Ir.ofGeos(At.conics)},kr.allconics$1=function(e,t){return Rr.all$1(e,(function(e){return"C"===e.kind}))},kr.allcircles$0=function(e,t){return Ir.ofGeos(At.conics.filter((function(e){return"Circle"===e.matrix.usage})))},kr.allcircles$1=function(e,t){return Rr.all$1(e,(function(e){return"C"===e.kind&&"Circle"===e.matrix.usage}))},kr.allelements$0=function(e,t){return Ir.ofGeos(At.gslp)},kr.allelements$1=function(e,t){return Rr.all$1(e,(function(e){return!0}))},kr.elementsatmouse$0=function(e,t){var r=Ir.realVector([It[0],It[1],1]),n=function(e){return Cr._helper.isAlmostZero(e.value[2])?1/0:(e=Ir.normalizeZ(e),Ir.abs(Ir.sub(e,r)).value.real)},i=function(e){return e=Ir.turnIntoCSList([e.value[0],e.value[1],Cr.zero]),Ir.normalizeMax(Ir.cross(r,e))},a=function(e){var t=Or.mult(e.matrix,r);return t=i(t),e=Gn._helper.IntersectLC(t,e.matrix).map((function(e){return n(e)})),.5>Math.min(e[0],e[1])};e=At.points.filter((function(e){return.5>n(e.homog)})),t=At.lines.filter((function(e){var t=i(e.homog);if(t=Ir.normalizeMax(Ir.cross(e.homog,t)),(t=.5>n(t))&&"S"===e.kind){var a=e.homog;a=Ir.turnIntoCSList([a.value[0],a.value[1],Cr.zero]),(0>(e=Ir.crossratio3(e.farpoint,e.startpos,e.endpos,r,a).value.real)||1<e)&&(t=!1)}return t}));var o=At.conics.filter((function(e){var t=a(e);if(t&&e.isArc){var n=Ir.crossratio3harm(e.startPoint,e.endPoint,e.viaPoint,r,Ir.ii);e=n.value[0],n=n.value[1],Cr._helper.isAlmostZero(e)?(e=Cr.div(e,n),n=Cr.real(1)):(n=Cr.div(n,e),e=Cr.real(1));var i=Ir.abs(Ir.turnIntoCSList([n,e]));e=Cr.div(e,i),n=Cr.div(n,i),n=Cr.mult(n,e),0>e.value.real&&(n=Cr.neg(n)),0>n.value.real&&(t=!1)}return t}));return e=e.concat(t,o),Ir.ofGeos(e)},kr.incidences$1=kr.allelements$1,kr.createpoint$2=function(e,t){return t=he(e[0]),e=de(e[1]),"string"!==t.ctype?(ge("Name must be a string"),p):"list"!==e.ctype&&Ir.isNumberVector(e)?(ge("Position must be a number vector"),p):{ctype:"geo",value:Ye({name:t.value,type:"Free",labeled:!0,pos:e},!0)}},kr.create$3=function(e,t){var r=he(e[0]),n=he(e[1]),i=he(e[2]);for(var a in e={},t)e[a]=ve(t[a]);if("string"===r.ctype)a=r.value;else{if("list"!==r.ctype)return ge("Names must be a string or a list of strings"),p;if(1!==r.value.length){a=Or.string(r.value.map((function(e){return e.value})).join("__"));var o=[];if((i=kr.create$3([a,n,i],e))!==p)for(n=Or.string(i.value.kind.replace(/^(.*)s$/,"Select$1")),i=Ir.turnIntoCSList([Or.string(i.value.name)]),t=0;t<r.value.length;++t)e.index=Cr.real(t+1),o.push(kr.create$3([r.value[t],n,i],e));return Ir.turnIntoCSList(o)}if("string"!==r.value[0].ctype)return ge("Element of names list must be a string"),p;a=r.value[0].value}if("string"!==n.ctype)return ge("Type must be a string"),p;if("list"!==i.ctype)return ge("Arguments must be a list"),p;if(!Gn.hasOwnProperty(n.value)&&!Jn.hasOwnProperty(n.value)&&!Zn.hasOwnProperty(n.value))return ge("Invalid geometric operation: '"+n.value+"'"),p;r=[];var l=null;for(t=0;t<i.value.length;t++){var s=i.value[t];if("string"===s.ctype)r.push(s.value);else if("geo"===s.ctype)r.push(s.value.name);else if((l=de(s))===p)return ge("Unknown argument type"),p}for(o in i={name:a,type:n.value,labeled:!0},l&&(i.pos=l),0<r.length&&(i.args=r),e)i[o]=Or.unwrap(e[o]);return{ctype:"geo",value:Ye(i,!0)}},kr.create$2=function(e,t){function r(e){function t(e){At.csnames[e]||(n=e)}var r,n=!1;if("P"===e)for(r=0;26>r&!n;r++)8!==r&&9!==r&&t(String.fromCharCode(65+r));else if("L"===e||"S"===e)for(r=0;26>r&!n;r++)8!==r&&9!==r&&t(String.fromCharCode(97+r));for(r=0;!n;r++)t(e+r);return n}var n=he(e[0]);e=he(e[1]);var i={};for(a in t)i[a]=ve(t[a]);if(!Gn.hasOwnProperty(n.value)&&!Jn.hasOwnProperty(n.value)&&!Zn.hasOwnProperty(n.value))return ge("Invalid geometric operation: '"+n.value+"'"),p;for(;Jn.hasOwnProperty(n.value);)n.value=Jn[n.value];var a=Gn[n.value];if(t=Or.string(r(a.kind)),e.value.length>a.signature.length){var o="Operation "+n.value+" requieres only "+a.signature.length+" argument"+(1===a.signature.length?"":"s")+" ("+e.value.length+" argument"+(1===e.value.length?"":"s")+" given) to create "+t.value+". Ignoring the last arguments.";if(!i.pos){var l=de(e.value[e.value.length-1]);l!==p&&(o+=" Use the last argument as modifier `pos`.",i.pos=l)}ge(o),e=Ir.turnIntoCSList(e.value.slice(0,a.signature.length))}if((a=kr.create$3([t,n,e],i))!==p&&"s"===a.value.kind[1]&&a.value.results){if(n=Or.string("Select"+a.value.kind[0]),e=Ir.turnIntoCSList([Or.string(a.value.name)]),i.pos)return t=Or.string(r(a.value.kind[0])),kr.create$3([t,n,e],i);for(o=[],l=0;l<a.value.results.value.length;l++)i.index=Cr.real(l+1),t=Or.string(r(a.value.kind[0])),o.push(kr.create$3([t,n,e],i));return Ir.turnIntoCSList(o)}return a.isDuplicate&&delete a.isDuplicate,a},kr.javascript$1=function(e,t){return"string"===(e=he(e[0])).ctype&&new Function(e.value).call(ur),p},kr.use$1=function(t,r){var n;return"string"===(t=he(t[0])).ctype?(t=t.value,e.plugins&&(n=e.plugins[t]),n||(n=kt._pluginRegistry[t]),n?(n({instance:ur,config:e,nada:p,evaluate:he,extractPoint:Rr.extractPoint,evaluateAndVal:ve,defineFunction:function(e,t,r){kr[e.toLowerCase()+"$"+t]=r},addShutdownHook:lr.push.bind(lr),addAutoCleaningEventListener:w,getVariable:zr.getvar.bind(zr),getInitialMatrix:function(){return In.drawingstate.initialmatrix},setTextRenderer:function(e,t){Yr=e,t&&(qr=t)},getImage:function(e,t){return"string"==typeof e&&(e=Or.string(e)),(e=ie(e))?(!t&&e.cdyUpdate&&e.cdyUpdate(),e):null},getMyfunction:function(e){return Ar.hasOwnProperty(e)?Ar[e]:null},scheduleUpdate:M}),{ctype:"boolean",value:!0}):(ge("Plugin "+t+" not found"),{ctype:"boolean",value:!1})):p},kr.format$2=function(e,t){function r(e,r){e=e.toFixed(o);do{var n=e;e=e.substring(0,e.length-1)}while(r&&""!==e&&"-"!==e&&+e==+n);return r=""+n,t.delimiter&&"string"===t.delimiter.ctype&&(r=r.replace(".",t.delimiter.value)),r}var n=ve(e[0]);e=ve(e[1]);var i=!0;if(t.truncate){var a=he(t.truncate);"boolean"===a.ctype&&(i=a.value)}if(("number"===n.ctype||"list"===n.ctype)&&"number"===e.ctype){var o=Math.max(0,Math.min(20,Math.round(e.value.real)));return function e(t,n){if("number"===t.ctype){var a=r(t.value.real,i),o=r(t.value.imag,i);return{ctype:"string",value:t=Math.abs(t.value.imag)<Math.pow(10,-n)?a:"-"===o.substring(0,1)?a+" - i*"+o.substring(1):a+" + i*"+o}}return"list"===t.ctype?{ctype:"list",value:t.value.map(e)}:{ctype:"string",value:R(t).toString()}}(n,o)}return p},Date.now||(Date.now=function(){return(new Date).getTime()});var Br=0;kr.timestamp$0=function(e,t){return Cr.real(Date.now())},kr.seconds$0=function(e,t){return Cr.real((Date.now()-Br)/1e3)},kr.resetclock$0=function(e,t){return Br=Date.now(),p},kr.time$0=function(e,t){return e=new Date,Ir.realVector([e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()])},kr.date$0=function(e,t){return e=new Date,Ir.realVector([e.getFullYear(),e.getMonth()+1,e.getDate()])},kr.simulationtime$0=function(e,t){return Cr.real(Dt*$t)},kr.settimeout$2=function(e,t){t=he(e[0]);var r=e[1];return"number"===t.ctype&&"undefined"!=typeof window&&window.setTimeout((function(){he(r),M()}),1e3*t.value.real),p},Rr.formatForWebGL=function(e){return e.toFixed(10)},kr.generateWebGL$2=function(e,t){var r=Rr.formatForWebGL;if(t=e[0],e=he(e[1]),console.log(e),"list"!==e.ctype)return p;for(var n=[],i=0;i<e.value.length;i++)"string"===e.value[i].ctype&&n.push(e.value[i].value);if(console.log("***********"),console.log(n),e=Rr.plotvars(t),console.log(e),-1===e.indexOf("a")&&-1===e.indexOf("b")&&-1===e.indexOf("c")&&-1===e.indexOf("d")&&-1===e.indexOf("e")&&-1===e.indexOf("f")&&(t=ve(t)),"number"===t.ctype)return{ctype:"string",value:"vec2("+r(t.value.real)+","+r(t.value.imag)+")"};if("variable"===t.ctype)return{ctype:"string",value:t.name};if("string"===t.ctype||"void"===t.ctype)return t;if(2===t.args.length&&("infix"===t.ctype||"function"===t.ctype)){if(r=kr.compileToWebGL$1([t.args[0]],{}),e=kr.compileToWebGL$1([t.args[1]],{}),"+"===t.oper||"add"===t.oper)return void 0===r.value||"void"===r.ctype?{ctype:"string",value:e.value}:{ctype:"string",value:"addc("+r.value+","+e.value+")"};if("*"===t.oper||"mult"===t.oper)return{ctype:"string",value:"multc("+r.value+","+e.value+")"};if("/"===t.oper||"div"===t.oper)return{ctype:"string",value:"divc("+r.value+","+e.value+")"};if("-"===t.oper||"sub"===t.oper)return void 0===r.value||"void"===r.ctype?{ctype:"string",value:"negc("+e.value+")"}:{ctype:"string",value:"subc("+r.value+","+e.value+")"};if("^"===t.oper||"pow"===t.oper)return{ctype:"string",value:"powc("+r.value+","+e.value+")"}}if("function"===t.ctype&&1===t.args.length){if(r=kr.compileToWebGL$1([t.args[0]],{}),"sin$1"===t.oper)return{ctype:"string",value:"sinc("+r.value+")"};if("cos$1"===t.oper)return{ctype:"string",value:"cosc("+r.value+")"};if("tan$1"===t.oper)return{ctype:"string",value:"tanc("+r.value+")"};if("exp$1"===t.oper)return{ctype:"string",value:"expc("+r.value+")"};if("log$1"===t.oper)return{ctype:"string",value:"logc("+r.value+")"};if("arctan$1"===t.oper)return{ctype:"string",value:"arctanc("+r.value+")"};if("arcsin$1"===t.oper)return{ctype:"string",value:"arcsinc("+r.value+")"};if("arccos$1"===t.oper)return{ctype:"string",value:"arccosc("+r.value+")"};if("sqrt$1"===t.oper)return{ctype:"string",value:"sqrtc("+r.value+")"}}return p},kr.compileToWebGL$1=function(e,t){t=Rr.formatForWebGL,e=e[0];var r=Rr.plotvars(e);if(-1===r.indexOf("a")&&-1===r.indexOf("b")&&-1===r.indexOf("c")&&-1===r.indexOf("d")&&-1===r.indexOf("e")&&-1===r.indexOf("f")&&(e=ve(e)),"number"===e.ctype)return{ctype:"string",value:"vec2("+t(e.value.real)+","+t(e.value.imag)+")"};if("variable"===e.ctype)return{ctype:"string",value:e.name};if("string"===e.ctype||"void"===e.ctype)return e;if(2===e.args.length&&("infix"===e.ctype||"function"===e.ctype)){if(t=kr.compileToWebGL$1([e.args[0]],{}),r=kr.compileToWebGL$1([e.args[1]],{}),"+"===e.oper||"add"===e.oper)return void 0===t.value||"void"===t.ctype?{ctype:"string",value:r.value}:{ctype:"string",value:"addc("+t.value+","+r.value+")"};if("*"===e.oper||"mult"===e.oper)return{ctype:"string",value:"multc("+t.value+","+r.value+")"};if("/"===e.oper||"div"===e.oper)return{ctype:"string",value:"divc("+t.value+","+r.value+")"};if("-"===e.oper||"sub"===e.oper)return void 0===t.value||"void"===t.ctype?{ctype:"string",value:"negc("+r.value+")"}:{ctype:"string",value:"subc("+t.value+","+r.value+")"};if("^"===e.oper||"pow"===e.oper)return{ctype:"string",value:"powc("+t.value+","+r.value+")"}}if("function"===e.ctype&&1===e.args.length){if(t=kr.compileToWebGL$1([e.args[0]],{}),"sin$1"===e.oper)return{ctype:"string",value:"sinc("+t.value+")"};if("cos$1"===e.oper)return{ctype:"string",value:"cosc("+t.value+")"};if("tan$1"===e.oper)return{ctype:"string",value:"tanc("+t.value+")"};if("exp$1"===e.oper)return{ctype:"string",value:"expc("+t.value+")"};if("log$1"===e.oper)return{ctype:"string",value:"logc("+t.value+")"};if("arctan$1"===e.oper)return{ctype:"string",value:"arctanc("+t.value+")"};if("arcsin$1"===e.oper)return{ctype:"string",value:"arcsinc("+t.value+")"};if("arccos$1"===e.oper)return{ctype:"string$1",value:"arccosc("+t.value+")"};if("sqrt$1"===e.oper)return{ctype:"string",value:"sqrtc("+t.value+")"}}return p},kr.setsimulationspeed$1=function(e,t){return"number"===(e=ve(e[0])).ctype&&c(e.value.real),p},kr.setsimulationaccuracy$1=function(e,t){return"number"===(e=ve(e[0])).ctype&&void 0!==si&&void 0!==si.env&&(si.env.accuracy=Math.max(1,0|e.value.real)),p},kr.setsimulationquality$1=function(e,t){return"number"===(e=ve(e[0])).ctype&&void 0!==si&&void 0!==si.env&&(0===(e=e.value.real)&&(si.env.errorbound=.01,si.env.lowestdeltat=1e-5,si.env.slowdownfactor=2),1===e&&(si.env.errorbound=.001,si.env.lowestdeltat=1e-7,si.env.slowdownfactor=2),2===e&&(si.env.errorbound=1e-5,si.env.lowestdeltat=1e-10,si.env.slowdownfactor=4),3===e&&(si.env.errorbound=1e-6,si.env.lowestdeltat=1e-12,si.env.slowdownfactor=4)),p};var Xr=null,$r=null;kr.createtool$3=function(e,t){var r="left",n="top",i=null;if(t.space){var a=he(t.space);"number"===a.ctype&&(i=a.value.real/2)}var o=null;if(t.toolbar&&("string"===(a=he(t.toolbar)).ctype&&((o=document.getElementById(a.value))||console.warn("Element #"+a.value+" not found"))),!o){if(t.reference&&"string"===(a=he(t.reference)).ctype)switch(a.value){case"UR":r="right";break;case"LL":n="bottom";break;case"LR":r="right",n="bottom"}(o=document.createElement("div")).className="CindyJS-toolbar",Tt.parentNode.appendChild(o),a=he(e[1]);var l=he(e[2]);"number"===a.ctype&&(o.style[r]=a.value.real+"px"),"number"===l.ctype&&(o.style[n]=l.value.real+"px"),null!==i&&(o.style.margin=-i+"px")}if("string"===(e=he(e[0])).ctype)e=[[e.value]];else{if("list"!==e.ctype)return ge("Name must be a string or a list of strings"),p;e=e.value.map((function(e){return"string"===e.ctype?[e.value]:"list"===e.ctype?e.value.map((function(e){return"string"===e.ctype?e.value:null})):[null]}))}if(t.flipped&&("boolean"===(a=he(t.flipped)).ctype&&a.value)){ge("Flipping");var s=0;for(t=e.length,e.forEach((function(e){e.length>s&&(s=e.length)})),a=[],l=0;l<s;++l){a[l]=[];for(var u=0;u<t;++u)a[l][u]=e[u][l]||null}e=a}return"bottom"===n&&e.reverse(),e.forEach((function(e){"right"===r&&e.reverse();var t=document.createElement("div");o.appendChild(t),e.forEach((function(e){function r(){Xr&&Xr.classList.remove("CindyJS-active"),Xr=a,a.classList.add("CindyJS-active");var t=wn[bn=e].actions;$r&&($r.textContent=t[0].tooltip||""),xn=[],_n=Pn=0}if(wn.hasOwnProperty(e)||(ge("Tool '"+e+"' not implemented yet."),e=null),null===e){var n=document.createElement("span");n.className="CindyJS-spacer",t.appendChild(n)}else{var a=document.createElement("button");(n=document.createElement("img")).src=kt.getBaseDir()+"images/"+e+".png",a.appendChild(n),a.addEventListener("click",r),Xr||r(),null!==i&&(a.style.margin=i+"px"),t.appendChild(a)}}))})),p},kr.dropped$0=function(){return er},kr.droppoint$0=function(){return tr},kr.parsecsv$1=function(e,t){var r=!0,n=ve(t.autoconvert);if("boolean"===n.ctype&&(r=n.value),n=null,"string"===(t=ve(t.delimiter)).ctype&&/^[^"\r\n]$/.test(t.value)&&(n=t.value),"string"!==(e=ve(e[0])).ctype)return ge("CSV data is not a string"),p;e=e.value,t='(?:"((?:[^"]+|"")*)"|([^]*?))(\r\n|(,)|[\r\n]|$)',n&&(n=n.replace(/[^A-Za-z0-9]/g,"\\$&").replace(/\$/g,"$$$$"),t=t.replace(/,/g,n)),t=new RegExp(t,"g"),n=[];for(var i=[],a=null;t.lastIndex<e.length;){var o=t.exec(e),l=o[2];if("string"==typeof o[1]&&(l=o[1].replace(/""/g,'"')),l=r?/^[Tt]rue$/.test(l)?Or.bool(!0):/^[Ff]alse$/.test(l)?Or.bool(!1):/^[\-+]?([0-9]+(\.[0-9]*)?|\.[0-9]+|Infinity)$/.test(l)?Cr.real(Number(l)):Or.string(l):Or.string(l),n.push(l),o[4]&&t.lastIndex===e.length&&(n.push(Or.string("")),o={}),!o[4]){if(null===a&&(a=n.length),a<n.length)for(a=n.length,o=0;o<i.length;++o)for(l=i[o].length;l<a;++l)i[o][l]=p;else if(a>n.length)for(o=n.length;o<a;++o)n[o]=p;i.push(n),n=[]}}return Ir.turnIntoCSList(i.map(Ir.turnIntoCSList))},kr.load$2=function(e,t){return kr.load$3([e[0],null,e[1]],t)},kr.load$3=function(e,t){var r="#";null!==e[1]&&"variable"===e[1].ctype&&(r=e[1].name),t=ve(e[0]);var n=null,i=null;return"string"===t.ctype&&/^https?:\/\//.test(t.value)&&(n=t.value),null!==n?((i=new XMLHttpRequest).onreadystatechange=function(){if(i.readyState===XMLHttpRequest.DONE){if(200===i.status)var t=Or.string(String(i.responseText));else ge("Failed to load "+n+": "+i.statusText),t=p;zr.newvar(r),zr.setvar(r,t),he(e[2]),zr.removevar(r),M()}},i.open("GET",n),i.send(),Or.bool(!0)):p},kr.removeelement$1=function(e,t){"geo"===(e=he(e[0])).ctype?Ue(e.value.name):console.log("argument of removeelement is undefined or not of type <geo>")},kr.guess$1=function(e,t){function r(e){if((e=Tn.doPSLQ([e,1,Math.PI*Math.E],15))&&0===e[2])return[Math.round(e[0]),Math.round(e[1])]}function n(e){if(Cr._helper.isAlmostZero(e))return"0";if(!Cr._helper.isAlmostReal(e)){var t=e.value.real,n=e.value.imag,s=r(t),u=r(t*t+n*n);if(s&&u){t=-s[0]*u[0];var c=-s[1]*u[0]*2,p=s[0]*u[1];s=a(-c,2*t),u=c*c-4*p*t,u/=(e=o(u))*e,e="-"+(u=e===2*t||e===-2*t?"+i*sqrt("+-u+")":"+i*"+a(e,2*t).substring(1)+"*sqrt("+-u+")").substring(1),c=Math.abs((c*c-4*p*t)/(4*t*t)),t=Math.sqrt(c),c=-Math.sqrt(c),"+0"!==s&&"-0"!==s||(s=""),(n=Math.abs(n-t)<Math.abs(n-c)?s+u:s+e).startsWith("+")&&(n=n.substring(1))}else n=R(e);return n}var f=Tn.doPSLQ([Math.PI,e.value.real,1],15);n=""+e.value.real,p=t="";var h=c=1e4;if(s=1e5,f&&3e3>(s=i(f))){t=e.value.real,c=f[0],u=-f[1],f=f[2];var v="";if(0!==c){var d=Math.round(c),m=Math.round(u);v=a(d,m)+"*pi"}d="",0!==f&&(d=a(d=Math.round(f),m=Math.round(u))),l=Math.abs(t-(f/u+Math.PI*c/u)),""===(t=d+v)?t="0":t.startsWith("+")&&(t=t.substring(1)),c=l}if(u=1e5,(v=Tn.doPSLQ([e.value.real*e.value.real,e.value.real,1],15))&&9e3>(u=10+i(v))){e=e.value.real,h=v[0],f=v[1],v=v[2],d=Math.round(h),m=Math.round(f);var g=Math.round(v);p=a(-m,2*d),m=m*m-4*g*d,m/=(g=o(m))*g,d=g===2*d?"+sqrt("+m+")":g===-2*d?"-sqrt("+m+")":a(g,2*d)+"*sqrt("+m+")",m=-f/(2*h),v=Math.abs((f*f-4*v*h)/(4*h*h)),h="-"+(d="+"+d.substring(1)).substring(1),f=m+Math.sqrt(v),v=m-Math.sqrt(v),"+0"!==p&&"-0"!==p||(p=""),Math.abs(e-f)<Math.abs(e-v)?(l=Math.abs(e-f),e=p+d):(l=Math.abs(e-v),e=p+h),e.startsWith("+")&&(e=e.substring(1)),p=e,h=l}return s<u&&1e-12>c&&(n=t),u<s&&1e-12>h&&(n=p),n}function i(e){var t=Math.abs(e[0]);return Math.abs(e[1])>t&&(t=Math.abs(e[1])),Math.abs(e[2])>t&&(t=Math.abs(e[2])),t}function a(e,t){var r="+";0>e*t&&(e=Math.abs(e),t=Math.abs(t),r="-");var n=te(e,t);return t/=n,0>(e/=n)&&0>t&&(e=-e,t=-t),1===t?r+e:r+e+"/"+t}function o(e){for(var t=3e3;0<t;t--)if(0==e%(t*t))return t;return 1}var l=0;return"number"===(e=ve(e[0])).ctype&&Cr._helper.isFinite(e)?(e=void 0===n(e)?"no guess":n(e),Or.string(e)):p},Rr.extractPoint=function(e){var t={ok:!1};if("geo"===e.ctype){var r=e.value;if("P"===r.kind)return t.x=jr.getField(r,"x").value.real,t.y=jr.getField(r,"y").value.real,t.ok=!0,t}if("list"!==e.ctype)return t;var n=e.value;return 2===n.length&&(e=n[0],r=n[1],"number"===e.ctype&&"number"===r.ctype)?(t.x=e.value.real,t.y=r.value.real,t.ok=!0,t):(3===n.length&&(e=n[0],r=n[1],n=n[2],"number"===e.ctype&&"number"===r.ctype&&"number"===n.ctype&&(e=Cr.div(e,n),r=Cr.div(r,n),t.x=e.value.real,t.y=r.value.real,t.ok=!0)),t)},kr.draw$1=function(e,t){if("shape"===(e=ve(e[0])).ctype)Rr.drawshape(e,t);else if("Line"===e.usage)dn.handleModifs(t,dn.lineModifs),dn.drawline(e);else{var r=Rr.extractPoint(e);if(!r.ok)return void 0!==e.value&&2===e.value.length?kr.draw$2(e.value,t):void 0;null!==t&&dn.handleModifs(t,dn.pointModifs),dn.drawpoint(r)}return p},kr.draw$2=function(e,t){var r=ve(e[0]);return e=ve(e[1]),r=Rr.extractPoint(r),e=Rr.extractPoint(e),r.ok&&e.ok?(null!==t&&dn.handleModifs(t,dn.lineModifs),dn.drawsegcore(r,e),p):p},kr.drawcircle$2=function(e,t){return Rr.drawcircle(e,t,"D")},Rr.arcHelper=function(e){var t={};return t.startPoint=de(e[0]),t.viaPoint=de(e[1]),t.endPoint=de(e[2]),t},kr.fillcircle$2=function(e,t){return Rr.drawcircle(e,t,"F")},kr.drawarc$3=function(e,t){return e=Rr.arcHelper(e),Rr.drawarc(e,t,"D")},kr.fillarc$3=function(e,t){return e=Rr.arcHelper(e),Rr.drawarc(e,t,"F")},Rr.drawarc=function(e,t,r){var n=e.startPoint,i=e.viaPoint;if(e=e.endPoint,!Ir._helper.isAlmostReal(Ir.turnIntoCSList([n,i,e])))return p;if(dn.handleModifs(t,dn.conicModifs),dn.preDrawCurve(),t=Ir.det3(n,i,e),1e-12<Math.abs(t.value.real)){t=Gn._helper.ConicBy5(null,n,i,e,Ir.ii,Ir.jj);var a=Gn._helper.CenterOfConic(t);a=Ir.normalizeMax(a),t=Cr.real(0);var o=Ir.turnIntoCSList([Ir.turnIntoCSList([a.value[2],t,Cr.neg(a.value[0])]),Ir.turnIntoCSList([t,a.value[2],Cr.neg(a.value[1])]),Ir.turnIntoCSList([t,t,a.value[2]])]);t=Ir.normalizeZ(Or.mult(o,n)),Ir.normalizeZ(Or.mult(o,i)),o=Ir.normalizeZ(Or.mult(o,e)),t=-Math.atan2(t.value[1].value.real,t.value[0].value.real),o=-Math.atan2(o.value[1].value.real,o.value[0].value.real),a=Ir.normalizeZ(a),n=Ir.normalizeZ(n),i=Ir.normalizeZ(i),e=Ir.normalizeZ(e);var l=Ir.abs(Ir.sub(n,a)),s=[a.value[0].value.real,a.value[1].value.real];a=In.drawingstate.matrix;var u=s[0]*a.a-s[1]*a.b+a.tx;s=s[0]*a.c-s[1]*a.d-a.ty,n=0<Ir.det3(n,i,e).value.real,Lt.save(),Lt.beginPath(),Lt.translate(u,s),Lt.arc(0,0,l.value.real*a.sdet,t,o,n),"F"===r&&(Lt.fillStyle=dn.lineColor,Lt.closePath(),Lt.fill()),"D"===r&&Lt.stroke(),Lt.restore()}else{if("D"!==r)return p;if(r=Rr.extractPoint(n),t=Rr.extractPoint(i),o=Rr.extractPoint(e),!r.ok||!t.ok||!o.ok)return p;if(l=(r.x-o.x)*(r.x-o.x)+(r.y-o.y)*(r.y-o.y),a=(o.x-t.x)*(o.x-t.x)+(o.y-t.y)*(o.y-t.y),1e-12>(r.x-t.x)*(r.x-t.x)+(r.y-t.y)*(r.y-t.y)||1e-12>l||1e-12>a)return p;0>Ir.crossratio3(n,e,i,Ir.cross(Ir.cross(n,i),Ir.linfty),Ir.ii).value.real?dn.drawsegcore(r,o):dn.drawRaySegment(n,e)}return p},Rr.drawcircle=function(e,t,r){var n=ve(e[0]);e=ve(e[1]);var i=Rr.extractPoint(n);if(!i.ok||"number"!==e.ctype||!Cr._helper.isAlmostReal(e))return p;n=In.drawingstate.matrix;var a=i.x*n.a-i.y*n.b+n.tx;return i=i.x*n.c-i.y*n.d-n.ty,dn.handleModifs(t,dn.conicModifs),dn.preDrawCurve(),Lt.lineJoin="miter",Lt.beginPath(),Lt.arc(a,i,Math.abs(e.value.real)*n.sdet,0,2*Math.PI),Lt.closePath(),"D"===r&&Lt.stroke(),"F"===r&&(Lt.fillStyle=dn.lineColor,Lt.fill()),"C"===r&&Lt.clip(),p},kr.drawconic$1=function(e,t){if("list"!==(e=ve(e[0])).ctype||3!==e.value.length&&6!==e.value.length)return console.error("could not parse conic"),p;if(6===e.value.length){for(var r=0;6>r;r++)if("number"!==e.value[r].ctype)return console.error("could not parse conic"),p;var n=Cr.real(.5);r=e.value[0];var i=e.value[2];i=Cr.mult(i,n);var a=e.value[1],o=e.value[3];o=Cr.mult(o,n);var l=e.value[4];l=Cr.mult(l,n),e=e.value[5],e=Ir.turnIntoCSList([Ir.turnIntoCSList([r,i,o]),Ir.turnIntoCSList([i,a,l]),Ir.turnIntoCSList([o,l,e])])}else{if(!Ir.isNumberMatrix(e).value||3!==e.value.length||3!==e.value[0].value.length)return p;r=Ir.transpose(e),Ir.equals(e,r).value||(e=Ir.add(r,e))}return Rr.drawconic(e,t)},Rr.drawconic=function(e,t){function r(e,t){return 0<=(e=(s*e+u*t+c)*e+(p*t+f)*t+h)?1:0>e?-1:NaN}function n(e){return T.next=e,e.prev=T,T=e}function i(e,t,n,i){return{a:e,b1:t,b2:n,vertical:!0,index:i,sign:function(t){return r(e,t)},mkp:function(t){return{x:e,y:t}},sol:ne(p,u*e+f,(s*e+c)*e+h),discr:function(){return ne(b,-2*m,v)},tpt:function(e){return{x:e,y:-.5*(u*e+f)/p}}}}function a(e,t,n,i){return{a:e,b1:t,b2:n,vertical:!1,index:i,sign:function(t){return r(t,e)},mkp:function(t){return{x:t,y:e}},sol:ne(s,u*e+c,(p*e+f)*e+h),discr:function(){return ne(b,-2*y,g)},tpt:function(e){return{x:-.5*(u*e+c)/s,y:e}}}}function o(e){var t=Math.min(e.b1,e.b2),r=Math.max(e.b1,e.b2),i=e.sign(t),a=e.sign(r);if(!isFinite(i*a))return!1;var o=e.sol;if(i!==a){if(null===o)return!1;var l=.5*(o[0]+o[1]);l>t&&l<r?l=o[(t=e.sign(l))===a?0:1]:(i=.5*(t+r),l=o[Math.abs(i-o[0])<Math.abs(i-o[1])?0:1]),S.push(n(e.mkp(l)))}else{if(null===o)return 0>=x||null===(o=e.discr())||(e=e.tpt(o[e.index])).x>=P&&e.x<=_&&e.y>=C&&e.y<=w&&n(e),!0;if(!((l=.5*(o[0]+o[1]))>t&&l<r))return!0;if((t=e.sign(l))===i||isNaN(t))return!0;e.b1>e.b2&&(o=[o[1],o[0]]),S.push(n(e.mkp(o[0]))),S.push(n(e.mkp(o[1])))}return!0}function l(e,t,r,n,i){var a=t-n,o=r-e,x=e*n-t*r,P=m*a+y*o+b*x;if(1e-14>Math.abs(P))return Lt.lineTo(r,n);var C=(v*a+d*o+m*x)/P;if(a=(d*a+g*o+y*x)/P,!isFinite(C)||!isFinite(a)||.04>Math.abs(e*a+C*n+r*t-r*a-C*t-e*n))return Lt.lineTo(r,n);do{if(!(10<i)){var _=C-(x=.5*(e+r));if(!(.04>_*_+(P=a-(o=.5*(t+n)))*P)){var w=s*_*_+u*_*P+p*P*P,S=2*s*_*x+u*(_*o+P*x)+2*p*P*o+c*_+f*P,T=(s*x+u*o+c)*x+(p*o+f)*o+h,M=ne(w,S,T);if(M||(M=[-.5*S/w,-2*T/S]),0<M[0])M=M[0];else{if(!(0<=M[1]))break;M=M[1]}if(!(.04>(x=(_=x+M*_)-.5*(C+x))*x+(o=(P=o+M*P)-.5*(a+o))*o))return l(e,t,_,P,i+1),void l(_,P,r,n,i+1)}}}while(0);Lt.quadraticCurveTo(C,a,r,n)}if(dn.handleModifs(t,dn.conicModifs),0!==dn.lsize&&(dn.preDrawCurve(),e=Ir.normalizeMax(e),Ir._helper.isAlmostReal(e))){t=In.toMat(),e=Ir.mult(Ir.transpose(t),e),e=Ir.mult(e,t);var s=(e=Ir.normalizeMax(e)).value[0].value[0].value.real,u=2*e.value[0].value[1].value.real,c=2*e.value[0].value[2].value.real,p=e.value[1].value[1].value.real,f=2*e.value[1].value[2].value.real,h=e.value[2].value[2].value.real,v=4*h*p-f*f,d=f*c-2*h*u,m=f*u-2*p*c,g=4*h*s-c*c,y=c*u-2*f*s,b=4*p*s-u*u,x=b;0>(e=p*g+u*d+s*v-h*b)&&(s=-s,u=-u,c=-c,p=-p,f=-f,h=-h,e=-e);var P=-(e=dn.lsize),C=-e,_=Et+e,w=Ot+e,S=[],T=e={};if(o(i(P,C,w,0))&&o(a(w,P,_,1))&&o(i(_,w,C,1))&&o(a(C,_,P,0))&&T!==e){if(T.next=e.next,e.next.prev=T,Lt.beginPath(),0===S.length){var M=T;Lt.moveTo(M.x,M.y);do{var I=M.next;l(M.x,M.y,I.x,I.y,0),M=I}while(M!==T);Lt.closePath()}if(t=1===r(P,C)?0:1,4===S.length){var L=0;for(e=0;2>e;++e){M=S[e];var E=(I=S[e+2]).x-M.x;M=I.y-M.y,M=(s*E+u*M)*E+p*M*M,Math.abs(M)>Math.abs(L)&&(L=M)}if(isNaN(L))return;0<=L&&(t=1-t)}for(e=t;e<S.length;e+=2)for(M=S[e],t=S[(e+1)%S.length],Lt.moveTo(M.x,M.y),I=M.next;M!==t;I=(M=I).next)l(M.x,M.y,I.x,I.y,0);Lt.stroke()}}},kr.drawall$1=function(e,t){if("list"===(e=he(e[0])).ctype)for(dn.handleModifs(t,dn.pointAndLineModifs),t=0;t<e.value.length;t++)kr.draw$1([e.value[t]],null);return p},kr.connect$1=function(e,t){return Rr.drawpolygon(e,t,"D",!1)},kr.drawpoly$1=function(e,t){return Rr.drawpolygon(e,t,"D",!0)},kr.fillpoly$1=function(e,t){return Rr.drawpolygon(e,t,"F",!0)},kr.drawpolygon$1=function(e,t){return Rr.drawpolygon(e,t,"D",!0)},kr.fillpolygon$1=function(e,t){return Rr.drawpolygon(e,t,"F",!0)},Rr.drawpolygon=function(e,t,r,n){dn.handleModifs(t,n?dn.conicModifs:dn.lineModifs),dn.preDrawCurve();var i=In.drawingstate.matrix,a=he(e[0]);return Lt.beginPath(),"list"===a.ctype&&function(){var e;for(e=0;e<a.value.length;e++){var t=Rr.extractPoint(a.value[e]);if(!t.ok)return;var r=t.x*i.a-t.y*i.b+i.tx;t=t.x*i.c-t.y*i.d-i.ty,0===e?Lt.moveTo(r,t):Lt.lineTo(r,t)}n&&Lt.closePath()}(),"shape"===a.ctype&&function(){for(var e=a.value,t=0;t<e.length;t++){var r,n=e[t];for(r=0;r<n.length;r++){var o=n[r],l=o.X*i.a-o.Y*i.b+i.tx;o=o.X*i.c-o.Y*i.d-i.ty,0===r?Lt.moveTo(l,o):Lt.lineTo(l,o)}Lt.closePath()}}(),"D"===r&&(dn.fillColor&&(Lt.fillStyle=dn.fillColor,Lt.fill(dn.fillrule)),Lt.stroke()),"F"===r&&(Lt.fillStyle=dn.lineColor,Lt.fill(dn.fillrule)),"C"===r&&Lt.clip(),p};var Yr=function e(t,r,n,i,a,o,l,s){if(s=void 0===s?0:s,-1!==r.indexOf("\n")){var u=1/0,c=-1/0,p=1/0,f=-1/0;return r.split("\n").forEach((function(r){r=e(t,r,n,i,a,o),u>r.left&&(u=r.left),c<r.right&&(c=r.right),p>r.top&&(p=r.top),f<r.bottom&&(f=r.bottom),i+=l})),{left:u,right:c,top:p,bottom:f}}var h=t.measureText(r);return s?(t.save(),t.translate(n,i),t.rotate(-s),t.fillText(r,-h.width*a,0),t.restore()):t.fillText(r,n-h.width*a,i),{left:n-h.width*a,right:n+h.width*(1-a),top:i-.84*o,bottom:i+.36*o}},qr=function(e,t,r){if(-1!==t.indexOf("\n"))for(t=t.split("\n"),e.textContent=t[0],r=1;r<t.length;++r)e.appendChild(document.createElement("br")),e.appendChild(document.createTextNode(t[r]));else e.textContent=t};Rr.drawtext=function(e,t,r){var n=ve(e[0]);e=he(e[1]);var i=Rr.extractPoint(n);if(!i.ok)return null;dn.handleModifs(t,dn.textModifs),null===(t=In.drawingstate.textsize)&&(t=Ln.textsize),null!==dn.size&&(t=dn.size),Lt.fillStyle=dn.textColor;var a=In.drawingstate.matrix;return n=i.x*a.a-i.y*a.b+a.tx+dn.xOffset,i=i.x*a.c-i.y*a.d-a.ty-dn.yOffset,e=R(e),kt._pluginRegistry.katex||"string"!=typeof e||3<=e.split("$").length&&v("katex","katex-plugin.js",!0),Lt.font=dn.bold+dn.italics+Math.round(10*t)/10+"px "+dn.family,r?r(e,n,i,dn.align,t):Yr(Lt,e,n,i,dn.align,t,t*Ln.lineHeight,dn.angle)},kr.drawtext$2=function(e,t){return Rr.drawtext(e,t,null),p},kr.drawtable$2=function(e,t){var r=ve(e[0]);e=ve(e[1]);var n=Rr.extractPoint(r);if(!n.ok||"list"!==e.ctype)return p;e=(r=e.value).length;var i,a=-1;for(i=0;i<e;++i)"list"===r[i].ctype&&r[i].value.length>a&&(a=r[i].value.length);-1===a?(r=r.map((function(e){return[e]})),a=1):r=r.map((function(e){return Ir.asList(e).value}));var o=100,l=null,s=!0,u=In.drawingstate.textcolor;dn.handleModifs(t,{size:!0,color:function(e){Ir._helper.isNumberVecN(e,3)&&(u=dn.makeColor([e.value[0].value.real,e.value[1].value.real,e.value[2].value.real]))},alpha:!0,bold:!0,italics:!0,family:!0,align:!0,x_offset:!0,y_offset:!0,offset:!0,width:function(e){"number"===e.ctype&&(o=e.value.real)},height:function(e){"number"===e.ctype&&(l=e.value.real)},border:function(e){"boolean"===e.ctype&&(s=e.value)}}),null===(i=In.drawingstate.textsize)&&(i=Ln.textsize),null!==dn.size&&(i=dn.size),null===l&&(l=1.6*i),Lt.font=dn.bold+dn.italics+Math.round(10*i)/10+"px "+dn.family,i=In.drawingstate.matrix;var c=a*o,f=e*l;t=n.x*i.a-n.y*i.b+i.tx+dn.xOffset;var h=n.x*i.c-n.y*i.d-i.ty-dn.yOffset-f;if(s){for(dn.preDrawCurve(),Lt.strokeStyle=dn.lineColor,Lt.beginPath(),i=1;i<e;++i)Lt.moveTo(t,h+i*l),Lt.lineTo(t+c,h+i*l);for(n=1;n<a;++n)Lt.moveTo(t+n*o,h),Lt.lineTo(t+n*o,h+f);Lt.stroke(),Lt.lineWidth=dn.lsize+1,Lt.beginPath(),Lt.rect(t,h,c,f),Lt.stroke()}for(t+=dn.align*o+(1-2*dn.align)*l*.3,h+=.7*l,Lt.fillStyle=u,i=0;i<e;++i)for(n=0;n<a;++n)c=R(r[i][n]),Yr(Lt,c,t+n*o,h+i*l,dn.align);return p},Rr.drawshape=function(e,t){return"polygon"===e.type?Rr.drawpolygon([e],t,"D",1):"circle"===e.type?Rr.drawcircle([e.value.value[0],e.value.value[1]],t,"D"):p},Rr.fillshape=function(e,t){return"polygon"===e.type?Rr.drawpolygon([e],t,"F",1):"circle"===e.type?Rr.drawcircle([e.value.value[0],e.value.value[1]],t,"F"):p},Rr.clipshape=function(e,t){return"polygon"===e.type?Rr.drawpolygon([e],t,"C",1):"circle"===e.type?Rr.drawcircle([e.value.value[0],e.value.value[1]],t,"C"):p},kr.fill$1=function(e,t){return"shape"===(e=he(e[0])).ctype?Rr.fillshape(e,t):p},kr.clip$1=function(e,t){var r=he(e[0]);return"shape"===r.ctype?Rr.clipshape(r,t):"list"===r.ctype?(e=kr.polygon$1(e,[]),kr.clip$1([e],[])):p},kr.plot$1=function(e,t){return kr.plot$2([e[0],null],t)},kr.plot$2=function(e,t){function r(e){return"number"===e.ctype&&Cr._helper.isAlmostReal(e)}function n(e,t,r,n,i){t=+t.value.real,i=+n.value.real,n=t*d.a-i*d.b+d.tx,t=t*d.c-i*d.d-d.ty,e=+e.value.real,i=+r.value.real,r=e*d.a-i*d.b+d.tx,e=e*d.c-i*d.d-d.ty,l?(Lt.lineTo(r,e),Lt.lineTo(n,t)):(Lt.beginPath(),Lt.moveTo(r,e),Lt.lineTo(n,t),l=!0)}function i(e,t,s,u,c){var p=r(s),f=r(u);if(.001>c)!a&&l&&(Lt.stroke(),l=!1);else if(p||f){var d=Cr.real((e.value.real+t.value.real)/2);zr.setvar(v,d);var m=he(h),g=r(m);if(p&&f&&g){var y=s.value.real;if(f=m.value.real,g=u.value.real,p=1>Math.abs(y+g-2*f)/o){var b=Cr.real((e.value.real+d.value.real)/2);zr.setvar(v,b),b=he(h);var x=Cr.real((d.value.real+t.value.real)/2);zr.setvar(v,x),x=he(h),y=Math.abs(y+f-2*b.value.real)/o,f=Math.abs(f+g-2*x.value.real)/o,p=p&&1>y&&1>f}p?(n(e,d,s,m,c/2),n(d,t,m,u,c/2)):(i(e,d,s,m,c/2),i(d,t,m,u,c/2))}else i(e,d,s,m,c/2),i(d,t,m,u,c/2)}}var a=!1,o=.2/qt,l=!1,s=-10,u=10,c=.1,f=1e3,h=e[0];if(null!==e[1]&&"variable"===e[1].ctype)var v=e[1].name;else e=Rr.plotvars(h),v="#",-1!==e.indexOf("t")&&(v="t"),-1!==e.indexOf("z")&&(v="z"),-1!==e.indexOf("y")&&(v="y"),-1!==e.indexOf("x")&&(v="x");zr.newvar(v);var d=In.drawingstate.matrix;dn.handleModifs(t,{color:!0,alpha:!0,size:!0,dashpattern:!0,dashtype:!0,dashing:!0,lineCap:!0,lineJoin:!0,miterLimit:!0,connect:function(e){"boolean"===e.ctype&&(a=e.value)},start:function(e){"number"===e.ctype&&(s=e.value.real)},stop:function(e){"number"===e.ctype&&(u=e.value.real)},steps:function(e){"number"===e.ctype&&(f=e.value.real)}}),Lt.strokeStyle=dn.lineColor,Lt.lineWidth=dn.lsize,l=!1,t=Cr.real(14.32),zr.setvar(v,t);var m=he(h);if("number"!==m.ctype){if(Ir.isNumberVector(m).value&&2===m.value.length){for(l=!1,c=(u-s)/f,t=s;t<u;t+=c){zr.setvar(v,Cr.real(t));var g=he(h);if(Ir.isNumberVector(g).value&&2===g.value.length){var y=+g.value[0].value.real;g=+g.value[1].value.real,e=y*d.a-g*d.b+d.tx,y=y*d.c-g*d.d-d.ty,l?Lt.lineTo(e,y):(Lt.beginPath(),Lt.moveTo(e,y),l=!0)}}Lt.stroke(),zr.removevar(v)}return p}for(e=s;e<u+c;e+=c)t=Cr.real(e),zr.setvar(v,t),m=he(h),t.value.real>s&&i(y,t,g,m,c),y=t,g=m;return zr.removevar(v),l&&Lt.stroke(),p},kr.plotX$1=function(e,t){e=e[0];var r=Rr.plotvars(e);t="#",-1!==r.indexOf("t")&&(t="t"),-1!==r.indexOf("z")&&(t="z"),-1!==r.indexOf("y")&&(t="y"),-1!==r.indexOf("x")&&(t="x"),zr.newvar(t),r=In.drawingstate.matrix,Lt.fillStyle=In.drawingstate.linecolor,Lt.lineWidth=1,Lt.lineCap=dn.lineCap,Lt.lineJoin=dn.lineJoin,Lt.miterLimit=dn.miterLimit;for(var n=!1,i=-10;10>i;i+=.01){zr.setvar(t,Cr.real(i));var a=he(e);if("number"===a.ctype){var o=+a.value.real;a=i*r.a-o*r.b+r.tx,o=i*r.c-o*r.d-r.ty,n?Lt.lineTo(a,o):(Lt.beginPath(),Lt.moveTo(a,o),n=!0)}}return Lt.stroke(),zr.removevar(t),p},Rr.plotvars=function(e){function t(e,t){var r,n={};for(r=e.length-1;0<=r;--r)n[e[r]]=e[r];for(r=t.length-1;0<=r;--r)n[t[r]]=t[r];for(var i in e=[],n)n.hasOwnProperty(i)&&e.push(n[i]);return e}var r;if("variable"===e.ctype)return[e.name];if("infix"===e.ctype){var n=Rr.plotvars(e.args[0]);return t(n,e=Rr.plotvars(e.args[1]))}if("list"===e.ctype){var i=e.value,a=[];for(r=0;r<i.length;r++)a=t(a,n=Rr.plotvars(i[r]));return a}if("function"===e.ctype){for(i=e.args,a=[],r=0;r<i.length;r++)a=t(a,n=Rr.plotvars(i[r]));return"apply"!==e.oper&&"select"!==e.oper&&"forall"!==e.oper&&"sum"!==e.oper&&"product"!==e.oper&&"repeat"!==e.oper&&"min"!==e.oper&&"max"!==e.oper&&"sort"!==e.oper||"variable"!==e.args[1].ctype||(a=function(e,t){for(var r=0;r<e.length;r++)e[r]===t&&(e.splice(r,1),r--);return e}(a,e.args[1].name)),a}return[]},kr.clrscr$0=function(e,t){return void 0!==Et&&void 0!==Ot&&Lt.clearRect(0,0,Et,Ot),p},kr.repaint$0=function(e,t){return M(),p},kr.screenbounds$0=function(e,t){e=Or.withUsage(Ir.realVector(In.to(0,0)),"Point"),t=Or.withUsage(Ir.realVector(In.to(Tt.clientWidth,0)),"Point");var r=Or.withUsage(Ir.realVector(In.to(Tt.clientWidth,Tt.clientHeight)),"Point"),n=Or.withUsage(Ir.realVector(In.to(0,Tt.clientHeight)),"Point");return Ir.turnIntoCSList([e,t,r,n])},kr.createimage$3=function(e,t){t=he(e[0]);var r=ve(e[1]);if(e=ve(e[2]),"number"!==r.ctype||"number"!==e.ctype||"string"!==t.ctype)return p;var n=document.createElement("canvas");return n.id=t.value,n.width=r.value.real,n.height=e.value.real,n.style.display="none",document.body.appendChild(n),Nt[t.value]=s(n,!1),p},kr.clearimage$1=function(e,t){if("string"!==(e=he(e[0])).ctype&&"image"!==e.ctype)return p;if(!(e=ie(e)))return p;if(null==(t=e.img))return p;var r=e.width,n=e.height;return t.getContext("2d").clearRect(0,0,r,n),e.generation++,p},kr.canvas$4=function(e,t){var r=ve(e[0]),n=ve(e[1]);t=he(e[2]),e=e[3];var i=Rr.extractPoint(r),a=Rr.extractPoint(n);if(!i.ok||!a.ok||"string"!==t.ctype&&"image"!==t.ctype)return p;if(!(t=ie(t))||!t.img.getContext)return p;n=t.img;var o=t.width;r=t.height;var l=a.x-i.x,s=a.y-i.y,u=i.x-s*r/o,c=i.y+l*r/o;s=a.x-s*r/o,l=a.y+l*r/o,a=In.from(i.x,i.y,1),u=In.from(u,c,1),s=In.from(s,l,1),i=a[0]*Kt,c=a[1]*Kt,l=u[0]*Kt;var f=u[1]*Kt,h=s[0]*Kt,v=s[1]*Kt;s=-(u=o*(c-f)/((i-l)*(c-v)-(i-h)*(c-f)))*i-(o=o*(i-l)/((c-f)*(i-h)-(c-v)*(i-l)))*c,r=r-(a=(r*(c-v)-r*(c-f))/((i-l)*(c-v)-(i-h)*(c-f)))*i-(l=(r*(i-h)-r*(i-l))/((c-f)*(i-h)-(c-v)*(i-l)))*c,n=n.getContext("2d"),i=Lt,(Lt=n).save(),Lt.transform(u,a,o,l,s,r),t.generation++,he(e),Lt.restore(),Lt=i},kr.canvas$5=function(e,t){var r=ve(e[0]),n=ve(e[1]),i=ve(e[2]);t=he(e[3]),e=e[4],r=Rr.extractPoint(r);var a=Rr.extractPoint(n),o=Rr.extractPoint(i);if(!r.ok||!a.ok||!o.ok||"string"!==t.ctype&&"image"!==t.ctype)return p;if(!(t=ie(t))||!t.img.getContext)return p;i=t.img;var l=t.width;n=t.height;var s=In.from(r.x,r.y,1),u=In.from(a.x,a.y,1);a=In.from(o.x,o.y,1),r=s[0]*Kt,o=s[1]*Kt;var c=u[0]*Kt,f=u[1]*Kt,h=a[0]*Kt,v=a[1]*Kt;u=-(a=((0-l)*(o-v)-0*(o-f))/((r-c)*(o-v)-(r-h)*(o-f)))*r-(l=((0-l)*(r-h)-0*(r-c))/((o-f)*(r-h)-(o-v)*(r-c)))*o,n=n-(s=((n-n)*(o-v)-(n-0)*(o-f))/((r-c)*(o-v)-(r-h)*(o-f)))*r-(c=((n-n)*(r-h)-(n-0)*(r-c))/((o-f)*(r-h)-(o-v)*(r-c)))*o,i=i.getContext("2d"),r=Lt,(Lt=i).save(),Lt.transform(a,s,l,c,u,n),t.generation++,he(e),Lt.restore(),Lt=r},kr.screenresolution$0=function(e,t){return Cr.real(In.drawingstate.matrix.a)},kr.layer$1=function(e,t){},kr.imagesize$1=function(e,t){return(e=ie(ve(e[0])))?Ir.realVector([+e.width,+e.height]):p},kr.imageready$1=function(e,t){return e=ie(ve(e[0])),Or.bool(!(!e||!e.ready))},kr.drawimage$2=function(e,t){function r(){var e=1,r=1,l=1,s=1,u=Rr.extractPoint(n),c=Rr.extractPoint(a);if(!u.ok||!c.ok)return p;if(!(i=ie(i)))return p;var f=i.width,h=i.height;if(0===o){var v={};v.x=u.x-(c.y-u.y),v.y=u.y+(c.x-u.x),s=h/f}else if(v=Rr.extractPoint(o),!u.ok)return p;if(Lt.save(),void 0!==t.alpha){var d=he(t.alpha);"number"===d.ctype&&(e=d.value.real)}void 0!==t.aspect&&("number"===(d=he(t.aspect)).ctype&&(s=d.value.real)),void 0!==t.flipx&&("boolean"===(d=he(t.flipx)).ctype&&d.value&&(r=-1)),void 0!==t.flipy&&("boolean"===(d=he(t.flipy)).ctype&&d.value&&(l=-1)),Lt.imageSmoothingEnabled=!0,void 0!==t.interpolate&&("boolean"===(d=he(t.interpolate)).ctype&&(Lt.imageSmoothingEnabled=d.value)),d=In.drawingstate.matrix,1!==e&&(Lt.globalAlpha=e),e=u.x*d.a-u.y*d.b+d.tx,u=u.x*d.c-u.y*d.d-d.ty,Lt.transform(c.x*d.a-c.y*d.b+d.tx-e,c.x*d.c-c.y*d.d-d.ty-u,v.x*d.a-v.y*d.b+d.tx-e,v.x*d.c-v.y*d.d-d.ty-u,e,u),Lt.scale(1/f,-1/h*s),Lt.translate(f/2,-h/2),Lt.scale(r,l),Lt.translate(-f/2,h/2),Lt.translate(0,-h),(r=i).drawTo?r.drawTo(Lt,0,0):Lt.drawImage(r.img,0,0),Lt.globalAlpha=1,Lt.restore()}if(2===e.length){var n=ve(e[0]),i=ve(e[1]);return function(){var e=1,r=1,a=1,o=1,l=0,s=1,u=Rr.extractPoint(n);if(!u.ok)return p;if(!(i=ie(i)))return p;if(Lt.save(),void 0!==t.angle){var c=he(t.angle);"number"===c.ctype&&(l=c.value.real)}void 0!==t.rotation&&"number"===(c=he(t.rotation)).ctype&&(l=c.value.real),void 0!==t.scale&&("number"===(c=ve(t.scale)).ctype&&(r=e=c.value.real),Ir.isNumberVector(c).value&&2===c.value.length&&(e=c.value[0].value.real,r=c.value[1].value.real)),void 0!==t.scalex&&"number"===(c=he(t.scalex)).ctype&&(e=c.value.real),void 0!==t.scaley&&"number"===(c=he(t.scaley)).ctype&&(r=c.value.real),void 0!==t.flipx&&"boolean"===(c=he(t.flipx)).ctype&&c.value&&(a=-1),void 0!==t.flipy&&"boolean"===(c=he(t.flipy)).ctype&&c.value&&(o=-1),void 0!==t.alpha&&"number"===(c=he(t.alpha)).ctype&&(s=c.value.real),Lt.imageSmoothingEnabled=!0,void 0!==t.interpolate&&"boolean"===(c=he(t.interpolate)).ctype&&(Lt.imageSmoothingEnabled=c.value);var f=In.drawingstate.matrix,h=In.drawingstate.initialmatrix,v=i.width,d=i.height;c=u.x*f.a-u.y*f.b+f.tx;var m=u.x*f.c-u.y*f.d-f.ty,g=(u.x+1)*f.a-u.y*f.b+f.tx-c;f=(u.x+1)*f.c-u.y*f.d-f.ty-m;var y=(u.x+1)*h.a-u.y*h.b+h.tx-(u.x*h.a-u.y*h.b+h.tx);h=(u.x+1)*h.c-u.y*h.d-h.ty-(u.x*h.c-u.y*h.d-h.ty),u=Math.sqrt(g*g+f*f)/Math.sqrt(y*y+h*h),g=-Math.atan2(g,f)+Math.atan2(y,h),e*=f=In.drawingstate.matrix.sdet/72,r*=f,1!==s&&(Lt.globalAlpha=s),Lt.translate(c,m),Lt.scale(e*a*u,r*o*u),Lt.rotate(l+g),Lt.translate(-c,-m),Lt.translate(-v/2,-d/2),(e=i).drawTo?e.drawTo(Lt,c,m):Lt.drawImage(e.img,c,m),Lt.globalAlpha=1,Lt.restore()}()}if(3===e.length){n=ve(e[0]);var a=ve(e[1]),o=0;return i=ve(e[2]),r()}return 4===e.length?(n=ve(e[0]),a=ve(e[1]),o=ve(e[2]),i=ve(e[3]),r()):p},kr.drawimage$3=kr.drawimage$2,kr.drawimage$4=kr.drawimage$2,kr.allimages$0=function(){var e=[];return Object.keys(Nt).forEach((function(t){e.push({ctype:"string",value:t})})),Ir.turnIntoCSList(e)};var Ur,Vr={};kr.cameravideo$0=function(e,t){function r(e){return{video:{width:e,advanced:[{width:{max:e,min:e}},{width:{ideal:e}}]},audio:!1}}e=!0;var n={};if(void 0!==t.resolution&&("string"===(t=he(t.resolution)).ctype&&"maximal"===t.value?e=!0:"number"===t.ctype?(e=!1,n=r(t.value.real)):Ir._helper.isNumberVecN(t,2)&&(e=!1,n=r(t.value[0].value.real),10>(t=t.value[1].value.real)||!Number.isInteger(t)?(n.video.aspectRatio=t,n.video.advanced[0].aspectRatio={min:t,max:t},n.video.advanced[1].aspectRatio={ideal:t}):(n.video.height=t,n.video.advanced[0].height={min:t,max:t},n.video.advanced[1].height={ideal:t}))),e&&(n=(n=[320,640,1024,1280,1920,2560]).map((function(e){return{width:{min:e}}})),n={video:{width:16e3,height:9e3,advanced:n},audio:!1}),e=JSON.stringify(n),Vr[e])return Vr[e];t=null;var i=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia;if(i?t=function(e,t){navigator.mediaDevices.getUserMedia(n).then(e,t)}:(i=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia)&&(t=function(e,t){i.call(navigator,n,e,t)}),!t)return console.warn("getUserMedia call not supported"),Vr[e]=p;var a=document.createElement("video");return a.autoplay=!0,Vr[e]=s(a,!0),console.log("Opening stream."),t((function(e){a.srcObject=e,a.setAttribute("autoplay",""),a.setAttribute("muted",""),a.setAttribute("playsinline",""),a.play(),a.addEventListener("loadeddata",m)}),(function(e){console.error("Could not get user video:",String(e),e)})),Vr[e]},kr.playvideo$1=function(e,t){return(e=ie(ve(e[0]))).live&&e.img.play&&e.img.play(),p},kr.pausevideo$1=function(e,t){return(e=ie(ve(e[0]))).live&&e.img.pause&&e.img.pause(),p},kr.imagergba$3=function(e,t){t=ie(ve(e[0]));var r=ve(e[1]);return e=ve(e[2]),t&&"number"===r.ctype&&"number"===e.ctype&&t.ready?(r=Math.round(r.value.real),e=Math.round(e.value.real),Qt(r)&&Qt(e)?(e=ae(t,r,e,1,1),Ir.realVector([255*e[0],255*e[1],255*e[2],e[3]])):p):p},kr.imagergb$3=kr.imagergba$3,kr.imagergba$4=function(e,t){var r=ie(ve(e[2]));if(!r||!r.ready)return p;var n=r.width,i=r.height,a=de(e[0]),o=de(e[1]),l=de(Ir.realVector([0,i,1]));if(n=de(Ir.realVector([n,i,1])),a===p||o===p||s===p)return p;s=Ir.ii,i=Ir.jj,l=Rr.basismap(l,n,s,i),a=Rr.basismap(a,o,i,s);var s=de(e[3]);if((i=Rr.extractPoint(Or.mult(l,Or.mult(Ir.adjoint3(a),s)))).ok)if(e=r.width,a=r.height,o=!0,l=!1,void 0!==t.interpolate&&("boolean"===(s=he(t.interpolate)).ctype&&(o=s.value)),void 0!==t.repeat&&("boolean"===(s=he(t.repeat)).ctype&&(l=s.value)),o&&(i.x-=.5,i.y-=.5),l&&(i.x=(i.x%e+e)%e,i.y=(i.y%a+a)%a),s=Math.floor(i.x),n=Math.floor(i.y),Qt(s)&&Qt(n)){if(t=[0,0,0,0],o){o=i.x-s,i=i.y-n;var u=ae(r,s,n,2,2);if(l){if(s===e-1||n===a-1){l=ae(r,(s+1)%e,n,1,1);var c=ae(r,s,(n+1)%a,1,1);r=ae(r,(s+1)%e,(n+1)%a,1,1),u=u.slice(0,4).concat(l,c,r)}}else-1!==s&&s!==e-1||(o=Math.round(o)),-1!==n&&n!==a-1||(i=Math.round(i));for(r=0;4>r;r++)t[r]=(1-i)*((1-o)*u[r]+o*u[r+4])+i*((1-o)*u[r+8]+o*u[r+12])}else t=ae(r,s,n,1,1);r=Ir.realVector(t)}else r=p;else r=p;return r},kr.imagergb$4=function(e,t){return(e=kr.imagergba$4(e,t))===p?p:Ir.turnIntoCSList(e.value.slice(0,3))},kr.readpixels$1=function(e,t){e=ae(e=ie(ve(e[0])),0,0,e.width,e.height),t=[];for(var r=0;r+3<e.length;r+=4)t.push(Ir.turnIntoCSList([Cr.real(e[r+0]),Cr.real(e[r+1]),Cr.real(e[r+2]),Cr.real(e[r+3])]));return Ir.turnIntoCSList(t)};var Wr,Gr,Hr=["+","-"],Jr=["!","√"],Zr=["°",":=_"],Kr=[";",","],Qr=[],en={};Gr=0,[{key:[":"],field:["."],deg:["°"],take:["_"]},{functionCall:!0},{rassoc:!0,pow:["^"],sqrt:["√"]},{mul:["*","⁢","⋅","·"],cross:["×"],div:["/","÷","∕","∶"]},{add:["+"],sub:["-","−"],neg:["!","¬"]},{seq:[".."]},{eq:["==","≟"],ne:["!=","<>","≠"],lt:["<"],gt:[">"],le:["<=","≤","≦"],ge:[">=","≥","≧"],aeq:["~=","≈"],ane:["~!=","≉"],alt:["~<","⪉"],agt:["~>","⪊"],ale:["~<=","⪅"],age:["~>=","⪆"],in:["∈"],nin:["∉"]},{and:["&","∧"],or:["%","∨"]},{rassoc:!0,prepend:["<:"]},{concat:["++","∪"],remove:["--","∖"],common:["~~","∩"],append:[":>"]},{rassoc:!0,assign:["="],define:[":="],undefine:[":=_"],bdefine:["::="]},{seq:[";"]},{modif:["->","→"]},{rassoc:!0,list:[","]}].forEach((function(e){Gr+=2;var t=!!e.rassoc;for(var r in e.functionCall&&(Wr=Gr),e){var n=e[r];if("boolean"!=typeof n)for(var i={name:r,sym:n[0],symbols:n,rassoc:t,precedence:Gr,prefix:!1,postfix:!1,infix:!0,bare:!1},a=0;a<n.length;++a){var o=n[a];if(en.hasOwnProperty(o))throw Error("Duplicate operator: "+o);en[o]=i,Qr.push(o)}}})),Hr.forEach((function(e){en[e].prefix=!0})),Jr.forEach((function(e){en[e].prefix=!0,en[e].infix=!1})),Zr.forEach((function(e){en[e].postfix=!0,en[e].infix=!1})),Kr.forEach((function(e){en[e].prefix=!0,en[e].postfix=!0,en[e].infix=!0,en[e].bare=!0})),Qr.sort((function(e,t){return t.length-e.length}));var tn="(?:[⁺⁻] )?[⁰¹²³⁴⁵⁶⁷⁸⁹](?: [⁰¹²³⁴⁵⁶⁷⁸⁹])*".replace(/ /g,"[ \t]*"),rn="(?:[₊₋] )?[₀₁₂₃₄₅₆₇₈₉](?: [₀₁₂₃₄₅₆₇₈₉])*".replace(/ /g,"[ \t]*"),nn=function(e,t,r){var n,i=0,a="(?:[",o=t.length;for(n=0;n<o;++n){var l=t.charCodeAt(n);55296<=l?(a+="]|"+t.charAt(n)+"[",i=56320):(a+=String.fromCharCode(l=i=e[l-32]+i),(i+=e[t.charCodeAt(++n)-32])!==l&&(i!==l+1&&(a+="-"),a+=String.fromCharCode(i)))}return a+"]|[\ud80c\ud840-\ud868\ud86a-\ud86c\ud86f-\ud872][\udc00-\udfff])"}([2,0,106,3,4,1,6,5,7,11,17,8,12,21,9,22,30,10,15,24,25,16,13,42,46,14,18,19,29,37,27,28,35,26,32,36,40,43,47,53,20,48,50,56,33,34,39,51,52,55,63,64,65,68,85,23,31,38,45,49,105,59,66,69,72,88,102,114,117,128,157,191,41,44,54,60,67,70,71,73,74,75,76,80,81,82,83,84,86,87,89,93,94,98,99,107,108,116,122,130,132,134,138,160,165,185,195,196,255,268,277,310,332,339,362,365,390,449,457,470,512,513,541,568,582,619,673,726,768,820,921,991,1164,2684,6581,8453,11171,20949],"T4(4I!)!'!&/ 0 ')2$+! !$ %## !(!   ! ; u . =#!+YoA& 87C% } !5%+%) #!*! <0a,!4B1%'!&-'!1!$!33`HsG$!;!+.52'(#%#- & !$#$!*!9%  2%H''%#- & % % %B# !H *+   - & % $$!;!5%3!,(#%#- & % $$!X%  5!:! '$  #$% ! %$%$ $)W!G(   / 2$!> &%C(   / . $$!L! %5%;(   D#!*!* 4'&*$W + !#&]F %6&]% !#% !#!(# &   ! !#% # %1!#$ !/#L!S( @?$7-!*''#$!$%+ ',6!:= !&!#7  ##& ! ##D ##B ##& ! ##9 K ##^Y2*V#'$#5 4&p((+, #2*2*2,  5OC!'!Uy.D !&_)0J<#$,E'4Q/1Pv!|8:&K<9%)E>@7 )@# #$%1gT#'#=#'#( ! ! ! 0#P & !$  &$##'',&  &d!9!*,b!'!#. !$$(! ! ! # 1##&$'!G%¥8 8 (#$%6= !&!#Q+!*/1& & & & & & & &t!%E$&%'V(  z #&D${:Aj2¦q©E¤UZ#$2)%-8*0#_J+#b#M#(S1   # /0O2[R'$! !6>)/A?+8<!*$ .)$ D3  (-/$!$[ !$%#$#! !4 #1+ 6'#'#'1& & 7 .)c0¨6/'I§#\\N&6$&! . , $ ! % % M;R#Gh)d$ =4(4,a$'#'#'# \ud800!) 4 : % 9#6@?$IIX*5 ((=)<#@'(\ud801!f~N.Of1-)(\ud802!'#! E %$!#/)/10^: %)-)4nQ(%T!5#   AZ?$?C( >?G)-):9*\ud803!`KJ9J\ud804#PriL3>@7M$!6F2#/! !C* 3V& ! # 9 .+8N(#%#- & % $$!;!6$\ud805eF-% !87#=F-!k7x4\ud806RB!K\ud808!¢\ud809e\ud80d!8\ud811!\ud81a!+0c<;F*#BH&:\ud81b U,!l,\ud82c!%\ud82f!\"&,$++.\ud835!w m %#!#%## ) ! & S ##( & > # $ !$& #3 3 0 3 0 3 0 3 0 3 (\ud83a!\ud83b# A % !#! . # ! !(!'! ! !   % !#! ! ! ! ! % !## & # # ! . 5&  $ 5\ud869!7\ud86d!¡,g\ud86e!<#£\ud873!\ud87e!"),an=("#(?: [1-9])?|(?:'|"+nn+")(?: (?:[0-9']|"+nn+"))*").replace(/ /g,"[ \t]*"),on=["([ \t\n\r]+)|(//.*)|(/\\*)","("+("(?:[0-9](?: [0-9])*(?: \\.(?! \\.)(?:(?! "+an+")|(?= (?: [Ee](?: [+-])?(?: [0-9])+)))(?: [0-9])*)?|\\.(?: [0-9])+)(?: [Ee](?: [+-])?(?: [0-9])+)?").replace(/ /g,"[ \t]*")+")","("+Qr.map(oe).join("|")+")","("+"[](){}||".split("").map(oe).join("|")+")","("+rn+")","("+tn+")","("+an+")",'("[^"]*")|($)'].join("|"),ln=new RegExp("[ \t]*".replace(/\*$/,"+"),"g"),sn="ANY WS COMMENT START_COMMENT NUM OP BRA SUB SUP ID STR EOF".split(" ");!function(){var e=new RegExp(on,"g").exec("");if(e.hasOwnProperty(sn.length))throw Error("RE has more groups than expected");if(!e.hasOwnProperty(sn.length-1))throw Error("RE has fewer groups than expected")}(),se.prototype.advanceBy=function(e){this.advanceTo(this.pos+e)},se.prototype.advanceTo=function(e){for(this.pos=e;this.bols[0]<=e;)this.bol=this.bols.shift(),this.line++},se.prototype.curPos=function(){return{row:this.line,col:this.pos-this.bol,pos:this.pos}},se.prototype.nextInternal=function(){var e=this.re.exec(this.input);if(e.index!==this.pos)throw le("Invalid token",this.curPos(),this.input.substring(this.pos,e.index));var t=this.curPos();this.advanceBy(e[0].length);var r,n=this.curPos();for(r=1;null==e[r];++r);return{start:t,end:n,raw:e[0],text:e[0].replace(ln,""),toktype:sn[r]}},se.prototype.next=function(){do{var e=this.nextInternal();if("START_COMMENT"===e.toktype){var t=/\*\/|\/\*/g;t.lastIndex=e.start.pos+2;for(var r,n=1;0<n;){if(!(r=t.exec(this.input)))throw le("Unterminated comment",e.start,e.text);"/*"===r[0]?++n:--n}this.re.lastIndex=t.lastIndex,this.advanceTo(t.lastIndex),e.end=this.curPos(),e.raw=this.input.substring(e.start.pos,e.end.pos),e.text=e.raw,e.toktype="COMMENT"}}while("WS"===e.toktype||"COMMENT"===e.toktype);return e};var un={ctype:"void"};fe.prototype.postprocess=function(e){if(null===e)return un;if(e){if("infix"===e.ctype)if(":="===e.oper){var t=e.args[0];if("function"===t.ctype)t.args.forEach((function(t){if(null===t||"variable"!==t.ctype)throw le("Function argument must be an identifier",t.start||e.start)}));else if("variable"!==t.ctype)throw le(e.oper+" can only be used to define functions or variables",e.start)}else if(","===e.oper)throw le("comma may only be used to delimit list elements",e.start);if(e.args&&(e.args=e.args.map(this.postprocess,this)),e.modifs)for(var r in e.modifs)e.modifs[r]=this.postprocess(e.modifs[r]);if("paren"===e.ctype)return e.args[0];if("infix"===e.ctype){if("."===e.oper){if(!e.args[1]||"variable"!==e.args[1].ctype)throw le("Field name must be identifier",e.start,e.text);e.ctype="field",e.obj=e.args[0],e.key=e.args[1].name,delete e.args}if(":"===e.oper){if(e.jsonatom){if(!e.args[1])throw le("JSON: Value undefined",e.start,e.text);e.ctype="jsonatom",e.key=e.args[0],e.value=e.args[1],delete e.jsonatom}else{if(!e.args[1])throw le("UserData: Key undefined",e.start,e.text);e.ctype="userdata",e.obj=e.args[0],e.key=e.args[1]}delete e.args}this.infixmap&&(e.impl=this.infixmap[e.oper])}else"variable"===e.ctype?this.usedVariables[e.name]=!0:"function"===e.ctype&&(this.usedFunctions[e.oper]=!0)}if("infix"===e.ctype)return{ctype:"infix",oper:String(e.oper),args:[e.args[0],e.args[1]],impl:e.impl};if("variable"===e.ctype)return{ctype:"variable",name:String(e.name)};if("number"===e.ctype)return{ctype:"number",value:{real:+e.value.real,imag:+e.value.imag}};if("string"===e.ctype)return{ctype:"string",value:String(e.value)};if("list"===e.ctype)return{ctype:"list",value:e.value};if("function"===e.ctype)return{ctype:"function",oper:String(e.oper),args:e.args,modifs:e.modifs};if("field"===e.ctype)return{ctype:"field",obj:e.obj,key:String(e.key)};if("userdata"===e.ctype)return{ctype:"userdata",obj:e.obj,key:e.key};if("jsonatom"===e.ctype)return{ctype:"jsonatom",key:e.key,value:e.value};throw Error("Unsupported AST node of type "+e.ctype)},fe.prototype.parse=function(e){try{var t=pe(new se(e));if("EOF"!==t.closedBy.toktype)throw le("Closing bracket never opened.",t.closedBy.start,t.closedBy.text);return this.postprocess(t.expr)}catch(e){return e.ctype="error",e}},void 0!==o&&void 0!==a&&"undefined"==typeof window&&(a.Parser=fe,a.Tokenizer=se,a.unicodeLetters=nn,a.parse=function(e){return(new fe).parse(e)});var cn={},pn=[],fn={lines:{},audioCtx:null,getAudioContext:function(){return this.audioCtx||(window.AudioContext||window.webkitAudioContext?this.audioCtx=new(window.AudioContext||window.webkitAudioContext):console.warn("Web Audio API not supported in this browser")),this.audioCtx},handleModif:function(e,t,r){if(void 0===e)return r;if((e=he(e)).ctype===t){if("number"===e.ctype)return e.value.real;if("list"===e.ctype){for(t=e.value,e=[],r=0;r<t.length;r++)e[r]=t[r].value.real;return e}return e.value}},handleLineModif:function(e,t){return void 0!==e?R(e=he(e)):t},getBufferNode:function(e,t){var r=this.getAudioContext();if(t*r.sampleRate>e.length){for(var n=[],i=0,a=0;i<r.sampleRate*t;i++,a++)a>e.length&&(a=0),n[i]=e[a];e=n}return t=new Float32Array(e),(e=r.createBuffer(1,t.length,r.sampleRate)).copyToChannel(t,0),(r=r.createBufferSource()).buffer=e,r},createMonoOscillator:function(e,t){var r=this.getAudioContext().createOscillator();if(0!==t){var n=new Float32Array(2),i=new Float32Array(2);n[1]=Math.sin(t),i[1]=Math.cos(t),t=this.getAudioContext().createPeriodicWave(n,i,{disableNormalization:!0}),r.setPeriodicWave(t)}else r.type="sine";return r.mono=!0,r.frequency.value=e,r},createWaveOscillator:function(e,t,r){for(var n=this.getAudioContext().createOscillator(),i=new Float32Array(t.length+1),a=new Float32Array(t.length+1),o=0;o<t.length;o++)a[o+1]=t[o]*Math.cos(r[o]),i[o+1]=t[o]*Math.sin(r[o]);return t=this.getAudioContext().createPeriodicWave(i,a,{disableNormalization:!0}),n.setPeriodicWave(t),n.frequency.value=e,n},cleanup:function(){for(var e in this.lines)if("sin"===this.lines[e].lineType)if(this.lines[e].oscNodes.every((function(e){return!e.oscNode.isplaying})))delete this.lines[e];else for(var t=0;t<this.lines[e].oscNodes.length;t++)this.lines[e].oscNodes[t]&&!this.lines[e].oscNodes[t].oscNode.isplaying&&delete this.lines[e].oscNodes[t]},registerInput:function(e){e.cnt?e.cnt++:e.cnt=1},deregisterInput:function(e){e.cnt&&e.cnt--},hasRegisteredInput:function(e){return e.cnt&&0!==e.cnt},playOscillator:function(e,t,r,n,i,a){var o=this.getAudioContext(),l=o.createGain();return l.gain.value=0,e.connect(l),l.connect(t),fn.registerInput(t),e.start(0),e.isplaying=!0,e.onended=function(){this.isplaying=!1,l.disconnect(),fn.deregisterInput(t),fn.hasRegisteredInput(t)||(t.disconnect(),t.panNode&&t.panNode.disconnect()),fn.cleanup()},l.gain.linearRampToValueAtTime(r,o.currentTime+n),0<=i&&(l.gain.setValueAtTime(r,o.currentTime+n+i),l.gain.linearRampToValueAtTime(0,o.currentTime+n+i+a),this.triggerStop(e,i+n+a)),{oscNode:e,gainNode:l}},softStop:function(e,t){var r=this.getAudioContext();e.gainNode.gain.cancelScheduledValues(r.currentTime),e.gainNode.gain.setValueAtTime(e.gainNode.gain.value,r.currentTime),e.gainNode.gain.linearRampToValueAtTime(0,r.currentTime+t),this.triggerStop(e.oscNode,t)},extendDuration:function(e,t,r){var n=this.getAudioContext();e.gainNode.gain.cancelScheduledValues(n.currentTime),e.gainNode.gain.setValueAtTime(e.gainNode.gain.value,n.currentTime),e.gainNode.gain.setValueAtTime(e.gainNode.gain.value,n.currentTime+t),e.gainNode.gain.linearRampToValueAtTime(0,n.currentTime+t+r),this.triggerStop(e.oscNode,t+r)},triggerStop:function(e,t){e.timeoutId&&clearTimeout(e.timeoutId),e.timeoutId=setTimeout((function(){e.stop(0)}),1e3*t+10)}},hn=function(e){this.audioCtx=e,this.lineType="sin",this.oscNodes=[]};hn.prototype.handleModif=function(e,t,r,n){if("phaseshift"===t)n=this.handlePhaseshiftModif(e.phaseshift,this.harmonics.length);else if(void 0!==e[t]&&(e=he(e[t])).ctype===r)if("number"===e.ctype)n=e.value.real;else if("list"===e.ctype){for(r=e.value,e=[],n=0;n<r.length;n++)e[n]=r[n].value.real;n=e}else n=e.value;return this[t]=n},hn.prototype.handlePhaseshiftModif=function(e,t){if(this.phaseshift=Array(t).fill(0),void 0!==e)if("list"===(e=he(e)).ctype)for(t=e.value,e=0;e<t.length;e++)this.phaseshift[e]=t[e].value.real;else if("number"===e.ctype)for(var r=0;r<t;r++)this.phaseshift[r]=(r+1)*e.value.real;return this.phaseshift},hn.prototype.cleanparameters=function(e){this.partials.length<this.harmonics.length&&(this.partials=Array(this.harmonics.length).fill(1),e.partials&&console.warn("Ignore partials because the given length does not match with the length of harmonics")),this.phaseshift.length<this.harmonics.length&&(this.phaseshift=Array(this.harmonics.length).fill(0),e.phaseshift&&console.warn("Ignore phaseshift because the given length does not match with the length of harmonics")),this.precompute&=this.partials.every((function(e){return 1e-8>Math.abs(e-1)})),0<this.damp&&(this.duration=Math.min(this.duration,6/this.damp))},hn.prototype.panit=function(){0===this.pan||this.masterGain.panNode||(this.masterGain.disconnect(this.audioCtx.destination),this.masterGain.panNode=this.audioCtx.createStereoPanner(),this.masterGain.connect(this.masterGain.panNode),this.masterGain.panNode.connect(this.audioCtx.destination)),this.masterGain.panNode&&(this.masterGain.panNode.pan.value=this.pan)},hn.prototype.dampit=function(){this.masterGain.gain.cancelScheduledValues(this.audioCtx.currentTime),this.masterGain.gain.setValueAtTime(this.masterGain.gain.value,this.audioCtx.currentTime),0<this.damp?this.masterGain.gain.setTargetAtTime(0,this.audioCtx.currentTime+this.attack,1/this.damp):0>this.damp&&this.masterGain.gain.setTargetAtTime(1,this.audioCtx.currentTime+this.attack,-this.damp)},hn.prototype.startOscillators=function(){if(this.precompute)this.oscNodes[0]=fn.playOscillator(fn.createWaveOscillator(this.freq,this.harmonics,this.phaseshift),this.masterGain,1,this.attack,this.duration,this.release);else for(var e=0;e<this.harmonics.length;e++)this.oscNodes[e]=fn.playOscillator(fn.createMonoOscillator(this.partials[e]*(e+1)*this.freq,this.phaseshift[e]),this.masterGain,this.harmonics[e],this.attack,this.duration,this.release)},hn.prototype.stopOscillators=function(){for(var e in this.oscNodes)fn.softStop(this.oscNodes[e],this.release),delete this.oscNodes[e]},hn.prototype.stop=function(){this.stopOscillators()},hn.prototype.updateFrequencyAndGain=function(){if(this.precompute)this.harmonicsdidnotchange()&&this.oscNodes[0]&&this.oscNodes[0].oscNode.isplaying&&!this.oscNodes[0].oscNode.mono?(this.oscNodes[0].oscNode.frequency.value=this.freq,fn.extendDuration(this.oscNodes[0],this.duration,this.release)):(this.stopOscillators(),this.startOscillators());else{for(var e=0;e<this.harmonics.length;e++)0<this.harmonics[e]&&(this.oscNodes[e]&&this.oscNodes[e].oscNode.isplaying&&this.oscNodes[e].oscNode.mono?(this.oscNodes[e].oscNode.frequency.value=this.partials[e]*(e+1)*this.freq,this.oscNodes[e].gainNode.gain.value=this.harmonics[e],fn.extendDuration(this.oscNodes[e],this.duration,this.release)):(this.oscNodes[e]&&this.oscNodes[e].oscNode.isplaying&&!this.oscNodes[e].oscNode.mono&&fn.softStop(this.oscNodes[e],this.release),this.oscNodes[e]=fn.playOscillator(fn.createMonoOscillator(this.partials[e]*(e+1)*this.freq,this.phaseshift[e]),this.masterGain,this.harmonics[e],this.attack,this.duration,this.release)));for(var t in this.oscNodes)this.harmonics[t]||(fn.softStop(this.oscNodes[t],this.release),delete this.oscNodes[t])}},hn.prototype.generateNewMasterGain=function(e){this.masterGain=this.audioCtx.createGain(),this.masterGain.connect(this.audioCtx.destination),this.masterGain.gain.value=e},hn.prototype.harmonicsdidnotchange=function(){if(this.lastharmonics){var e=1&this.lastharmonics.length===this.harmonics.length;for(var t in this.harmonics)e&&(e&=this.harmonics[t]===this.lastharmonics[t])}else e=!1;return e},hn.prototype.evokeplaysin=function(e,t,r){if(this.cleanparameters(r),0===this.duration)return this.stop(),p;e||t&&0!==this.damp?(t&&!e&&this.stopOscillators(),this.generateNewMasterGain(this.amp),this.startOscillators()):(this.masterGain||this.generateNewMasterGain(this.amp),this.updateFrequencyAndGain()),this.panit(),this.dampit(),this.lastharmonics=this.harmonics},kr.stopsound$0=function(){if(fn.audioCtx){for(var e in fn.lines)fn.lines[e].stop(),delete fn.lines[e];fn.audioCtx.close(),fn.audioCtx=null}},kr.playsin$1=function(e,t){var r=fn.getAudioContext(),n=fn.handleLineModif(t.line,"0"),i=!1;return fn.lines[n]&&"sin"===fn.lines[n].lineType||(fn.lines[n]&&fn.lines[n].stop(),fn.lines[n]=new hn(r),i=!0),(r=fn.lines[n]).freq=he(e[0]).value.real,r.handleModif(t,"amp","number",.5),r.handleModif(t,"damp","number",0),r.handleModif(t,"duration","number",fn.handleModif(t.stop,"number",1)),r.handleModif(t,"harmonics","list",[1]),r.handleModif(t,"partials","list",[1]),r.handleModif(t,"attack","number",.01),r.handleModif(t,"release","number",.01),r.handleModif(t,"pan","number",0),r.handleModif(t,"precompute","boolean",!1),r.handleModif(t,"phaseshift","phaseshift",Array(r.harmonics.length).fill(0)),e=fn.handleModif(t.restart,"boolean",!0),r.evokeplaysin(i,e,t),p},kr.playsin$0=function(e,t){if(void 0!==t.line&&(e=fn.handleLineModif(t.line,"0"),e=fn.lines[e])){e.handleModif(t,"freq","number",e.freq),e.handleModif(t,"amp","number",e.amp),e.handleModif(t,"damp","number",e.damp),e.handleModif(t,"duration","number",fn.handleModif(t.stop,"number",e.duration)),e.handleModif(t,"harmonics","list",e.harmonics),e.handleModif(t,"partials","list",e.partials),e.handleModif(t,"attack","number",e.attack),e.handleModif(t,"release","number",e.release),e.handleModif(t,"pan","number",e.pan),e.handleModif(t,"precompute","boolean",e.precompute),e.handleModif(t,"phaseshift","phaseshift",e.phaseshift);var r=fn.handleModif(t.restart,"boolean",!1);e.evokeplaysin(!1,r,t)}return p},kr.playfunction$1=function(e,t){var r=fn.getAudioContext(),n=e[0];e=function(e){var t=[];for(t.push(e);0!==t.length;){if("variable"===(e=t.pop()).ctype&&he(e)===p&&-1!==["x","y","t"].indexOf(e.name))return e.name;if(e.args)for(var r in e.args)t.push(e.args[r])}return p}(n),e!==p&&zr.newvar(e);var i=fn.handleLineModif(t.line,"0"),a=fn.handleModif(t.start,"number",0),o=fn.handleModif(t.amp,"number",.5),l=fn.handleModif(t.damp,"number",0);fn.handleModif(t.stop,"number",1);var s=fn.handleModif(t.duration,"number",1),u=fn.handleModif(t.attack,"number",.01),c=fn.handleModif(t.release,"number",.01),f=fn.handleModif(t.export,"boolean",!1),h=fn.handleModif(t.silent,"boolean",!1);t=[];for(var v=0;v<r.sampleRate*s;v++){e!==p&&zr.setvar(e,Cr.real(v/r.sampleRate));var d=he(n);t[v]=d.value.real*o*Math.exp(-l*v/r.sampleRate)}return h||(fn.lines[i]&&"function"===fn.lines[i].lineType?((n=fn.lines[i]).masterGain.gain.linearRampToValueAtTime(0,r.currentTime+c),n.bufferNode.stop(r.currentTime+c),n.bufferNode=fn.getBufferNode(t,s),n.bufferNode.connect(n.masterGain),n.bufferNode.start(a+c),n.masterGain.gain.linearRampToValueAtTime(o,r.currentTime+c+u)):(fn.lines[i]&&fn.lines[i].stop(),fn.lines[i]={lineType:"function",bufferNode:fn.getBufferNode(t,s),masterGain:r.createGain(),stop:function(){this.bufferNode.stop()}},(s=fn.lines[i]).masterGain.gain.value=0,s.masterGain.connect(r.destination),s.bufferNode.connect(s.masterGain),s.bufferNode.start(a),s.masterGain.gain.linearRampToValueAtTime(o,r.currentTime+u))),e!==p&&zr.removevar(e),f?t:p},kr.playwave$1=function(e,t){var r=fn.getAudioContext(),n=he(e[0]),i=fn.handleLineModif(t.line,"0");e=fn.handleModif(t.amp,"number",.5),fn.handleModif(t.damp,"number",0);var a=fn.handleModif(t.duration,"number",1),o=fn.handleModif(t.attack,"number",.01),l=fn.handleModif(t.release,"number",.01);return t=fn.handleModif(t.start,"number",0),"list"!==n.ctype||(fn.lines[i]&&"wave"===fn.lines[i].lineType?((i=fn.lines[i]).masterGain.gain.linearRampToValueAtTime(0,r.currentTime+l),i.bufferNode.stop(r.currentTime+l),i.bufferNode=fn.getBufferNode(Or.unwrap(n),a),i.bufferNode.connect(i.masterGain),i.bufferNode.start(t+l),i.masterGain.gain.linearRampToValueAtTime(e,r.currentTime+l+o)):(fn.lines[i]&&fn.lines[i].stop(),fn.lines[i]={lineType:"wave",bufferNode:fn.getBufferNode(Or.unwrap(n),a),masterGain:r.createGain(),stop:function(){this.bufferNode.stop()}},(n=fn.lines[i]).masterGain.gain.value=0,n.masterGain.connect(r.destination),n.bufferNode.connect(n.masterGain),n.bufferNode.start(0),n.masterGain.gain.linearRampToValueAtTime(e,r.currentTime+o))),p};var vn={printArr:function(e){for(var t=e.value.length,r=[],n=[],i=!1,a=0;a<t;a++)r[a]=e.value[a].value.real,n[a]=e.value[a].value.imag,0!==n[a]&&(i=!0);console.log(r),i&&console.log(n)},zero:function(e){for(var t=[],r=Cr.real(0),n=0;n<e.value.real;n++)t[n]=r;return Ir.turnIntoCSList(t)},number:function(e,t){return(t=vn.zero(t)).value[0]=e,t},variable:function(e,t){return(t=vn.zero(t)).value[0]=e,t.value[1]=Cr.real(1),t},add:function(e,t){return Ir.add(e,t)},sub:function(e,t){return Ir.sub(e,t)},mult:function(e,t){if(e.value.length!==t.value.length)return console.error("dims don't fit return nada"),p;for(var r=e.value.length,n=vn.zero(Cr.real(r)),i=Cr.real(0),a=0;a<r;a++){for(var o=0;o<=a;o++)i=Cr.add(i,Cr.mult(e.value[o],t.value[a-o]));n.value[a]=i,i=Cr.real(0)}return n},pow:function(e,t){if(0>t.value.real||t.value.real!==Math.floor(t.value.real))return vn.root(e,t);for(var r=e,n=1;n<t.value.real;n++)r=vn.mult(r,e);return r},root:function(e,t){var r=Cr.real(0),n=Cr.real(1),i=Cr.add(n,t),a=e.value.length,o=vn.zero(Cr.real(a));o.value[0]=Cr.pow(e.value[0],t);var l=r;for(t=1;t<a;t++){for(var s=Cr.real(t),u=1;u<=t;u++){var c=Cr.mult(i,Cr.real(u));c=Cr.div(c,s),c=Cr.sub(c,n),c=Cr.mult(c,e.value[u]),c=Cr.mult(c,o.value[t-u]),l=Cr.add(l,c)}l=Cr.div(l,e.value[0]),o.value[t]=l,l=r}return o},findFirstNoneZero:function(e,t,r){for(var n=1/0,i=1/0,a=r;a<e.value.length;a++)if(1e-12<Cr.abs2(e.value[a]).value.real){n=a;break}for(e=r;e<t.value.length;e++)if(1e-12<Cr.abs2(t.value[e]).value.real){i=e;break}return[n,i]},div:function(e,t){if(e.value.length!==t.value.length)return console.log("dims don't fit - return nada"),p;for(var r,n=e.value.length,i=Cr.real(0),a=vn.zero(Cr.real(n)),o=i,l=0;l<n;l++){l<(r=vn.findFirstNoneZero(e,t,l))[0]&&r[0]===r[1]&&1/0!==r[0]&&(e.value.splice(l,r[0]),t.value.splice(l,r[0]),a.value.splice(l,r[0]),n-=r[0]),r=e.value[l];for(var s=0;s<l;s++)o=Cr.add(o,Cr.mult(a.value[s],t.value[l-s]));r=Cr.sub(r,o),r=Cr.div(r,t.value[0]),a.value[l]=r,o=i}return a},exp:function(e){var t=Cr.real(0),r=e.value.length,n=vn.zero(Cr.real(r)),i=t;n.value[0]=Cr.exp(e.value[0]);for(var a=1;a<r;a++){for(var o=1;o<=a;o++){var l=Cr.mult(Cr.real(o),e.value[o]);l=Cr.mult(l,n.value[a-o]),i=Cr.add(i,l)}n.value[a]=Cr.div(i,Cr.real(a)),i=t}return n},log:function(e){var t=Cr.real(0),r=e.value.length,n=vn.zero(Cr.real(r));n.value[0]=Cr.log(e.value[0]);for(var i,a,o=t,l=1;l<r;l++){i=e.value[l];for(var s=1;s<l;s++)a=Cr.mult(Cr.real(s),n.value[s]),a=Cr.mult(a,e.value[l-s]),o=Cr.add(o,a);o=Cr.div(o,Cr.real(l)),i=Cr.sub(i,o),i=Cr.div(i,e.value[0]),n.value[l]=i,o=t}return n},sincos:function(e){var t=Cr.real(0),r=e.value.length,n=vn.zero(Cr.real(r)),i=vn.zero(Cr.real(r));n.value[0]=Cr.sin(e.value[0]),i.value[0]=Cr.cos(e.value[0]);for(var a,o,l,s=t,u=t,c=1;c<r;c++){l=Cr.real(c);for(var p=1;p<=c;p++)o=Cr.mult(Cr.real(p),e.value[p]),a=Cr.mult(o,i.value[c-p]),o=Cr.mult(o,n.value[c-p]),u=Cr.add(u,a),s=Cr.add(s,o);u=Cr.div(u,l),s=Cr.div(s,Cr.neg(l)),n.value[c]=u,i.value[c]=s,s=u=t}return vn.sinsave=n,vn.cossave=i,[n,i]},sin:function(e){return vn.sincos(e)[0]},cos:function(e){return vn.sincos(e)[1]},faculty:function(e){var t=[];t[0]=Cr.real(1);for(var r=1,n=1;n<=e.value.real;n++)r*=n,t[n]=Cr.real(r);return Ir.turnIntoCSList(t)},diff:function(e,t,r,n){if("variable"===e.ctype)var i=e.name!==t?vn.number(he(e),n):vn.variable(r,n);else if("number"===e.ctype)i=vn.number(e,n);else{if("infix"===e.ctype)return"*"===e.oper?vn.mult(vn.diff(e.args[0],t,r,n),vn.diff(e.args[1],t,r,n)):"^"===e.oper?vn.pow(vn.diff(e.args[0],t,r,n),vn.diff(e.args[1],t,r,n).value[0]):"/"===e.oper?vn.div(vn.diff(e.args[0],t,r,n),vn.diff(e.args[1],t,r,n)):"+"===e.oper?vn.add(vn.diff(e.args[0],t,r,n),vn.diff(e.args[1],t,r,n)):"-"===e.oper?vn.sub(vn.diff(e.args[0],t,r,n),vn.diff(e.args[1],t,r,n)):(console.log("infix not found",e.oper),p);if("function"!==e.ctype)return console.log("ctype not found",e.ctype),p;if("exp$1"===e.oper)return vn.exp(vn.diff(e.args[0],t,r,n));if("log$1"===e.oper)return vn.log(vn.diff(e.args[0],t,r,n));if("sin$1"===e.oper)return vn.sin(vn.diff(e.args[0],t,r,n));if("cos$1"===e.oper)return vn.cos(vn.diff(e.args[0],t,r,n))}return i},adevaluate:function(e,t,r,n){for(e=vn.diff(e,t,r,n),n=vn.faculty(n),t=2;t<e.value.length;t++)e.value[t]=Cr.mult(e.value[t],n.value[t]);return e},autodiff:function(e,t,r,n){for(var i,a=[],o=r.value.length,l=0;l<o;l++)i=vn.adevaluate(e,t,r.value[l],n),a[l]=i;return Ir.turnIntoCSList(a)}},dn={handleModifs:function(e,t){var r,n;for(r in dn.dashing&&dn.unSetDash(),dn.colorraw=null,dn.fillcolorraw=null,dn.fillrule="nonzero",dn.size=null,0>=dn.psize&&(dn.psize=0),0>=dn.lsize&&(dn.lsize=0),dn.overhang=1,dn.dashing=!1,dn.isArrow=!1,dn.arrowSides="==>",dn.arrowposition=1,dn.headlen=10,dn.arrowShape=dn.arrowShapes.line,dn.alpha=In.drawingstate.alpha,dn.fillalpha=0,dn.bold="",dn.italics="",dn.family="sans-serif",dn.align=0,dn.angle=0,dn.xOffset=0,dn.yOffset=0,dn.lineCap="round",dn.lineJoin="round",dn.miterLimit=10,dn.noborder=!1,e){var i=e[r];i&&((n=t[r])?(!0===n&&(n=dn.modifHandlers[r]),n(he(i))):console.log("Modifier not supported: "+r))}null!==dn.size?dn.psize=dn.lsize=dn.size:(dn.psize=In.drawingstate.pointsize,dn.lsize=In.drawingstate.linesize),dn.dashing&&dn.dashing(dn.lsize),null!==dn.colorraw?dn.pointColor=dn.lineColor=dn.textColor=dn.makeColor(dn.colorraw):1===dn.alpha?(dn.pointColor=In.drawingstate.pointcolor,dn.lineColor=In.drawingstate.linecolor,dn.textColor=In.drawingstate.textcolor):(dn.pointColor=dn.makeColor(In.drawingstate.pointcolorraw),dn.lineColor=dn.makeColor(In.drawingstate.linecolorraw),dn.textColor=dn.makeColor(In.drawingstate.textcolorraw)),dn.black=1===dn.alpha?"rgb(0,0,0)":"rgba(0,0,0,"+dn.alpha+")",dn.fillColor=dn.fillcolorraw&&0<dn.fillalpha?dn.makeColor(dn.fillcolorraw,dn.fillalpha):null},modifHandlers:{size:function(e){"number"===e.ctype&&(dn.size=e.value.real,0>dn.size&&(dn.size=0),1e3<dn.size&&(dn.size=1e3))},color:function(e){Ir.isNumberVector(e).value&&3===e.value.length&&(dn.colorraw=[e.value[0].value.real,e.value[1].value.real,e.value[2].value.real])},fillcolor:function(e){Ir.isNumberVector(e).value&&3===e.value.length&&(dn.fillcolorraw=[e.value[0].value.real,e.value[1].value.real,e.value[2].value.real])},alpha:function(e){"number"===e.ctype&&(dn.alpha=e.value.real)},fillalpha:function(e){"number"===e.ctype&&(dn.fillalpha=e.value.real)},dashpattern:function(e){if("list"===e.ctype){for(var t=[],r=0,n=0;r<e.value.length;r++)"number"===e.value[r].ctype&&(t[n++]=e.value[r].value.real);dn.dashing=dn.setDash.bind(null,t)}},dashtype:function(e){if("number"===e.ctype)e=Math.floor(e.value.real);else{if("string"!==e.ctype)return;e=e.value}(e=dn.dashTypes[e])&&(dn.dashing=dn.setDash.bind(null,e))},dashing:function(e){"number"===e.ctype&&(e=Math.floor(e.value.real),dn.dashing=dn.setDash.bind(null,[2*e,e]))},overhang:function(e){"number"===e.ctype&&(dn.overhang=dn.overhang*e.value.real+(1-dn.overhang)*(1-e.value.real))},arrow:function(e){"boolean"===e.ctype?dn.isArrow=e.value:console.error("arrow needs to be of type boolean")},arrowshape:function(e){"string"!==e.ctype?console.error("arrowshape needs to be of type string"):dn.arrowShapes.hasOwnProperty(e.value)?(dn.arrowShape=dn.arrowShapes[e.value],dn.isArrow=!0,dn.arrowShape.deprecated&&(console.log("arrowshape "+e.value+" is deprecated, use "+dn.arrowShape.deprecated+" instead."),dn.arrowShape.deprecated=null)):((e=Object.keys(dn.arrowShapes)).sort(),e=e.join(", "),console.error("arrowshape needs to be one of "+e))},arrowsides:function(e){"string"!==e.ctype?console.error("arrowsides is not of type string"):"==>"!==e.value&&"<==>"!==e.value&&"<=="!==e.value?console.error("arrowsides is unknows"):(dn.arrowSides=e.value,dn.isArrow=!0)},arrowposition:function(e){"number"!==e.ctype?console.error("arrowposition is not of type number"):0>e.value.real?console.error("arrowposition has to be positive"):1<e.value.real?dn.overhang=dn.overhang*e.value.real+(1-dn.overhang)*(1-e.value.real):(dn.arrowposition=e.value.real,dn.isArrow=!0)},arrowsize:function(e){"number"!==e.ctype?console.error("arrowsize is not of type number"):0>e.value.real?console.error("arrowsize has to be positive"):dn.headlen*=e.value.real},bold:function(e){"boolean"===e.ctype&&e.value&&(dn.bold="bold ")},italics:function(e){"boolean"===e.ctype&&e.value&&(dn.italics="italic ")},family:function(e){"string"===e.ctype&&(dn.family=e.value)},align:function(e){"string"===e.ctype&&("left"===(e=e.value)&&(dn.align=0),"right"===e&&(dn.align=1),"mid"===e||"center"===e)&&(dn.align=.5)},angle:function(e){"number"===e.ctype&&(dn.angle=e.value.real)},x_offset:function(e){"number"===e.ctype&&(dn.xOffset=e.value.real)},y_offset:function(e){"number"===e.ctype&&(dn.yOffset=e.value.real)},offset:function(e){"list"===e.ctype&&2===e.value.length&&"number"===e.value[0].ctype&&"number"===e.value[1].ctype&&(dn.xOffset=e.value[0].value.real,dn.yOffset=e.value[1].value.real)},lineCap:function(e){"string"!==e.ctype||"round"!==e.value&&"square"!==e.value&&"butt"!==e.value||(dn.lineCap=e.value)},lineJoin:function(e){"string"!==e.ctype||"round"!==e.value&&"bevel"!==e.value&&"miter"!==e.value||(dn.lineJoin=e.value)},fillrule:function(e){"string"!==e.ctype||"nonzero"!==e.value&&"evenodd"!==e.value||(dn.fillrule=e.value)},miterLimit:function(e){"number"===e.ctype&&0<e.value.real&&(dn.miterLimit=Math.round(e.value.real))},noborder:function(e){"boolean"===e.ctype?dn.noborder=e.value:console.error("noborder needs to be of type boolean")},border:function(e){"boolean"===e.ctype?dn.noborder=!e.value:console.error("border needs to be of type boolean")}},lineModifs:{size:!0,color:!0,alpha:!0,dashpattern:!0,dashtype:!0,dashing:!0,overhang:!0,arrow:!0,arrowshape:!0,arrowsides:!0,arrowposition:!0,arrowsize:!0,lineCap:!0,lineJoin:!0,miterLimit:!0},pointModifs:{size:!0,color:!0,alpha:!0,noborder:!0,border:!0}};dn.pointAndLineModifs=dn.lineModifs,dn.conicModifs={size:!0,color:!0,alpha:!0,dashing:!0,dashpattern:!0,dashtype:!0,fillcolor:!0,fillrule:!0,fillalpha:!0,lineCap:!0,lineJoin:!0,miterLimit:!0},dn.textModifs={size:!0,color:!0,alpha:!0,bold:!0,italics:!0,family:!0,align:!0,angle:!0,x_offset:!0,y_offset:!0,offset:!0},dn.makeColor=function(e,t){return void 0===t&&(t=dn.alpha),"rgba("+Math.floor(255*e[0])+","+Math.floor(255*e[1])+","+Math.floor(255*e[2])+","+t+")"},dn.preDrawCurve=function(){Lt.lineWidth=dn.lsize,Lt.lineCap=dn.lineCap,Lt.lineJoin=dn.lineJoin,Lt.mozFillRule=dn.fillrule,Lt.fillrule=dn.fillrule,Lt.miterLimit=dn.miterLimit,Lt.strokeStyle=dn.lineColor},dn.arrowShapes={default:{close:!1,fill:!1,ratio:1,deprecated:"line"},line:{close:!1,fill:!1,ratio:1},empty:{close:!0,fill:!1,ratio:1},hollow:{close:!0,fill:!1,ratio:1,deprecated:"empty"},full:{close:!0,fill:!0,ratio:1},jet:{close:!0,fill:!0,ratio:1.5},delta:{close:!0,fill:!0,ratio:1.5,deprecated:"jet"}},dn.clipSegment=function(e,t){var r=t.x-e.x,n=t.y-e.y,i=dn.clipLineCore(-n,r,e.x*t.y-t.x*e.y);if(2!==i.length)return[];var a=i[0];i=i[1];var o=1/(r*r+n*n),l=((a.x-e.x)*r+(a.y-e.y)*n)*o;return 0>l&&(a=e),1<l&&(a=t),0>(r=((i.x-e.x)*r+(i.y-e.y)*n)*o)&&(i=e),1<r&&(i=t),a===i?[]:[a,i]},dn.drawsegcore=function(e,t){function r(e,t,r,n){var i=e-n*c+.5*p,a=t-n*p-.5*c,o=e-n*c-.5*p;n=t-n*p+.5*c,Lt.beginPath(),dn.arrowShape.fill&&(Lt.lineWidth=dn.lsize/2),Lt.moveTo(i,a),Lt.lineTo(e,t),Lt.lineTo(o,n),dn.arrowShape.close&&(Lt.fillStyle=dn.lineColor,Lt.lineTo(e-r*c,t-r*p),Lt.closePath(),dn.arrowShape.fill&&Lt.fill()),Lt.stroke()}var n=In.drawingstate.matrix,i=e.x*n.a-e.y*n.b+n.tx,a=e.x*n.c-e.y*n.d-n.ty,o=t.x*n.a-t.y*n.b+n.tx,l=t.x*n.c-t.y*n.d-n.ty,s=dn.overhang,u=1-s;if(t=s*i+u*o,n=s*a+u*l,e=s*o+u*i,s=s*l+u*a,0>t||t>Et||0>n||n>Ot||0>e||e>Et||0>s||s>Ot){if(2!==(s=dn.clipSegment({x:t,y:n},{x:e,y:s})).length||.01>dn.lsize)return;t=s[0].x,n=s[0].y,e=s[1].x,s=s[1].y}if(dn.preDrawCurve(),!dn.isArrow||i===a&&o===l).01>dn.lsize||(Lt.beginPath(),Lt.moveTo(t,n),Lt.lineTo(e,s),Lt.stroke());else{a=l-a;var c=(i=o-i)*(o=dn.headlen/Math.sqrt(i*i+a*a)),p=a*o;i=(l=dn.arrowposition)*t+(u=1-l)*e,a=l*n+u*s,o=l*e+u*t,l=l*s+u*n,u=dn.arrowSides,Lt.beginPath(),dn.arrowShape.close?("<==>"===u||"<=="===u?(1>dn.arrowposition&&(Lt.moveTo(t,n),Lt.lineTo(i,a)),Lt.moveTo(i+c,a+p)):Lt.moveTo(t,n),"==>"===u||"<==>"===u?(Lt.lineTo(o-c,l-p),1>dn.arrowposition&&(Lt.moveTo(o,l),Lt.lineTo(e,s))):Lt.lineTo(e,s)):(Lt.moveTo(t,n),Lt.lineTo(e,s)),Lt.stroke(),"==>"!==u&&"<==>"!==u||r(o,l,1,dn.arrowShape.ratio),"<=="!==u&&"<==>"!==u||r(i,a,-1,-dn.arrowShape.ratio)}},dn.drawpoint=function(e){var t=In.drawingstate.matrix,r=e.x*t.a-e.y*t.b+t.tx;e=e.x*t.c-e.y*t.d-t.ty,Lt.lineWidth=.3*dn.psize,Lt.beginPath(),Lt.arc(r,e,dn.psize,0,2*Math.PI),Lt.fillStyle=dn.pointColor,Lt.fill(),dn.noborder||(Lt.beginPath(),Lt.arc(r,e,1.15*dn.psize,0,2*Math.PI),Lt.fillStyle=dn.black,Lt.strokeStyle=dn.black,Lt.stroke())},dn.clipLineCore=function(e,t,r){var n=Math.SQRT1_2*dn.lsize,i=0-n,a=Et+n,o=0-n,l=0>i*e+o*t+r,s=0>a*e+o*t+r,u=0>i*e+(n=Ot+n)*t+r,c=0>a*e+n*t+r,p=[];return l!==s&&p.push({x:(-r-t*o)/e,y:o}),s!==c&&p.push({x:a,y:(-r-e*a)/t}),u!==c&&p.push({x:(-r-t*n)/e,y:n}),l!==u&&p.push({x:i,y:(-r-e*i)/t}),p},dn.clipLine=function(e){return e=Ir.normalizeMax(Ir.productVM(e,In.toMat())),dn.clipLineCore(e.value[0].value.real,e.value[1].value.real,e.value[2].value.real)},dn.drawline=function(e){Ir._helper.isAlmostReal(e)&&(2===(e=dn.clipLine(e)).length&&.01<=dn.lsize&&(dn.preDrawCurve(),Lt.beginPath(),Lt.moveTo(e[0].x,e[0].y),Lt.lineTo(e[1].x,e[1].y),Lt.stroke()))},dn.drawRaySegment=function(e,t){if(e=Rr.extractPoint(e),t=Rr.extractPoint(t),e.ok&&t.ok){var r=e.x-t.x,n=e.y-t.y,i=25e3/In.drawingstate.matrix.sdet/Math.sqrt(r*r+n*n);r*=i,n*=i,dn.drawsegcore(e,{x:e.x+r,y:e.y+n}),dn.drawsegcore(t,{x:t.x-r,y:t.y-n})}},dn.dashTypes={solid:[],dashed:[10,10],tightdash:[10,4],dotted:[1,3],dashdot:[10,5,1,5],"dashvalue.solid":[],"dashvalue.dashed":[10,10],"dashvalue.tightdash":[10,4],"dashvalue.dotted":[1,3],"dashvalue.dashdot":[10,5,1,5],0:[],1:[10,10],2:[10,4],3:[1,3],4:[10,5,1,5]},dn.setDash=function(e,t){t=Math.sqrt(t),e=e.slice();for(var r=0;r<e.length;r++)e[r]*=t;Lt.webkitLineDash=e,Lt.setLineDash(e),Lt.mozDash=e},dn.unSetDash=function(){Lt.webkitLineDash=[],Lt.setLineDash([]),Lt.mozDash=[]},ye.prototype={set fillStyle(e){var t=this;Pe(e,(function(e,r,n,i){t._fill="#"+Ce(e.toString(16),2)+Ce(r.toString(16),2)+Ce(n.toString(16),2),t._fillOpacity=255===i?null:i}))},set strokeStyle(e){var t=this;Pe(e,(function(e,r,n,i){t._stroke="#"+Ce(e.toString(16),2)+Ce(r.toString(16),2)+Ce(n.toString(16),2),t._strokeOpacity=255===i?null:i}))},clearRect:function(){},beginPath:function(){this._path=[]},_pathcmd:function(){this._path.push.apply(this._path,arguments)},closePath:function(){this._pathcmd("Z")},moveTo:function(e,t){this._pathcmd("M",e,t)},lineTo:function(e,t){this._pathcmd("L",e,t)},bezierCurveTo:function(e,t,r,n,i,a){this._pathcmd("C",e,t,r,n,i,a)},quadraticCurveTo:function(e,t,r,n){this._pathcmd("Q",e,t,r,n)},arc:function(e,t,r,n,i,a){var o=r*Math.cos(n)+e,l=r*Math.sin(n)+t,s=r*Math.cos(i)+e,u=r*Math.sin(i)+t;(i=a?n-i:i-n)>=2*Math.PI?this._pathcmd(this._path.length?"L":"M",o,l,"A",r,r,0,0,a?1:0,e-r*Math.cos(n),t-r*Math.sin(n),"A",r,r,0,0,a?1:0,o,l):this._pathcmd(this._path.length?"L":"M",o,l,"A",r,r,0,i>Math.PI?1:0,a?1:0,s,u)},rect:function(e,t,r,n){this._pathcmd("M",e,t,"h",r,"v",n,"h",-r,"z")},_cmd:function(e){1!==this.globalAlpha?(this._body.push('<g opacity="'+this.globalAlpha+'">'),this._body.push(e),this._body.push("</g>")):this._body.push(e)},_attrs:function(e){var t,r="";for(t in e)null!==e[t]&&(r+=" "+t+'="'+e[t]+'"');return r},fill:function(){this._cmd("<path"+this._attrs({d:this._path.join(" "),fill:this._fill,"fill-opacity":this._fillOpacity})+"/>")},stroke:function(){this._cmd("<path"+this._attrs({d:this._path.join(" "),stroke:this._stroke,"stroke-opacity":this._strokeOpacity,"stroke-width":this.lineWidth,"stroke-linecap":this.lineCap,"stroke-linejoin":this.lineJoin,"stroke-miterlimit":"miter"===this.lineJoin?this.miterLimit:null})+"/>")},clip:function(){++this._clipIndex,this._body.push('<clipPath id="clip'+this._clipIndex+'"><path d="'+this._path.join(" ")+'"/></clipPath>','<g clip-path="url(#clip'+this._clipIndex+')">'),this._saveStack[this._saveStack.length-1]+="</g>"},save:function(){this._saveStack.push("")},restore:function(){this._body.push(this._saveStack.pop()),0===this._saveStack.length&&this._saveStack.push("")},_transform:function(e){this._body.push('<g transform="'+e+'">'),this._saveStack[this._saveStack.length-1]+="</g>"},translate:function(e,t){this._transform("translate("+e+" "+t+")")},rotate:function(e){this._transform("rotate("+Math.PI/180*e+")")},scale:function(e,t){this._transform("scale("+e+" "+t+")")},transform:function(e,t,r,n,i,a){this._transform("matrix("+[e,t,r,n,i,a].join(" ")+")")},drawImage:function(e,t,r){if(3!==arguments.length)throw Error("SvgWriterContext only supports 3-argument version of drawImage");var n=this._imgcache.indexOf(e);if(-1===n){n=this._imgcache.length;var i=e.cachedDataURL?e.cachedDataURL:xe(e);this._defs.push('<image id="img'+n+'" x="0" y="0" width="'+e.width+'" height="'+e.height+'" xlink:href="'+i+'"/>'),this._imgcache.push(e)}this._cmd('<use x="'+t+'" y="'+r+'" xlink:href="#img'+n+'"/>')},toBlob:function(){for(;1<this._saveStack.length||""!==this._saveStack[0];)this.restore();var e='<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="'+this.width+'px" height="'+this.height+'px">\n'+this._defs.join("\n")+'\n</defs>\n<g stroke="none" fill="none">\n'+this._body.join("\n")+"\n</g>\n</svg>\n";return new Blob([e],{type:"image/svg+xml"})}},be.prototype={_cmd:function(){this._body.push(Array.prototype.join.call(arguments," "))},_setAlpha:function(e,t,r){var n=Math.round(255*e*this._globalAlpha);return t+=n,this._extGState[t]="<< /"+r+" "+n/255+" >>",this._cmd("/"+t,"gs"),e},set globalAlpha(e){this._globalAlpha=e,this._setAlpha(this._strokeAlpha,"As","CA"),this._setAlpha(this._fillAlpha,"Af","ca")},set fillStyle(e){var t=this;Pe(e,(function(e,r,n,i){t._cmd(e/255,r/255,n/255,"rg"),t._setAlpha(t._fillAlpha=i,"Af","ca")}))},set strokeStyle(e){var t=this;Pe(e,(function(e,r,n,i){t._cmd(e/255,r/255,n/255,"RG"),t._setAlpha(t._strokeAlpha=i,"As","CA")}))},set lineWidth(e){this._cmd(e,"w")},set lineCap(e){this._cmd({butt:0,round:1,square:2}[e],"J")},set lineJoin(e){this._cmd({miter:0,round:1,bevel:2}[e],"j")},set miterLimit(e){this._cmd(e,"M")},clearRect:function(){},beginPath:function(){this._pathUsed=!1},closePath:function(){this._cmd("h")},moveTo:function(e,t){this._cmd(this._xPos=e,this._yPos=-t,"m")},lineTo:function(e,t){this._cmd(this._xPos=e,this._yPos=-t,"l")},bezierCurveTo:function(e,t,r,n,i,a){this._cmd(e,-t,r,-n,this._xPos=i,this._yPos=-a,"c")},quadraticCurveTo:function(e,t,r,n){this.bezierCurveTo((2*e+this._xPos)/3,(2*t-this._yPos)/3,(r+2*e)/3,(n+2*t)/3,r,n)},_kappa:.5522847498307935,arc:function(e,t,r,n,i,a){if(0!==n||i!==2*Math.PI)throw Error("PdfWriterContext.arc only supports full circles");n=this._kappa*r,this.moveTo(e+r,t),this.bezierCurveTo(e+r,t+n,e+n,t+r,e,t+r),this.bezierCurveTo(e-n,t+r,e-r,t+n,e-r,t),this.bezierCurveTo(e-r,t-n,e-n,t-r,e,t-r),this.bezierCurveTo(e+n,t-r,e+r,t-n,e+r,t)},rect:function(e,t,r,n){this._cmd(e,-t,r,-n,"re")},_usePath:function(e){if(this._pathUsed){var t=this._body[this._pathUsed],r={"S + f":"B","f + S":"B","W n + S":"W S","W n + f":"W f","S + W n":"W S","f + W n":"W f","B + W n":"W B","W S + f":"W B","W f + S":"W B"}[t+" + "+e];if(!r)throw Error("Don't know how to combine '"+t+"' and '"+e+"'");this._body.splice(this._pathUsed,1),e=r}this._pathUsed=this._body.length,this._cmd(e)},fill:function(){this._usePath("f")},stroke:function(){this._usePath("S")},clip:function(){this._usePath("W n")},save:function(){this._cmd("q")},restore:function(){this._cmd("Q")},translate:function(e,t){this.transform(1,0,0,1,e,t)},rotate:function(e){var t=Math.cos(e);e=Math.sin(e),this.transform(t,e,-e,t,0,0)},scale:function(e,t){this.transform(e,0,0,t,0,0)},transform:function(e,t,r,n,i,a){this._cmd(e,-t,-r,n,i,-a,"cm")},_png:function(e){if("data:image/png;base64,"!==e.substr(0,22))return{error:"Not a base64-encoded PNG file"};e=function(e){e=e.replace(/[^ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/]+/g,"");var t,r,n=new Uint8Array(3*e.length>>2);for(r=t=0;t+3<e.length;t+=4){var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e.charAt(t)),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e.charAt(t+1)),o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e.charAt(t+2)),l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e.charAt(t+3));n[r++]=i<<2|a>>4,n[r++]=a<<4|o>>2,n[r++]=o<<6|l}switch(e.length-t){case 0:break;case 2:i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e.charAt(t)),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e.charAt(t+1)),n[r++]=i<<2|a>>4;break;case 3:i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e.charAt(t)),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e.charAt(t+1)),o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e.charAt(t+2)),n[r++]=i<<2|a>>4,n[r++]=a<<4|o>>2;break;default:throw Error("Malformed Base64 input: "+(e.length-t)+" chars left: "+e.substr(t))}if(r!==n.length)throw Error("Failed assertion: "+r+" should be "+n.length);return n}(e.substr(22));var t=function(e){function t(t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}if(57>e.length)throw Error("Too short to be a PNG file");if(2303741511!==t(0)||218765834!==t(4))throw Error("PNG signature missing");for(var r=[],n=8;n<e.length;){if(n+12>e.length)throw Error("Incomplete chunk at offset 0x"+n.toString(16));var i=t(n);if(2147483648<=i)throw Error("Chunk too long");var a=n+12+i;if(a>e.length)throw Error("Incomplete chunk at offset 0x"+n.toString(16));var o=e.subarray(n+4,n+8);o=String.fromCharCode.apply(String,o),r.push({len:i,type:o,data:e.subarray(n+8,n+8+i),crc:t(n+8+i)}),n=a}return r}(e);if(console.log("PNG chunks:",t.map((function(e){return e.type}))),"IHDR"!==t[0].type)throw Error("Image does not start with an IHDR");var r=t[0].data;e=(r[0]<<24|r[1]<<16|r[2]<<8|r[3])>>>0;var n=(r[4]<<24|r[5]<<16|r[6]<<8|r[7])>>>0,i=r[8],a=r[9],o=0==(2&a),l=0!=(4&a),s=r[10],u=r[11];if(r=r[12],0!==s)throw Error("Unsupported PNG compression method: "+s);if(0!==u)throw Error("Unsupported PNG filter method: "+u);if(0!==r)return{error:"Interlaced image not supported"};if(0!=(1&a))return{error:"Indexed PNG image not supported"};if(u=null,a=o?1:3,s=t.filter((function(e){return"IDAT"===e.type})).map((function(e){return e.data})),l){for(u=new(l=window.pako).Inflate,t=0;t<s.length;++t)u.push(s[t],t+1===s.length);if(u.err)throw Error(u.err);if(r=i>>>3,(u=u.result).length!==n*(e*(a+1)*r+1))throw Error("Data length mismatch");var c=a*r;s=new Uint8Array(n*(e*c+1));for(var p=new Uint8Array(n*(e*r+1)),f=0,h=0,v=0,d=0;d<n;++d){s[h++]=p[v++]=u[f++];for(var m=0;m<e;++m){for(t=0;t<c;++t)s[h++]=u[f++];for(t=0;t<r;++t)p[v++]=u[f++]}}if(f!==u.length||h!==s.length||v!==p.length)throw Error("Seems we garbled our index computation somehow");p=l.deflate(p),u=this._strm({Type:"/XObject",Subtype:"/Image",Width:e,Height:n,ColorSpace:"/DeviceGray",BitsPerComponent:i,Filter:"/FlateDecode",DecodeParms:this._dict({Predictor:15,Colors:1,BitsPerComponent:i,Columns:e})},p).ref,s=[l.deflate(s)]}var g=0;return s.forEach((function(e){g+=e.length})),this._obj([this._dict({Type:"/XObject",Subtype:"/Image",Name:"/img"+this._imgcache.length,Width:e,Height:n,ColorSpace:o?"/DeviceGray":"/DeviceRGB",SMask:u,BitsPerComponent:i,Length:g,Filter:"/FlateDecode",DecodeParms:this._dict({Predictor:15,Colors:a,BitsPerComponent:i,Columns:e})}),"\nstream\n"].concat(s,["\nendstream"]))},drawImage:function(e,t,r){if(3!==arguments.length)throw Error("PdfWriterContext only supports 3-argument version of drawImage");var n=this._imgcache.indexOf(e);if(-1===n){n=this._imgcache.length,this._imgcache.push(e);var i=this._png(e.cachedDataURL||"");if(i.hasOwnProperty("error")&&(i=this._png(xe(e))),i.hasOwnProperty("error"))throw Error(i.error);this._xobjects["img"+n]=i.ref}this._cmd("q"),this._setAlpha(1,"Af","ca"),this._cmd(e.width,0,0,e.height,t,-r-e.height,"cm"),this._cmd("/img"+n,"Do"),this._cmd("Q")},_dict:function(e){var t,r="<<";for(t in e)r+=" /"+t+" "+e[t];return r+" >>"},_obj:function(e,t){t||(t=this._nextIndex++),Array.isArray(e)||(e=[this._dict(e)]),e.index=t,e.ref=t+" 0 R",e.offset=this._offset;var r=0;for(e.unshift(t+" 0 obj\n"),e.push("\nendobj\n"),t=0;t<e.length;++t)r+=e[t].length;return this._offset+=r,this._objects.push(e),e},_strm:function(e,t,r){return e.Length=t.length,this._obj([this._dict(e),"\nstream\n",t,"\nendstream"],r)},toBlob:function(){var e="["+[0,-this.height,this.width,0].join(" ")+"]";this._obj({Type:"/Catalog",Pages:"2 0 R"},1),this._obj({Type:"/Pages",Kids:"[3 0 R]",Count:1},2),this._obj({Type:"/Page",Parent:"2 0 R",MediaBox:e,Contents:"4 0 R",Resources:this._dict({ProcSet:"[/PDF /Text /ImageB /ImageC /ImageI]",XObject:this._dict(this._xobjects),ExtGState:this._dict(this._extGState)})},3);var t=this._body.join("\n"),r=new Uint8Array(t.length);for(e=0;e<t.length;++e)r[e]=255&t.charCodeAt(e);t=window.pako.deflate(r),this._strm({Filter:"/FlateDecode"},t,4),t=this._objects;var n=[];for(e=1;e<t.length;++e)n[t[e].index]=t[e];for(r="xref\n0 "+n.length+"\n",e=0;e<n.length;++e)r=n[e]?r+(Ce(String(n[e].offset),10)+" 00000 n \n"):r+"0000000000 65535 f \n";return e="trailer\n"+this._dict({Size:n.length,Root:"1 0 R"})+"\nstartxref\n"+this._offset+"\n%%EOF\n",(t=Array.prototype.concat.apply([],t)).push(r,e),new Blob(t,{type:"application/pdf"})}};var mn=null;lr.push(_e),ur.exportSVG=function(){we(ye)},ur.exportPDF=function(){kt.loadScript("pako","pako.min.js",(function(){we(be)}))},ur.exportPNG=function(){yn(Lt.canvas.toDataURL())};var gn,yn=function(e){var t=document.createElement("a");document.body.appendChild(t),t.style="display: none",t.href=e,t.download="CindyJSExport",t.click(),setTimeout((function(){document.body.removeChild(t),_e()}),100)},bn="Move",xn=[],Pn=0,Cn=0,_n=0,wn={Delete:{}};wn.Delete.actions=[],wn.Delete.actions[0]={},wn.Delete.actions[0].event="mousedown",wn.Delete.actions[0].tooltip="...",wn.Delete.actions[0].do=function(){return null!==(fr=Se(hr))&&Ue(fr.mover.name),!0},wn.Move={},wn.Move.actions=[],wn.Move.actions[0]={},wn.Move.actions[0].event="mousedown",wn.Move.actions[0].tooltip="Move free elements by dragging the mouse",wn.Move.actions[0].do=function(){for(var e,t=hr,r=null,n=1e6,i=0;i<At.free.length;i++){var a=At.free[i];if(!a.pinned&&!1!==a.visible&&!0!==a.tmp){var o=In.drawingstate.matrix.sdet;if("P"===a.kind){var l=Ir.normalizeZ(a.homog);if(!Ir._helper.isAlmostReal(l))continue;var s=l.value[0].value.real-t.x;l=l.value[1].value.real-t.y;var u=Math.sqrt(s*s+l*l);if(a.narrow&&u>("number"==typeof a.narrow?a.narrow:20)/o)continue}else if("C"===a.kind){if(l=Ir.normalizeZ(At.csnames[a.args[0]].homog),s=a.radius,!Ir._helper.isAlmostReal(l)||!Cr._helper.isAlmostReal(s))continue;u=l.value[0].value.real;var c=l.value[1].value.real;l=t.x-u;var p=t.y-c,f=Math.sqrt(l*l+p*p);if(0===f)continue;if(c+=p/f*s.value.real,s=u+l/f*s.value.real-t.x,l=c-t.y,u=Math.sqrt(s*s+l*l),u+=30/o,a.narrow&&u>(("number"==typeof a.narrow?a.narrow:20)+30)/o)continue}else if("L"===a.kind)s=a.homog,l=(u=Cr).add(u.mult(s.value[0],u.conjugate(s.value[0])),u.mult(s.value[1],u.conjugate(s.value[1]))),l=Ir.scaldiv(u.sqrt(l),s),u=l.value[0].value.real*t.x+l.value[1].value.real*t.y+l.value[2].value.real,s=-l.value[0].value.real*u,l=-l.value[1].value.real*u,0>u&&(u=-u),u+=25/o;else{if("Text"!==a.kind)continue;if(!a.homog||a.dock||!a._bbox)continue;if(l=In.from(t.x,t.y,1),s=Math.max(0,l[0]-a._bbox.right,a._bbox.left-l[0]),l=Math.max(0,l[1]-a._bbox.bottom,a._bbox.top-l[1]),20<(u=Math.sqrt(s*s+l*l)))continue;if(u/=o,l=Ir.normalizeZ(a.homog),!Ir._helper.isAlmostReal(l))continue;s=l.value[0].value.real-t.x,l=l.value[1].value.real-t.y}u<n+.2/o&&(n=u,r=a,e={x:s,y:l})}}return console.log("Moving "+(r?r.name:"nothing")),fr=null===r?null:{mover:r,offset:e,prev:{x:t.x,y:t.y}},!0},wn.Point={},wn.Point.actions=[],wn.Point.actions[0]={},wn.Point.actions[0].event="mousedown",wn.Point.actions[0].tooltip="Add a single point with the mouse",wn.Point.actions[0].do=function(){return Ye({type:"Free",name:Te(),labeled:!0,pos:[It[0],It[1],1]}),!0},wn.Mid={},wn.Mid.actions=[],wn.Mid.actions[0]={},wn.Mid.actions[0].event="mousedown",wn.Mid.actions[0].tooltip="Construct two points and their midpoint by dragging",wn.Mid.actions[0].do=function(){return Ae(),!0},wn.Mid.actions[1]={},wn.Mid.actions[1].event="mousemove",wn.Mid.actions[1].do=function(){return ze("Mid"),!0},wn.Mid.actions[2]={},wn.Mid.actions[2].event="mouseup",wn.Mid.actions[2].do=function(){return Re(),!0},wn.Circle={},wn.Circle.actions=[],wn.Circle.actions[0]={},wn.Circle.actions[0].event="mousedown",wn.Circle.actions[0].tooltip="Construct two points and a circle by dragging the mouse",wn.Circle.actions[0].do=function(){return Ae(),!0},wn.Circle.actions[1]={},wn.Circle.actions[1].event="mousemove",wn.Circle.actions[1].do=function(){return ze("CircleMP"),!0},wn.Circle.actions[2]={},wn.Circle.actions[2].event="mouseup",wn.Circle.actions[2].do=function(){return Re(),!0},wn.Compass={},wn.Compass.actions=[],wn.Compass.actions[0]={},wn.Compass.actions[0].event="mousedown",wn.Compass.actions[0].tooltip="...",wn.Compass.actions[0].do=function(){return Ae(),!0},wn.Compass.actions[1]={},wn.Compass.actions[1].event="mousedown",wn.Compass.actions[1].tooltip="...",wn.Compass.actions[1].do=function(){return Ae(),!0},wn.Compass.actions[2]={},wn.Compass.actions[2].event="mousedown",wn.Compass.actions[2].tooltip="...",wn.Compass.actions[2].do=function(){return Ae(),Ye({type:"Compass",name:Te(),labeled:!0,args:[xn[0].name,xn[1].name,xn[2].name]}),!0},wn.Line={},wn.Line.actions=[],wn.Line.actions[0]={},wn.Line.actions[0].event="mousedown",wn.Line.actions[0].tooltip="Construct two points and their connecting line by dragging the mouse",wn.Line.actions[0].do=function(){return Ae(),!0},wn.Line.actions[1]={},wn.Line.actions[1].event="mousemove",wn.Line.actions[1].do=function(){return ze("Join"),!0},wn.Line.actions[2]={},wn.Line.actions[2].event="mouseup",wn.Line.actions[2].do=function(){return Re(),!0},wn.Segment={},wn.Segment.actions=[],wn.Segment.actions[0]={},wn.Segment.actions[0].event="mousedown",wn.Segment.actions[0].tooltip="Draw a segment by dragging the mouse",wn.Segment.actions[0].do=function(){return Ae(),!0},wn.Segment.actions[1]={},wn.Segment.actions[1].event="mousemove",wn.Segment.actions[1].do=function(){return ze("Segment"),!0},wn.Segment.actions[2]={},wn.Segment.actions[2].event="mouseup",wn.Segment.actions[2].do=function(){return Re(),!0},wn.Parallel={},wn.Parallel.actions=[],wn.Parallel.actions[0]={},wn.Parallel.actions[0].event="mousedown",wn.Parallel.actions[0].tooltip="Construct a parallel line by dragging a line",wn.Parallel.actions[0].do=function(){return Ne()},wn.Parallel.actions[1]={},wn.Parallel.actions[1].event="mousemove",wn.Parallel.actions[1].do=function(){var e={type:"Free",name:Te(),labeled:!0,pos:[It[0],It[1],1],tmp:!0};return e=Ye(e),gn=Ye({type:"Para",name:Te(),labeled:!0,args:[xn[0].name,e.name]}),Oe(e),!0},wn.Parallel.actions[2]={},wn.Parallel.actions[2].event="mouseup",wn.Parallel.actions[2].do=function(){return Re(),!0},wn.Orthogonal={},wn.Orthogonal.actions=[],wn.Orthogonal.actions[0]={},wn.Orthogonal.actions[0].event="mousedown",wn.Orthogonal.actions[0].tooltip="Construct a orthogonal line by dragging a line",wn.Orthogonal.actions[0].do=function(){if(Ne()){var e={type:"Free",name:Te(),labeled:!0,pos:[It[0],It[1],1],tmp:!0};return e=Ye(e),gn=Ye({type:"Perp",name:Te(),labeled:!0,args:[xn[0].name,e.name]}),Oe(e),!0}return!1},wn.Orthogonal.actions[1]={},wn.Orthogonal.actions[1].event="mouseup",wn.Orthogonal.actions[1].do=function(){return Re(),!0},wn.Intersection={},wn.Intersection.actions=[],wn.Intersection.actions[0]={},wn.Intersection.actions[0].event="mousedown",wn.Intersection.actions[0].tooltip="Select two elements to define their intersection",wn.Intersection.actions[0].do=function(){return ke()},wn.Intersection.actions[1]={},wn.Intersection.actions[1].event="mousedown",wn.Intersection.actions[1].do=function(){return!!ke()&&(gn=Ye({type:"Meet",name:Te(),labeled:!0,args:[xn[0].name,xn[1].name]}),!0)};var Sn=function(e){e?(this._e=[],this._e[0]=e[0][0],this._e[1]=e[1][0],this._e[2]=e[2][0],this._e[3]=e[0][1],this._e[4]=e[1][1],this._e[5]=e[2][1],this._e[6]=e[0][2],this._e[7]=e[1][2],this._e[8]=e[2][2]):this._e=[1,0,0,0,1,0,0,0,1]};Sn.prototype.clone=function(){var e=[].concat(l.arrayFromIterable(this._e)),t=new Sn;return t.set(e),t},Sn.prototype.get=function(e){return this._e[e]},Sn.prototype.getRow=function(e){var t=this._e;return[t[e],t[3+e],t[6+e]]},Sn.prototype.set=function(e,t){1===arguments.length&&(this._e=e),2===arguments.length&&(this._e[e]=t)},Sn.prototype.exchange=function(e,t){var r=l.makeIterator([this._e[t],this._e[e]]);this._e[e]=r.next().value,this._e[t]=r.next().value},Sn.prototype.inverse=function(){var e=this._e,t=-e[2]*e[4]*e[6]+e[1]*e[5]*e[6]+e[2]*e[3]*e[7]-e[0]*e[5]*e[7]-e[1]*e[3]*e[8]+e[0]*e[4]*e[8];return e=[-e[4]*e[7]+e[4]*e[8],e[5]*e[6]-e[3]*e[8],-e[4]*e[6]+e[3]*e[7],e[2]*e[7]-e[1]*e[8],-e[2]*e[6]+e[0]*e[8],e[1]*e[6]-e[0]*e[7],-e[2]*e[4]+e[1]*e[5],e[2]*e[3]-e[0]*e[5],-e[1]*e[3]+e[0]*e[4]],1e-10>Math.abs(t)&&console.log("PSLQ: inverting singular matrix!"),this._e=e.map((function(e){return e/t})),this},Sn.prototype.swRow=function(e,t){for(var r=0;9>r;)this.exchange(r+e,r+t),r+=3},Sn.prototype.swCol=function(e,t){for(var r=0;3>r;++r)this.exchange(3*e+r,3*t+r)},Sn.mult=function(e,t,r){e=[e.get(0)*t.get(0)+e.get(3)*t.get(1)+e.get(6)*t.get(2),e.get(1)*t.get(0)+e.get(4)*t.get(1)+e.get(7)*t.get(2),e.get(2)*t.get(0)+e.get(5)*t.get(1)+e.get(8)*t.get(2),e.get(0)*t.get(3)+e.get(3)*t.get(4)+e.get(6)*t.get(5),e.get(1)*t.get(3)+e.get(4)*t.get(4)+e.get(7)*t.get(5),e.get(2)*t.get(3)+e.get(5)*t.get(4)+e.get(8)*t.get(5),e.get(0)*t.get(6)+e.get(3)*t.get(7)+e.get(6)*t.get(8),e.get(1)*t.get(6)+e.get(4)*t.get(7)+e.get(7)*t.get(8),e.get(2)*t.get(6)+e.get(5)*t.get(7)+e.get(8)*t.get(8)],r.set(e)},Sn.prototype.getString=function(){var e=this._e;return"/"+e[0]+"\t "+e[3]+"\t "+e[6]+"\\\n|"+e[1]+"\t "+e[4]+"\t "+e[7]+"|\n\\"+e[2]+"\t "+e[5]+"\t "+e[8]+"/\n"},Sn.prototype.transpose=function(){return this.exchange(1,3),this.exchange(2,6),this.exchange(5,7),this},Sn.VMmult=function(e,t,r){r[0]=t.get(0)*e[0]+t.get(1)*e[1]+t.get(2)*e[2],r[1]=t.get(3)*e[0]+t.get(4)*e[1]+t.get(5)*e[2],r[2]=t.get(6)*e[0]+t.get(7)*e[1]+t.get(8)*e[2]};var Tn=function(){};Tn.dot=function(e,t){for(var r=0,n=0;n<e.length;n++)r+=e[n]*t[n];return r},Tn.scale=function(e,t){for(var r=0;r<e.length;++r)e[r]*=t},Tn.maxIndex=function(e){for(var t=0,r=1;r<e.length;++r)e[r]>e[t]&&(t=r);return t},Tn.hermiteReduce=function(e){for(var t,r=[[1,0,0],[0,1,0],[0,0,1]],n=e.length,i=e.map((function(e){return[].concat(l.arrayFromIterable(e))})),a=1;a<n;a++)for(var o=a-1;0<=o;o--){t=Math.round(e[a][o]/e[o][o]);for(var s=0;s<=o;s++)i[a][s]-=t*i[o][s];for(s=0;s<n;s++)r[a][s]-=t*r[o][s]}for(n=0;3>n;n++)e[n]=i[n];return new Sn(r)},Tn.doPSLQ=function(e,t){for(var r=e.length,n=[],i=[],a=0;a<r;++a){n[a]=e[a]/Math.sqrt(Tn.dot(e,e));for(var o=0,s=a;s<r;++s)o+=Math.pow(e[s],2);i[a]=Math.sqrt(o)}for(Tn.scale(i,1/i[0]),a=new Sn,e=new Sn,o=[],s=0;s<r;s++)o[s]=[];for(s=0;s<r;++s)for(var u=0;u<r-1;++u)o[s][u]=s>u?-n[s]*n[u]/i[u]/i[u+1]:s===u?i[s+1]/i[s]:0;for(u=(s=Tn.hermiteReduce(o)).clone().inverse().transpose(),Sn.VMmult(n,u,n),Sn.mult(s,a,a),Sn.mult(e,u,e),i=0;i<Tn.MAX_ITER;++i){u=[o[0][0],o[1][1]],s=0,Math.pow(this.GAMMA,2)*Math.abs(u[1])>Math.pow(this.GAMMA,1)*Math.abs(u[0])&&(s=1);var c=u=0,p=0;s<r-2&&(u=o[s+1][s],c=o[s+1][s+1],p=Math.sqrt(Math.pow(u,2)+Math.pow(c,2)));var f=n[s];n[s]=n[s+1],n[s+1]=f,f=[].concat(l.arrayFromIterable(o[s])),o[s]=o[s+1],o[s+1]=f,a.swRow(s,s+1),e.swCol(s,s+1),f=Array(2);for(var h=0;3>h;h++)f[h]=[];if(s<r-2){for(h=0;h<r-1;++h)for(var v=0;v<r-1;++v)f[h][v]=h===s&&v===s?u/p:h===s&&v===s+1?-c/p:h===s+1&&v===s?c/p:h===s+1&&v===s+1?u/p:h===v&&v!==s||h===v&&v!==s+1?1:0;o=[[o[0][0]*f[0][0]+o[0][1]*f[1][0],o[0][0]*f[0][1]+o[0][1]*f[1][1]],[o[1][0]*f[0][0]+o[1][1]*f[1][0],o[1][0]*f[0][1]+o[1][1]*f[1][1]],[o[2][0]*f[0][0]+o[2][1]*f[1][0],o[2][0]*f[0][1]+o[2][1]*f[1][1]]]}for(u=(s=Tn.hermiteReduce(o)).clone().inverse().transpose(),Sn.VMmult(n,u,n),Sn.mult(s,a,a),Sn.mult(e,u,e),s=[n[0],n[1],n[2],o[0][0],o[1][1]],u=0;u<s.length;++u)if(Math.abs(s[u])<=Math.pow(10,5-t)){for(e.transpose(),t=0;t<n.length;++t)n[t]=-Math.abs(n[t]);return e.getRow(Tn.maxIndex(n))}}},l.global.Object.defineProperties(Tn,{MAX_ITER:{configurable:!0,enumerable:!0,get:function(){return 20}},GAMMA:{configurable:!0,enumerable:!0,get:function(){return 2/Math.sqrt(3)}}});var Mn={},In={drawingstate:{}};In.drawingstate.linecolor="rgb(0,0,255)",In.drawingstate.linecolorraw=[0,0,1],In.drawingstate.pointcolor="rgb(0,255,0)",In.drawingstate.pointcolorraw=[0,1,0],In.drawingstate.textcolor="rgb(0,0,0)",In.drawingstate.textcolorraw=[0,0,0],In.drawingstate.alpha=1,In.drawingstate.pointsize=4,In.drawingstate.linesize=1,In.drawingstate.textsize=null,In.drawingstate.matrix={},In.drawingstate.matrix.a=25,In.drawingstate.matrix.b=0,In.drawingstate.matrix.c=0,In.drawingstate.matrix.d=25,In.drawingstate.matrix.tx=250.5,In.drawingstate.matrix.ty=250.5,In.drawingstate.matrix.det=In.drawingstate.matrix.a*In.drawingstate.matrix.d-In.drawingstate.matrix.b*In.drawingstate.matrix.c,In.drawingstate.matrix.sdet=Math.sqrt(In.drawingstate.matrix.det),In.drawingstate.initialmatrix={},In.drawingstate.initialmatrix.a=In.drawingstate.matrix.a,In.drawingstate.initialmatrix.b=In.drawingstate.matrix.b,In.drawingstate.initialmatrix.c=In.drawingstate.matrix.c,In.drawingstate.initialmatrix.d=In.drawingstate.matrix.d,In.drawingstate.initialmatrix.tx=In.drawingstate.matrix.tx,In.drawingstate.initialmatrix.ty=In.drawingstate.matrix.ty,In.drawingstate.initialmatrix.det=In.drawingstate.matrix.det,In.drawingstate.initialmatrix.sdet=In.drawingstate.matrix.sdet,In.clone=function(e){if(null===e||"object"!=typeof e)return e;var t,r=e.constructor();for(t in e)r[t]=In.clone(e[t]);return r},Mn.backup=In.clone(In.drawingstate),Mn.stack=[],In.clone(In.drawingstate),In.reset=function(){In.drawingstate.matrix.a=In.drawingstate.initialmatrix.a,In.drawingstate.matrix.b=In.drawingstate.initialmatrix.b,In.drawingstate.matrix.c=In.drawingstate.initialmatrix.c,In.drawingstate.matrix.d=In.drawingstate.initialmatrix.d,In.drawingstate.matrix.tx=In.drawingstate.initialmatrix.tx,In.drawingstate.matrix.ty=In.drawingstate.initialmatrix.ty,In.drawingstate.matrix.det=In.drawingstate.initialmatrix.det,In.drawingstate.matrix.sdet=In.drawingstate.initialmatrix.sdet},In.from=function(e,t,r){return t/=r,[((e/=r)*(r=In.drawingstate.matrix).a-t*r.b+r.tx)/Kt,(e*r.c-t*r.d-r.ty)/Kt]},In.to=function(e,t){var r=In.drawingstate.matrix;return e=e*Kt-r.tx,t=t*Kt+r.ty,[(e*r.d-t*r.b)/r.det,-(-e*r.c+t*r.a)/r.det,1]},In.toMat=function(){var e=In.drawingstate.matrix;return Ir.realMatrix([[e.d,-e.b,-e.tx*e.d-e.ty*e.b],[e.c,-e.a,-e.tx*e.c-e.ty*e.a],[0,0,e.det]])},In.dumpTrafo=function(){function e(e){return Math.round(1e3*e)/1e3}var t=In.drawingstate.matrix;console.log("a:"+e(t.a)+" b:"+e(t.b)+" c:"+e(t.c)+" d:"+e(t.d)+" tx:"+e(t.ty)+" ty:"+e(t.tx))},In.setMat=function(e,t,r,n,i,a){var o=In.drawingstate.matrix;o.a=e,o.b=t,o.c=r,o.d=n,o.tx=i,o.ty=a,o.det=e*n-t*r,o.sdet=Math.sqrt(o.det)},In.scaleAndOrigin=function(e,t,r){In.setMat(e,0,0,e,t,r)},In.visibleRect=function(e,t,r,n){var i=r-e,a=t-n;i=Et*a<Ot*i?Et/i:Ot/a,In.setMat(i,0,0,i,(Et-i*(e+r))/2,(Ot-i*(t+n))/2)},In.applyMat=function(e,t,r,n,i,a){var o=In.drawingstate.matrix;In.setMat(o.a*e+o.c*t,o.b*e+o.d*t,o.a*r+o.c*n,o.b*r+o.d*n,o.a*i+o.c*a+o.tx,o.b*i+o.d*a+o.ty)},In.translate=function(e,t){In.applyMat(1,0,0,1,e,t)},In.rotate=function(e){var t=Math.cos(e);e=Math.sin(e),In.applyMat(t,e,-e,t,0,0)},In.scale=function(e){In.applyMat(e,0,0,e,0,0)},In.gsave=function(){Mn.stack.push(In.clone(In.drawingstate))},In.grestore=function(){0!==Mn.stack.length&&(In.drawingstate=Mn.stack.pop())},In.greset=function(){In.drawingstate=In.clone(Mn.backup),In.drawingstate.matrix.ty-=Ot,In.drawingstate.initialmatrix.ty-=Ot,Mn.stack=[]},In.createnewbackup=function(){In.drawingstate.initialmatrix.a=In.drawingstate.matrix.a,In.drawingstate.initialmatrix.b=In.drawingstate.matrix.b,In.drawingstate.initialmatrix.c=In.drawingstate.matrix.c,In.drawingstate.initialmatrix.d=In.drawingstate.matrix.d,In.drawingstate.initialmatrix.tx=In.drawingstate.matrix.tx,In.drawingstate.initialmatrix.ty=In.drawingstate.matrix.ty,In.drawingstate.initialmatrix.det=In.drawingstate.matrix.det,In.drawingstate.initialmatrix.sdet=In.drawingstate.matrix.sdet,Mn.backup=In.clone(In.drawingstate)},In.makecolor=function(e,t,r){return e=Math.floor(255*e),t=Math.floor(255*t),r=Math.floor(255*r),1===In.drawingstate.alpha?"rgb("+e+","+t+","+r+")":"rgba("+e+","+t+","+r+","+In.drawingstate.alpha+")"},In.setcolor=function(e){var t=e.value[0].value.real,r=e.value[1].value.real;e=e.value[2].value.real,In.drawingstate.linecolor=In.drawingstate.pointcolor=In.makecolor(t,r,e),In.drawingstate.linecolorraw=In.drawingstate.pointcolorraw=[t,r,e]},In.setlinecolor=function(e){var t=e.value[0].value.real,r=e.value[1].value.real;e=e.value[2].value.real,In.drawingstate.linecolor=In.makecolor(t,r,e),In.drawingstate.linecolorraw=[t,r,e]},In.settextcolor=function(e){var t=e.value[0].value.real,r=e.value[1].value.real;e=e.value[2].value.real,In.drawingstate.textcolor=In.makecolor(t,r,e),In.drawingstate.textcolorraw=[t,r,e]},In.setpointcolor=function(e){var t=e.value[0].value.real,r=e.value[1].value.real;e=e.value[2].value.real,In.drawingstate.pointcolor=In.makecolor(t,r,e),In.drawingstate.pointcolorraw=[t,r,e]},In.setalpha=function(e){In.drawingstate.alpha=e.value.real,In.drawingstate.linecolor=In.makecolor(In.drawingstate.linecolorraw[0],In.drawingstate.linecolorraw[1],In.drawingstate.linecolorraw[2]),In.drawingstate.pointcolor=In.makecolor(In.drawingstate.pointcolorraw[0],In.drawingstate.pointcolorraw[1],In.drawingstate.pointcolorraw[2]),In.drawingstate.textcolor=In.makecolor(In.drawingstate.textcolorraw[0],In.drawingstate.textcolorraw[1],In.drawingstate.textcolorraw[2])},In.setpointsize=function(e){In.drawingstate.pointsize=e.value.real},In.setlinesize=function(e){In.drawingstate.linesize=e.value.real},In.settextsize=function(e){In.drawingstate.textsize=e.value.real};var Ln={clip:"none",pointColor:[1,0,0],lineColor:[0,0,1],pointSize:5,lineSize:1,alpha:1,overhangLine:1,overhangSeg:1,dimDependent:.7,fontFamily:"sans-serif",textColor:[0,0,0],textsize:20,noborder:!1,lineHeight:1.45};e.defaultAppearance&&function(e){for(var t in e)null!==e[t]&&(Ln[t]=e[t])}(e.defaultAppearance);var En={},On={UL:0,UR:1,LR:2,LL:3},An=["in","out","good","backup","prover"],Nn=new Float64Array(0),kn={};An.forEach((function(e){kn[e]=Nn}));var Rn,zn,jn,Dn,Fn,Bn=Nn,Xn=Nn,$n=Nn,Yn=!1,qn={toString:function(){return"RefineException"}},Un=null,Vn=null;e.enableTraceLog&&(Vn={logLength:1/0,fullLog:[],currentMouseAndScripts:null,currentMover:null,currentStep:null,currentElement:null,currentParam:null,labelTracing2:Or.wrap("tracing2"),labelTracing4:Or.wrap("tracing4"),labelTracingSesq:Or.wrap("tracingSesq"),postMouseHooks:[]},"number"==typeof e.enableTraceLog&&(Vn.logLength=e.enableTraceLog),ur.getTraceLog=function(){return Ir.turnIntoCSList(Vn.fullLog.slice())},ur.formatTraceLog=function(e){var t=JSON.stringify(Vn.fullLog);return e=new Blob([t],{type:e?"application/octet-stream":"application/json"}),window.URL.createObjectURL(e)},ur.addTraceHook=Vn.postMouseHooks.push.bind(Vn.postMouseHooks)),st.stateSize=12,ct.stateSize=24,ft.stateSize=24;var Wn=[];ht._helper={},ht._helper.duplicatePPLL=function(e,t){return{getInvolved:function(){return[e,t]},toString:function(){return{P:"point",L:"line"}[e.kind]+" "+e.name+" is duplicate of "+t.name},apply:mt(e,t),holds:function(){return Ir.projectiveDistMinScal(e.homog,t.homog)<Cr.epsbig}}},ht._helper.duplicatePsLs=function(e,t){return{getInvolved:function(){return[e,t]},toString:function(){return{Ps:"point set",Ls:"line set"}[e.kind]+" "+e.name+" is duplicate of "+t.name},apply:mt(e,t),holds:function(){return ht._helper.isSetEq(e.results.value,t.results.value,Ir.projectiveDistMinScal)}}},ht._helper.duplicateCC=function(e,t){return{getInvolved:function(){return[e,t]},toString:function(){return"Conic "+e.name+" is duplicate of "+t.name},apply:mt(e,t),holds:function(){return Ir.conicDist(e.matrix,t.matrix)<Cr.epsbig}}},ht._helper.duplicateCs=function(e,t){return{getInvolved:function(){return[e,t]},toString:function(){return"Conic set"+e.name+" is duplicate of "+t.name},apply:mt(e,t),holds:function(){return ht._helper.isSetEq(e.results,t.results,Ir.conicDist)}}},ht._helper.duplicateSS=function(e,t){return{getInvolved:function(){return[e,t]},toString:function(){return"Segment "+e.name+" is duplicate of "+t.name},apply:mt(e,t),holds:function(){var r=e.startpos,n=e.endpos,i=t.startpos,a=t.endpos,o=Ir.projectiveDistMinScal(r,i);return o+=Ir.projectiveDistMinScal(n,a),n=Ir.projectiveDistMinScal(n,i),n+=Ir.projectiveDistMinScal(r,a),Math.min(o,n)<Cr.epsbig}}},ht.P=function(e){At.points.forEach((function(t){e.name!==t.name&&((t=ht._helper.duplicatePPLL(e,t)).holds()&&Wn.push(t))}))},ht.Ps=function(e){At.sets.points.forEach((function(t){e.name!==t.name&&((t=ht._helper.duplicatePsLs(e,t)).holds()&&Wn.push(t))}))},ht.Ls=function(e){At.sets.lines.forEach((function(t){e.name!==t.name&&((t=ht._helper.duplicatePsLs(e,t)).holds()&&Wn.push(t))}))},ht.Cs=function(e){At.sets.conics.forEach((function(t){e.name!==t.name&&((t=ht._helper.duplicateCs(e,t)).holds()&&Wn.push(t))}))},ht.L=function(e){At.lines.forEach((function(t){e.name!==t.name&&e.kind===t.kind&&((t=ht._helper.duplicatePPLL(e,t)).holds()&&Wn.push(t))}))},ht.S=function(e){At.lines.forEach((function(t){e.name!==t.name&&"S"===t.kind&&((t=ht._helper.duplicateSS(e,t)).holds()&&Wn.push(t))}))},ht.C=function(e){At.conics.forEach((function(t){e.name!==t.name&&((t=ht._helper.duplicateCC(e,t)).holds()&&Wn.push(t))}))},ht._helper.isSetEq=function(e,t,r){if(e=e.slice(),t=t.slice(),e.length!==t.length)return!1;if(0===e.length&&0===t.length)return!0;var n=e.shift(),i=t.reduce((function(e,t,i,a){return r(t,n)<r(a[e],n)?i:e}),0);return r(t[i],n)<Cr.epsbig&&(t.splice(i,1),ht._helper.isSetEq(e,t,r))},vt.P=function(e){At.lines.forEach((function(t){(t=gt(e,t)).holds()&&Wn.push(t)})),At.conics.forEach((function(t){(t=yt(e,t)).holds()&&Wn.push(t)}))},vt.L=function(e){At.points.forEach((function(t){(t=gt(t,e)).holds()&&Wn.push(t)}))},vt.S=vt.L,vt.C=function(e){At.points.forEach((function(t){(t=yt(t,e)).holds()&&Wn.push(t)}))};var Gn={_helper:{},RandomLine:{}};Gn.RandomLine.kind="L",Gn.RandomLine.signature=[],Gn.RandomLine.updatePosition=function(e){e.homog=Ir.realVector([Math.random()-.5,Math.random()-.5,Math.random()-.5]),e.homog=Ir.normalizeMax(e.homog),e.homog=Or.withUsage(e.homog,"Line")},Gn._helper.getRandMove=function(e){e=e.homog;var t=Ir.getRandComplexVec3(-.05,.05);return{type:"homog",value:Ir.add(e,t)}},Gn._helper.getRandPointMove=function(e){var t=(e=Ir.normalizeMax(e.homog)).value[2],r=Cr.abs(t).value.real,n=Cr.real(0);return r<Cr.eps&&(n=Cr.getRandComplex(-.05,.05),t=Cr.real(1)),r=Ir.turnIntoCSList([Cr.getRandComplex(-.1,.1),Cr.getRandComplex(-.1,.1),n]),t=Ir.scalmult(t,r),{type:"homog",value:t=Ir.add(e,t)}},Gn.FreeLine={},Gn.FreeLine.kind="L",Gn.FreeLine.signature=[],Gn.FreeLine.isMovable=!0,Gn.FreeLine.initialize=function(e){lt(e=Gn._helper.initializeLine(e))},Gn.FreeLine.getParamForInput=function(e,t,r){return"mouse"===r?(e=Ir.cross(t,Ir.ez),e=Ir.cross(e,t)):e="homog"===r?t:Ir.turnIntoCSList([Cr.zero,Cr.zero,Cr.zero]),Ir.normalizeMax(e)},Gn.FreeLine.getParamFromState=function(e){return at(3)},Gn.FreeLine.putParamToState=function(e,t){lt(t)},Gn.FreeLine.updatePosition=function(e){var t=at(3);lt(t),e.homog=Or.withUsage(t,"Line")},Gn.FreeLine.getRandomMove=Gn._helper.getRandMove,Gn.FreeLine.stateSize=6,Gn.RandomPoint={},Gn.RandomPoint.kind="P",Gn.RandomPoint.signature=[],Gn.RandomPoint.updatePosition=function(e){e.homog=Ir.realVector([100*Math.random(),100*Math.random(),100*Math.random()]),e.homog=Ir.normalizeMax(e.homog),e.homog=Or.withUsage(e.homog,"Point")},Gn.Join={},Gn.Join.kind="L",Gn.Join.signature=["P","P"],Gn.Join.updatePosition=function(e){e.homog=Ir.cross(At.csnames[e.args[0]].homog,At.csnames[e.args[1]].homog),e.homog=Ir.normalizeMax(e.homog),e.homog=Or.withUsage(e.homog,"Line")},Gn.Segment={},Gn.Segment.kind="S",Gn.Segment.signature=["P","P"],Gn.Segment.updatePosition=function(e){var t=At.csnames[e.args[0]],r=At.csnames[e.args[1]];Gn.Segment.setSegmentPos(e,Ir.cross(t.homog,r.homog),Ir.scalmult(r.homog.value[2],t.homog),Ir.scalmult(t.homog.value[2],r.homog))},Gn.Segment.setSegmentPos=function(e,t,r,n){t=Ir.normalizeMax(t),e.homog=Or.withUsage(t,"Line"),t=Ir.turnIntoCSList([r,n]),t=Ir.normalizeMax(t),e.startpos=t.value[0],e.endpos=t.value[1]},Gn.Meet={},Gn.Meet.kind="P",Gn.Meet.signature=["L","L"],Gn.Meet.updatePosition=function(e){e.homog=Ir.cross(At.csnames[e.args[0]].homog,At.csnames[e.args[1]].homog),e.homog=Ir.normalizeMax(e.homog),e.homog=Or.withUsage(e.homog,"Point")},Gn.Meet.visiblecheck=function(e){var t=!0,r=At.csnames[e.args[0]],n=At.csnames[e.args[1]];"S"===r.kind&&(t=Ve(e,r)),t&&"S"===n.kind&&(t=Ve(e,n)),e.isshowing=t},Gn._helper.midpoint=function(e,t){return Ir.normalizeMax(Ir.add(Ir.scalmult(t.value[2],e),Ir.scalmult(e.value[2],t)))},Gn.Mid={},Gn.Mid.kind="P",Gn.Mid.signature=["P","P"],Gn.Mid.updatePosition=function(e){var t=Gn._helper.midpoint(At.csnames[e.args[0]].homog,At.csnames[e.args[1]].homog);e.homog=Or.withUsage(t,"Point")},Gn.Perp={},Gn.Perp.kind="L",Gn.Perp.signature=["L","P"],Gn.Perp.updatePosition=function(e){var t=At.csnames[e.args[0]].homog,r=At.csnames[e.args[1]].homog;t=Ir.turnIntoCSList([t.value[0],t.value[1],Cr.zero]),e.homog=Ir.cross(t,r),e.homog=Ir.normalizeMax(e.homog),e.homog=Or.withUsage(e.homog,"Line")},Gn.Para={},Gn.Para.kind="L",Gn.Para.signature=["L","P"],Gn.Para.updatePosition=function(e){var t=At.csnames[e.args[1]].homog;e.homog=Ir.cross(Ir.cross(Ir.linfty,At.csnames[e.args[0]].homog),t),e.homog=Ir.normalizeMax(e.homog),e.homog=Or.withUsage(e.homog,"Line")},Gn.Horizontal={},Gn.Horizontal.kind="L",Gn.Horizontal.signature=["P"],Gn.Horizontal.updatePosition=function(e){e.homog=Ir.cross(Ir.ex,At.csnames[e.args[0]].homog),e.homog=Ir.normalizeMax(e.homog),e.homog=Or.withUsage(e.homog,"Line")},Gn.HorizontalLine={},Gn.HorizontalLine.kind="L",Gn.HorizontalLine.signature=[],Gn.HorizontalLine.isMovable=!0,Gn.HorizontalLine.initialize=function(e){e=Gn._helper.initializeLine(e),e=Ir.turnIntoCSList([Cr.zero,e.value[1],e.value[2]]),lt(e=Ir.normalizeMax(e))},Gn.HorizontalLine.getParamForInput=function(e,t,r){return"mouse"===r?t=Ir.cross(t,Ir.ex):"homog"===r?0===t.value[0].real&&0===t.value[0].imag||(t=Ir.turnIntoCSList([Cr.zero,t.value[1],t.value[2]])):t=Ir.turnIntoCSList([Cr.zero,Cr.zero,Cr.zero]),Ir.normalizeMax(t)},Gn.HorizontalLine.getParamFromState=function(e){return at(3)},Gn.HorizontalLine.putParamToState=function(e,t){lt(t)},Gn.HorizontalLine.updatePosition=function(e){var t=at(3);lt(t),e.homog=Or.withUsage(t,"Line")},Gn.HorizontalLine.getRandomMove=Gn._helper.getRandMove,Gn.HorizontalLine.stateSize=6,Gn.Vertical={},Gn.Vertical.kind="L",Gn.Vertical.signature=["P"],Gn.Vertical.updatePosition=function(e){e.homog=Ir.cross(Ir.ey,At.csnames[e.args[0]].homog),e.homog=Ir.normalizeMax(e.homog),e.homog=Or.withUsage(e.homog,"Line")},Gn.VerticalLine={},Gn.VerticalLine.kind="L",Gn.VerticalLine.signature=[],Gn.VerticalLine.isMovable=!0,Gn.VerticalLine.initialize=function(e){e=Gn._helper.initializeLine(e),e=Ir.turnIntoCSList([e.value[0],Cr.zero,e.value[2]]),lt(e=Ir.normalizeMax(e))},Gn.VerticalLine.getParamForInput=function(e,t,r){return"mouse"===r?t=Ir.cross(t,Ir.ey):"homog"===r?0===t.value[1].real&&0===t.value[1].imag||(t=Ir.turnIntoCSList([t.value[0],Cr.zero,t.value[2]])):t=Ir.turnIntoCSList([Cr.zero,Cr.zero,Cr.zero]),Ir.normalizeMax(t)},Gn.VerticalLine.getParamFromState=function(e){return at(3)},Gn.VerticalLine.putParamToState=function(e,t){lt(t)},Gn.VerticalLine.updatePosition=function(e){var t=at(3);lt(t),e.homog=Or.withUsage(t,"Line")},Gn.VerticalLine.getRandomMove=Gn._helper.getRandMove,Gn.VerticalLine.stateSize=6,Gn.LineByFixedAngle={},Gn.LineByFixedAngle.kind="L",Gn.LineByFixedAngle.signature=["L","P"],Gn.LineByFixedAngle.initialize=function(e){var t=Cr._helper.input(e.angle),r=Cr.cos(t);t=Cr.sin(t),e.rot=Ir.turnIntoCSList([Ir.turnIntoCSList([t,r,Cr.zero]),Ir.turnIntoCSList([Cr.neg(r),t,Cr.zero]),Ir.turnIntoCSList([Cr.zero,Cr.zero,Cr.zero])])},Gn.LineByFixedAngle.updatePosition=function(e){var t=At.csnames[e.args[1]],r=Ir.productMV(e.rot,At.csnames[e.args[0]].homog);e.homog=Ir.cross(t.homog,r),e.homog=Ir.normalizeMax(e.homog),e.homog=Or.withUsage(e.homog,"Line")},Gn.Through={},Gn.Through.kind="L",Gn.Through.signature=["P"],Gn.Through.isMovable=!0,Gn.Through.initialize=function(e){lt(e=e.dir?Or.wrap(e.dir):Ir.realVector([e.pos[1],-e.pos[0],0]))},Gn.Through.getParamForInput=function(e,t,r){return e="dir"===r||"mouse"===r?Ir.cross(At.csnames[e.args[0]].homog,t):"homog"===r?t:Ir.turnIntoCSList([Cr.zero,Cr.zero,Cr.zero]),e=Ir.cross(Ir.linfty,e),Ir.normalizeMax(e)},Gn.Through.getParamFromState=function(e){return at(3)},Gn.Through.putParamToState=function(e,t){lt(t)},Gn.Through.updatePosition=function(e){var t=at(3);lt(t),t=Ir.cross(At.csnames[e.args[0]].homog,t),t=Ir.normalizeMax(t),e.homog=Or.withUsage(t,"Line")},Gn.Through.getRandomMove=Gn._helper.getRandMove,Gn.Through.stateSize=6,Gn.Through.set_angle=function(e,t){if("number"===t.ctype){var r=Cr.cos(t);t=Cr.sin(t),et(e,r=Ir.turnIntoCSList([r,t,Cr.real(0)]),"dir")}},Gn.Through.set_slope=function(e,t){"number"===t.ctype&&et(e,t=Ir.turnIntoCSList([Cr.real(1),t,Cr.real(0)]),"dir")},Gn.Free={},Gn.Free.kind="P",Gn.Free.signature=[],Gn.Free.isMovable=!0,Gn.Free.initialize=function(e){lt(e=Gn._helper.initializePoint(e))},Gn.Free.getParamForInput=function(e,t,r){if("mouse"===r&&Wt&&0!==Ut){e=(t=Ir.normalizeZ(t)).value[0].value.real,r=t.value[1].value.real;var n=Math.round(e/Ut)*Ut,i=Math.round(r/Ut)*Ut;Math.abs(n-e)<Gt&&Math.abs(i-r)<Gt&&(t=Ir.realVector([n,i,1]))}return Ir.normalizeMax(t)},Gn.Free.getParamFromState=function(e){return at(3)},Gn.Free.putParamToState=function(e,t){lt(t)},Gn.Free.updatePosition=function(e){var t=at(3);lt(t),e.homog=Or.withUsage(t,"Point")},Gn.Free.getRandomMove=Gn._helper.getRandPointMove,Gn.Free.stateSize=6,Gn._helper.projectPointToLine=function(e,t){var r=Ir.turnIntoCSList([t.value[0],t.value[1],Cr.zero]);return e=Ir.cross(r,e),Ir.normalizeMax(Ir.cross(e,t))},Gn.PointOnLine={},Gn.PointOnLine.kind="P",Gn.PointOnLine.signature=["L"],Gn.PointOnLine.isMovable=!0,Gn.PointOnLine.initialize=function(e){var t=Gn._helper.initializePoint(e);e=At.csnames[e.args[0]].homog,t=Gn._helper.projectPointToLine(t,e),t=Ir.normalizeMax(t);var r=Ir.cross(Ir.linfty,t);Ir.normalizeMax(r),lt(t),lt(e),jn=!1},Gn.PointOnLine.updatePosition=function(e,t){var r=At.csnames[e.args[0]].homog,n=at(3);if(at(3),!t){Rn=e.stateIdx;var i=Bn;Bn=$n,t=at(3);var a=at(3);Bn=i,i=Ir.cross(a,r),Ir._helper.isAlmostZero(i)&&(i=Ir.cross(Ir.linfty,r)),t=Gn._helper.CircleMP(i,t),t=Gn._helper.IntersectLC(r,t),i=Gn._helper.pointReflection(i,n),n=ut(t[0],t[1],n,i)[0]}lt(n=Ir.normalizeMax(n)),lt(r),e.homog=Or.withUsage(n,"Point")},Gn.PointOnLine.getParamForInput=function(e,t,r){return e=At.csnames[e.args[0]].homog,t=Gn._helper.projectPointToLine(t,e),"mouse"===r&&Wt&&0!==Ut&&(t=Gn._helper.snapPointToLine(t,e)),t},Gn.PointOnLine.getParamFromState=function(e){return at(3)},Gn.PointOnLine.putParamToState=function(e,t){return lt(t)},Gn.PointOnLine.getRandomMove=Gn._helper.getRandPointMove,Gn.PointOnLine.stateSize=12,Gn.PointOnCircle={},Gn.PointOnCircle.kind="P",Gn.PointOnCircle.signature=["C"],Gn.PointOnCircle.isMovable=!0,Gn.PointOnCircle.initialize=function(e){var t=At.csnames[e.args[0]];e=Ir.normalizeZ(Gn._helper.initializePoint(e));var r=Ir.normalizeZ(Gn._helper.CenterOfCircle(t.matrix)),n=Ir.sub(e,r);n=Ir.turnIntoCSList([n.value[1],Cr.neg(n.value[0]),Cr.zero]),r=Ir.cross(e,r),t=Gn._helper.IntersectLC(r,t.matrix),r=Ir.projectiveDistMinScal(e,t[0]),Ir.projectiveDistMinScal(e,t[1])<r?(e=t[1],t=t[0]):(e=t[0],t=t[1]),lt(n),lt(e),lt(t),jn=!1},Gn.PointOnCircle.putParamToState=function(e,t){lt(t)},Gn.PointOnCircle.getParamFromState=function(e){return at(3)},Gn.PointOnCircle.getParamForInput=function(e,t,r){r=Ir.normalizeZ(Gn._helper.CenterOfCircle(At.csnames[e.args[0]].matrix)),t=Ir.sub(t,r),Rn=e.stateIdx,e=at(3);var n=Ir.normalizeZ(at(3));return r=Ir.sub(n,r),0>Cr.sub(Cr.mult(e.value[0],r.value[1]),Cr.mult(e.value[1],r.value[0])).value.real&&(t=Ir.neg(t)),Ir.turnIntoCSList([t.value[1],Cr.neg(t.value[0]),Cr.zero])},Gn.PointOnCircle.parameterPath=function(e,t,r,n,i){n=Ir.normalizeAbs(n),i=Ir.normalizeAbs(i);var a=Ir.scalproduct(n,i);if(0<=a.value.real)return Qe(0,0,r,n,i);e=Ir.turnIntoCSList([Cr.sub(n.value[1],i.value[1]),Cr.sub(i.value[0],n.value[0]),Cr.zero]),0>(a=Ir.scalproduct(n,e)).value.real&&(e=Ir.neg(e)),0>t?(a=.25/(1+(r=(t=2*t+1)*t)),r=Cr.complex(2*t*a+.25,(1-r)*a)):(a=.25/(1+(r=(t=2*t-1)*t)),r=Cr.complex(2*t*a+.75,(1-r)*a));var o=Cr.sub(Cr.real(1),r);return t=Cr.mult(r,r),a=Cr.mult(o,o),r=Cr.mult(r,o),n=Ir.scalmult(a,n),n=Ir.add(n,Ir.scalmult(r,e)),Ir.add(n,Ir.scalmult(t,i))},Gn.PointOnCircle.updatePosition=function(e){var t=at(3);lt(t);var r=At.csnames[e.args[0]];t=Ir.productMV(r.matrix,t),r=st((r=Gn._helper.IntersectLC(t,r.matrix))[0],r[1]),t=Ir.normalizeMax(r.value[0]),e.homog=Or.withUsage(t,"Point"),e.antipodalPoint=r.value[1]},Gn.PointOnCircle.getRandomMove=Gn._helper.getRandPointMove,Gn.PointOnCircle.stateSize=6+st.stateSize,Gn.PointOnCircle.get_angle=function(e){var t=Gn._helper.CenterOfCircle(At.csnames[e.args[0]].matrix),r=Ir._helper.isAlmostFarpoint;return r(e.homog)||r(t)?p:(e=Ir.normalizeZ(e.homog),t=Ir.normalizeZ(t),t=Ir.sub(e,t),t=Cr.arctan2(t.value[0],t.value[1]),e=Cr.real(Sr),t=Cr.mod(Cr.add(t,e),e),Or.withUsage(t,"Angle"))},Gn.PointOnCircle.set_angle=function(e,t){if("number"===t.ctype){var r=At.csnames[e.args[0]],n=Gn._helper.CenterOfCircle(r.matrix);if(!Ir._helper.isAlmostFarpoint(n)){n=Ir.normalizeZ(n);var i=Cr.cos(t);t=Cr.sin(t),r=Ir.turnIntoCSList([Cr.mult(i,r.radius),Cr.mult(t,r.radius),Cr.real(0)]),et(e,Ir.add(n,r),"homog")}}return p},Gn.OtherPointOnCircle={},Gn.OtherPointOnCircle.kind="P",Gn.OtherPointOnCircle.signature=["P"],Gn.OtherPointOnCircle.signatureConstraints=function(e){return"PointOnCircle"===At.csnames[e.args[0]].type},Gn.OtherPointOnCircle.updatePosition=function(e){var t=At.csnames[e.args[0]].antipodalPoint;t=Ir.normalizeMax(t),e.homog=Or.withUsage(t,"Point")},Gn.PointOnSegment={},Gn.PointOnSegment.kind="P",Gn.PointOnSegment.signature=["S"],Gn.PointOnSegment.isMovable=!0,Gn.PointOnSegment.initialize=function(e){var t=Gn._helper.initializePoint(e);ot(e=Gn.PointOnSegment.getParamForInput(e,t))},Gn.PointOnSegment.getParamForInput=function(e,t,r){var n=(e=At.csnames[e.args[0]]).homog;return"mouse"===r&&Wt&&0!==Ut&&(t=Gn._helper.snapPointToLine(t,n)),r=Ir.turnIntoCSList([n.value[0],n.value[1],Cr.zero]),n=Ir.sub(e.startpos,e.endpos),0>(t=Ir.crossratio3(n,e.startpos,e.endpos,t,r)).value.real&&(t=Cr.complex(0,t.value.imag)),1<t.value.real&&(t=Cr.complex(1,t.value.imag)),t},Gn.PointOnSegment.getParamFromState=function(e){return it()},Gn.PointOnSegment.putParamToState=function(e,t){ot(t)},Gn.PointOnSegment.updatePosition=function(e){var t=it();ot(t);var r=At.csnames[e.args[0]],n=r.startpos;r=Ir.sub(r.endpos,n),t=Ir.add(n,Ir.scalmult(t,r)),t=Ir.normalizeMax(t),e.homog=Or.withUsage(t,"Point")},Gn.PointOnSegment.getRandomMove=Gn._helper.getRandPointMove,Gn.PointOnSegment.stateSize=2,Gn._helper.projectPointToCircle=function(e,t){var r=Gn._helper.CenterOfCircle(e.matrix);return r=Ir.normalizeMax(r),r=Ir.normalizeMax(Ir.cross(t,r)),e=Gn._helper.IntersectLC(r,e.matrix),(r=Ir.projectiveDistMinScal(t,e[0]))<(t=Ir.projectiveDistMinScal(t,e[1]))?e[0]:e[1]},Gn.PointOnArc={},Gn.PointOnArc.kind="P",Gn.PointOnArc.signature=["C"],Gn.PointOnArc.signatureConstraints=function(e){return At.csnames[e.args[0]].isArc},Gn.PointOnArc.isMovable=!0,Gn.PointOnArc.initialize=function(e){var t=Gn._helper.initializePoint(e);lt(e=Gn.PointOnArc.getParamForInput(e,t))},Gn.PointOnArc.getParamForInput=function(e,t){return e=At.csnames[e.args[0]],t=Gn._helper.projectPointToCircle(e,t),t=Ir.normalizeMax(Ir.crossratio3harm(e.startPoint,e.endPoint,e.viaPoint,t,Ir.ii)),0>(e=Cr.div(t.value[0],t.value[1])).value.real&&(t=-1>e.value.real?Ir.realVector([1,0]):Ir.realVector([0,1])),t},Gn.PointOnArc.getParamFromState=function(e){return at(2)},Gn.PointOnArc.putParamToState=function(e,t){lt(t)},Gn.PointOnArc.updatePosition=function(e){var t=At.csnames[e.args[0]],r=t.startPoint,n=t.viaPoint,i=t.endPoint,a=Ir.ii,o=Ir.cross(r,a);n=Ir.cross(n,a);var l=Ir.cross(i,a);l=Ir.turnIntoCSList([o,l]),o=Ir.transpose(l),l=Ir.conjugate(l),o=Ir.productMM(l,o),n=Ir.productMV(l,n),n=(o=Ir.productMV(Ir.adjoint2(o),n)).value[0],o=o.value[1],lt(l=at(2)),r=Ir.normalizeMax(Ir.add(Ir.scalmult(Cr.mult(n,l.value[0]),r),Ir.scalmult(Cr.mult(o,l.value[1]),i))),t=Gn._helper.conicOtherIntersection(t.matrix,a,r),e.homog=Or.withUsage(t,"Point")},Gn.PointOnArc.getRandomMove=Gn._helper.getRandPointMove,Gn.PointOnArc.stateSize=4,Gn._helper.CenterOfCircle=function(e){return Ir.turnIntoCSList([e.value[2].value[0],e.value[2].value[1],Cr.neg(e.value[0].value[0])])},Gn._helper.CenterOfConic=function(e){return{ctype:"list",value:[(e=Ir.adjoint3(e)).value[2].value[0],e.value[2].value[1],e.value[2].value[2]]}},Gn.CenterOfConic={},Gn.CenterOfConic.kind="P",Gn.CenterOfConic.signature=["C"],Gn.CenterOfConic.updatePosition=function(e){var t=Gn._helper.CenterOfConic(At.csnames[e.args[0]].matrix);e.homog=t,e.homog=Ir.normalizeMax(e.homog),e.homog=Or.withUsage(e.homog,"Point")},Gn._helper.CircleMP=function(e,t){var r=e.value[0],n=e.value[1];e=Cr.neg(e.value[2]);var i=Cr.zero;return r=Ir.turnIntoCSList([Ir.turnIntoCSList([e,i,r]),Ir.turnIntoCSList([i,e,n]),Ir.turnIntoCSList([r,n,i])]),n=Or.mult(Or.mult(t,r),t),t=Or.mult(Or.mult(t,Ir.fund),t),n=Or.mult(n,Ir.fund),t=Or.mult(t,r),Ir.sub(n,t)},Gn.CircleMP={},Gn.CircleMP.kind="C",Gn.CircleMP.signature=["P","P"],Gn.CircleMP.updatePosition=function(e){e.matrix=Gn._helper.CircleMP(At.csnames[e.args[0]].homog,At.csnames[e.args[1]].homog),e.matrix=Ir.normalizeMax(e.matrix),e.matrix=Or.withUsage(e.matrix,"Circle")},Gn.CircleMr={},Gn.CircleMr.kind="C",Gn.CircleMr.signature=["P"],Gn.CircleMr.isMovable=!0,Gn.CircleMr.initialize=function(e){ot(Cr.real(e.radius))},Gn.CircleMr.getParamForInput=function(e,t,r){return"radius"===r?t:(e=At.csnames[e.args[0]].homog,e=Ir.normalizeZ(e),t=Ir.normalizeZ(t),t=Ir.sub(e,t),Ir.abs(t))},Gn.CircleMr.getParamFromState=function(e){return it()},Gn.CircleMr.putParamToState=function(e,t){ot(t)},Gn.CircleMr.updatePosition=function(e){var t=it();ot(t);var r=At.csnames[e.args[0]].homog,n=Cr.mult(r.value[2],t);if(n=Cr.mult(n,n),!Cr._helper.isFinite(n)&&!Cr._helper.isNaN(n))return Ir.fund;r=Gn._helper.ScaledCircleMrr(r,n),e.matrix=Or.withUsage(r,"Circle"),e.radius=t},Gn.CircleMr.getRandomMove=function(e){return e=e.radius,{type:"radius",value:Cr.abs(e).value.real<Cr.eps?Cr.getRandComplex(.05,.1):Cr.mult(e,Cr.getRandReal(.95,1.05))}},Gn.CircleMr.stateSize=2,Gn.CircleMr.set_radius=function(e,t){"number"===t.ctype&&et(e,t,"radius")},Gn._helper.ScaledCircleMrr=function(e,t){var r=e.value[0],n=e.value[1];return e=Cr.neg(e.value[2]),e=Ir.scalmult(e,Ir.turnIntoCSList([r,n,e])).value,r=Ir.turnIntoCSList([r,n]),t=Cr.sub(Ir.scalproduct(r,r),t),t=Gn._helper.buildConicMatrix([e[2],Cr.zero,e[2],e[0],e[1],t]),Ir.normalizeMax(t)},Gn.Compass={},Gn.Compass.kind="C",Gn.Compass.signature=["P","P","P"],Gn.Compass.updatePosition=function(e){var t=At.csnames[e.args[0]].homog,r=At.csnames[e.args[1]].homog,n=At.csnames[e.args[2]].homog,i=t.value[2],a=r.value[2],o=n.value[2];t=Ir.scalmult(Cr.mult(a,o),t),r=Ir.scalmult(Cr.mult(i,o),r),n=Ir.scalmult(Cr.mult(i,a),n),t=Ir.sub(r,t),n=Gn._helper.ScaledCircleMrr(n,Ir.scalproduct(t,t)),e.matrix=Or.withUsage(n,"Circle")},Gn._helper.getConicType=function(e){if(1e-16>Cr.abs(Ir.det(e)).value.real)return"degenerate";var t=Cr.mult(e.value[0].value[0],e.value[1].value[1]);return t=(t=Cr.sub(t,Cr.pow(e.value[0].value[1],Cr.real(2)))).value.real,1e-16>Math.abs(t)?"parabola":1e-16<t?"ellipsoid":"hyperbola"},Gn._helper.ConicBy5=function(e,t,r,n,i,a){e=Ir.turnIntoCSList([Ir.cross(r,n)]);var o=Ir.turnIntoCSList([Ir.cross(t,i)]);return t=Ir.turnIntoCSList([Ir.cross(t,r)]),n=Ir.turnIntoCSList([Ir.cross(n,i)]),Gn._helper.conicFromTwoDegenerates(e,o,t,n,a)},Gn._helper.conicFromTwoDegenerates=function(e,t,r,n,i){return e=Or.mult(Ir.transpose(t),e),r=Or.mult(Ir.transpose(n),r),e=Ir.add(e,Ir.transpose(e)),r=Ir.add(r,Ir.transpose(r)),n=Or.mult(Or.mult(i,e),i),i=Or.mult(Or.mult(i,r),i),r=Or.mult(n,r),i=Or.mult(i,e),Ir.sub(r,i)},Gn.ConicBy5={},Gn.ConicBy5.kind="C",Gn.ConicBy5.signature=["P","P","P","P","P"],Gn.ConicBy5.updatePosition=function(e){var t=Gn._helper.ConicBy5(e,At.csnames[e.args[0]].homog,At.csnames[e.args[1]].homog,At.csnames[e.args[2]].homog,At.csnames[e.args[3]].homog,At.csnames[e.args[4]].homog);e.matrix=t,e.matrix=Ir.normalizeMax(e.matrix),e.matrix=Or.withUsage(e.matrix,"Conic")},Gn.FreeConic={},Gn.FreeConic.kind="C",Gn.FreeConic.signature=[],Gn.FreeConic.initialize=function(e){var t=e.pos?Gn._helper.inputConic(e.pos):Ir.zeromatrix(Cr.real(3),Cr.real(3));Gn.FreeConic.putParamToState(e,t)},Gn.FreeConic.getParamForInput=function(e,t,r){return Ir.normalizeMax(t)},Gn.FreeConic.getParamFromState=function(e){return Gn._helper.buildConicMatrix(at(6).value)},Gn.FreeConic.putParamToState=function(e,t){for(e=0;3>e;++e)for(var r=0;r<=e;++r)ot(t.value[e].value[r])},Gn.FreeConic.updatePosition=function(e){var t=at(6);lt(t),e.matrix=Gn._helper.buildConicMatrix(t.value),e.matrix=Ir.normalizeMax(e.matrix),e.matrix=Or.withUsage(e.matrix,"Conic")},Gn.FreeConic.set_matrix=function(e,t){Ir._helper.isNumberMatrixMN(t,3,3)&&et(e,Ir.add(t,Ir.transpose(t)),"matrix")},Gn.FreeConic.stateSize=12,Gn._helper.buildConicMatrix=function(e){var t=e[1],r=e[2],n=e[3],i=e[4],a=e[5];return Ir.turnIntoCSList([Ir.turnIntoCSList([e[0],t,n]),Ir.turnIntoCSList([t,r,i]),Ir.turnIntoCSList([n,i,a])])},Gn._helper.flattenConicMatrix=function(e){return Ir.turnIntoCSList([e.value[0].value[0],e.value[0].value[1],e.value[1].value[1],e.value[0].value[2],e.value[1].value[2],e.value[2].value[2]])},Gn._helper.splitDegenConic=function(e){var t,r=Ir.adjoint3(e),n=0,i=Cr.abs2(r.value[0].value[0]).value.real;for(t=1;3>t;t++){var a=Cr.abs2(r.value[t].value[t]).value.real;a>i&&(n=t,i=a)}if(t=Cr.sqrt(Cr.mult(Cr.real(-1),r.value[n].value[n])),1e-16>Cr.abs2(t).value.real)return[e=Ir.turnIntoCSList([Cr.zero,Cr.zero,Cr.zero]),e];n=Cr.real(n+1),a=Ir.column(r,n),t=(a=Ir.scaldiv(t,a)).value[0],i=a.value[1],a=a.value[2],t=Ir.turnIntoCSList([Ir.turnIntoCSList([Cr.real(0),a,Cr.mult(Cr.real(-1),i)]),Ir.turnIntoCSList([Cr.mult(Cr.real(-1),a),Cr.real(0),t]),Ir.turnIntoCSList([i,Cr.mult(Cr.real(-1),t),Cr.real(0)])]),e=Ir.add(e,t);var o=0;for(t=i=r=0;3>t;t++)for(n=0;3>n;n++)(a=Cr.abs2(e.value[t].value[n]).value.real)>i&&(o=t,r=n,i=a);return t=e.value[o],e=(e=Ir.transpose(e)).value[r],t=Ir.normalizeMax(t),e=Ir.normalizeMax(e),[t=Or.withUsage(t,"Line"),e=Or.withUsage(e,"Line")]},Gn._helper.inputConic=function(e){var t="xx xy yy xz yz zz".split(" ").map((function(t){var r=Cr._helper.input(e[t]);return t[0]!==t[1]&&(r=Cr.realmult(.5,r)),r}));return Gn._helper.buildConicMatrix(t)},Gn.SelectConic={},Gn.SelectConic.kind="C",Gn.SelectConic.signature=["Cs"],Gn.SelectConic.initialize=function(e){if(void 0!==e.index)return e.index-1;var t=Gn._helper.inputConic(e.pos);e=At.csnames[e.args[0]].results;for(var r=Ir.conicDist(t,e[0]),n=0,i=1;i<e.length;++i){var a=Ir.conicDist(t,e[i]);a<r&&(r=a,n=i)}return n},Gn.SelectConic.updatePosition=function(e){e.matrix=At.csnames[e.args[0]].results[e.param],e.matrix=Ir.normalizeMax(e.matrix),e.matrix=Or.withUsage(e.matrix,"Conic")},Gn._helper.ConicBy4p1l=function(e,t,r,n,i,a){var o=Ir.scalproduct(t,a),l=Ir.scalproduct(r,a),s=Ir.scalproduct(n,a),u=Ir.scalproduct(i,a),c=Ir.det3(r,n,i),p=Ir.det3(t,r,i),f=Ir.det3(t,n,i),h=Ir.det3(t,r,n),v=Cr.mult;return l=Cr.sqrt(v(v(l,u),v(c,p))),o=Cr.sqrt(v(v(o,s),v(f,h))),s=Ir.cross(Ir.cross(t,n),a),a=Ir.cross(Ir.cross(r,i),a),s=Ir.scalmult(l,s),o=Ir.scalmult(o,a),o=st(a=Ir.normalizeMax(Ir.add(s,o)),o=Ir.normalizeMax(Ir.sub(s,o))),a=Gn._helper.ConicBy5(e,t,r,n,i,o.value[0]),e=Gn._helper.ConicBy5(e,t,r,n,i,o.value[1]),[Ir.normalizeMax(a),Ir.normalizeMax(e)]},Gn.ConicBy4p1l={},Gn.ConicBy4p1l.kind="Cs",Gn.ConicBy4p1l.signature=["P","P","P","P","L"],Gn.ConicBy4p1l.updatePosition=function(e){var t=Gn._helper.ConicBy4p1l(e,At.csnames[e.args[0]].homog,At.csnames[e.args[1]].homog,At.csnames[e.args[2]].homog,At.csnames[e.args[3]].homog,At.csnames[e.args[4]].homog);e.results=t},Gn.ConicBy4p1l.stateSize=st.stateSize,Gn._helper.ConicBy3p2l=function(e,t,r,n,i){function a(e,t,r,n){return Cr.sub(Cr.mult(e,n),Cr.mult(t,r))}var o=Ir.cross(e,t),l=Ir.cross(n,i);n=Ir.cross(n,o),i=Ir.cross(i,o),o=Ir.turnIntoCSList([n,i,l]),r=Ir.productVM(r,Ir.adjoint3(o)),l=Ir.adjoint3(Ir.turnIntoCSList([Ir.scalmult(r.value[0],n),Ir.scalmult(r.value[1],i),Ir.scalmult(r.value[2],l)])),r=Ir.transpose(l),n=Cr.mult,e=(i=Ir.productMV(r,e)).value[0],i=i.value[1],t=(o=Ir.productMV(r,t)).value[0],o=o.value[1];var s,u=Cr.sqrt(n(e,i)),c=Cr.sqrt(n(t,o)),p=Array(4);for(s=0;4>s;++s){var f=(2&s)-1,h=n(Cr.real(((1&s)<<1)-1),u),v=n(Cr.real(f),c),d=a(i,h,o,v),m=a(t,v,e,h);f=a(e,i,t,o);var g=Cr.add(Cr.add(a(t,o,e,i),a(o,v,i,h)),a(v,t,h,e));h=n(d,d),v=n(m,m);var y=n(g,g),b=n(d,m);d=n(d,g),m=n(m,g),b=Cr.sub(b,n(Cr.real(.5),n(f,f))),f=Ir.turnIntoCSList([Ir.turnIntoCSList([h,b,d]),Ir.turnIntoCSList([b,v,m]),Ir.turnIntoCSList([d,m,y])]),f=Ir.productMM(l,Ir.productMM(f,r)),f=Ir.turnIntoCSList([f.value[0].value[0],f.value[0].value[1],f.value[0].value[2],f.value[1].value[1],f.value[1].value[2],f.value[2].value[2]]),p[s]=f}return p},Gn.ConicBy3p2l={},Gn.ConicBy3p2l.kind="Cs",Gn.ConicBy3p2l.signature=["P","P","P","L","L"],Gn.ConicBy3p2l.updatePosition=function(e){var t=Gn._helper.ConicBy3p2l(At.csnames[e.args[0]].homog,At.csnames[e.args[1]].homog,At.csnames[e.args[2]].homog,At.csnames[e.args[3]].homog,At.csnames[e.args[4]].homog);t=pt(t);for(var r=Array(4),n=0;4>n;++n){var i=t[n].value;r[n]=Ir.turnIntoCSList([Ir.turnIntoCSList([i[0],i[1],i[2]]),Ir.turnIntoCSList([i[1],i[3],i[4]]),Ir.turnIntoCSList([i[2],i[4],i[5]])])}e.results=r},Gn.ConicBy3p2l.stateSize=48,Gn.ConicBy2p3l={},Gn.ConicBy2p3l.kind="Cs",Gn.ConicBy2p3l.signature=["P","P","L","L","L"],Gn.ConicBy2p3l.updatePosition=function(e){var t=Gn._helper.ConicBy3p2l(At.csnames[e.args[2]].homog,At.csnames[e.args[3]].homog,At.csnames[e.args[4]].homog,At.csnames[e.args[0]].homog,At.csnames[e.args[1]].homog);t=pt(t);for(var r=Array(4),n=0;4>n;++n){var i=t[n].value;i=Ir.turnIntoCSList([Ir.turnIntoCSList([i[0],i[1],i[2]]),Ir.turnIntoCSList([i[1],i[3],i[4]]),Ir.turnIntoCSList([i[2],i[4],i[5]])]),r[n]=Ir.normalizeMax(Ir.adjoint3(i))}e.results=r},Gn.ConicBy2p3l.stateSize=48,Gn.ConicBy1p4l={},Gn.ConicBy1p4l.kind="Cs",Gn.ConicBy1p4l.signature=["P","L","L","L","L"],Gn.ConicBy1p4l.updatePosition=function(e){var t=Gn._helper.ConicBy4p1l(e,At.csnames[e.args[1]].homog,At.csnames[e.args[2]].homog,At.csnames[e.args[3]].homog,At.csnames[e.args[4]].homog,At.csnames[e.args[0]].homog),r=t[0];t=t[1],t=[r=Ir.adjoint3(r),t=Ir.adjoint3(t)],e.results=t},Gn.ConicBy1p4l.stateSize=st.stateSize,Gn.ConicParabolaPL={},Gn.ConicParabolaPL.kind="C",Gn.ConicParabolaPL.signature=["P","L"],Gn.ConicParabolaPL.updatePosition=function(e){var t=At.csnames[e.args[0]].homog.value,r=At.csnames[e.args[1]].homog.value,n=Cr.mult,i=Cr.neg,a=Cr.add,o=Cr.sub,l=t[0],s=t[1],u=t[2],c=r[0];t=r[1],r=r[2];var p=n(u,u),f=n(c,c),h=n(t,t),v=n(u,r),d=i(u);u=a(f,h),h=n(p,h),f=n(p,f),i=n(i(p),n(c,t)),c=n(d,a(n(l,u),n(v,c))),t=n(d,a(n(s,u),n(v,t))),n=o(n(a(n(l,l),n(s,s)),u),n(p,n(r,r))),n=Gn._helper.buildConicMatrix([h,i,f,c,t,n]),n=Ir.normalizeMax(n),e.matrix=Or.withUsage(n,"Conic")},Gn.ConicBy2Foci1P={},Gn.ConicBy2Foci1P.kind="Cs",Gn.ConicBy2Foci1P.signature=["P","P","P"],Gn.ConicBy2Foci1P.updatePosition=function(e){var t=At.csnames[e.args[0]].homog,r=At.csnames[e.args[1]].homog,n=At.csnames[e.args[2]].homog,i=Ir.ii,a=Ir.jj,o=Ir.normalizeMax(Ir.cross(t,n)),l=Ir.normalizeMax(Ir.cross(r,n)),s=Ir.normalizeMax(Ir.cross(n,i));n=Ir.normalizeMax(Ir.cross(n,a)),l=Gn._helper.coHarmonic(s,n,o,l),o=Ir.normalizeMax(l[0]),l=Ir.normalizeMax(l[1]),i=Ir.turnIntoCSList([i]),s=Ir.turnIntoCSList([a]),n=Ir.turnIntoCSList([t]);var u=Ir.turnIntoCSList([r]);a=Gn._helper.conicFromTwoDegenerates(i,s,n,u,o),a=Ir.normalizeMax(a),i=Gn._helper.conicFromTwoDegenerates(i,s,n,u,l),i=Ir.normalizeMax(i),a=Ir.normalizeMax(Ir.adjoint3(a)),i=Ir.normalizeMax(Ir.adjoint3(i)),"ellipsoid"!==Gn._helper.getConicType(a)&&(o=a,a=i,i=o),Ir.almostequals(t,r).value&&(t=Cr.real(3),i=Ir.zeromatrix(t,t)),e.results=[a,i]},Gn.ConicBy2Pol1P={},Gn.ConicBy2Pol1P.kind="C",Gn.ConicBy2Pol1P.signature=["P","L","P","L","P"],Gn.ConicBy2Pol1P.updatePosition=function(e){var t=At.csnames[e.args[0]].homog,r=At.csnames[e.args[1]].homog,n=At.csnames[e.args[2]].homog,i=At.csnames[e.args[3]].homog,a=At.csnames[e.args[4]].homog,o=Ir.scalproduct,l=Ir.scalmult,s=Ir.sub,u=Ir.productMM,c=Cr.realmult,p=Ir.transpose,f=Ir.turnIntoCSList,h=s(l(o(r,t),a),l(c(2,o(r,a)),t)),v=s(l(o(i,n),a),l(c(2,o(i,a)),n)),d=f([Ir.cross(t,a)]);a=f([Ir.cross(n,a)]),v=u(p(d),f([Ir.cross(t,v)])),f=u(p(a),f([Ir.cross(n,h)])),u=u(p(d),a),t=o(t,i),r=o(n,r),n=s(n=Ir.add(l(r,v),l(t,f)),l(c(2,Cr.mult(t,r)),u)),n=Ir.add(n,p(n)),n=Ir.normalizeMax(n),n=Or.withUsage(n,"Conic"),e.matrix=n},Gn.ConicBy2Pol1L={},Gn.ConicBy2Pol1L.kind="C",Gn.ConicBy2Pol1L.signature=["P","L","P","L","L"],Gn.ConicBy2Pol1L.updatePosition=function(e){var t=At.csnames[e.args[0]].homog,r=At.csnames[e.args[1]].homog,n=At.csnames[e.args[2]].homog,i=At.csnames[e.args[3]].homog,a=At.csnames[e.args[4]].homog,o=Ir.scalproduct,l=Ir.scalmult,s=Ir.productMM,u=Cr.mult,c=Ir.transpose,p=Ir.turnIntoCSList,f=o(r,t),h=o(r,n),v=o(i,t),d=o(i,n),m=o(a,t);o=o(a,n);var g=p([Ir.sub(l(u(v,o),r),l(u(h,m),i))]);t=Ir.add(s(c(p([l(u(v,h),a)])),p([Ir.sub(Ir.add(l(Cr.sub(u(f,o),u(h,m)),i),l(Cr.sub(u(d,m),u(v,o)),r)),l(Ir.det3(r,i,a),Ir.cross(t,n)))])),s(c(g),g)),t=Ir.add(t,c(t)),t=Ir.normalizeMax(t),t=Or.withUsage(t,"Conic"),e.matrix=t},Gn._helper.conic1Pol3Inc=function(e,t,r,n,i){var a=Ir.scalproduct,o=Ir.scalmult,l=Ir.productMM,s=Ir.cross,u=Cr.realmult,c=Cr.mult,p=Ir.transpose,f=Ir.turnIntoCSList,h=Ir.det3,v=h(e,r,n),d=f([s(r,i)]),m=f([s(e,i)]),g=f([s(r,n)]),y=a(t,e),b=a(t,r);return t=a(t,i),s=f([s(n,Ir.sub(o(y,i),o(u(2,t),e)))]),d=o(v,l(p(d),s)),e=u(2,Cr.add(c(h(e,n,i),b),c(v,t))),e=Cr.sub(c(h(r,n,i),y),e),d=Ir.add(d,o(e,l(p(m),g))),d=Ir.add(d,p(d)),Ir.normalizeMax(d)},Gn.ConicBy1Pol3P={},Gn.ConicBy1Pol3P.kind="C",Gn.ConicBy1Pol3P.signature=["P","L","P","P","P"],Gn.ConicBy1Pol3P.updatePosition=function(e){var t=Gn._helper.conic1Pol3Inc(At.csnames[e.args[0]].homog,At.csnames[e.args[1]].homog,At.csnames[e.args[2]].homog,At.csnames[e.args[3]].homog,At.csnames[e.args[4]].homog);t=Or.withUsage(t,"Conic"),e.matrix=t},Gn.ConicBy1Pol3L={},Gn.ConicBy1Pol3L.kind="C",Gn.ConicBy1Pol3L.signature=["P","L","L","L","L"],Gn.ConicBy1Pol3L.updatePosition=function(e){var t=Gn._helper.conic1Pol3Inc(At.csnames[e.args[1]].homog,At.csnames[e.args[0]].homog,At.csnames[e.args[2]].homog,At.csnames[e.args[3]].homog,At.csnames[e.args[4]].homog);t=Ir.normalizeMax(Ir.adjoint3(t)),t=Or.withUsage(t,"Conic"),e.matrix=t},Gn.ConicBy1Pol2P1L={},Gn.ConicBy1Pol2P1L.kind="Cs",Gn.ConicBy1Pol2P1L.signature=["P","L","P","P","L"],Gn.ConicBy1Pol2P1L.updatePosition=function(e){var t=At.csnames[e.args[0]].homog,r=At.csnames[e.args[1]].homog,n=At.csnames[e.args[2]].homog,i=At.csnames[e.args[3]].homog,a=At.csnames[e.args[4]].homog,o=Cr.add,l=Ir.turnIntoCSList,s=Ir.cross,u=Ir.productMM,c=Cr.mult,p=Cr.realmult,f=Ir.scalmult,h=Ir.scalproduct,v=Cr.sub,d=Ir.transpose,m=h(r,t),g=h(r,n),y=h(r,i);r=h(a,t);var b=h(a,n);h=h(a,i),a=l([s(t,n)]),t=l([s(t,i)]),n=l([s(n,i)]),i=Cr.sqrt(c(c(b,h),c(v(c(m,b),p(2,c(r,g))),v(c(m,h),p(2,c(r,y)))))),l=u(d(a),t),i=f(i,Ir.add(l,d(l))),o=f(v(c(m,c(b,h)),o(c(r,c(g,h)),c(r,c(b,y)))),l),p=Ir.add(Ir.sub(f(y,a),f(g,t)),f(p(.5,m),n)),o=Ir.add(o,f(c(r,r),u(d(n),p))),o=Ir.add(o,d(o)),u=Ir.normalizeMax(Ir.add(i,o)),c=Ir.normalizeMax(Ir.sub(i,o)),e.results=ft(u,c).value},Gn.ConicBy1Pol2P1L.stateSize=ft.stateSize,Gn.ConicBy1Pol1P2L={},Gn.ConicBy1Pol1P2L.kind="Cs",Gn.ConicBy1Pol1P2L.signature=["P","L","P","L","L"],Gn.ConicBy1Pol1P2L.updatePosition=function(e){var t=At.csnames[e.args[0]].homog,r=At.csnames[e.args[1]].homog,n=At.csnames[e.args[2]].homog,i=At.csnames[e.args[3]].homog,a=At.csnames[e.args[4]].homog,o=Cr.add,l=Ir.turnIntoCSList,s=Ir.cross,u=Ir.productMM,c=Cr.mult,p=Cr.realmult,f=Ir.scalmult,h=Ir.scalproduct,v=Cr.sub,d=Ir.transpose,m=h(r,t),g=h(r,n),y=h(i,t),b=h(i,n),x=h(a,t),P=h(a,n),C=c(m,m),_=c(m,g);h=c(g,g);var w=c(y,y),S=c(y,b),T=c(b,b),M=c(x,x),I=c(x,P),L=c(P,P),E=c(c(C,T),L);E=v(E,p(2,c(c(_,S),L))),E=o(E=v(E,p(2,c(c(_,T),I))),p(.5,c(c(h,w),L))),E=o(E,p(3,c(c(h,S),I))),E=o(E,p(.5,c(c(h,T),M))),I=v(I=c(c(m,b),P),c(c(g,y),P)),I=v(I,c(c(g,b),x)),I=c(I,c(h,x)),L=v(c(m,b),p(2,c(g,y))),L=c(L,c(h,c(b,x))),E=u(d(l([r])),l([Ir.add(Ir.add(f(E,r),f(I,i)),f(L,a))])),I=l([i]),E=Ir.add(E,f(p(.5,c(c(h,h),M)),u(d(I),I))),E=Ir.add(E,f(h,u(d(l([a])),l([Ir.add(f(v(v(p(2,c(_,S)),c(C,T)),p(.5,c(h,w))),a),f(c(Ir.det3(r,i,a),v(c(m,b),c(g,y))),s(t,n)))])))),E=Ir.add(E,d(E)),t=Cr.sqrt(c(c(b,P),c(v(c(m,b),p(2,c(g,y))),v(c(m,P),p(2,c(g,x)))))),r=u(d(l([r])),l([Ir.sub(f(v(c(g,o(c(y,P),c(b,x))),c(m,c(b,P))),r),f(h,Ir.add(f(x,i),f(y,a))))])),r=Ir.add(r,f(c(m,h),u(d(l([i])),l([a])))),r=f(t,r),r=Ir.add(r,d(r)),i=Ir.normalizeMax(Ir.add(E,r)),a=Ir.normalizeMax(Ir.sub(E,r)),e.results=ft(i,a).value},Gn.ConicBy1Pol1P2L.stateSize=ft.stateSize,Gn._helper.coHarmonic=function(e,t,r,n){var i=Ir.realVector([100*Math.random(),100*Math.random(),1]),a=Ir.det3(i,r,e),o=Ir.det3(i,r,t);return r=Ir.det3(i,n,e),n=Ir.det3(i,n,t),n=Cr.sqrt(Cr.mult(n,o)),a=Cr.sqrt(Cr.mult(r,a)),e=Or.mult(e,n),a=Or.mult(t,a),[t=Ir.add(e,a),e=Ir.sub(e,a)]},Gn.ConicInSquare={},Gn.ConicInSquare.kind="C",Gn.ConicInSquare.signature=["P","P","P","P"],Gn.ConicInSquare.updatePosition=function(e){var t=Rr.basismap(At.csnames[e.args[0]].homog,At.csnames[e.args[1]].homog,At.csnames[e.args[2]].homog,At.csnames[e.args[3]].homog),r=Cr.one;r=Gn._helper.buildConicMatrix([r,r,r,Cr.real(-3),r,r]),t=Ir.adjoint3(t),t=Ir.productMM(Ir.productMM(Ir.transpose(t),r),t),t=Ir.normalizeMax(t),e.matrix=Or.withUsage(t,"Conic")},Gn.ConicBy5lines={},Gn.ConicBy5lines.kind="C",Gn.ConicBy5lines.signature=["L","L","L","L","L"],Gn.ConicBy5lines.updatePosition=function(e){var t=Gn._helper.ConicBy5(e,At.csnames[e.args[0]].homog,At.csnames[e.args[1]].homog,At.csnames[e.args[2]].homog,At.csnames[e.args[3]].homog,At.csnames[e.args[4]].homog);t=Ir.adjoint3(t),e.matrix=t,e.matrix=Ir.normalizeMax(e.matrix),e.matrix=Or.withUsage(e.matrix,"Conic")},Gn.ConicFromPrincipalDirections={},Gn.ConicFromPrincipalDirections.kind="C",Gn.ConicFromPrincipalDirections.signature=["P","P","P"],Gn.ConicFromPrincipalDirections.updatePosition=function(e){var t=At.csnames[e.args[0]].homog,r=At.csnames[e.args[1]].homog,n=At.csnames[e.args[2]].homog,i=Gn._helper.pointReflection(t,r),a=Ir.cross(r,t);t=Ir.turnIntoCSList([a.value[0],a.value[1],Cr.zero]),a=Ir.turnIntoCSList([a]),r=Ir.turnIntoCSList([Ir.cross(r,t)]),i=Ir.turnIntoCSList([Ir.cross(i,t)]),e.matrix=Gn._helper.conicFromTwoDegenerates(a,a,r,i,n),e.matrix=Ir.normalizeMax(e.matrix),e.matrix=Or.withUsage(e.matrix,"Conic")},Gn.CircleBy3={},Gn.CircleBy3.kind="C",Gn.CircleBy3.signature=["P","P","P"],Gn.CircleBy3.updatePosition=function(e){var t=Gn._helper.ConicBy5(e,At.csnames[e.args[0]].homog,At.csnames[e.args[1]].homog,Ir.ii,Ir.jj,At.csnames[e.args[2]].homog);e.matrix=Ir.normalizeMax(t),e.matrix=Or.withUsage(e.matrix,"Circle")},Gn.ArcBy3={},Gn.ArcBy3.kind="C",Gn.ArcBy3.signature=["P","P","P"],Gn.ArcBy3.updatePosition=function(e){Gn.CircleBy3.updatePosition(e),e.startPoint=At.csnames[e.args[0]].homog,e.viaPoint=At.csnames[e.args[1]].homog,e.endPoint=At.csnames[e.args[2]].homog},Gn.ArcBy3.initialize=function(e){e.startPoint=At.csnames[e.args[0]].homog,e.viaPoint=At.csnames[e.args[1]].homog,e.endPoint=At.csnames[e.args[2]].homog,e.isArc=!0},Gn.PolarOfPoint={},Gn.PolarOfPoint.kind="L",Gn.PolarOfPoint.signature=["P","C"],Gn.PolarOfPoint.updatePosition=function(e){var t=Or.mult(At.csnames[e.args[1]].matrix,At.csnames[e.args[0]].homog);t=Ir.normalizeMax(t),e.homog=Or.withUsage(t,"Line")},Gn.PolarOfLine={},Gn.PolarOfLine.kind="P",Gn.PolarOfLine.signature=["L","C"],Gn.PolarOfLine.updatePosition=function(e){var t=At.csnames[e.args[0]],r=Ir.adjoint3(At.csnames[e.args[1]].matrix);t=Or.mult(r,t.homog),t=Ir.normalizeMax(t),e.homog=Or.withUsage(t,"Point")},Gn.AngleBisector={},Gn.AngleBisector.kind="Ls",Gn.AngleBisector.signature=["L","L","P"],Gn.AngleBisector.updatePosition=function(e){var t=At.csnames[e.args[0]].homog,r=At.csnames[e.args[1]].homog,n=At.csnames[e.args[2]].homog,i=Ir.add,a=Ir.sub,o=Ir.abs,l=Ir.cross,s=Ir.scalmult,u=Ir.normalizeMax,c=Ir._helper.isAlmostZero,p=Ir.linfty,f=s(o(l(l(p,r),p)),t);a=a(f,t=s(o(l(l(p,t),p)),r)),i=i(f,t),c(a)&&(a=l(l(l(p,i),p),n)),c(i)&&(i=l(l(l(p,a),p),n)),e.results=st(u(a),u(i))},Gn.AngleBisector.stateSize=st.stateSize,Gn._helper.IntersectLC=function(e,t){var r=Cr,n=Ir.crossOperator(e),i=Ir.transpose(n);if(t=Or.mult(i,Or.mult(t,n)),0===(i=Ir.maxIndex(e,Cr.abs2))){i=t.value[1].value[1];var a=t.value[1].value[2],o=t.value[2].value[1],l=t.value[2].value[2];e=e.value[0]}else 1===i?(i=t.value[0].value[0],a=t.value[0].value[2],o=t.value[2].value[0],l=t.value[2].value[2],e=e.value[1]):(i=t.value[0].value[0],a=t.value[0].value[1],o=t.value[1].value[0],l=t.value[1].value[1],e=e.value[2]);return r=r.div(r.sqrt(r.sub(r.mult(a,o),r.mult(i,l))),e),r=Ir.add(t,Ir.scalmult(r,n)),i=Ir.maxIndex(r,Ir.abs2),n=r.value[i],n=Ir.normalizeMax(n),n=Or.withUsage(n,"Point"),r=Ir.transpose(r),i=Ir.maxIndex(r,Ir.abs2),r=r.value[i],r=Ir.normalizeMax(r),[n,r=Or.withUsage(r,"Point")]},Gn.IntersectLC={},Gn.IntersectLC.kind="Ps",Gn.IntersectLC.signature=["L","C"],Gn.IntersectLC.updatePosition=function(e){var t=Gn._helper.IntersectLC(At.csnames[e.args[0]].homog,At.csnames[e.args[1]].matrix);e.results=st(t[0],t[1])},Gn.IntersectLC.stateSize=st.stateSize,Gn.OtherIntersectionCL={},Gn.OtherIntersectionCL.kind="P",Gn.OtherIntersectionCL.signature=["C","L","P"],Gn.OtherIntersectionCL.updatePosition=function(e){var t=At.csnames[e.args[2]].homog,r=Gn._helper.IntersectLC(At.csnames[e.args[1]].homog,At.csnames[e.args[0]].matrix),n=r[0];r=r[1];var i=Ir.projectiveDistMinScal(n,t);t=Ir.projectiveDistMinScal(r,t),e.homog=i<t?r:n,e.homog=Ir.normalizeMax(e.homog),e.homog=Or.withUsage(e.homog,"Point")},Gn.IntersectCirCir={},Gn.IntersectCirCir.kind="Ps",Gn.IntersectCirCir.signature=["C","C"],Gn.IntersectCirCir.updatePosition=function(e){var t=At.csnames[e.args[0]].matrix,r=At.csnames[e.args[1]].matrix,n=Ir.scalmult(r.value[0].value[0],t.value[2]);r=Ir.scalmult(t.value[0].value[0],r.value[2]),n=Ir.sub(n,r),n=Ir.turnIntoCSList([n.value[0],n.value[1],Cr.realmult(.5,n.value[2])]),n=Ir.normalizeMax(n),t=Gn._helper.IntersectLC(n,t),e.results=st(t[0],t[1])},Gn.IntersectCirCir.stateSize=st.stateSize,Gn.OtherIntersectionCC={},Gn.OtherIntersectionCC.kind="P",Gn.OtherIntersectionCC.signature=["C","C","P"],Gn.OtherIntersectionCC.updatePosition=function(e){var t=At.csnames[e.args[0]].matrix,r=At.csnames[e.args[1]].matrix,n=At.csnames[e.args[2]].homog,i=Ir.scalmult(r.value[0].value[0],t.value[2]);r=Ir.scalmult(t.value[0].value[0],r.value[2]),i=Ir.sub(i,r),i=Ir.turnIntoCSList([i.value[0],i.value[1],Cr.realmult(.5,i.value[2])]),i=Ir.normalizeMax(i),t=(i=Gn._helper.IntersectLC(i,t))[0],i=i[1],r=Ir.projectiveDistMinScal(t,n),n=Ir.projectiveDistMinScal(i,n),e.homog=r<n?i:t,e.homog=Ir.normalizeMax(e.homog),e.homog=Or.withUsage(e.homog,"Point")},Gn._helper.IntersectConicConic=function(e,t){var r=e.value[0],n=e.value[1],i=e.value[2],a=t.value[0],o=t.value[1],l=t.value[2],s=Ir.det3(r,n,i),u=Cr.add(Cr.add(Ir.det3(r,n,l),Ir.det3(r,o,i)),Ir.det3(a,n,i));return r=Cr.add(Cr.add(Ir.det3(r,o,l),Ir.det3(a,n,l)),Ir.det3(a,o,i)),a=Ir.det3(a,o,l),(l=Cr.abs2(s).value.real)<(o=Cr.abs2(a).value.real)&&(l=e,e=t,t=l,l=a,a=s,s=l,l=r,r=u,u=l,l=o),1e-24>l?(s=e,u=t):(u=Cr.solveCubic(s,u,r,a),r=Cr.abs2(Cr.sub(u[0],u[1])).value.real,a=Cr.abs2(Cr.sub(u[0],u[2])).value.real,o=Cr.abs2(Cr.sub(u[1],u[2])).value.real,r>a?(s=u[1],u=r>o?u[0]:u[2]):(s=u[2],u=a>o?u[0]:u[1]),s=Ir.add(Ir.scalmult(s,e),t),u=Ir.add(Ir.scalmult(u,e),t)),e=(t=Gn._helper.splitDegenConic(s))[0],t=t[1],r=(s=Gn._helper.splitDegenConic(u))[0],u=s[1],s=Ir.cross(e,r),r=Ir.cross(t,r),e=Ir.cross(e,u),t=Ir.cross(t,u),s=Ir.normalizeMax(s),r=Ir.normalizeMax(r),e=Ir.normalizeMax(e),t=Ir.normalizeMax(t),[s=Or.withUsage(s,"Point"),r=Or.withUsage(r,"Point"),e=Or.withUsage(e,"Point"),t=Or.withUsage(t,"Point")]},Gn.IntersectConicConic={},Gn.IntersectConicConic.kind="Ps",Gn.IntersectConicConic.signature=["C","C"],Gn.IntersectConicConic.updatePosition=function(e){var t=Gn._helper.IntersectConicConic(At.csnames[e.args[0]].matrix,At.csnames[e.args[1]].matrix);t=ct(t[0],t[1],t[2],t[3]),e.results=t},Gn.IntersectConicConic.stateSize=ct.stateSize,Gn.SelectP={},Gn.SelectP.kind="P",Gn.SelectP.signature=["Ps"],Gn.SelectP.initialize=function(e){if(void 0!==e.index)return e.index-1;var t=At.csnames[e.args[0]].results.value;e=Gn._helper.initializePoint(e);for(var r=Ir.projectiveDistMinScal(e,t[0]),n=0,i=1;i<t.length;++i){var a=Ir.projectiveDistMinScal(e,t[i]);a<r&&(r=a,n=i)}return n},Gn.SelectP.updatePosition=function(e){e.homog=At.csnames[e.args[0]].results.value[e.param]},Gn.SelectL={},Gn.SelectL.kind="L",Gn.SelectL.signature=["Ls"],Gn.SelectL.initialize=function(e){if(void 0!==e.index)return e.index-1;var t=At.csnames[e.args[0]].results.value;e=Gn._helper.initializeLine(e);for(var r=Ir.projectiveDistMinScal(e,t[0]),n=0,i=1;i<t.length;++i){var a=Ir.projectiveDistMinScal(e,t[i]);a<r&&(r=a,n=i)}return n},Gn.SelectL.updatePosition=function(e){e.homog=At.csnames[e.args[0]].results.value[e.param],e.homog=Or.withUsage(e.homog,"Line")},Gn._helper.moebiusStep=function(e,t,r){var n=Cr.add,i=Cr.sub,a=Cr.mult,o=e.value[0],l=e.value[1];e=e.value[2];var s=t.value[0],u=t.value[1];t=t.value[2];var c=r.value[0],p=r.value[1],f=r.value[2];r=i(a(t,c),a(s,f));var h=i(a(t,p),a(u,f));return c=i(a(o,f),a(e,c)),p=i(a(l,f),a(e,p)),[i(a(o,r),a(l,h)),n(a(l,r),a(o,h)),a(e,r),a(e,h),i(a(s,c),a(u,p)),n(a(u,c),a(s,p)),a(t,c),a(t,p)]},Gn.TrMoebius={},Gn.TrMoebius.kind="Mt",Gn.TrMoebius.signature="PPPPPP".split(""),Gn.TrMoebius.updatePosition=function(e){var t=Cr.neg,r=Gn._helper.moebiusStep(At.csnames[e.args[0]].homog,At.csnames[e.args[2]].homog,At.csnames[e.args[4]].homog),n=Gn._helper.moebiusStep(At.csnames[e.args[1]].homog,At.csnames[e.args[3]].homog,At.csnames[e.args[5]].homog);n=Ir.normalizeMax(Ir.matrix([[n[0],t(n[1]),n[4],t(n[5])],[n[1],n[0],n[5],n[4]],[n[2],t(n[3]),n[6],t(n[7])],[n[3],n[2],n[7],n[6]]])),t=Ir.normalizeMax(Ir.matrix([[r[6],t(r[4])],[r[7],t(r[5])],[t(r[2]),r[0]],[t(r[3]),r[1]]])),t=Ir.normalizeMax(Ir.productMM(n,t)),e.moebius={anti:!1,ar:t.value[0].value[0],ai:t.value[1].value[0],br:t.value[0].value[1],bi:t.value[1].value[1],cr:t.value[2].value[0],ci:t.value[3].value[0],dr:t.value[2].value[1],di:t.value[3].value[1]},Gn._helper.moebiusPair(e)},Gn._helper.moebiusPair=function(e){var t=e.moebius,r=Cr.neg,n=t.anti?r:Or.identity;t=Ir.normalizeMax(Ir.turnIntoCSList([Ir.matrix([[r(t.cr),n(t.ci),r(t.dr)],[t.ci,n(t.cr),t.di],[t.ar,r(n(t.ai)),t.br]]),Ir.matrix([[r(t.ci),r(n(t.cr)),r(t.di)],[r(t.cr),n(t.ci),r(t.dr)],[t.ai,n(t.ar),t.bi]])])),e.mat1=t.value[0],e.mat2=t.value[1]},Gn._helper.inverseMoebius=function(e){var t=Cr.neg,r=e.anti?t:Or.identity;return{anti:e.anti,ar:e.dr,ai:r(e.di),br:t(e.br),bi:t(r(e.bi)),cr:t(e.cr),ci:t(r(e.ci)),dr:e.ar,di:r(e.ai)}},Gn.TrInverseMoebius={},Gn.TrInverseMoebius.kind="Mt",Gn.TrInverseMoebius.signature=["Mt"],Gn.TrInverseMoebius.updatePosition=function(e){e.moebius=Gn._helper.inverseMoebius(At.csnames[e.args[0]].moebius),Gn._helper.moebiusPair(e)},Gn.TrMoebiusP={},Gn.TrMoebiusP.kind="P",Gn.TrMoebiusP.signature=["Mt","P"],Gn.TrMoebiusP.updatePosition=function(e){var t=At.csnames[e.args[0]],r=At.csnames[e.args[1]].homog,n=Ir.productMV(t.mat1,r);t=Ir.productMV(t.mat2,r),e.homog=Ir.normalizeMax(Ir.cross(n,t)),e.homog=Or.withUsage(e.homog,"Point")},Gn._helper.TrMoebiusP=function(e,t){var r=Ir.productMV(t.mat1,e);return e=Ir.productMV(t.mat2,e),Ir.normalizeMax(Ir.cross(r,e))},Gn.TrMoebiusL={},Gn.TrMoebiusL.kind="C",Gn.TrMoebiusL.signature=["Mt","L"],Gn.TrMoebiusL.updatePosition=function(e){var t=At.csnames[e.args[0]],r=At.csnames[e.args[1]].homog,n=function(){var e=Ir.realVector([Math.random()-.5,Math.random()-.5,Math.random()-.5]);return Ir.normalizeMax(e)},i=Ir.cross(n(),r),a=Ir.cross(n(),r);r=Ir.cross(n(),r),i=Gn._helper.TrMoebiusP(i,t),a=Gn._helper.TrMoebiusP(a,t),t=Gn._helper.TrMoebiusP(r,t),e.matrix=Ir.normalizeMax(Gn._helper.ConicBy5(null,i,a,t,Ir.ii,Ir.jj)),e.matrix=Or.withUsage(e.matrix,"Circle")},Gn.TrMoebiusS={},Gn.TrMoebiusS.kind="C",Gn.TrMoebiusS.signature=["Mt","S"],Gn.TrMoebiusS.updatePosition=function(e){var t=At.csnames[e.args[0]],r=At.csnames[e.args[1]],n=r.startpos;r=r.endpos;var i=Ir.add(n,r);n=Gn._helper.TrMoebiusP(n,t),i=Gn._helper.TrMoebiusP(i,t),t=Gn._helper.TrMoebiusP(r,t),e.startPoint=n,e.viaPoint=i,e.endPoint=t,e.isArc=!0,e.matrix=Ir.normalizeMax(Gn._helper.ConicBy5(null,n,i,t,Ir.ii,Ir.jj)),e.matrix=Or.withUsage(e.matrix,"Circle")},Gn.TrMoebiusC={},Gn.TrMoebiusC.kind="C",Gn.TrMoebiusC.signature=["Mt","C"],Gn.TrMoebiusC.signatureConstraints=function(e){return"Circle"===At.csnames[e.args[1]].matrix.usage},Gn.TrMoebiusC.updatePosition=function(e){var t=At.csnames[e.args[0]],r=At.csnames[e.args[1]].matrix,n=function(){var e=Ir.realVector([Math.random()-.5,Math.random()-.5,Math.random()-.5]);return Ir.normalizeMax(e)},i=Gn._helper.IntersectLC(n(),r);n=Gn._helper.IntersectLC(n(),r),r=i[1],n=n[1],i=Gn._helper.TrMoebiusP(i[0],t),r=Gn._helper.TrMoebiusP(r,t),t=Gn._helper.TrMoebiusP(n,t),e.matrix=Ir.normalizeMax(Gn._helper.ConicBy5(null,i,r,t,Ir.ii,Ir.jj)),e.matrix=Or.withUsage(e.matrix,"Circle")},Gn.TrMoebiusArc={},Gn.TrMoebiusArc.kind="C",Gn.TrMoebiusArc.signature=["Mt","C"],Gn.TrMoebiusArc.signatureConstraints=function(e){return At.csnames[e.args[1]].isArc},Gn.TrMoebiusArc.updatePosition=function(e){var t=At.csnames[e.args[0]],r=At.csnames[e.args[1]],n=r.viaPoint,i=r.endPoint;r=Gn._helper.TrMoebiusP(r.startPoint,t),n=Gn._helper.TrMoebiusP(n,t),t=Gn._helper.TrMoebiusP(i,t),e.startPoint=r,e.viaPoint=n,e.endPoint=t,e.isArc=!0,e.matrix=Ir.normalizeMax(Gn._helper.ConicBy5(null,r,n,t,Ir.ii,Ir.jj)),e.matrix=Or.withUsage(e.matrix,"Circle")},Gn._helper.trBuildMatrix=function(e,t){var r=t(0);t=t(1);var n=Ir.productMM(t,Ir.adjoint3(r));e.matrix=Ir.normalizeMax(n),n=Ir.transpose(Ir.productMM(r,Ir.adjoint3(t))),e.dualMatrix=Ir.normalizeMax(n)},Gn.TrProjection={},Gn.TrProjection.kind="Tr",Gn.TrProjection.signature="PPPPPPPP".split(""),Gn.TrProjection.initialize=function(e){e.isEuclidean=0},Gn.TrProjection.updatePosition=function(e){Gn._helper.trBuildMatrix(e,(function(t){return Rr.basismap(At.csnames[e.args[0+t]].homog,At.csnames[e.args[2+t]].homog,At.csnames[e.args[4+t]].homog,At.csnames[e.args[6+t]].homog)}))},Gn.TrAffine={},Gn.TrAffine.kind="Tr",Gn.TrAffine.signature="PPPPPP".split(""),Gn.TrAffine.initialize=function(e){e.isEuclidean=0},Gn.TrAffine.updatePosition=function(e){var t=Cr.mult,r=Ir.scalmult,n=Ir.turnIntoCSList,i=Ir.transpose,a=Ir.normalizeMax,o=Ir.productMM,l=Ir.adjoint3,s=n([At.csnames[e.args[0]].homog,At.csnames[e.args[2]].homog,At.csnames[e.args[4]].homog]),u=n([At.csnames[e.args[1]].homog,At.csnames[e.args[3]].homog,At.csnames[e.args[5]].homog]),c=i(s);i=i(u);var p=c.value[2].value,f=i.value[2].value,h=[t(p[0],f[2]),t(p[1],f[0]),t(p[2],f[1])];c=l(c).value,e.matrix=a(o(i,n([r(t(h[0],f[1]),c[0]),r(t(h[1],f[2]),c[1]),r(t(h[2],f[0]),c[2])]))),c=s.value,e.dualMatrix=a(o(l(u),n([r(t(p[2],h[1]),c[0]),r(t(p[0],h[2]),c[1]),r(t(p[1],h[0]),c[2])])))},Gn.TrSimilarity={},Gn.TrSimilarity.kind="Tr",Gn.TrSimilarity.signature=["P","P","P","P"],Gn.TrSimilarity.initialize=function(e){e.isEuclidean=1},Gn.TrSimilarity.updatePosition=function(e){Gn._helper.trBuildMatrix(e,(function(t){return Rr.basismap(At.csnames[e.args[0+t]].homog,At.csnames[e.args[2+t]].homog,Ir.ii,Ir.jj)}))},Gn.TrTranslation={},Gn.TrTranslation.kind="Tr",Gn.TrTranslation.signature=["P","P"],Gn.TrTranslation.initialize=function(e){e.isEuclidean=1},Gn.TrTranslation.updatePosition=function(e){var t=At.csnames[e.args[0]].homog,r=At.csnames[e.args[1]].homog,n=Ir.cross(t,r).value;t=Cr.mult(t.value[2],r.value[2]),r=Ir.turnIntoCSList;var i=Cr.neg,a=Cr.zero;n=r([r([t,a,n[1]]),r([a,t,i(n[0])]),r([a,a,t])]),n=Ir.normalizeMax(n),e.matrix=n,n=r([r([t=i(n.value[0].value[0]),a,a]),r([a,t,a]),r([n.value[0].value[2],n.value[1].value[2],t])]),e.dualMatrix=n},Gn.TrRotationPNumb={},Gn.TrRotationPNumb.kind="Tr",Gn.TrRotationPNumb.signature=["P","V"],Gn.TrRotationPNumb.updatePosition=function(e){var t=At.csnames[e.args[0]].homog.value,r=At.csnames[e.args[1]].value,n=Cr.mult,i=Cr.add,a=Cr.sub,o=Ir.turnIntoCSList,l=Ir.normalizeMax,s=Cr.zero,u=t[0],c=t[1];t=t[2];var p=Cr.cos(r),f=Cr.sin(r),h=a(Cr.real(1),p);r=n(h,u),h=n(h,c),u=n(f,u),c=n(f,c),p=n(p,t),n=n(f,t),f=Cr.neg(n),e.matrix=l(o([o([p,f,i(r,c)]),o([n,p,a(h,u)]),o([s,s,t])])),e.dualMatrix=l(o([o([p,f,s]),o([n,p,s]),o([a(r,c),i(h,u),t])]))},Gn.TrReflectionP={},Gn.TrReflectionP.kind="Tr",Gn.TrReflectionP.signature=["P"],Gn.TrReflectionP.initialize=function(e){e.isEuclidean=1},Gn.TrReflectionP.updatePosition=function(e){var t=At.csnames[e.args[0]].homog.value,r=Cr.realmult(-.5,t[2]),n=Cr.zero;t=Ir.turnIntoCSList([Ir.turnIntoCSList([r,n,t[0]]),Ir.turnIntoCSList([n,r,t[1]]),Ir.turnIntoCSList([n,n,Cr.neg(r)])]),t=Ir.normalizeMax(t),e.matrix=t,e.dualMatrix=Ir.transpose(t)},Gn.TrReflectionL={},Gn.TrReflectionL.kind="Tr",Gn.TrReflectionL.signature=["L"],Gn.TrReflectionL.initialize=function(e){e.isEuclidean=-1},Gn.TrReflectionL.updatePosition=function(e){var t=Cr.mult,r=Cr.realmult,n=Cr.zero,i=At.csnames[e.args[0]].homog.value,a=i[0],o=i[1];i=i[2];var l=t(a,a),s=t(o,o),u=r(-.5,Cr.sub(l,s)),c=t(a,o);t=Ir.turnIntoCSList([Ir.turnIntoCSList([Cr.neg(u),c,t(a,i)]),Ir.turnIntoCSList([c,u,t(o,i)]),Ir.turnIntoCSList([n,n,r(-.5,Cr.add(l,s))])]),t=Ir.normalizeMax(t),e.matrix=t,e.dualMatrix=Ir.transpose(t)},Gn.TrReflectionS={},Gn.TrReflectionS.kind="Tr",Gn.TrReflectionS.signature=["S"],Gn.TrReflectionS.updatePosition=Gn.TrReflectionL.updatePosition,Gn.TrReflectionC={},Gn.TrReflectionC.kind="Mt",Gn.TrReflectionC.signature=["C"],Gn.TrReflectionC.signatureConstraints=function(e){return"Circle"===At.csnames[e.args[0]].matrix.usage},Gn.TrReflectionC.updatePosition=function(e){var t=At.csnames[e.args[0]].matrix,r=t.value[0].value[2],n=t.value[1].value[2],i=Cr.neg;e.moebius={anti:!0,ar:r,ai:n,br:t.value[2].value[2],bi:Cr.zero,cr:i(t.value[0].value[0]),ci:Cr.zero,dr:i(r),di:n},Gn._helper.moebiusPair(e)},Gn.TrInverse={},Gn.TrInverse.kind="Tr",Gn.TrInverse.signature=["Tr"],Gn.TrInverse.initialize=function(e){e.isEuclidean=At.csnames[e.args[0]].isEuclidean},Gn.TrInverse.updatePosition=function(e){var t=At.csnames[e.args[0]];e.dualMatrix=Ir.transpose(t.matrix),e.matrix=Ir.transpose(t.dualMatrix)},Gn.TransformC={},Gn.TransformC.kind="C",Gn.TransformC.signature=["Tr","C"],Gn.TransformC.updatePosition=function(e){var t=At.csnames[e.args[0]].dualMatrix;t=Ir.productMM(Ir.productMM(t,At.csnames[e.args[1]].matrix),Ir.transpose(t)),t=Ir.normalizeMax(t),e.matrix=Or.withUsage(t,"Conic")},Gn.TransformArc={},Gn.TransformArc.kind="C",Gn.TransformArc.signature=["Tr","C"],Gn.TransformArc.signatureConstraints=function(e){return At.csnames[e.args[0]].isArc},Gn.TransformArc.updatePosition=function(e){var t=At.csnames[e.args[0]].matrix,r=At.csnames[e.args[1]],n=r.viaPoint,i=r.endPoint;r=Ir.normalizeMax(Ir.productMV(t,r.startPoint)),n=Ir.normalizeMax(Ir.productMV(t,n)),t=Ir.normalizeMax(Ir.productMV(t,i)),e.startPoint=r,e.viaPoint=n,e.endPoint=t,e.isArc=!0,e.matrix=Ir.normalizeMax(Gn._helper.ConicBy5(null,r,n,t,Ir.ii,Ir.jj)),e.matrix=Or.withUsage(e.matrix,"Circle")},Gn.TransformP={},Gn.TransformP.kind="P",Gn.TransformP.signature=["Tr","P"],Gn.TransformP.updatePosition=function(e){e.homog=Ir.normalizeMax(Ir.productMV(At.csnames[e.args[0]].matrix,At.csnames[e.args[1]].homog)),e.homog=Or.withUsage(e.homog,"Point")},Gn.TransformL={},Gn.TransformL.kind="L",Gn.TransformL.signature=["Tr","L"],Gn.TransformL.updatePosition=function(e){e.homog=Ir.normalizeMax(Ir.productMV(At.csnames[e.args[0]].dualMatrix,At.csnames[e.args[1]].homog)),e.homog=Or.withUsage(e.homog,"Line")},Gn.TransformS={},Gn.TransformS.kind="S",Gn.TransformS.signature=["Tr","S"],Gn.TransformS.updatePosition=function(e){var t=At.csnames[e.args[0]],r=At.csnames[e.args[1]];Gn.Segment.setSegmentPos(e,Ir.productMV(t.dualMatrix,r.homog),Ir.productMV(t.matrix,r.startpos),Ir.productMV(t.matrix,r.endpos))},Gn.TransformPolygon={},Gn.TransformPolygon.kind="Poly",Gn.TransformPolygon.signature=["Tr","Poly"],Gn.TransformPolygon.updatePosition=function(e){var t=At.csnames[e.args[0]].matrix;e.vertices=Ir.turnIntoCSList(At.csnames[e.args[1]].vertices.value.map((function(e){return e=Ir.normalizeMax(Ir.productMV(t,e)),Or.withUsage(e,"Point")})))},Gn.TrComposeTrTr={},Gn.TrComposeTrTr.kind="Tr",Gn.TrComposeTrTr.signature=["Tr","Tr"],Gn.TrComposeTrTr.initialize=function(e){e.isEuclidean=At.csnames[e.args[0]].isEuclidean*At.csnames[e.args[1]].isEuclidean},Gn.TrComposeTrTr.updatePosition=function(e){var t=At.csnames[e.args[0]],r=At.csnames[e.args[1]];e.matrix=Ir.normalizeMax(Ir.productMM(r.matrix,t.matrix)),e.dualMatrix=Ir.normalizeMax(Ir.productMM(r.dualMatrix,t.dualMatrix))},Gn._helper.composeMtMt=function(e,t,r){function n(e,t,r,n){return o(s(e,t),s(r,n))}function i(e,t,r,i,a,l,s,u){return o(n(e,t,r,i),n(a,l,s,u))}function a(e,t,r,i,a,o,s,u){return l(n(e,t,r,i),n(a,o,s,u))}var o=Cr.add,l=Cr.sub,s=Cr.mult,u=r.anti?a:i,c=r.anti?i:a;u=Ir.normalizeMax(Ir.turnIntoCSList([c(t.ar,r.ar,t.cr,r.br,t.ai,r.ai,t.ci,r.bi),u(t.ar,r.ai,t.cr,r.bi,t.ai,r.ar,t.ci,r.br),c(t.br,r.ar,t.dr,r.br,t.bi,r.ai,t.di,r.bi),u(t.br,r.ai,t.dr,r.bi,t.bi,r.ar,t.di,r.br),c(t.ar,r.cr,t.cr,r.dr,t.ai,r.ci,t.ci,r.di),u(t.ar,r.ci,t.cr,r.di,t.ai,r.cr,t.ci,r.dr),c(t.br,r.cr,t.dr,r.dr,t.bi,r.ci,t.di,r.di),u(t.br,r.ci,t.dr,r.di,t.bi,r.cr,t.di,r.dr)])).value,e.moebius={anti:t.anti!==r.anti,ar:u[0],ai:u[1],br:u[2],bi:u[3],cr:u[4],ci:u[5],dr:u[6],di:u[7]},Gn._helper.moebiusPair(e)},Gn._helper.euc2moeb=function(e){var t=e.matrix.value;return{anti:0>e.isEuclidean,ar:t[0].value[0],ai:t[1].value[0],br:t[0].value[2],bi:t[1].value[2],cr:Cr.zero,ci:Cr.zero,dr:t[2].value[2],di:Cr.zero}},Gn.TrComposeMtMt={},Gn.TrComposeMtMt.kind="Mt",Gn.TrComposeMtMt.signature=["Mt","Mt"],Gn.TrComposeMtMt.updatePosition=function(e){Gn._helper.composeMtMt(e,At.csnames[e.args[0]].moebius,At.csnames[e.args[1]].moebius)},Gn.TrComposeTrMt={},Gn.TrComposeTrMt.kind="Mt",Gn.TrComposeTrMt.signature=["Tr","Mt"],Gn.TrComposeTrMt.signatureConstraints=function(e){return!!At.csnames[e.args[0]].isEuclidean},Gn.TrComposeTrMt.updatePosition=function(e){Gn._helper.composeMtMt(e,Gn._helper.euc2moeb(At.csnames[e.args[0]]),At.csnames[e.args[1]].moebius)},Gn.TrComposeMtTr={},Gn.TrComposeMtTr.kind="Mt",Gn.TrComposeMtTr.signature=["Mt","Tr"],Gn.TrComposeMtTr.signatureConstraints=function(e){return!!At.csnames[e.args[1]].isEuclidean},Gn.TrComposeMtTr.updatePosition=function(e){Gn._helper.composeMtMt(e,At.csnames[e.args[0]].moebius,Gn._helper.euc2moeb(At.csnames[e.args[1]]))},Gn._helper.pointReflection=function(e,t){return Ir.normalizeMax(Ir.sub(Ir.scalmult(Cr.realmult(2,t.value[2]),e),Ir.scalmult(e.value[2],t)))},Gn._helper.conicOtherIntersection=function(e,t,r){var n=Ir.productMV(e,r);return e=Ir.scalproduct(r,n),n=Ir.scalproduct(t,n),n=Cr.realmult(-2,n),t=Ir.scalmult(e,t),r=Ir.scalmult(n,r),r=Ir.add(t,r),Ir.normalizeMax(r)},Gn.Dist={},Gn.Dist.kind="V",Gn.Dist.signature=["P","P"],Gn.Dist.updatePosition=function(e){var t=At.csnames[e.args[1]].homog;e.value=Ir.abs(Ir.sub(Ir.normalizeZ(At.csnames[e.args[0]].homog),Ir.normalizeZ(t)))},Gn.Angle={},Gn.Angle.kind="V",Gn.Angle.signature=["L","L","P"],Gn.Angle.initialize=function(e){void 0===e.angle&&(e.angle=.5*Math.PI),ot(Cr._helper.input(e.angle))},Gn.Angle.updatePosition=function(e){var t=At.csnames[e.args[1]].homog,r=At.csnames[e.args[2]].homog,n=Ir.cross(At.csnames[e.args[0]].homog,Ir.linfty);t=Ir.cross(t,Ir.linfty),r=Ir.crossratio3(n,t,Ir.ii,Ir.jj,r),r=Cr.mult(Cr.complex(0,.5),Cr.log(r)),n=(it().value.real-r.value.real)/Math.PI,t=Math.round(n),!jn&&.01<Math.abs(t-n)&&Ke(),ot(r=Cr.complex(t*Math.PI+r.value.real,r.value.imag)),e.value=Or.withUsage(r,"Angle")},Gn.Angle.stateSize=2,Gn.Text={},Gn.Text.kind="Text",Gn.Text.signature="**",Gn.Text.isMovable=!0,Gn.Text.updatePosition=Pt,Gn.Text.initialize=function(e){e.text=String(e.text),e.pos&&(e.homog=Gn._helper.initializePoint(e)),e.dock&&(e.dock.offset=e.dock.offset&&2===e.dock.offset.length?Ir.realVector([+e.dock.offset[0],+e.dock.offset[1]]):Ir.realVector([0,0]))},Gn.Text.getParamForInput=function(e,t,r){return Gn.Free.getParamForInput(e,t,r)},Gn.Text.getParamFromState=function(e){return e.homog},Gn.Text.putParamToState=function(e,t){e.homog=t},Gn.Calculation={},Gn.Calculation.kind="Text",Gn.Calculation.signature="**",Gn.Calculation.isMovable=!0,Gn.Calculation.updatePosition=Pt,Gn.Calculation.initialize=function(e){Gn.Text.initialize(e),e.calculation=me(e.text)},Gn.Calculation.getText=function(e){return R(he(e.calculation))},Gn.Calculation.getParamForInput=Gn.Text.getParamForInput,Gn.Calculation.getParamFromState=Gn.Text.getParamFromState,Gn.Calculation.putParamToState=Gn.Text.putParamToState,Gn.Equation={},Gn.Equation.kind="Text",Gn.Equation.isMovable=!0,Gn.Equation.signature="**",Gn.Equation.updatePosition=Pt,Gn.Equation.initialize=function(e){Gn.Text.initialize(e),e.calculation=me(e.text)},Gn.Equation.getText=function(e){return e.text+" = "+R(he(e.calculation))},Gn.Equation.getParamForInput=Gn.Text.getParamForInput,Gn.Equation.getParamFromState=Gn.Text.getParamFromState,Gn.Equation.putParamToState=Gn.Text.putParamToState,Gn.Evaluate={},Gn.Evaluate.kind="Text",Gn.Evaluate.isMovable=!0,Gn.Evaluate.signature="**",Gn.Evaluate.updatePosition=Pt,Gn.Evaluate.initialize=function(e){Gn.Text.initialize(e),e.calculation=me(e.text)},Gn.Evaluate.getText=function(e){return he(e.calculation),e.text},Gn.Evaluate.getParamForInput=Gn.Text.getParamForInput,Gn.Evaluate.getParamFromState=Gn.Text.getParamFromState,Gn.Evaluate.putParamToState=Gn.Text.putParamToState,Gn.Plot={},Gn.Plot.kind="Text",Gn.Plot.isMovable=!0,Gn.Plot.signature="**",Gn.Plot.updatePosition=Pt,Gn.Plot.initialize=function(e){Gn.Text.initialize(e),e.calculation=me("plot(("+e.text+"))")},Gn.Plot.getText=function(e){return he(e.calculation),e.text},Gn.Plot.getParamForInput=Gn.Text.getParamForInput,Gn.Plot.getParamFromState=Gn.Text.getParamFromState,Gn.Plot.putParamToState=Gn.Text.putParamToState,Gn.Button={},Gn.Button.kind="Text",Gn.Button.signature="**",Gn.Button.isMovable=!0,Gn.Button.updatePosition=Pt,Gn.Button.initialize=function(e){xt(e,"click",document.createElement("button"))},Gn.Button.getParamForInput=Gn.Text.getParamForInput,Gn.Button.getParamFromState=Gn.Text.getParamFromState,Gn.Button.putParamToState=Gn.Text.putParamToState,Gn.Button.set_fillcolor=function(e,t){Ir._helper.isNumberVecN(t,3)&&(e.fillcolor=t.value.map((function(e){return e.value.real})),e.html.style.backgroundColor=dn.makeColor(e.fillcolor,e.fillalpha))},Gn.Button.set_color=function(e,t){Ir._helper.isNumberVecN(t,3)&&(e.color=t.value.map((function(e){return e.value.real})),e.html.style.color=dn.makeColor(e.color,e.alpha))},Gn.ToggleButton={},Gn.ToggleButton.kind="Text",Gn.ToggleButton.signature="**",Gn.ToggleButton.isMovable=!0,Gn.ToggleButton.updatePosition=Pt,Gn.ToggleButton.initialize=function(e){var t=void 0;void 0===t&&(t="CindyJSid"),t+=++f;var r=document.createElement("input"),n=document.createElement("label");r.setAttribute("id",t),n.setAttribute("for",t),r.setAttribute("type","checkbox"),e.pressed&&(r.checked=!0),e.checkbox=r,xt(e,"change",r,n)},Gn.ToggleButton.get_text=function(e){return Or.string(String(e.text))},Gn.ToggleButton.set_currenttext=function(e,t){e.html.value=e.text=R(t)},Gn.ToggleButton.getParamForInput=Gn.Text.getParamForInput,Gn.ToggleButton.getParamFromState=Gn.Text.getParamFromState,Gn.ToggleButton.putParamToState=Gn.Text.putParamToState,Gn.ToggleButton.set_fillcolor=Gn.Button.set_fillcolor,Gn.ToggleButton.set_color=Gn.Button.set_color,Gn.ToggleButton.set_text=Gn.ToggleButton.set_currenttext,Gn.ToggleButton.get_val=Gn.ToggleButton.get_text,Gn.ToggleButton.set_val=Gn.ToggleButton.set_currenttext,Gn.EditableText={},Gn.EditableText.kind="Text",Gn.EditableText.isMovable=!0,Gn.EditableText.signature=[],Gn.EditableText.updatePosition=Pt,Gn.EditableText.initialize=function(e){var t=document.createElement("input");t.setAttribute("type","text"),t.className="CindyJS-editabletext",Qt(e.minwidth)&&(t.style.width=e.minwidth-3+"px"),"string"==typeof e.text&&(t.value=e.text),t.addEventListener("keydown",(function(r){13===r.keyCode&&(e.text=e.html.value,t.blur())})),t.addEventListener("change",(function(t){e.text=e.html.value})),xt(e,"change",t)},Gn.EditableText.getText=function(e){return!1},Gn.EditableText.getParamForInput=Gn.Text.getParamForInput,Gn.EditableText.getParamFromState=Gn.Text.getParamFromState,Gn.EditableText.putParamToState=Gn.Text.putParamToState,Gn.EditableText.set_fillcolor=Gn.Button.set_fillcolor,Gn.EditableText.set_color=Gn.Button.set_color,Gn.EditableText.get_currenttext=function(e){return Or.string(String(e.html.value))},Gn.EditableText.get_text=Gn.ToggleButton.get_text,Gn.EditableText.set_currenttext=Gn.ToggleButton.set_currenttext,Gn.EditableText.set_text=Gn.EditableText.set_currenttext,Gn.EditableText.get_val=Gn.EditableText.get_text,Gn.EditableText.set_val=Gn.EditableText.set_currenttext,Gn._helper.initializePoint=function(e){var t=0,r=0,n=0;if(e.pos){if("list"===e.pos.ctype&&Ir.isNumberVector(e.pos))return e.pos;2===e.pos.length&&(t=e.pos[0],r=e.pos[1],n=1),3===e.pos.length&&(t=e.pos[0],r=e.pos[1],n=e.pos[2])}return e=Ir.turnIntoCSList([Cr._helper.input(t),Cr._helper.input(r),Cr._helper.input(n)]),Ir.normalizeMax(e)},Gn._helper.initializeLine=function(e){var t=0,r=0,n=0;if(e.pos){if("list"===e.pos.ctype&&Ir.isNumberVector(e.pos))return e.pos;3===e.pos.length&&(t=e.pos[0],r=e.pos[1],n=e.pos[2])}return e=Ir.turnIntoCSList([Cr._helper.input(t),Cr._helper.input(r),Cr._helper.input(n)]),Ir.normalizeMax(e)},Gn.Poly={},Gn.Poly.kind="Poly",Gn.Poly.signature="P*",Gn.Poly.updatePosition=function(e){e.vertices=Ir.turnIntoCSList(e.args.map((function(e){return At.csnames[e].homog})))};var Hn=null;Gn.IFS={},Gn.IFS.kind="IFS",Gn.IFS.signature="**",Gn.IFS.signatureConstraints=function(e){for(var t=0;t<e.args.length;++t){var r=At.csnames[e.args[t]].kind;if("Tr"!==r&&"Mt"!==r)return!1}return 0<e.args.length},Gn.IFS.initialize=function(e){if(Hn)Hn.dirty=!0;else if(!1!==(e=kt.getBaseDir())){var t=(Hn={dirty:!1,params:{generation:0}}).worker=new Worker(e+"ifs.js");t.onmessage=function(e){if(Hn.img&&"function"==typeof Hn.img.close&&Hn.img.close(),!sr){if((e=e.data).generation===Hn.params.generation){if(e.buffer){Hn.canvas||(Hn.canvas=document.createElement("canvas"),Hn.ctx=Hn.canvas.getContext("2d")),Hn.canvas.width=e.width,Hn.canvas.height=e.height;var r=new Uint8ClampedArray(e.buffer,e.imgPtr,e.width*e.height*4);r=new ImageData(r,e.width,e.height),Hn.ctx.putImageData(r,0,0),Hn.img=Hn.canvas}else Hn.img=e.img;M()}else Hn.img=null;e.buffer?t.postMessage({cmd:"next",buffer:e.buffer},[e.buffer]):t.postMessage({cmd:"next"})}},lr.push(t.terminate.bind(t))}},Gn.IFS.updatePosition=function(e){Hn.dirty=!0},Gn.IFS.updateParameters=function(){if(Hn.worker){var e={cmd:"init",generation:Hn.params.generation,width:Math.round(4*Et),height:Math.round(4*Ot)};e.systems=At.ifs.map((function(e){var t,r=0,n=e.ifs||[],i=e.args.map((function(e,t){return{prob:(e=n[t]||{}).prob||1,color:e.color||[0,0,0]}}));for(t=0;t<i.length;++t)r+=i[t].prob;t=Ir.realMatrix([[1,0,0],[0,1,0],[0,0,4]]);var a=Ir.productMM(In.toMat(),t);for(t=0;t<e.args.length;++t){var o=At.csnames[e.args[t]],l=o.kind,s=i[t];if(s.kind=l,s.prob/=r,"Tr"===l)o=Ir.normalizeMax(Ir.productMM(Ir.adjoint3(a),Ir.productMM(o.matrix,a))),Ir._helper.isAlmostReal(o)?s.mat=o.value.map((function(e){return e.value.map((function(e){return e.value.real}))})):s.kind="cplx";else if("Mt"===l){l={anti:0<(l=In.drawingstate.matrix).det,ar:Cr.real(l.a),ai:Cr.real(l.c),br:Cr.real(l.tx),bi:Cr.real(-l.ty),cr:Cr.zero,ci:Cr.zero,dr:Cr.real(.25),di:Cr.zero};var u={};Gn._helper.composeMtMt(u,o.moebius,l),l=Gn._helper.inverseMoebius(l),Gn._helper.composeMtMt(u,l,u.moebius),l=u.moebius,l=Ir.turnIntoCSList([l.ar,l.ai,l.br,l.bi,l.cr,l.ci,l.dr,l.di]),Ir._helper.isAlmostReal(l)?(l=l.value,s.moebius={ar:l[0].value.real,ai:l[1].value.real,br:l[2].value.real,bi:l[3].value.real,cr:l[4].value.real,ci:l[5].value.real,dr:l[6].value.real,di:l[7].value.real,sign:o.moebius.anti?-1:1}):s.kind="cplx"}}return{trafos:i}})),Or.deeplyEqual(e,Hn.params)||(++e.generation,Hn.img=null,Hn.params=e,Hn.mat=In.drawingstate.matrix,Hn.worker.postMessage(e))}},Gn.IFS.probSetter=function(e,t,r){"number"===r.ctype&&(t.ifs[e].prob=r.value.real,Hn.dirty=!0)},function(){for(var e=0;10>e;++e)Gn.IFS["set_prob"+e]=Gn.IFS.probSetter.bind(null,e)}(),Gn._helper.snapPointToLine=function(e,t){if(Cr._helper.isAlmostZero(e.value[2]))return e;var r=Gn._helper.projectPointToLine(e,t),n=(r=Ir.normalizeZ(r)).value[0].value.real;r=r.value[1].value.real;var i=Math.round(n/Ut)*Ut,a=Math.round(r/Ut)*Ut,o=Ir.realVector([i,a,1]);return Math.abs(i-n)<Gt&&Math.abs(a-r)<Gt&&Cr._helper.isAlmostZero(Ir.scalproduct(t,o))&&(e=Gn._helper.projectPointToLine(o,t)),e};var Jn={CircleByRadius:"CircleMr",IntersectionCircleCircle:"IntersectCirCir",IntersectionConicConic:"IntersectConicConic",FreePoint:"Free",Orthogonal:"Perp",Parallel:"Para",Pole:"PolarOfLine",Polar:"PolarOfPoint",Arc:"ArcBy3",EuclideanMid:"Mid",AngularBisector:"AngleBisector",TransformConic:"TransformC",TransformSegment:"TransformS",TrMoebiusSegment:"TrMoebiusS",ReflectCC:"TrMoebiusC",ReflectCL:"TrMoebiusL",ReflectCP:"TrMoebiusP",ReflectCArc:"TrMoebiusArc",ReflectCS:"TrMoebiusS",TrMoebiusCircle:"TrMoebiusC"},Zn={CircleMFixedr:function(e){return e.pinned=!0,e.type="CircleMr",[e]},CircleByFixedRadius:function(e){return e.pinned=!0,e.type="CircleMr",[e]},IntersectionConicLine:function(e){return e.args=[e.args[1],e.args[0]],e.type="IntersectLC",[e]},angleBisector:function(e){var t={name:e.name+"_Intersection",type:"Meet",args:e.args,visible:!1};return e.type="AngleBisector",e.args=[e.args[0],e.args[1],t.name],[t,e]},Transform:function(e){var t=At.csnames[e.args[1]];return t={Tr:"Transform",Mt:"TrMoebius"}[At.csnames[e.args[0]].kind]+(t.isArc?"Arc":t.kind),Gn.hasOwnProperty(t)?(e.type=t,[e]):(console.log(t+" not implemented yet"),[])},TrReflection:function(e){var t="TrReflection"+At.csnames[e.args[0]].kind;return Gn.hasOwnProperty(t)?(e.type=t,[e]):(console.log(t+" not implemented yet"),[])},TrCompose:function(e){var t="TrCompose"+e.args.map((function(e){return At.csnames[e].kind})).join("");return Gn.hasOwnProperty(t)?(e.type=t,[e]):(console.log(t+" not implemented yet"),[])}},Kn="align alpha angle args arrow arrowposition arrowshape arrowsides arrowsize clip color dashtype drawtrace fillalpha fillcolor filled labeled labelpos name overhang pinned printname radius size text text_fontfamily textbold textitalics textsize tracedim tracelength traceskip tracing type visible".split(" ");ur.saveState=function(){return{geometry:_t()}};var Qn,ei={},ti=[[],[.2],[.075,.225],[44/45,-56/15,32/9],[19372/6561,-25360/2187,64448/6561,-212/729],[9017/3168,-355/33,46732/5247,49/176,-5103/18656],[35/384,0,500/1113,125/192,-2187/6784,11/84]],ri=[0,.2,.3,.8,8/9,1,1],ni=[35/384,0,500/1113,125/192,-2187/6784,11/84,0],ii=[5179/57600,0,7571/16695,.6140625,-92097/339200,187/2100,.025],ai=[],oi=[],li=!1;ei.tick=function(e){e/=Xt;for(var t=0;t<Xt;t++)ei.tick1(e),Dt+=e,he(Rt.simulationstep)},ei.tick1=function(e){for(var t=e,r=0;0<e&&r<.999*e||0>e&&r>.999*e;)r+=t=ei.oneRKStep(t),t=Math.min(2*t,e-r),t=Math.max(t,1e-16),ei.restorePosition(),ei.doCollisions(),ei.calculateForces(),ei.moveToFinalPos();return!0},ei.restorePosition=function(){Qn.forEach((function(e){si[e.type].restorePos(e,9)}))},ei.doCollisions=function(){Qn.forEach((function(e){si[e.type].doCollisions(e)}))},ei.calculateForces=function(){Qn.forEach((function(e){si[e.type].calculateForces(e)}))},ei.moveToFinalPos=function(){Qn.forEach((function(e){si[e.type].move(e)}))},ei.oneRKStep=function(e){for(var t=function(e){Qn.forEach((function(t){si[t.type].initRK(t,e),si[t.type].storePosition(t)}))},r=function(e){Qn.forEach((function(t){si[t.type].setToTimestep(t,ri[e])}))},n=function(e){Qn.forEach((function(t){si[t.type].proceedMotion(t,ri[e],e,ti[e])}))},i=function(e){Qn.forEach((function(t){si[t.type].calculateDelta(t,e)}))},a=function(t){var r=0;return Qn.forEach((function(e){si[e.type].proceedMotion(e,ri[6],7,ni),si[e.type].savePos(e,8),si[e.type].proceedMotion(e,ri[6],7,ii),si[e.type].savePos(e,9),r+=si[e.type].sqDist(e,8,9)})),r=Math.sqrt(r)/e},o=!1;!o;){t(e);for(var l=0;7>l;l++)r(l),n(l),Qn.forEach((function(e){si[e.type].resetForces(e)})),ei.calculateForces(),i(l);a()>si.env.errorbound&&e>si.env.lowestdeltat?(e/=si.env.slowdownfactor,Qn.forEach((function(e){si[e.type].recallPosition(e)}))):o=!0}return e};var si={Mass:{reset:function(e,t){e.vel=[0,0,0],e.pos=[0,0,0,0],e.el=t,void 0===e.mass&&(e.mass=1),void 0===e.charge&&(e.charge=0),void 0===e.friction&&(e.friction=0),e.lnfrict=0,void 0===e.limitspeed&&(e.limitspeed=!1),void 0===e.fixed&&(e.fixed=!1),void 0===e.radius&&(e.radius=1),e.internalmove=!1,e.fx=0,e.fy=0,e.fz=0,e.vx=e.vx||0,e.vy=e.vy||0,e.vz=e.vz||0,e.mtype=0,e.env=si.env,e.deltat=0,e.mx=0,e.my=0,e.mz=0,e.mvx=0,e.mvy=0,e.mvz=0,e.dx=[0,0,0,0,0,0,0,0,0,0],e.dy=[0,0,0,0,0,0,0,0,0,0],e.dz=[0,0,0,0,0,0,0,0,0,0],e.dvx=[0,0,0,0,0,0,0,0,0,0],e.dvy=[0,0,0,0,0,0,0,0,0,0],e.dvz=[0,0,0,0,0,0,0,0,0,0],e.midx=0,e.midy=0,e.midz=0,e.lx=0,e.ly=0,e.lz=0},resetForces:function(e){e.fx=0,e.fy=0,e.fz=0},getBlock:!1,setToTimestep:function(e,t,r){},initRK:function(e,t){var r=Rr.extractPoint(e.el.homog);e.x=r.x,e.y=r.y,e.z=0,e.xo=e.x,e.yo=e.y,e.zo=e.z,e.vxo=e.vx,e.vyo=e.vy,e.vzo=e.vz,e.deltat=t,e.fx=0,e.fy=0,e.fz=0},setVelocity:function(e,t,r,n){n||(n=0),e.vx=t,e.vy=r,e.vz=n},move:function(e){e.pos=[e.x,e.y,1],e.internalmove=!0,fr&&hr.down&&e.el===fr.mover||et(e.el,Ir.realVector(e.pos),"homog"),e.el.sx=e.x,e.el.sy=e.y,e.internalmove=!1},proceedMotion:function(e,t,r,n){if(!e.fixed)for(e.x=e.mx,e.y=e.my,e.z=e.mz,e.vx=e.mvx,e.vy=e.mvy,e.vz=e.mvz,t=0;t<r;t++)e.x+=n[t]*e.dx[t]*e.deltat,e.y+=n[t]*e.dy[t]*e.deltat,e.z+=n[t]*e.dz[t]*e.deltat,e.vx+=n[t]*e.dvx[t]*e.deltat,e.vy+=n[t]*e.dvy[t]*e.deltat,e.vz+=n[t]*e.dvz[t]*e.deltat},calculateForces:function(e){var t=Math.sqrt(e.vx*e.vx+e.vy*e.vy+e.vz*e.vz);e.lnfrict=-Math.log((1-e.friction)*(1-e.env.friction)*(.1<t&&e.limitSpeed?.1/t:1)),e.fx+=-e.vx*e.lnfrict*e.mass,e.fy+=-e.vy*e.lnfrict*e.mass,e.fz+=-e.vz*e.lnfrict*e.mass},calculateDelta:function(e,t){e.dx[t]=e.vx,e.dy[t]=e.vy,e.dz[t]=e.vz,e.dvx[t]=e.fx/e.mass,e.dvy[t]=e.fy/e.mass,e.dvz[t]=e.fz/e.mass},savePos:function(e,t){e.dx[t]=e.x,e.dy[t]=e.y,e.dz[t]=e.z,e.dvx[t]=e.vx,e.dvy[t]=e.vy,e.dvz[t]=e.vz},restorePos:function(e,t){e.fixed||(e.x=e.dx[t],e.y=e.dy[t],e.z=e.dz[t],e.vx=e.dvx[t],e.vy=e.dvy[t],e.vz=e.dvz[t])},sqDist:function(e,t,r){var n=(e.dx[t]-e.dx[r])*(e.dx[t]-e.dx[r]);return n+=(e.dy[t]-e.dy[r])*(e.dy[t]-e.dy[r]),n+=(e.dz[t]-e.dz[r])*(e.dz[t]-e.dz[r]),n+=(e.dvx[t]-e.dvx[r])*(e.dvx[t]-e.dvx[r]),(n+=(e.dvy[t]-e.dvy[r])*(e.dvy[t]-e.dvy[r]))+(e.dvz[t]-e.dvz[r])*(e.dvz[t]-e.dvz[r])},kineticEnergy:function(e){return.5*e.mass*(e.vx*e.vx+e.vy*e.vy+e.vz*e.vz)},storePosition:function(e){e.mx=e.x,e.my=e.y,e.mz=e.z,e.mvx=e.vx,e.mvy=e.vy,e.mvz=e.vz},recallPosition:function(e){e.fixed||(e.x=e.mx,e.y=e.my,e.z=e.mz,e.vx=e.mvx,e.vy=e.mvy,e.vz=e.mvz)},doCollisions:function(e){}},Sun:{reset:function(e,t){e.vel=[0,0,0],e.pos=[0,0,0,0],e.el=t,void 0===e.mass&&(e.mass=10),void 0===e.friction&&(e.friction=0),e.charge=0,e.x=0,e.y=0,e.z=0},resetForces:function(e){},getBlock:!1,setToTimestep:function(e,t,r){},initRK:function(e,t){t=Rr.extractPoint(e.el.homog),e.x=t.x,e.y=t.y,e.z=0},setVelocity:function(e,t,r,n){},move:function(e){},proceedMotion:function(e,t,r,n){},calculateDelta:function(e,t){},calculateForces:function(e){for(var t=e.x,r=e.y,n=e.z,i=0;i<ai.length;i++){var a=ai[i],o=a.behavior.x,l=a.behavior.y,s=a.behavior.z,u=Math.sqrt((t-o)*(t-o)+(r-l)*(r-l)+(n-s)*(n-s));l=(r-l)*e.mass*a.behavior.mass/(u*u*u),s=(n-s)*e.mass*a.behavior.mass/(u*u*u),a.behavior.fx+=(t-o)*e.mass*a.behavior.mass/(u*u*u)*a.behavior.mass,a.behavior.fy+=l*a.behavior.mass,a.behavior.fz+=s*a.behavior.mass}},savePos:function(e,t){},restorePos:function(e,t){},sqDist:function(e,t,r){return 0},kineticEnergy:function(e){},storePosition:function(e){},recallPosition:function(e){},doCollisions:function(e){}},Velocity:{reset:function(e){var t=At.csnames[e.geo[1]];console.log(t);var r=Rr.extractPoint(t.homog);e=Rr.extractPoint(At.csnames[e.geo[2]].homog),t=t.behavior,si[t.type].setVelocity(t,e.x-r.x,e.y-r.y,0)},resetForces:function(e){},getBlock:!1,setToTimestep:function(e,t,r){},initRK:function(e,t){},setVelocity:function(e,t,r,n){},move:function(e){var t=At.csnames[e.geo[2]];if(!fr||!hr.down||t!==fr.mover){var r=At.csnames[e.geo[1]];e=Rr.extractPoint(r.homog),r=r.behavior,et(t,e=Ir.realVector([e.x+r.vx,e.y+r.vy,1]),"homog")}},proceedMotion:function(e,t,r,n){},calculateForces:function(e){},calculateDelta:function(e,t){},savePos:function(e,t){},restorePos:function(e,t){},sqDist:function(e,t,r){return 0},kineticEnergy:function(e){},storePosition:function(e){},recallPosition:function(e){},doCollisions:function(e){}},Gravity:{reset:function(e,t){e.vel=[0,0,0],e.pos=[0,0,0,0],e.el=t,void 0===e.strength&&(e.strength=1),e.namea=t.args[0],e.nameb=t.args[1],e.ma=At.csnames[e.namea],e.mb=At.csnames[e.nameb]},resetForces:function(e){},getBlock:!1,setToTimestep:function(e,t,r){},initRK:function(e,t){},setVelocity:function(e,t,r,n){},move:function(e){},proceedMotion:function(e,t,r,n){},calculateDelta:function(e,t){},calculateForces:function(e){var t=Rr.extractPoint(e.ma.homog),r=Rr.extractPoint(e.mb.homog),n=(r.x-t.x)*e.strength;for(e=(r.y-t.y)*e.strength,t=0;t<ai.length;t++)(r=ai[t]).behavior.fx+=n*r.behavior.mass,r.behavior.fy+=e*r.behavior.mass,r.behavior.fz+=0*r.behavior.mass},savePos:function(e,t){},restorePos:function(e,t){},sqDist:function(e,t,r){return 0},kineticEnergy:function(e){},storePosition:function(e){},recallPosition:function(e){},doCollisions:function(e){}},Spring:{reset:function(e,t){e.el=t,void 0===e.strength&&(e.strength=1),void 0===e.amplitude&&(e.amplitude=0),void 0===e.phase&&(e.phase=0),void 0===e.speed&&(e.speed=1),void 0===e.l0&&(e.l0=0),void 0===e.stype&&(e.stype=1),void 0===e.readOnInit&&(e.readOnInit=!1),e.namea=t.args[0],e.nameb=t.args[1],e.ma=At.csnames[e.namea],e.mb=At.csnames[e.nameb],t=Rr.extractPoint(e.ma.homog);var r=Rr.extractPoint(e.mb.homog);e.l0=Math.sqrt((t.x-r.x)*(t.x-r.x)+(t.y-r.y)*(t.y-r.y)),e.env=si.env,e.ldiff=0},resetForces:function(e){},getBlock:!1,setToTimestep:function(e,t,r){},initRK:function(e,t){},setVelocity:function(e,t,r,n){},move:function(e){},proceedMotion:function(e,t,r,n){},calculateForces:function(e){if(!e.ma.behavior||fr&&hr.down&&e.ma===fr.mover)var t=Rr.extractPoint(e.ma.homog),r=t.x,n=t.y;else r=e.ma.behavior.x,n=e.ma.behavior.y;if(!e.mb.behavior||fr&&hr.down&&e.mb===fr.mover){var i=Rr.extractPoint(e.mb.homog);t=i.x,i=i.y}else t=e.mb.behavior.x,i=e.mb.behavior.y;var a=Math.sqrt((r-t)*(r-t)+(n-i)*(n-i)),o=e.l0;e.ldiff=a-o;var l=e.stype;1===l&&(o=0);var s=0;if(2!==l&&3!==l||(s=e.ma.behavior.mass*e.mb.behavior.mass*e.strength),2===l&&(s=-s),0===a||0!==l&&1!==l)if(e.ma.behavior&&e.mb.behavior&&0!==a){if(a*=a*a,2===l||3===l)var u=(r-t)*s/a,c=(n-i)*s/a}else u=c=0;else u=-(r-t)*e.strength*(a-o)/a*e.env.springstrength,c=-(n-i)*e.strength*(a-o)/a*e.env.springstrength;e.ma.behavior&&(e.ma.behavior.fx+=u,e.ma.behavior.fy+=c),e.mb.behavior&&(e.mb.behavior.fx-=u,e.mb.behavior.fy-=c)},calculateDelta:function(e,t){},savePos:function(e,t){},restorePos:function(e,t){},sqDist:function(e,t,r){return 0},kineticEnergy:function(e){},storePosition:function(e){},recallPosition:function(e){},doCollisions:function(e){}},det:function(e,t,r,n,i,a){return r*a-i*n+i*t-e*a+e*n-r*t},Bouncer:{reset:function(e,t){e.el=t,void 0===e.xdamp&&(e.xdamp=0),void 0===e.ydamp&&(e.ydamp=0),void 0===e.motorchanger&&(e.motorchanger=!0),e.namea=t.args[0],e.nameb=t.args[1],e.ma=At.csnames[e.namea],e.mb=At.csnames[e.nameb],t=Rr.extractPoint(e.ma.homog);var r=Rr.extractPoint(e.mb.homog);e.x1o=1.01*t.x-.01*r.x,e.y1o=1.01*t.y-.01*r.y,e.x2o=1.01*r.x-.01*t.x,e.y2o=1.01*r.y-.01*t.y,e.env=si.env},resetForces:function(e){},getBlock:!1,setToTimestep:function(e,t,r){},initRK:function(e,t){e.deltat=t},setVelocity:function(e,t,r,n){},move:function(e){},proceedMotion:function(e,t,r,n){},calculateForces:function(e){},calculateDelta:function(e,t){},savePos:function(e,t){},restorePos:function(e,t){},sqDist:function(e,t,r){return 0},kineticEnergy:function(e){},storePosition:function(e){},recallPosition:function(e){},doCollisions:function(e){var t=Rr.extractPoint(e.ma.homog),r=Rr.extractPoint(e.mb.homog),n=t.x;t=t.y;var i=r.x;r=r.y;var a=e.x1o,o=e.y1o,l=e.x2o,s=e.y2o,u=Math.sqrt((n-i)*(n-i)+(t-r)*(t-r)),c=(n-i)/u;u=(t-r)/u;for(var p=0;p<ai.length;p++){var f=ai[p],h=f.behavior.xo,v=f.behavior.yo,d=f.behavior.x,m=f.behavior.y,g=Cr.mult(Cr.complex(a,o),Cr.complex(i,r)),y=Cr.mult(Cr.complex(l,s),Cr.complex(n,t));g=Cr.sub(g,y),y=Cr.mult(Cr.complex(h,v),Cr.complex(n,t)),g=Cr.add(g,y),y=Cr.mult(Cr.complex(h,v),Cr.complex(i,r)),g=Cr.sub(g,y),y=Cr.sub(Cr.complex(a,o),Cr.complex(l,s)),g=Cr.div(g,y),0>si.det(n,t,i,r,d,m)*si.det(n,t,i,r,g.value.real,g.value.imag)&&0>si.det(n,t,d,m,g.value.real,g.value.imag)*si.det(i,r,d,m,g.value.real,g.value.imag)&&(h=c*(v=f.behavior.mvx+e.deltat*(-g.value.real+f.behavior.xo))+u*(d=f.behavior.mvy+e.deltat*(-g.value.imag+f.behavior.yo)),v=u*v-c*d,f.behavior.x=g.value.real,f.behavior.y=g.value.imag,f.behavior.vx=c*h*(1-e.xdamp),f.behavior.vy=u*h*(1-e.xdamp),f.behavior.vx+=-u*v*(1-e.ydamp),f.behavior.vy+=c*v*(1-e.ydamp))}e.x1o=n,e.y1o=t,e.x2o=i,e.y2o=r}},Environment:{init:function(e){void 0===e.gravity&&(e.gravity=0),void 0===e.friction&&(e.friction=0),void 0===e.springstrength&&(e.springstrength=1),void 0!==e.accuracy&&(Xt=e.accuracy),void 0!==e.deltat&&c(e.deltat/.6),void 0===e.charges&&(e.charges=!1),void 0===e.balls&&(e.balls=!1),void 0===e.newton&&(e.newton=!1),void 0===e.ballInteractionBoosting&&(e.ballInteractionBoosting=1),si.env=e,e.errorbound=.001,e.lowestdeltat=1e-7,e.slowdownfactor=2},reset:function(e){},resetForces:function(e){},getBlock:!1,setToTimestep:function(e,t,r){},initRK:function(e,t){},setVelocity:function(e,t,r,n){},move:function(e){},proceedMotion:function(e,t,r,n){},calculateForces:function(e){var t,r;if(e.newton)for(t=0;t<ai.length-1;t++){var n=ai[t],i=n.behavior.x,a=n.behavior.y;for(r=t+1;r<ai.length;r++){var o=ai[r],l=o.behavior.x,s=o.behavior.y,u=Math.sqrt((i-l)*(i-l)+(a-s)*(a-s));l=(i-l)*n.behavior.mass*o.behavior.mass/(u*u*u),s=(a-s)*n.behavior.mass*o.behavior.mass/(u*u*u),n.behavior.fx-=l,n.behavior.fy-=s,o.behavior.fx+=l,o.behavior.fy+=s}}if(e.charges)for(t=0;t<ai.length-1;t++)for(i=(n=ai[t]).behavior.x,a=n.behavior.y,r=t+1;r<ai.length;r++)l=(o=ai[r]).behavior.x,s=o.behavior.y,u=Math.sqrt((i-l)*(i-l)+(a-s)*(a-s)),l=(i-l)*n.behavior.charge*o.behavior.charge/(u*u*u),s=(a-s)*n.behavior.charge*o.behavior.charge/(u*u*u),n.behavior.fx+=l,n.behavior.fy+=s,o.behavior.fx-=l,o.behavior.fy-=s;if(e.balls)for(t=0;t<ai.length-1;t++)if(0!==(n=ai[t]).behavior.radius)for(i=n.behavior.x,a=n.behavior.y,r=t+1;r<ai.length;r++)if(0!==(o=ai[r]).behavior.radius){l=o.behavior.x,s=o.behavior.y;var c=n.behavior.radius+o.behavior.radius;u=Math.sqrt((i-l)*(i-l)+(a-s)*(a-s)),0===e.ballInteractionBoosting?(l=(i-l)/(u*u*u)*(u>c?0:(u-c)*(u-c)),s=(a-s)/(u*u*u)*(u>c?0:(u-c)*(u-c))):1===e.ballInteractionBoosting?(l=(i-l)/(u*u*u*u)*(u>c?0:(u-c)*(u-c)),s=(a-s)/(u*u*u*u)*(u>c?0:(u-c)*(u-c))):(l=(i-l)/(u*u*u*u*u)*(u>c?0:(u-c)*(u-c)),s=(a-s)/(u*u*u*u*u)*(u>c?0:(u-c)*(u-c))),n.behavior.fx+=l,n.behavior.fy+=s,o.behavior.fx-=l,o.behavior.fy-=s}for(t=0;t<ai.length;t++)(n=ai[t]).behavior.fx+=0,n.behavior.fy+=-e.gravity*n.behavior.mass,n.behavior.fz+=0},calculateDelta:function(e,t){},savePos:function(e,t){},restorePos:function(e,t){},sqDist:function(e,t,r){return 0},kineticEnergy:function(e){},storePosition:function(e){},recallPosition:function(e){},doCollisions:function(e){}}};return ur},t}();void 0!==o&&void 0!==a&&"undefined"==typeof window&&(a=c);(function(){"use strict";var e="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,r){e!=Array.prototype&&e!=Object.prototype&&(e[t]=r.value)},t="undefined"!=typeof window&&window===this?this:void 0!==r&&null!=r?r:this;function n(){n=function(){},t.Symbol||(t.Symbol=a)}var i,a=(i=0,function(e){return"jscomp_symbol_"+(e||"")+i++});function o(){n();var r=t.Symbol.iterator;r||(r=t.Symbol.iterator=t.Symbol("iterator")),"function"!=typeof Array.prototype[r]&&e(Array.prototype,r,{configurable:!0,writable:!0,value:function(){return function(e){var r=0;return function(e){return o(),(e={next:e})[t.Symbol.iterator]=function(){return this},e}((function(){return r<e.length?{done:!1,value:e[r++]}:{done:!0}}))}(this)}}),o=function(){}}function l(r,n){if(n){var i=t;r=r.split(".");for(var a=0;a<r.length-1;a++){var o=r[a];o in i||(i[o]={}),i=i[o]}(n=n(a=i[r=r[r.length-1]]))!=a&&null!=n&&e(i,r,{configurable:!0,writable:!0,value:n})}}l("Array.from",(function(e){return e||function(e,t,r){o(),t=null!=t?t:function(e){return e};var n=[],i=e[Symbol.iterator];if("function"==typeof i)for(e=i.call(e);!(i=e.next()).done;)n.push(t.call(r,i.value));else{i=e.length;for(var a=0;a<i;a++)n.push(t.call(r,e[a]))}return n}})),l("Array.prototype.keys",(function(e){return e||function(){return function(e,t){o(),e instanceof String&&(e+="");var r=0,n={next:function(){if(r<e.length){var i=r++;return{value:t(i,e[i]),done:!1}}return n.next=function(){return{done:!0,value:void 0}},n.next()}};return n[Symbol.iterator]=function(){return n},n}(this,(function(e){return e}))}})),l("Array.prototype.fill",(function(e){return e||function(e,t,r){var n=this.length||0;for(0>t&&(t=Math.max(0,n+t)),(null==r||r>n)&&(r=n),0>(r=Number(r))&&(r=Math.max(0,n+r)),t=Number(t||0);t<r;t++)this[t]=e;return this}}));var s,u,c,p,f,h,v,d={addc:"vec2 addc(vec2 a,vec2 b){\nreturn a+b;\n}\n",addpoints:"vec2 addpoints(vec3 a,vec3 b){\nreturn dehomogenize(a) +dehomogenize(b);\n}\n",arccosc:"vec2 arccosc(vec2 a){\nvec2 t2=multc(a,negc(a));\nvec2 tmp=sqrtc(addc(vec2(1.0,0.0),t2));\nvec2 tmp1=addc(multc(a,vec2(0.0,1.0)),tmp);\nvec2 erg=addc(multc(logc(tmp1),vec2(0.0,1.0)),vec2(pi*0.5,0.0));\nreturn erg;\n}\n",arccosf:"vec2 arccosf(float z){\nif(abs(z)<=1.)return vec2(acos(z),0.);\nelse if(z>1.)return vec2(0,log(z+sqrt(z*z-1.)));\nelse return vec2(pi, -log(-z+sqrt(z*z-1.)));\n}\n",arcsinc:"vec2 arcsinc(vec2 a){\nvec2 t2=multc(a,negc(a));\nvec2 tmp=sqrtc(addc(vec2(1.0,0.0),t2));\nvec2 tmp1=addc(multc(a,vec2(0.0,1.0)),tmp);\nvec2 erg=multc(logc(tmp1),vec2(0.0,-1.0));\nreturn erg;\n}\n",arcsinf:"vec2 arcsinf(float z){\nif(abs(z)<=1.)return vec2(asin(z),0.);\nelse if(z>1.)return vec2(pi*.5, -log(z+sqrt(z*z-1.)));\nelse return vec2(-pi*.5,log(-z+sqrt(z*z-1.)));\n}\n",arctan2c:"\n\n\n\nvec2 arctan2c(vec2 x,vec2 y){\nvec2 r=logc(divc(x+vec2(-y.y,y.x),sqrtc(multc(x,x)+multc(y,y))));\nreturn vec2(r.y, -r.x);\n}\n",arctan2cvec2:"vec2 arctan2cvec2(cvec2 v){\nreturn arctan2c(v.real,v.imag);\n}\n",arctan2vec2:"float arctan2vec2(vec2 v){\nreturn atan(v.y,v.x);\n}\n",arctanc:"vec2 arctanc(vec2 a){\nvec2 t1=logc(addc(multc(a,vec2(0.0,-1.0)),vec2(1.0,0.0)));\nvec2 t2=logc(addc(multc(a,vec2(0.0,1.0)),vec2(1.0,0.0)));\nvec2 erg=multc(subc(t1,t2),vec2(0.0,0.5));\nreturn erg;\n}\n",blue:"vec3 blue(float f)\n{\nreturn vec3(0.,0.,clamp(f,0.,1.));\n}\n",cimag:"float imagc(vec2 a){\nreturn a.y;\n}\n",conjugate:"vec2 conjugate(vec2 a){\nreturn vec2(a.x, -a.y);\n}\n",copytexture_f:"#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform sampler2D sampler;\nvarying vec2 cgl_pixel;\n\nvoid main(void){\ngl_FragColor=texture2D(sampler,cgl_pixel);\n}\n",copytexture_v:"attribute vec3 aPos;\nattribute vec2 aTexCoord;\nvarying vec2 cgl_pixel;\n\nvoid main(void){\ngl_Position=vec4(aPos,1.);\ncgl_pixel=aTexCoord;\n}\n",cosc:"vec2 cosc(vec2 a){\n\nfloat n=exp(a.y);\nfloat imag1=n*sin(-a.x);\nfloat real1=n*cos(-a.x);\nn=exp(-a.y);\nfloat imag2=n*sin(a.x);\nfloat real2=n*cos(a.x);\nfloat i= (imag1+imag2) /2.0;\nfloat r= (real1+real2) /2.0;\n\nreturn vec2(r,i);\n}\n",creal:"float realc(vec2 a){\nreturn a.x;\n}\n",dehomogenize:"vec2 dehomogenize(vec3 z){\nreturn vec2(z.x,z.y)/z.z;\n}\n",dehomogenizex:"float dehomogenizex(vec3 z){\nreturn z.x/z.z;\n}\n",dehomogenizey:"float dehomogenizey(vec3 z){\nreturn z.y/z.z;\n}\n",det2:"float det2(mat2 a){\nreturn a[0][0]*a[1][1] -a[0][1]*a[1][0];\n}\n",det3:"float det3(mat3 a){\nreturn dot(cross(a[0],a[1]),a[2]);\n}\n",det3v:"float det3v(vec3 a,vec3 b,vec3 c){\nreturn dot(cross(a,b),c);\n}\n",det4:"float det4(mat4 a){\nfloat s00=a[0][0]*a[1][1] -a[0][1]*a[1][0],\ns01=a[0][0]*a[1][2] -a[0][2]*a[1][0],\ns02=a[0][0]*a[1][3] -a[0][3]*a[1][0],\ns03=a[0][1]*a[1][2] -a[0][2]*a[1][1],\ns04=a[0][1]*a[1][3] -a[0][3]*a[1][1],\ns05=a[0][2]*a[1][3] -a[0][3]*a[1][2],\ns06=a[2][0]*a[3][1] -a[2][1]*a[3][0],\ns07=a[2][0]*a[3][2] -a[2][2]*a[3][0],\ns08=a[2][0]*a[3][3] -a[2][3]*a[3][0],\ns09=a[2][1]*a[3][2] -a[2][2]*a[3][1],\ns10=a[2][1]*a[3][3] -a[2][3]*a[3][1],\ns11=a[2][2]*a[3][3] -a[2][3]*a[3][2];\nreturn s00*s11-s01*s10+s02*s09+s03*s08-s04*s07+s05*s06;\n}\n",divc:"vec2 divc(vec2 a,vec2 b){\nreturn vec2(dot(a,b),dot(a,vec2(-b.y,b.x)))/dot(b,b);\n}\n",divfc:"vec2 divfc(float a,vec2 b){\nreturn a*vec2(b.x,-b.y)/dot(b,b);\n}\n",expc:"vec2 expc(vec2 a){\nfloat n=exp(a.x);\nfloat r=n*cos(a.y);\nfloat i=n*sin(a.y);\nreturn vec2(r,i);\n}\n",float2color:"vec4 float2color(float f)\n{\nreturn vec4(f,f,f,1.);\n}\n",gray:"vec3 gray(float f)\n{\nf=clamp(f,0.,1.);\nreturn vec3(f,f,f);\n}\n",green:"vec3 green(float f)\n{\nreturn vec3(0.,clamp(f,0.,1.),0.);\n}\n",hsv2rgb:"vec3 hsv2rgb(vec3 c)\n{\nvec4 K=vec4(1.0,2.0/3.0,1.0/3.0,3.0);\nvec3 p=abs(fract(c.xxx+K.xyz) *6.0-K.www);\nreturn c.z*mix(K.xxx,clamp(p-K.xxx,0.0,1.0),c.y);\n}\n",hue:"vec3 hue(float a){\nreturn hsv2rgb(vec3(a,1.,1.));\n}\n",imagc:"float imagc(vec2 a){\nreturn a.y;\n}\n",invc:"vec2 invc(vec2 a){\nfloat n=a.x*a.x+a.y*a.y;\nreturn vec2(a.x/n,-a.y/n);\n}\n",logc:"vec2 logc(vec2 a){\nfloat re=a.x;\nfloat im=a.y;\nfloat s=sqrt(re*re+im*im);\nfloat i=im;\nfloat imag=atan(im,re);\nif(i<0.0){\nimag+= (2.0*pi);\n}\nif(i==0.0&&re<0.0){\nimag=pi;\n}\nif(imag>pi){\nimag-= (2.0*pi);\n};\nfloat real=log(s);\n\nreturn vec2(real,imag);\n}\n",logr:"vec2 logr(float a){\nif(a>=0.)return vec2(log(a),0);\nelse return vec2(log(-a),pi);\n}\n",mat2complex:"mat4 mat2complex(mat2 a)\n{\nreturn mat4(\nvec4(a[0][0],0,a[0][1],0),\nvec4(0,a[0][0],0,a[0][1]),\nvec4(a[1][0],0,a[1][1],0),\nvec4(0,a[1][0],0,a[1][1])\n);\n}\n",multc:"vec2 multc(vec2 a,vec2 b){\nreturn vec2(dot(a,vec2(b.x,-b.y)),dot(a,b.yx));\n}\n",negc:"vec2 negc(vec2 a){\nreturn vec2(-a.x,-a.y);\n}\n",powc:"vec2 powc(vec2 a,vec2 b){\nreturn(b.x==0. &&b.y==0.) ?vec2(1.,0.) : ((a.x==0. &&a.y==0.) ?vec2(0.) :expc(multc(logc(a),b)));\n}\n",powi:"float powi(float a,int b){\nif(mod(float(b),2.) < .5)\nreturn pow(abs(a),float(b));\nelse\nreturn sign(a)*pow(abs(a),float(b));\n}\n",random:"uniform float rnd_;\n\nfloat last_rnd= .1231;\nfloat random(){\nfloat a=fract(132422.21*sin(dot(plain_pixel,343433.671228*vec2(.176574+last_rnd, .1131+rnd_))));\nfloat b=fract(last_rnd*2321.2312*sin(dot(plain_pixel+vec2(rnd_,last_rnd),plain_pixel) *43758.5453));\nlast_rnd=fract(rnd_ +last_rnd+a+b);\nreturn last_rnd;\n}\n",randomnormal:"float randomnormal(){\nreturn sqrt(-2. *log(random())) *cos(6.283185307179586*random());\n}\n",realc:"float realc(vec2 a){\nreturn a.x;\n}\n",red:"vec3 red(float f)\n{\nreturn vec3(clamp(f,0.,1.),0.,0.);\n}\n",rgb2hsv:"vec3 rgb2hsv(vec3 c)\n{\nvec4 K=vec4(0.0, -1.0/3.0,2.0/3.0, -1.0);\nvec4 p=mix(vec4(c.bg,K.wz),vec4(c.gb,K.xy),step(c.b,c.g));\nvec4 q=mix(vec4(p.xyw,c.r),vec4(c.r,p.yzx),step(p.x,c.r));\n\nfloat d=q.x-min(q.w,q.y);\nfloat e=1.0e-10;\nreturn vec3(abs(q.z+ (q.w-q.y) / (6.0*d+e)),d/ (q.x+e),q.x);\n}\n",sinc:"\n\nvec2 sinc(vec2 a){\n\nfloat n=exp(a.y);\nfloat imag1=n*sin(-a.x);\nfloat real1=n*cos(-a.x);\nn=exp(-a.y);\nfloat imag2=n*sin(a.x);\nfloat real2=n*cos(a.x);\nfloat r= -(imag1-imag2) /2.0;\nfloat i= (real1-real2) /2.0;\n\nreturn vec2(r,i);\n}\n",sqrtc:"vec2 sqrtc(vec2 a){\nreturn expc(multc(logc(a),vec2(0.5,0.0)));\n}\n",sqrtf:"vec2 sqrtf(float a){\nif(a>=0.)return vec2(sqrt(a),0.);\nelse return vec2(0.,sqrt(-a));\n}\n",standardFragmentHeader:"#ifdef GL_ES\nprecision highp float;\nprecision highp int;\n#endif\n\n#define pi 3.141592653589793\n\nvarying vec2 cgl_pixel;\nvarying vec2 plain_pixel;\n",subc:"vec2 subc(vec2 a,vec2 b){\nreturn a-b;\n}\n",subpoints:"vec2 subpoints(vec3 a,vec3 b){\nreturn dehomogenize(a) -dehomogenize(b);\n}\n",tanc:"vec2 tanc(vec2 a){\nvec2 s=sinc(a);\nvec2 c=cosc(a);\nreturn divc(s,c);\n}\n",vec2complex:"vec4 vec2complex(vec2 a)\n{\nreturn vec4(a.x,0.,a.y,0);\n}\n",vshader:"attribute vec3 aPos;\nattribute vec2 aTexCoord;\nvarying vec2 cgl_pixel;\nvarying vec2 plain_pixel;\nuniform mat3 transformMatrix;\nvoid main(void){\ngl_Position=vec4(aPos,1.);\nplain_pixel=aTexCoord;\nvec3 r=transformMatrix*vec3(plain_pixel,1);\ncgl_pixel=r.xy/r.z;\n}\n"},m=!1,g=!1,y=!1,b=!1,x=1;function P(){function e(r){s.removeEventListener("webglcontextcreationerror",e,!1),r.statusMessage&&(t=r.statusMessage)}if(!m){(s=document.createElement("canvas")).id="glcanvas",s.style.display="none",s.width=s.height=0,document.body.appendChild(s),(u=document.createElement("canvas")).id="tmpcanvas",u.style.display="none",u.width=u.height=0,document.body.appendChild(u),(c=document.createElement("canvas")).id="dummycanvas",c.style.display="none",c.width=c.height=1,document.body.appendChild(c),p={ctype:"image",value:{img:c,width:1,height:1,ready:!0,live:!1,generation:0,whenReady:function(){}}};var t="Unknown";s.addEventListener("webglcontextcreationerror",e,!1);var r={};if(void 0!==CindyJS._pluginRegistry.CindyXR&&(r.xrCompatible=!0),(f=s.getContext("webgl",r))||(f=s.getContext("experimental-webgl",r)),!f)throw new pt("Could not obtain a WebGL context.\nReason: "+t);G.gl=f,s.removeEventListener("webglcontextcreationerror",e,!1),b||((y=f.getExtension("OES_texture_float")&&f.getExtension("OES_texture_float_linear"))||(console.error("Your browser does not suppert OES_texture_float, trying OES_texture_half_float..."),(g=(v=f.getExtension("OES_texture_half_float"))&&f.getExtension("OES_texture_half_float_linear"))||console.error("Your browser does not suppert OES_texture_half_float, will use 8-bit textures.")),navigator.userAgent.match(/(iPad|iPhone)/i)&&(console.log("You are using an iPhone/iPad."),y=g=!1,f.getExtension("OES_texture_half_float")&&f.getExtension("OES_texture_half_float_linear")&&f.getExtension("EXT_color_buffer_half_float")?g=!0:console.error("Your browser does not suppert writing to half_float textures, we will use 8-bit textures."))),m=!0}}function C(e){if(null==e||"object"!=typeof e)return e;if(e instanceof Array){for(var t=[],r=0,n=e.length;r<n;r++)t[r]=C(e[r]);return t}if(e instanceof Object){for(r in t={},e)e.hasOwnProperty(r)&&(0<="oper impl args ctype stack name arglist value real imag key obj body".split(" ").indexOf(r)&&(t[r]=C(e[r])),e.modifs&&(t.modifs=e.modifs));return t}}function _(e,t){if(null==e||"object"!=typeof e)return e===t;if(e instanceof Array&&t instanceof Array){if(e.length!=t.length)return!1;for(var r=0,n=e.length;r<n;r++)if(!_(e[r],t[r]))return!1;return!0}if(e instanceof Object&&t instanceof Object){for(r="oper impl args ctype stack name modifs arglist value real imag key obj body".split(" "),n=0;n<r.length;n++){var i=r[n];if(!_(e[i],t[i]))return!1}return!0}return!1}function w(e){return-1===e.indexOf("$")?e:e.substr(0,e.indexOf("$"))}function S(e){if("boolean"===e.ctype)return K.A;if("number"===e.ctype)return e=e.value,1e-5>Math.abs(e.imag)?(0|e.real)===e.real?K.u:K.f:K.h;if("list"===e.ctype){var t=e.value;if(3===t.length){if("Point"===e.usage)return K.w;if("Line"===e.usage)return K.line}if(0<t.length){for(var r=S(t[0]),n=1;n<t.length;n++)r=he(r,S(t[n]));if(r)return{type:"list",length:t.length,parameters:r}}}else{if("string"===e.ctype||"image"===e.ctype)return K.image;if("geo"===e.ctype&&"L"===e.value.kind)return K.line}return console.error("Cannot guess type of the following type:"),console.log(e),!1}var T=0;function M(){return"_h"+ ++T}function I(e,t){(e>s.width||t>s.height)&&(s.width=Math.ceil(e),s.height=Math.ceil(t))}function L(e,t){return e.instance.ha||(e.instance.ha={}),e.instance.ha[t]||(e.instance.ha[t]=e.instance.parse(t)),(e=e.evaluate(e.instance.ha[t])).ctype&&"number"===e.ctype?e.value.real:0}function E(e){return{x:L(e,"(screenbounds()_4).x"),y:L(e,"(screenbounds()_4).y")}}function O(e){return{x:L(e,"(screenbounds()_3).x"),y:L(e,"(screenbounds()_3).y")}}var A=new Float32Array(1),N=new Int32Array(A.buffer);function k(e){A[0]=e;var t=(e=N[0])>>16&32768,r=4096+(2147483647&e);return 1199570944<=r?1199570944<=(2147483647&e)?2139095040>r?31744|t:31744|t|(8388607&e)>>13:31743|t:947912704<=r?t|r-939524096>>13:855638016>r?t:t|(8388607&e|8388608)+(8388608>>>(r=(2147483647&e)>>23)-102)>>126-r}function R(e){return y?new Float32Array(e):g?new Uint16Array(e):new Uint8Array(e)}function z(){return y?f.FLOAT:g?v.HALF_FLOAT_OES:f.UNSIGNED_BYTE}function j(e){for(var t=[],r=0;r<e.length;r++)if(y)t.push(e[r]);else if(g){var n=e[r],i=(31744&n)>>10,a=1023&n;t.push((n>>15?-1:1)*(i?31===i?a?NaN:1/0:Math.pow(2,i-15)*(1+a/1024):a/1024*6103515625e-14))}else t.push(e[r]/255);return t}function D(e){for(var t=1;t<e;)t<<=1;return t}function F(e,t,r){if(e.canvaswrapper){if(!e.ready||e.canvaswrapper.canvas!=p&&e.canvaswrapper.L==e.width&&e.canvaswrapper.G==e.height||(delete e.canvaswrapper,e.canvaswrapper=F(e,t,r)),r){var n=(t=e.canvaswrapper).j;if(r&&(r.repeat!=n.repeat||r.clamptoedge!=n.clamptoedge||r.mipmap!=n.mipmap||r.interpolate!=n.interpolate))for(t.j=r,n=0;2>n;n++)f.bindTexture(f.TEXTURE_2D,t.textures[n]),r.mipmap?f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,r.interpolate?f.LINEAR_MIPMAP_LINEAR:f.NEAREST_MIPMAP_LINEAR):f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,r.interpolate?f.LINEAR:f.NEAREST),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,r.interpolate?f.LINEAR:f.NEAREST),r.clamptoedge&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE))}}else e.canvaswrapper=new B(e.ready?e:p,r||{interpolate:!0,mipmap:!1,repeat:!1,clamptoedge:!1}),e.ready||console.log("Image is not ready yet.");return e.canvaswrapper}function B(e,t){this.canvas=e,this.j=t,this.L=e.width,this.G=e.height,X(this),this.it=0,this.textures=[],this.X=[],this.generation=-1,this.bindTexture(),e.drawTo=this.drawTo.bind(this),e.readPixels=this.la.bind(this),e.cdyUpdate=this.pa.bind(this),e=R(this.P*this.M*4);for(var r=0;2>r;r++)this.textures[r]=f.createTexture(),f.bindTexture(f.TEXTURE_2D,this.textures[r]),f.pixelStorei(f.UNPACK_ALIGNMENT,1),f.texImage2D(f.TEXTURE_2D,0,f.RGBA,this.P,this.M,0,f.RGBA,z(),e),t.mipmap?f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,t.interpolate?f.LINEAR_MIPMAP_LINEAR:f.NEAREST_MIPMAP_LINEAR):f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,t.interpolate?f.LINEAR:f.NEAREST),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,t.interpolate?f.LINEAR:f.NEAREST),t.clamptoedge&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE)),this.X[r]=f.createFramebuffer(),f.bindFramebuffer(f.FRAMEBUFFER,this.X[r]),f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,this.textures[r],0);this.B=new ft(d.copytexture_v,d.copytexture_f),t=f.createBuffer(),f.bindBuffer(f.ARRAY_BUFFER,t),t=new Float32Array([-1,-1,0,1,-1,0,-1,1,0,1,1,0]),e=f.getAttribLocation(this.B.handle,"aPos"),f.enableVertexAttribArray(e),r=f.getAttribLocation(this.B.handle,"aTexCoord"),f.enableVertexAttribArray(r);var n=new Float32Array([0,0,1,0,0,1,1,1]),i=t.byteLength;f.bufferData(f.ARRAY_BUFFER,i+n.byteLength,f.STATIC_DRAW),f.bufferSubData(f.ARRAY_BUFFER,0,t),f.bufferSubData(f.ARRAY_BUFFER,i,n),f.vertexAttribPointer(e,3,f.FLOAT,!1,0,0),f.vertexAttribPointer(r,2,f.FLOAT,!1,0,i)}function X(e){e.j.clamptoedge&&e.j.interpolate&&!e.j.repeat&&!e.j.mipmap?(e.P=e.L,e.M=e.G):(e.P=D(e.L+e.L/2*(e.j.mipmap&&e.j.repeat)),e.M=D(e.G+e.G/2*(e.j.mipmap&&e.j.repeat)))}function $(e,t){this.C=e,this.X=t,Y(this)}function Y(e){var t=it(new Ze(e.C),e.X);e.B=t.D,e.N=t.N,e.ea=t.ea,e.fa=d.standardFragmentHeader+t.code,e.la=d.vshader,e.j=new ft(e.la,e.fa),t=f.createBuffer(),f.bindBuffer(f.ARRAY_BUFFER,t),t=new Float32Array([-1,-1,0,1,-1,0,-1,1,0,1,1,0]);var r=f.getAttribLocation(e.j.handle,"aPos");f.enableVertexAttribArray(r),e=f.getAttribLocation(e.j.handle,"aTexCoord"),f.enableVertexAttribArray(e);var n=new Float32Array([0,0,1,0,0,1,1,1]),i=t.byteLength;f.bufferData(f.ARRAY_BUFFER,i+n.byteLength,f.STATIC_DRAW),f.bufferSubData(f.ARRAY_BUFFER,0,t),f.bufferSubData(f.ARRAY_BUFFER,i,n),f.vertexAttribPointer(r,3,f.FLOAT,!1,0,0),f.vertexAttribPointer(e,2,f.FLOAT,!1,0,i)}function q(e,t,r,n){t=[r.x-t.x,n.x-t.x,t.x,r.y-t.y,n.y-t.y,t.y,0,0,1],e.j.uniform.hasOwnProperty("transformMatrix")&&e.j.uniform.transformMatrix([t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8]])}function U(e){function t(e,r,n){if(e)if("function"==typeof e)switch(r){case K.h:e([n.value.real,n.value.imag]);break;case K.A:n.value?e([1]):e([0]);break;case K.u:case K.f:e([n.value.real]);break;case K.w:case K.line:"geo"===n.ctype?e(n.value.homog.value.map((function(e){return e.value.real}))):"list"===n.ctype&&2===n.value.length?e(n.value.map((function(e){return e.value.real})).concat([1])):"list"===n.ctype&&3===n.value.length&&e(n.value.map((function(e){return e.value.real})));break;default:if("list"===r.type&&r.parameters===K.f)e(n.value.map((function(e){return e.value.real})));else if("list"===r.type&&"list"===r.parameters.type&&r.parameters.parameters===K.f){for(var i=[],a=0;a<r.length;a++)for(var o=0;o<r.parameters.length;o++)i.push(n.value[a].value[o].value.real);e(i)}else console.error("Don't know how to set uniform of type "+Q(r)+", to "+n)}else if("list"===r.type)if(a=ae(r),1===ie(r)&&a===K.f){r=Ce(r.length);var l=0;for(i in r)t(e["a"+i],K.aa(r[i]),{ctype:"list",value:Pe(r[i]).map((function(e){return n.value[l+e]}))}),l+=r[i]}else for(i=0;i<r.length;i++)t(e["a"+i],r.parameters,{ctype:"list",value:n.value[i].value});else console.error("Don't know how to set uniform of type "+Q(r)+", to"),console.log(n)}for(var r in e.B){var n=e.C.evaluateAndVal(e.B[r].U),i=e.B[r].type;if(!fe(J(n),i))return console.log("Type of "+r+" changed ("+Q(J(n))+" is no subtype of  "+Q(i)+"); forcing rebuild."),Y(e),e.j.use(f),void U(e);e.j.uniform[r]&&t(e.j.uniform[r],i,n)}[["rnd_",function(){return[Math.random()]}],["_lowerleft",function(){var t=E(e.C);return[t.x,t.y]}],["_lowerright",function(){var t=O(e.C);return[t.x,t.y]}]].map((function(t){return e.j.uniform[t[0]]&&e.j.uniform[t[0]](t[1]())}))}function V(e){var t,r=0;for(t in e.N){f.activeTexture(f.TEXTURE0+r);var n=e.N[t],i=n.name;(n=lt(n)).reloadIfRequired(),n.bindTexture(),[["_sampler"+i,[r]],["_ratio"+i,[n.L/n.G]],["_cropfact"+i,[n.L/n.P,n.G/n.M]]].map((function(t){return e.j.uniform[t[0]]&&e.j.uniform[t[0]](t[1])})),r++}}function W(e){for(var t in e.ea)if(e.C.getMyfunction(t).generation>e.ea[t])return console.log(t+" is outdated; forcing rebuild."),!1;return!0}function G(e){function t(t,r,n,i,a,o){(!t.ka||t.ja<x)&&(t.ka=!0,t.ja=x,t.ma=new $(e,t)),W(t=t.ma)||Y(t);var l=a/i;l={x:r.x+-(n.y-r.y)*l,y:r.y+(n.x-r.x)*l},I(i,a),o?f.viewport(0,0,i,a):f.viewport(0,s.height-a,i,a),t.j.use(f),U(t),q(t,r,n,l),V(t),o?(o.bindFramebuffer(),o.generation=++o.canvas.generation):f.bindFramebuffer(f.FRAMEBUFFER,null),f.drawArrays(f.TRIANGLE_STRIP,0,4),f.flush(),o&&(o.generation=Math.max(o.generation,o.canvas.generation+1))}h=e.nada,e.defineFunction("compile",1,(function(t){return t=it(new Ze(e),t[0]),console.log(t),{ctype:"string",value:t}})),e.defineFunction("use8bittextures",0,(function(){return b=!0,y=g=!1,console.log("Switching to 8-bit textures mode."),e.nada})),e.defineFunction("forcerecompile",0,(function(){return x++,h})),e.defineFunction("colorplot",1,(function(r){P();var n=e.instance.canvas.width,i=e.instance.canvas.height;return t(r[0],E(e),O(e),n,i,null),(r=e.instance.canvas.getContext("2d")).save(),r.setTransform(1,0,0,1,0,0),r.drawImage(s,0,0,n,i,0,0,n,i),r.restore(),h})),e.defineFunction("colorplot",3,(function(r){P();var n=r[0],i=e.extractPoint(e.evaluateAndVal(r[1])),a=e.extractPoint(e.evaluateAndVal(r[2])),o={x:Math.min(i.x,a.x),y:Math.min(i.y,a.y)},l={x:Math.max(i.x,a.x),y:Math.min(i.y,a.y)},u=Math.min(i.x,a.x),c=Math.max(i.y,a.y);r=e.instance.canvas.width;var p=e.instance.canvas.height,f=L(e,"(screenbounds()_1).x"),v=L(e,"(screenbounds()_1).y"),d=O(e),m=Math.abs((i.x-a.x)/(d.x-f));return t(n,o,l,r*m,p*(i=Math.abs((i.y-a.y)/(d.y-v))),null),n=e.instance.canvas.getContext("2d"),e.getInitialMatrix(),f=r*(u-f)/(d.x-f),v=p*(c-v)/(d.y-v),n.save(),n.setTransform(1,0,0,1,0,0),n.drawImage(s,0,0,r*m,p*i,f,v,r*m,p*i),n.restore(),h})),e.defineFunction("colorplot",4,(function(r){P();var n=e.extractPoint(e.evaluateAndVal(r[0])),i=e.extractPoint(e.evaluateAndVal(r[1])),a=e.evaluateAndVal(r[2]);if(r=r[3],!n.ok||!i.ok||"string"!==a.ctype)return h;var o=F(a=e.getImage(a.value,!0),e,!1);return t(r,n,i,a.width,a.height,o),h})),e.defineFunction("colorplot",2,(function(r){P();var n=E(e),i=O(e),a=e.evaluateAndVal(r[0]);if(r=r[1],"string"!==a.ctype)return h;var o=F(a=e.getImage(a.value,!0),e,!1);return t(r,n,i,a.width,a.height,o),h})),e.defineFunction("setpixel",4,(function(t){var r=e.evaluateAndVal(t[0]),n=void 0===n?null:n;if("string"===r.ctype)var i=r.value;else console.log("argument is not a string"),i=n;if(r=ut(e.evaluateAndVal(t[1])),n=ut(e.evaluateAndVal(t[2])),t=function(e){var t=void 0===t?[.5,.5,.5]:t;if("number"===e.ctype){var r=ct(e);if(!isNaN(r))return[r,r,r]}return e=function(e){var t=void 0===t?null:t;return"list"!==e.ctype?(console.log("argument is not a list"),t):e.value}(e),null===e?t:3!=e.length?(console.log("Not an RGB color vector"),t):e.map((function(e){return ct(e)}))}(e.evaluateAndVal(t[3])),!i)return h;var a=e.getImage(i,!0);return a=F(a,e,!1),isFinite(r)&&isFinite(n)&&i&&a&&t&&(a.bindTexture(),i=[t[0],t[1],t[2],1],f.texSubImage2D(f.TEXTURE_2D,0,r,n,1,1,f.RGBA,z(),function(e){if(y)return new Float32Array(e);if(g){for(var t=new Uint16Array(e.length),r=0;r<e.length;r++)t[r]=k(e[r]);return t}for(t=new Uint8Array(e.length),r=0;r<e.length;r++)t[r]=255*e[r];return t}(i)),t=a.canvas.img.getContext("2d"),(a=t.createImageData(1,1)).data.d=i,t.putImageData(a,r,n)),h})),e.defineFunction("colorplotxr",2,(function(t){P();var r=e.evaluate(t[0]).value.real;if((!(t=t[1]).ka||t.ja<x)&&(t.ka=!0,t.ja=x,t.ma=new $(e,t)),t=t.ma,0==r){f.clearColor(0,0,0,1),f.clear(f.COLOR_BUFFER_BIT|f.DEPTH_BUFFER_BIT);var n=f.getAttribLocation(t.j.handle,"aPos");f.enableVertexAttribArray(n);var i=f.getAttribLocation(t.j.handle,"aTexCoord");f.enableVertexAttribArray(i),f.vertexAttribPointer(n,3,f.FLOAT,!1,0,0),f.vertexAttribPointer(i,2,f.FLOAT,!1,0,48)}return W(t)||Y(t),t.j.use(f),U(t),q(t,{x:-1,y:-1},{x:1,y:-1},{x:-1,y:1}),V(t),CindyJS._pluginRegistry.CindyXR.xrUpdateCindyGLView(f,r),f.drawArrays(f.TRIANGLE_STRIP,0,4),f.flush(),h}))}function H(e,t){return{type:"list",length:e,parameters:t}}function J(e){return{type:"constant",value:e}}function Z(e){return J({ctype:"number",value:{real:e,imag:0}})}B.prototype.bindTexture=function(){f.bindTexture(f.TEXTURE_2D,this.textures[this.it])},B.prototype.bindFramebuffer=function(){f.bindFramebuffer(f.FRAMEBUFFER,this.X[1^this.it]),this.it^=1},B.prototype.pa=function(){if(this.canvas.img.hasOwnProperty("getContext"))var e=this.canvas.img.getContext("2d");else this.canvas.img=document.createElement("canvas"),this.canvas.img.style.display="none",this.canvas.img.width=this.L,this.canvas.img.height=this.G,e=this.canvas.img.getContext("2d");e.clearRect(0,0,this.L,this.G),this.drawTo(e,0,0),this.canvas.img.generation++},B.prototype.reloadIfRequired=function(){if(!(this.canvas.live&&(this.canvas.img.webkitDecodedFrameCount||this.canvas.img.j)&&this.fa>=(this.canvas.img.webkitDecodedFrameCount||this.canvas.img.j)||!this.canvas.live&&(!this.canvas.ready||this.generation>=this.canvas.generation))){if(this.L!=this.canvas.width||this.G!=this.canvas.height){this.L=this.canvas.width,this.G=this.canvas.height,X(this);for(var e=R(this.P*this.M*4),t=0;2>t;t++)f.bindTexture(f.TEXTURE_2D,this.textures[t]),f.texImage2D(f.TEXTURE_2D,0,f.RGBA,this.P,this.M,0,f.RGBA,z(),e)}this.bindTexture(),f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,1),this.j.repeat?(u.width=this.P,u.height=this.M,(e=u.getContext("2d")).drawImage(this.canvas.img,0,this.M-this.G),e.drawImage(this.canvas.img,this.L,this.M-this.G),e.drawImage(this.canvas.img,0,this.M-2*this.G),e.drawImage(this.canvas.img,this.L,this.M-2*this.G),f.texSubImage2D(f.TEXTURE_2D,0,0,0,f.RGBA,z(),u)):f.texSubImage2D(f.TEXTURE_2D,0,0,0,f.RGBA,z(),this.canvas.img),this.j.mipmap&&f.generateMipmap(f.TEXTURE_2D),f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,0),this.generation=this.canvas.generation,this.fa=Math.min(this.fa+1,this.canvas.img.webkitDecodedFrameCount||this.canvas.img.j)}},B.prototype.drawTo=function(e,t,r){I(this.P,this.M),f.viewport(0,0,this.P,this.M),this.B.use(f),f.activeTexture(f.TEXTURE0),f.bindTexture(f.TEXTURE_2D,this.textures[this.it]),this.B.uniform.sampler([0]),f.bindFramebuffer(f.FRAMEBUFFER,null),f.drawArrays(f.TRIANGLE_STRIP,0,4),f.flush(),e.drawImage(s,0,s.height-this.G,this.L,this.G,t,r,this.L,this.G)},B.prototype.la=function(e,t,r,n){f.bindFramebuffer(f.FRAMEBUFFER,this.X[this.it]),f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,this.textures[this.it],0);var i=R(r*n*4);for(f.readPixels(e,this.G-t-n,r,n,f.RGBA,z(),i),e=[],--n;0<=n;n--)e=e.concat(j(i.slice(n*r*4,(n+1)*r*4)));return e},G.gl=null,G.generateCanvasWrapperIfRequired=F,G.initGLIfRequired=P,CindyJS.registerPlugin(1,"CindyGL",G);var K={A:1,u:2,f:3,h:4,T:5,color:6,w:7,line:8,K:9,image:10,F:H(2,3),J:H(3,3),O:H(4,3),aa:function(e){return H(e,3)},da:function(e){return H(e,4)},Y:H(2,H(2,3)),Z:H(3,H(3,3)),$:H(4,H(4,3))};function Q(e){return 1<=e&&10>=e?"bool int float complex voidt color point line coordinate2d image".split(" ")[e-1]:"list"===e.type?Q(e.parameters)+"["+e.length+"]":"constant"===e.type?"const["+JSON.stringify(e.value.value)+"]":JSON.stringify(e)}function ee(e){return"list"===e.type&&ee(e.parameters)||fe(e,K.f)}function te(e){return"list"===e.type&&te(e.parameters)||fe(e,K.h)}function re(e){return"constant"===e.type&&fe(e,K.u)}function ne(e){return"constant"===e.type?S(e.value):e}function ie(e){return"list"===e.type?ie(e.parameters)+1:0}function ae(e){return void 0!==e.parameters?ae(e.parameters):e}function oe(e,t){return ie(e)===ie(t)&&(0===ie(e)||e.length===t.length&&oe(e.parameters,t.parameters))}function le(e){return fe(e,K.f)?K.f:fe(e,K.h)?K.h:{type:"list",length:e.length,parameters:le(e.parameters)}}function se(e){return fe(e,K.h)?K.h:{type:"list",length:e.length,parameters:se(e.parameters)}}function ue(e){return"constant"===e.type&&ue(ne(e))||e===K.A||e===K.u||e===K.f||e===K.h||e===K.w||e===K.line||"list"===e.type&&e.parameters===K.f&&1<=e.length&&4>=e.length||"list"===e.type&&"list"===e.parameters.type&&e.parameters.parameters===K.f&&e.length===e.parameters.length&&2<=e.length&&4>=e.length}function ce(e){return-1!==[K.A,K.u,K.f,K.h].indexOf(e)}function pe(e,t){return e===t||"constant"===e.type&&"constant"===t.type&&_(e.value,t.value)||"list"===e.type&&"list"===t.type&&e.length===t.length&&pe(e.parameters,t.parameters)}function fe(e,t){return!!pe(e,t)||!!e&&(ce(e)&&ce(t)?e<=t:"constant"!==t.type&&("constant"===e.type?fe(S(e.value),t):t===K.K?fe(e,K.h)||fe(e,K.F)||fe(e,K.w):t===K.w?fe(e,K.J)||fe(e,K.F):t===K.line?fe(e,K.J):t===K.color?fe(e,K.f)||"list"===e.type&&(3===e.length||4===e.length)&&fe(e.parameters,K.f):"list"===e.type&&"list"===t.type&&e.length===t.length&&fe(e.parameters,t.parameters)))}function he(e,t){return e?!t||pe(e,t)?e:("constant"===e.type&&(e=S(e.value)),"constant"===t.type&&(t=S(t.value)),ce(e)&&ce(t)?Math.max(e,t):!("list"!==e.type||"list"!==t.type||e.length!==t.length||!(t=he(e.parameters,t.parameters)))&&{type:"list",length:e.length,parameters:t}):t}function ve(e){return function(t){var r,n={};for(r in e){var i=e[r];if(n.ca=i[0],t.length==n.ca.length&&t.every(function(e){return function(t,r){return fe(t,e.ca[r])}}(n)))return{o:n.ca,s:i[1],l:i[2]};n={ca:n.ca}}return!1}}function de(e){switch(e){case K.u:return ve([[[K.A],K.u,Ye("int")]]);case K.f:return ve([[[K.A],K.f,Ye("float")],[[K.u],K.f,Ye("float")]]);case K.h:return ve([[[K.f],K.h,function(e){return"vec2("+e+", 0.)"}]]);case K.color:return ve([[[K.f],K.color,xe("float2color")],[[K.J],K.color,function(e){return"vec4("+e+",1.0)"}],[[K.O],K.color,Ue]]);case K.w:return ve([[[K.F],K.w,function(e){return"vec3("+e+",1.0)"}],[[K.J],K.w,Ue]]);case K.line:return ve([[[K.F],K.line,function(e){return"vec3("+e+",1.0)"}],[[K.J],K.line,Ue]]);case K.K:return ve([[[K.h],K.K,Ue],[[K.F],K.K,Ue],[[K.w],K.K,xe("dehomogenize")]]);default:if("list"===e.type)return function(t){var r=t[0],n=de(e.parameters)([r.parameters]).l;return{o:t,s:e,l:function(t,i,a){return Ne(e)(Pe(e.length).map((function(e){return n([ke(r,e)([t],i,a)],i,a)})),i,a)}}}}return console.log("no inclusionfunction ->"+Q(e)+" implemented yet; using identity..."),function(t){return{o:t,s:e,l:Ue}}}function me(e){switch(e=ne(e)){case K.A:return"bool";case K.u:return"int";case K.f:return"float";case K.h:case K.K:return"vec2";case K.T:return"void";case K.color:return"vec4";case K.w:case K.line:return"vec3"}if("list"===e.type&&e.parameters===K.f)return 1==e.length?"float":"vec"+e.length;if("list"===e.type&&e.parameters===K.h)return"cvec"+e.length;if("list"===e.type&&"list"===e.parameters.type&&e.length===e.parameters.length&&e.parameters.parameters===K.f)switch(e.length){case 2:return"mat2";case 3:return"mat3";case 4:return"mat4"}if("list"===e.type)return"l"+e.length+"_"+me(e.parameters);console.error("No WebGL implementation for type "+Q(e)+" found")}function ge(e,t){switch(t){case K.A:return me(t)+"("+e.value+")";case K.u:return""+(0|e.value.real);case K.f:return me(t)+"("+e.value.real+")";case K.h:return me(t)+"("+e.value.real+", "+e.value.imag+")";case K.color:return"vec4("+(e=e.value.real)+","+e+","+e+",1.)";default:console.error("Dont know how to paste values of Type "+Q(t)+" yet.")}}Object.freeze(K);var ye={};function be(e,t,r){if(!r.mark("includedfunctions",e)){for(var n in ye[e])be(ye[e][n],t,r);r.add("includedfunctions",e,(function(){return d[e]}))}}function xe(e){return function(t,r,n){return be(e,r,n),Ye(e)(t)}}function Pe(e){return Array.from(Array(e).keys())}function Ce(e){return 4>=e?[e]:5==e?[2,3]:Ce(e-4).concat([4])}function _e(e){var t=ae(e),r=ie(e);return 1==r&&t===K.f?Ce(e.length).map((function(e,t){return{type:K.aa(e),name:"a"+t}})):1<=r?Pe(e.length).map((function(t){return{type:e.parameters,name:"a"+t}})):[]}function we(e,t){if(!ue(e)){var r=me(e);t.add("structs",r,(function(){return"struct "+r+" { "+_e(e).map((function(e){return we(e.type,t)||me(e.type)+" "+e.name+";"})).join("")+"};"}))}}function Se(e,t,r){if(!(ue(e)&&1>=ie(e))){var n=e.length,i="sum"+me(e);r.add("functions",i,(function(){return me(e.parameters)+" "+i+"("+me(e)+" a){"+me(e.parameters)+" res = "+Re(e.parameters,0)([],t,r)+";\n      "+Pe(n).map((function(n){return"res = "+Le(e.parameters)(["res",ke(e,n)(["a",n],t,r)],t,r)+";"})).join("\n")+"\n        return res;\n    }"}))}}function Te(e){if(e===K.h)return xe("multc");if(ue(e))return function(e){return qe("*")([e[1],e[0]])};var t=ae(e);return fe(t,K.f)?function(t,r,n){return function(e,t,r){if(!ue(e)){var n=e.length,i=e.parameters.length;r.add("functions","mult"+n+"_"+i,(function(){return me(K.aa(n))+" mult"+n+"_"+i+"("+me(e)+" a, "+me(K.aa(i))+" b){return "+Ae(n)(Pe(n).map((function(e){return Me(i)(["a.a"+e,"b"],t,r)})),t,r)+";}"}))}}(e,r,n)||"mult"+e.length+"_"+e.parameters.length+"("+t.join(",")+")"}:t===K.h?function(t,r,n){return function(e,t,r){var n=e.length,i=e.parameters.length;r.add("functions","multc"+n+"_"+i,(function(){return me(K.da(n))+" multc"+n+"_"+i+"("+me(e)+" a, "+me(K.da(i))+" b){\n        return cvec"+n+"("+Pe(n).map((function(e){return Ie(i)(["a.a"+e,"b"],t,r)}))+");\n    }\n    "}))}(e,r,n)||"multc"+e.length+"_"+e.parameters.length+"("+t.join(",")+")"}:void 0}function Me(e){return function(t,r,n){return function(e,t){2<=e&&4>=e||t.add("functions","dot"+e,(function(){return"float dot"+e+"(vec"+e+" a, vec"+e+" b) {\n    return "+Ce(e).map((function(e,t){return"dot(a.a"+t+",b.a"+t+")"})).join("+")+"; }\n    "}))}(e,n)||"dot"+(2<=e&&4>=e?"":e)+"("+t.join(",")+")"}}function Ie(e){return function(t,r,n){return function(e,t){t.add("functions","cdot"+e,(function(){return"vec2 cdot"+e+"(cvec"+e+" a, cvec"+e+" b) {\n      return "+Pe(e).map((function(e){return"vec2(dot(a.a"+e+",vec2(b.a"+e+".x,-b.a"+e+".y)), dot(a.a"+e+",b.a"+e+".yx))"})).join("+\n")+";\n    }\n    "}))}(e,n)||"cdot"+e+"("+t.join(",")+")"}}function Le(e){return ue(e)?qe("+"):function(t,r,n){return function(e,t,r){var n="add"+me(e);r.add("functions",n,(function(){return me(e)+" "+n+"("+me(e)+" a, "+me(e)+" b) {\n    return "+me(e)+"("+_e(e).map((function(e){return me(e.type)+"("+Le(e.type)(["a."+e.name,"b."+e.name],t,r)+")"})).join(",")+");\n      }"}))}(e,r,n)||"add"+me(e)+"("+t.join(",")+")"}}function Ee(e){return ue(e)?qe("-"):function(t,r,n){return function(e,t,r){var n="sub"+me(e);r.add("functions",n,(function(){return me(e)+" "+n+"("+me(e)+" a, "+me(e)+" b) {\n    return "+me(e)+"("+_e(e).map((function(e){return me(e.type)+"("+Ee(e.type)(["a."+e.name,"b."+e.name],t,r)+")"})).join(",")+");\n    }"}))}(e,r,n)||"sub"+me(e)+"("+t.join(",")+")"}}function Oe(e){return ee(e)&&1==ie(e)?function(t,r,n){return Me(e.length)([t[0],Ae(e.length)(Array(e.length).fill("1."),r,n)],r,n)}:function(t,r,n){return Se(e,r,n)||"sum"+me(e)+"("+t.join(",")+")"}}function Ae(e){if(2<=e&&4>=e)return function(t){return"vec"+e+"("+t.join(",")+")"};if(1==e)return function(e){return"float("+e.join(",")+")"};var t=0;return function(r,n,i){return we(K.aa(e),i)||"vec"+e+"("+Ce(e).map((function(e){return"vec"+e+"("+Pe(e).map((function(){return++t&&r[t-1]})).join(",")+")"})).join(",")+")"}}function Ne(e){var t=ie(e);return ue(e)?function(t){return me(e)+"("+t.join(",")+")"}:1==t&&e.parameters===K.f?Ae(e.length):function(t,r,n){return we(e,n)||me(e)+"("+t.join(",")+")"}}function ke(e,t){var r=ae(e);return 1==ie(e)&&r===K.f?function(e,t){return function(r){if(1==e)return r[0];if(2<=e&&4>=e)return"("+r[0]+")["+t+"]";e:{var n,i=t,a=Ce(e);for(n in a){if(!(a[n]<=i)){i={first:n,second:i};break e}i-=a[n]}console.error("Accessing index out of range"),i=void 0}return"("+r[0]+").a"+i.first+"["+i.second+"]"}}(e.length,t):ue(e)?function(e){return"("+e[0]+")["+t+"]"}:function(e){return"("+e[0]+").a"+t}}function Re(e,t){return ue(e)?function(){return me(e)+"(float("+t+"))"}:function(r,n,i){return Ne(e)+"("+_e(e).map((function(e){return Re(e.type,t)(r,n,i)})).join(",")+")"}}function ze(e){return ue(e)?qe("*"):function(t,r,n){return function(e,t,r){var n="scalarmult"+me(e);r.add("functions",n,(function(){return me(e)+" "+n+"(float a, "+me(e)+" b) {\n    return "+me(e)+"("+_e(e).map((function(e){return me(e.type)+"("+ze(e.type)(["a","b."+e.name],t,r)+")"})).join(",")+");\n    }"}))}(e,r,n)||"scalarmult"+me(e)+"("+t.join(",")+")"}}function je(e){return e===K.h?xe("multc"):function(t,r,n){return function(e,t,r){be("multc",t,r);var n="cscalarmult"+me(e);r.add("functions",n,(function(){return me(e)+" "+n+"(vec2 a, "+me(e)+" b) {\n    return "+me(e)+"("+_e(e).map((function(e){return""+je(e.type)(["a","b."+e.name],t,r)})).join(",")+");\n    }"}))}(e,r,n)||"cscalarmult"+me(e)+"("+t.join(",")+")"}}function De(e){return function(t,r,n){return function(e,t,r){var n="reverse"+me(e);r.add("functions",n,(function(){return me(e)+" "+n+"("+me(e)+" a){"+me(e.parameters)+" m;\n"+Pe(Math.floor(e.length/2)).map((function(n){var i=ke(e,n)(["a",n],t,r);return"m = "+i+"; "+i+" = "+(n=ke(e,e.length-1-n)(["a",e.length-1-n],t,r))+"; "+n+" = m;"})).join("\n")+"return a;\n      }"}))}(e,r,n)||"reverse"+me(e)+"("+t.join(",")+")"}}function Fe(e){return function(t,r,n){return function(e,t,r){var n="max"+me(e);r.add("functions",n,(function(){return me(e.parameters)+" "+n+"("+me(e)+" a){"+me(e.parameters)+" m = "+ke(e,e.length-1)(["a",e.length-1],t,r)+";\n"+Pe(e.length-1).map((function(n){return"m = max(m,"+ke(e,n)(["a",n],t,r)+");"})).join("\n")+"return m;\n      }"}))}(e,r,n)||"max"+me(e)+"("+t.join(",")+")"}}function Be(e){return function(t,r,n){return function(e,t,r){var n="min"+me(e);r.add("functions",n,(function(){return me(e.parameters)+" "+n+"("+me(e)+" a){"+me(e.parameters)+" m = "+ke(e,e.length-1)(["a",e.length-1],t,r)+";\n"+Pe(e.length-1).map((function(n){return"m = min(m,"+ke(e,n)(["a",n],t,r)+");"})).join("\n")+"return m;\n      }"}))}(e,r,n)||"min"+me(e)+"("+t.join(",")+")"}}function Xe(e){return function(t,r,n){return function(e,t,r){var n="transpose"+me(e),i=H(e.parameters.length,H(e.length,e.parameters.parameters));r.add("functions",n,(function(){return me(i)+" "+n+"("+me(e)+" a){return "+Ne(i)(Pe(i.length).map((function(n){return Ne(i.parameters)(Pe(i.parameters.length).map((function(i){return ke(e.parameters,n)([ke(e,i)(["a",i],t,r),n],t,r)})),t,r)})),t,r)+";}"}))}(e,r,n)||"transpose"+me(e)+"("+t.join(",")+")"}}function $e(e){return function(t,r,n){return function(e,t,r){var n="sort"+me(e);r.add("functions",n,(function(){return me(e)+" "+n+"("+me(e)+" a){"+me(e.parameters)+" m;\n"+function(e){function t(e,n,i){if(1<n){var a;for(a=1;a<n;)a<<=1;a>>=1;for(var o=e;o<e+n-a;o++){var l=o,s=o+a;i?r.push([l,s]):r.push([s,l])}t(e,a,i),t(e+a,n-a,i)}}var r=[];return function e(r,n,i){if(1<n){var a=n/2|0;e(r,a,!i),e(r+a,n-a,i),t(r,n,i)}}(0,e,!0),r}(e.length).map((function(n){var i=ke(e,n[0])(["a",n[0]],t,r);return"m = min("+i+","+(n=ke(e,n[1])(["a",n[1]],t,r))+"); "+n+" = max("+i+","+n+"); "+i+" = m;"})).join("\n")+"return a;\n      }"}))}(e,r,n)||"sort"+me(e)+"("+t.join(",")+")"}}function Ye(e){return function(t){return w(e)+"("+t+")"}}function qe(e){return function(t){return"("+t.join(e)+")"}}function Ue(e){return e}var Ve={};Ve.join=ve([[[K.w,K.w],K.line,Ye("cross")]]),Ve.meet=ve([[[K.line,K.line],K.w,Ye("cross")]]),Ve.gauss=ve([[[K.h],K.F,Ue]]),Ve.complex=ve([[[K.F],K.h,Ue],[[K.w],K.h,xe("dehomogenize")]]),Ve.if=function(e){if(!e.every((function(e){return e})))return!1;if(2===e.length)return{o:e,s:e[1],l:function(e){return"if("+e[0]+") {"+e[1]+";}"}};if(3===e.length){var t=he(e[1],e[2]);return t?{o:[K.A,t,t],s:t,l:function(e){return"("+e[0]+" ? "+e[1]+" : "+e[2]+")"}}:{o:e,s:K.T,l:function(e){return"if("+e[0]+") {"+e[1]+";} else {"+e[2]+";}"}}}return!1},Ve["="]=function(e){return{o:e=he(e[0],e[1]),s:e,l:function(e){return e[0]+" = "+e[1]+";"}}},Ve[";"]=function(e){return{o:e,s:e[1]!==K.T?e[1]:e[0],l:function(e){return e[0]+" ; "+e[1]+";"}}},Ve.repeat=function(e){return!(2!=e.length&&3!=e.length||!re(e[0]))&&{o:e,s:e[e.length-1],l:function(){return""}}},Ve.forall=function(e){return(2==e.length||3==e.length)&&"list"===ne(e[0]).type&&{o:e,s:e[e.length-1],l:function(){return""}}},Ve.apply=function(e){return(2==e.length||3==e.length)&&"list"===ne(e[0]).type&&{o:e,s:H(ne(e[0]).length,e[e.length-1]),l:function(){return""}}},Ve.sum=function(e){return!(1!=e.length||!ee(e[0])&&!te(e[0]))&&{o:e,s:e[0].parameters,l:Oe(e[0])}},Ve.regional=function(e){return{o:e,s:K.T,l:function(){return""}}},Ve.sqrt=ve([[[K.f],K.h,xe("sqrtf")],[[K.h],K.h,xe("sqrtc")]]),Ve.abs=ve([[[K.f],K.f,Ye("abs")],[[K.h],K.f,Ye("length")],[[K.F],K.f,Ye("length")],[[K.J],K.f,Ye("length")],[[K.O],K.f,Ye("length")]]),Ve.abs_infix=Ve.abs,Ve.dist=ve([[[K.f,K.f],K.f,function(e){return Ye("abs")(qe("-")(e))}],[[K.h,K.h],K.f,function(e){return Ye("length")(qe("-")(e))}],[[K.F,K.F],K.f,function(e){return Ye("length")(qe("-")(e))}],[[K.J,K.J],K.f,function(e){return Ye("length")(qe("-")(e))}],[[K.O,K.O],K.f,function(e){return Ye("length")(qe("-")(e))}]]),Ve.dist_infix=Ve.dist,Ve.sin=ve([[[K.f],K.f,Ye("sin")],[[K.h],K.h,xe("sinc")]]),Ve.cos=ve([[[K.f],K.f,Ye("cos")],[[K.h],K.h,xe("cosc")]]),Ve.tan=ve([[[K.f],K.f,Ye("tan")],[[K.h],K.h,xe("tanc")]]),Ve.exp=ve([[[K.f],K.f,Ye("exp")],[[K.h],K.h,xe("expc")]]),Ve.arctan=ve([[[K.f],K.f,Ye("atan")],[[K.h],K.h,xe("arctanc")]]),Ve.arcsin=ve([[[K.f],K.h,xe("arcsinf")],[[K.h],K.h,xe("arcsinc")]]),Ve.arccos=ve([[[K.f],K.h,xe("arccosf")],[[K.h],K.h,xe("arccosc")]]),Ve.log=ve([[[K.f],K.h,xe("logr")],[[K.h],K.h,xe("logc")]]);var We=[2,3,4].map((function(e){return H(e,K.f)})).concat([2,3,4].map((function(e){return H(e,H(e,K.f))}))),Ge=[K.u,K.f,K.h].concat(We);function He(e,t){if(!(1>=e))if(2==e)t.add("functions","raise2",(function(){return"float raise2(float a) { return a*a; }"}));else{He(2,t);var r=function(e,t){return 1==t?e:1&t?r(e,t-1)+"*a":"raise2("+r(e,t/2)+")"},n="raise"+e;t.add("functions",n,(function(){return"float "+n+"(float a) { return "+r("a",e)+";}"}))}}function Je(e){return function(t,r,n){return 0==e?"1.":1==e?t[0]:He(e,n)||"raise"+e+"("+t[0]+")"}}function Ze(e){this.i={},this.D={},this.j={},this.R=0,this.B={},this.C=e,this.N={}}function Ke(e,t){return e.j[t]?e.j[t].order.map((function(r){return e.j[t].ia[r]})).join("\n"):"\n"}function Qe(e,t,r,n){if(pe(r,n))return t;if(fe(r,n)){if("constant"===r.type)return ge(r.value,n);var i=de(n)([r]);return i?(n=i.l)(Qe(e,t,r,i.o[0]),{},e):(console.error("cannot find an implementation for "+Q(r)+" -> "+Q(n)+", using identity"),t)}return console.error(Q(r)+" is no subtype of "+Q(n)+" (trying to cast the term "+t+")"),t}function et(e,t,r){e.i[t]||(e.i[t]={}),e.i[t].S||(e.i[t].S=[]),e.i[t].v||(e.i[t].v=!1),e.hasOwnProperty("global")||(e.i[t].global=r)}function tt(e,t){return(!t.na||!t.R||e.R>t.R)&&(t.na=function(e,t){var r=t.I;if(t.isuniform)return e.D[t.uvariable].type;if("variable"===t.ctype)return t=r[t=t.name]||t,e.i[t].v;if("function"===t.ctype&&e.B.hasOwnProperty(t.oper))return e.i[r[t.oper]].v;if("number"===t.ctype)return J(t);if("void"===t.ctype)return K.T;if("field"===t.ctype){if(e=ne(tt(e,t.obj)),1==t.key.length){if("list"===e.type)return e.parameters;if(fe(e,K.w))return K.f}else if("xy"==t.key&&fe(e,K.w))return K.F;if(!e)return!1}else{if("string"===t.ctype)return K.image;if("function"===t.ctype||"infix"===t.ctype){r=Array(t.args.length);for(var n=!0,i=0;i<t.args.length;i++)r[i]=tt(e,t.args[i]),n&="constant"===r[i].type;if(n&&t.impl)return t={ctype:t.ctype,oper:t.oper,impl:t.impl,args:r.map((function(e){return e.value}))},J(t=e.C.evaluateAndVal(t));if(e=w(t.oper),!(n=!!Ve[e]&&Ve[e](r))&&r.every((function(e){return ae(e)})))throw console.error("Could not find an implementation for "+e+" with args ("+r.map(Q).join(", ")+")"),console.log(t),"error";return!!n&&n.s}}return console.error("Don't know how to compute type of"),console.log(t),!1}(e,t),t.R=e.R),t.na}function rt(e,t){if("function"===t.ctype&&!e.B.hasOwnProperty(t.oper)&&null!==e.C.getMyfunction(t.oper)){var r=t.oper;e.B[r]=C(e.C.getMyfunction(r)),rt(e,e.B[r].body)}for(var n in t.args)rt(e,t.args[n])}function nt(e,t,r){var n=tt(e,t);if(t.isuniform)return t=t.uvariable,r?{code:"",m:"constant"===n.type?ge(n.value,ne(n)):t}:{code:""};if(";"===t.oper){n={m:""};for(var i="",a=t.args.length-1,o=a;0<=o;o--)"void"===t.args[o].ctype&&(a=o-1);for(o=0;o<=a;o++)i+=(n=nt(e,t.args[o],r&&o===a)).code;return r?{code:i,m:n.m}:{code:i}}if("constant"===n.type)return r?{m:ge(n.value,ne(n)),code:""}:{code:""};if("="===t.oper)return n=nt(e,t.args[1],!0),t=nt(e,t.args[0],!0).m+" = "+Qe(e,n.m,tt(e,t.args[1]),tt(e,t.args[0])),r?{code:n.code,m:t}:{code:n.code+t+";\n"};if("repeat$2"===t.oper||"repeat$3"===t.oper){if(i=nt(e,t.args[0],!0),"constant"!==tt(e,t.args[0]).type)return console.error("repeat possible only for fixed constant number in GLSL"),!1;if(n="repeat$2"===t.oper?t.args[1].I["#"]:t.args[2].I[t.args[1].name],i=Number(i.m),a="","constant"===e.i[n].v.type)for(o=1;o<=i;o++){e.i[n].v=Z(o),e.R++;var l=nt(e,t.args["repeat$2"===t.oper?1:2],o===i&&r);if(a+=l.code,o===i&&r)return{code:a,m:l.m}}else if(o="",l=nt(e,t.args["repeat$2"===t.oper?1:2],r),t=tt(e,t.args["repeat$2"===t.oper?1:2]),r&&(o=M(),e.i[o]||(et(e,o,!0),e.i[o].v=t)),a=a+"for(int "+n+"=1; "+n+" <= "+i+"; "+n+"++) {\n"+l.code,r&&(a+=o+" = "+l.m+";\n"),a+="}\n",r)return{code:a,m:o};return{code:a}}if("forall$2"===t.oper||"forall$3"===t.oper||"apply$2"===t.oper||"apply$3"===t.oper){var s=tt(e,t.args[0]);if("list"!==s.type&&("constant"!==s.type||"list"!==s.value.ctype))return console.error(t.oper+" only possible for lists"),!1;i=s.length||s.value.value.length,o=2===t.args.length?t.args[1].I["#"]:t.args[2].I[t.args[1].name];var u=e.i[o].v,c=l="";if(r&&(c=M(),l+=me(n)+" "+c+";\n"),"list"===n.type&&we(n,e),"constant"===e.i[o].v.type||"constant"===s.type)for(s=e.C.evaluateAndVal(t.args[0]),u=0;u<i;u++)e.i[o].v=J(s.value[u]),e.R++,l+=(a=nt(e,t.args[2===t.args.length?1:2],r)).code,"forall$2"===t.oper||"forall$3"===t.oper?u+1===i&&r&&(l+=c+" = "+a.m+";\n"):r&&(l+=ke(n,u)([c],[],e)+" = "+a.m+";\n");else{a=nt(e,t.args[2===t.args.length?1:2],r);var p=nt(e,t.args[0],!0);l+=p.code;var f=p.m;for(!e.i[f]&&!e.D[f]&&2<=s.length&&(f=M(),l+=me(s)+" "+f+" = "+p.m+";\n"),e.i[o].global=!0,p=0;p<i;p++)l+=o+" = "+ke(s,p)([f],[],e)+";\n",l+=a.code,r&&("forall$2"===t.oper||"forall$3"===t.oper?p===i-1&&(l+=c+" = "+a.m+";\n"):l+=ke(n,p)([c],[],e)+" = "+a.m+";\n");"list"===u.type&&we(u,e)}return r?{code:l,m:c}:{code:l}}if("if$2"===t.oper||"if$3"===t.oper)return l=nt(e,t.args[0],!0),i=tt(e,t.args[0]),o=a="",c=nt(e,t.args[1],r),r&&(o=M(),e.i[o]||(et(e,o,!0),e.i[o].v=n)),"constant"!=i.type&&(a+=l.code,a+="if("+l.m+") {\n"),("constant"!=i.type||"constant"==i.type&&i.value.value)&&(a+=c.code,r&&(a+=o+" = "+Qe(e,c.m,tt(e,t.args[1]),n)+";\n")),"if$3"===t.oper&&(l=nt(e,t.args[2],r),"constant"!=i.type&&(a+="} else {\n"),"constant"!=i.type||"constant"==i.type&&!i.value.value)&&(a+=l.code,r&&(a+=o+" = "+Qe(e,l.m,tt(e,t.args[2]),n)+";\n")),"constant"!=i.type&&(a+="}\n"),r?{code:a,m:o}:{code:a};if("function"===t.ctype||"infix"===t.ctype){if("verbatimglsl"===w(l=t.oper))return t=e.C.evaluateAndVal(t.args[0]).value,r?{m:t,code:""}:{code:t};if(n=t.args.map((function(t){return nt(e,t,!0)})),i=t.args.map((function(t){return tt(e,t)})),e.B.hasOwnProperty(l))for(o=function(e,t){return function(e,t,r){if(!e.mark("compiledfunctions",t)){for(var n=e.B[t],i=t.replace("$","_"),a=n.body.I,o=Array(r),l=0;l<r;l++)o[l]=n.arglist[l].name;r=e.i[i].v===K.T;var s=me(e.i[i].v)+" "+i+"("+o.map((function(t){return me(e.i[a[t]].v)+" "+a[t]})).join(", ")+"){\n";for(u in n.i)o=n.i[u],s+=me(e.i[o].v)+" "+o+";\n";var u=nt(e,n.body,!r);n=tt(e,n.body),s+=u.code,r||(s+="return "+Qe(e,u.m,n,e.i[i].v)+";\n"),s+="}\n",e.add("compiledfunctions",t,(function(){return s}))}}(e,t,e.B[t].arglist.length),Ye(t.replace("$","_"))}(e,l),a=Array(n.length),c=0;c<n.length;c++)a[c]=e.i[e.B[l].body.I[e.B[l].arglist[c].name]].v;else{if("regional"===(l=w(l)))return r?{m:"",code:""}:{code:""};if(!(o=Ve[l](i)))return console.error("Could not find an implementation for "+l+"("+i.map(Q).join(", ")+").\nReturning empty code"),r?{m:"",code:""}:{code:""};a=o.o,o=o.l}for(l="",c=Array(n.length),s=0;s<n.length;s++)l+=n[s].code,c[s]=Qe(e,n[s].m,i[s],a[s]);return t=o(c,t.modifs,e),r?{m:t,code:l}:{code:l+t+";\n"}}return"variable"===t.ctype?(n=t.name,n=t.I[n]||n,r?{m:n,code:""}:{code:n+";\n"}):"void"===t.ctype?r?{m:"",code:""}:{code:""}:"field"===t.ctype&&(n=tt(e,t.obj),o={x:0,y:1,z:2,r:0,g:1,b:2,a:3}[t.key],i=!1,a=nt(e,t.obj,!0).m,null!=o&&"list"===n.type?i=ke(n,o)([a],null,e):"xy"===t.key&&"list"===n.type?(2===n.length&&(i=a),3===n.length&&(i=xe("dehomogenize")([Qe(e,a,n,K.w)],null,e))):n===K.w&&((o={xy:"dehomogenize",x:"dehomogenizex",y:"dehomogenizey"})[t.key]&&(i=xe(o[t.key])([Qe(e,a,n,K.w)],null,e))),i)?r?{m:i,code:""}:{code:i+";\n"}:void console.error("dont know how to this.compile "+JSON.stringify(t))}function it(e,t){T=0;var r=t=C(t);for(var n in rt(e,r),function(e,t,r){function n(e,t,r){var n,a={};for(n in e)a[n]=e[n];return e=M(),et(o,e,!1),i[e].v=r,i[e].oa=!0,a[t]=e,a}var i=e.i,a=e.B,o=e;!function e(t,r,l,s){for(var u in t.I=r,t.args){var c=s||"repeat$2"===t.oper&&0==u||"repeat$3"===t.oper&&0==u||"_"===t.oper&&1==u,p=r;-1!==["repeat","forall","apply"].indexOf(w(t.oper))&&(1==u?p="repeat$2"===t.oper?n(r,"#",K.u):"repeat$3"===t.oper?n(r,t.args[1].name,K.u):"forall$2"===t.oper||"apply$2"===t.oper?n(r,"#",!1):"forall$3"===t.oper||"apply$3"===t.oper?n(r,t.args[1].name,!1):r:2==u&&(p=t.args[1].I)),e(t.args[u],p,l,c)}if("field"===t.ctype&&e(t.obj,r,l,s),"variable"===t.ctype&&(u=r[u=t.name]||u,s&&o.i[u]&&(o.i[u].W=!0)),"="===t.oper)s=r[s=t.args[0].name]||s,et(o,s,!0),i[s].S.push(t.args[1]);else if(t.oper&&"regional"===w(t.oper)&&"global"!=l)for(var f in t.args){s=t.args[f].name;var h=M();r[s]=h,a[l].i||(a[l].i=[]),a[l].i.push(h),et(o,h,!1)}else if("forall$2"===t.oper||"apply$2"===t.oper||"forall$3"===t.oper||"apply$3"===t.oper)i[2===t.args.length?t.args[1].I["#"]:t.args[2].I[t.args[1].name]].S.push({ctype:"infix",oper:"_",args:[t.args[0],{ctype:"number",value:{real:1,imag:0}}],I:t.args[0].I});else if("function"===t.ctype&&a.hasOwnProperty(t.oper)){for(h in f=(l=t.oper).replace("$","_"),et(o,f,!1),r[l]=f,r={},a[l].arglist)c=f+"_"+(u=a[l].arglist[h].name),r[u]=c,et(o,c,!1),i[c].S.push(t.args[h]);a[l].qa||(a[l].qa=!0,e(a[l].body,r,l,s),i[f].S.push(a[l].body))}}(t,r,"global",!1)}(e,r,function(e,t){function r(e){var t,r={};for(t in e)r[t]=e[t];return r}var n={},i={};if(function e(t,n){for(var a in"repeat$2"===t.oper||"forall$2"===t.oper||"apply$2"===t.oper?(n=r(n))["#"]=!0:"repeat$3"===t.oper||"forall$3"===t.oper||"apply$3"===t.oper?(n=r(n))[t.args[1].name]=!0:"="===t.oper&&(n[t.args[0].name]=!0),t.args)e(t.args[a],n);"field"===t.ctype&&e(t.obj,n),"variable"===t.ctype&&(n[t=t.name]||(i[t]=!0))}(t,{}),et(e,"cgl_pixel",!1),e.i.cgl_pixel.v=K.F,1==Object.keys(i).length)n[Object.keys(i)[0]]="cgl_pixel";else if(i["#"])n["#"]="cgl_pixel";else if(i.x&&i.y)et(e,"cgl_pixel.x",!1),e.i["cgl_pixel.x"].v=K.f,n.x="cgl_pixel.x",et(e,"cgl_pixel.y",!1),e.i["cgl_pixel.y"].v=K.f,n.y="cgl_pixel.y";else{for(var a in t=[],i)e.C.nada==e.C.evaluateAndVal({ctype:"variable",name:a})&&t.push(a);1==t.length?n[t[0]]="cgl_pixel":i.p?n.p="cgl_pixel":i.z&&(n.z="cgl_pixel")}return"cgl_pixel"===n.z&&(e.i.cgl_pixel.v=K.h),n}(e,r)),function(e,t){function r(e){if(e.hasOwnProperty("dependsOnPixel"))return e.dependsOnPixel;if("variable"===e.ctype){var t=e.name;return t=e.I[t]||t,o[t]?e.dependsOnPixel=!0:e.dependsOnPixel=!1}if(t="random randomint randominteger randombool randomnormal verbatimglsl".split(" "),"function"===e.ctype&&-1!==t.indexOf(w(e.oper)))return e.dependsOnPixel=!0;if("repeat$2"===e.oper||"forall$2"===e.oper||"apply$2"===e.oper)return r(e.args[1])?(o[e.args[1].I["#"]]=!0,e.dependsOnPixel=!0):e.dependsOnPixel=!1;if("repeat$3"===e.oper||"forall$3"===e.oper||"apply$3"===e.oper)return r(e.args[2])?(o[e.args[2].I[e.args[1].name]]=!0,e.args[1].dependsOnPixel=!0,e.dependsOnPixel=!0):e.dependsOnPixel=!1;for(var n in e.args)if(r(e.args[n]))return e.dependsOnPixel=!0;return"function"===e.ctype&&a.hasOwnProperty(e.oper)&&r(a[e.oper].body)?e.dependsOnPixel=!0:"field"===e.ctype?e.dependsOnPixel=r(e.obj):e.dependsOnPixel=!1}var n,i=e.i,a=e.B,o={cgl_pixel:!0,"cgl_pixel.x":!0,"cgl_pixel.y":!0};for(n in i)(1<=i[n].S.length||i[n].oa)&&(o[n]=!0);r(t);var l={"":!0},s=e.D;!function e(t,n){if(r(t)){for(var i in t.args)e(t.args[i],n||"repeat$2"===t.oper&&0==i||"repeat$3"===t.oper&&0==i||"_"===t.oper&&1==i);"field"===t.ctype&&e(t.obj,n),"function"===t.ctype&&a.hasOwnProperty(t.oper)&&(t=t.oper,l.hasOwnProperty(t)||(l[t]=!0,e(a[t].body,n)))}else if("boolean"!==t.ctype&&"number"!==t.ctype&&"void"!==t.ctype){var o;for(o in".."===t.oper&&(n=!0),i=!1,s)if(!i&&_(t,s[o].U)){i=!0;var u=o}i||(u=M(),s[u]={U:t,type:!1,W:n}),s[u].W=s[u].W||n,t.isuniform=!0,t.uvariable=u}}(t,!1)}(e,r),e.D){if(!(r=e.C.evaluateAndVal(e.D[n].U)).ctype||"undefined"===r.ctype){console.error("can not evaluate:"),console.log(e.D[n].U);break}e.D[n].type=e.D[n].W?J(r):S(r)}for(var i in n=!0,e.i)e.i[i].v=e.i[i].v||!1,e.i[i].W&&(e.i[i].v=Z(1),e.R++);for(;n;)for(var a in n=!1,e.i)if(!e.i[a].W)for(var o in e.i[a].S){i=ne(tt(e,e.i[a].S[o]));var l=r=e.i[a].v||!1;i&&((l=r?fe(i,r)?r:he(r,i):i)&&l!==r&&(e.i[a].v=l,e.R++,n=!0))}for(var s in e.D)"list"===e.D[s].type.type&&we(e.D[s].type,e);for(var u in e.i)"list"===e.i[u].v.type&&we(e.i[u].v,e);for(var c in a=nt(e,t,!0),o=tt(e,t),t=Qe(e,a.m,o,K.color),fe(o,K.color)||console.error("expression does not generate a color"),o=Ke(e,"structs"),o+=Ke(e,"uniforms"),s=[],e.D)"constant"!=e.D[c].type.type&&e.D[c].type!=K.image&&s.push("uniform "+me(e.D[c].type)+" "+c+";");for(var p in o+=s.join("\n"),c="",e.N)c+=e.N[p].code+"\n";for(var f in o=o+c+Ke(e,"includedfunctions"),o+=Ke(e,"functions"),e.i)e.i[f].v&&e.i[f].global&&(o+=me(e.i[f].v)+" "+f+";\n");if(o+=Ke(e,"compiledfunctions"),o+="void main(void) {\n"+a.code+"gl_FragColor = "+t+";\n}\n",console.log(o),p={},e.j.compiledfunctions)for(var h in e.j.compiledfunctions.ga)p[h]=e.C.getMyfunction(h).generation;return{code:o,D:e.D,N:e.N,ea:p}}function at(e,t,r,n){this.U=t,this.C=n,this.B=r,ot(this),t=this.j,this.name=e,this.code="uniform sampler2D _sampler"+e+";\nuniform float _ratio"+e+";\nuniform vec2 _cropfact"+e+";\nvec4 _imagergba"+e+"(vec2 A, vec2 B, vec2 p) {\n  p -= A; B -= A;\n  float b = dot(B,B);\n  p = vec2(dot(p,B),_ratio"+e+"*dot(p,vec2(-B.y,B.x)))/b;\n  "+(t.repeat?"p = mod(p, vec2(1.));":"")+"\n  "+(t.repeat&&t.mipmap?"vec4 color = vec4(0.);\n    float totalWeight = 0.;\n    for(int dx=0; dx<2; dx++) for(int dy=0; dy<2; dy++) {\n      vec2 delta = .5*vec2(dx, dy);\n      vec2 center = delta+vec2(.5);\n      vec2 tc = fract(p-delta)+delta;\n      float dst = dot(abs(tc-center),vec2(1.));\n      float w = max(.5-dst,0.);\n      w=w*w;\n      color += w * texture2D(_sampler"+e+", tc*_cropfact"+e+");\n      totalWeight += w;\n    }\n    return color/totalWeight;":t.repeat?"return texture2D(_sampler"+e+", p*_cropfact"+e+");":"if(0. <= p.x && p.x <= 1. && 0. <= p.y && p.y <= 1.)\n          return texture2D(_sampler"+e+", p*_cropfact"+e+");\n       else\n          return vec4(0.);")+"\n  }"}function ot(e){var t=e.B,r=e.C;t={interpolate:!t.hasOwnProperty("interpolate")||r.evaluateAndVal(t.interpolate).value,mipmap:!!t.hasOwnProperty("mipmap")&&r.evaluateAndVal(t.mipmap).value,repeat:!!t.hasOwnProperty("repeat")&&r.evaluateAndVal(t.repeat).value},!e.j||e.j.mipmap==t.mipmap&&e.j.repeat==t.repeat||(console.log("enfore recompilation because texture modifiers changed."),x++),e.j=t}function lt(e){var t=e.C.evaluateAndVal(e.U).value,r="string"==typeof t?e.C.getImage(t,!0):t;return null==r?(console.error("Could not find image "+t+"."),h):(ot(e),F(r,e.C,e.j))}function st(e,t,r){return r.N.hasOwnProperty(e)||(r.N[e]=new at(e,r.D[e].U,t,r.C)),e}function ut(e){var t=void 0===t?Number.NaN:t;return"number"!==e.ctype?(console.log("argument is not a number"),t):(e=(t=e.value).real,0!==(t=t.imag)&&console.log("complex number is not real"),(t=Math.round(e))!==e&&console.log("number is not an integer"),t)}function ct(e){var t=void 0===t?Number.NaN:t;return t=void 0===t?Number.NaN:t,"number"!==e.ctype?(console.log("argument is not a number"),e=t):(t=(e=e.value).real,0!==e.imag&&console.log("complex number is not real"),e=t),0>e?0:1<e?1:e}function pt(e){this.message=e}function ft(e,t){var r=f;if(this.handle=r.createProgram(),r.j&&(e="#version 300 es\n"+e.replace(/attribute/g,"in").replace(/varying/g,"out"),t="#version 300 es\n"+t.replace(/varying/g,"in").replace(/gl_FragColor/g,"FragColor").replace(/texture2D/g,"texture").replace(/precision highp float;/g,"precision highp float;\n#define webgl2 true\nout vec4 FragColor;")),this.V=ht(this,r,r.VERTEX_SHADER,e),ht(this,r,r.FRAGMENT_SHADER,t),e=this.handle,r.linkProgram(e),!r.getProgramParameter(e,r.LINK_STATUS))throw new pt("Error linking shader:\n"+r.getProgramInfoLog(e));if(r.validateProgram(e),!r.getProgramParameter(e,r.VALIDATE_STATUS))throw new pt("Error validating shader:\n"+r.getProgramInfoLog(e));var n,i,a,o=this.handle,l={};for(t=r.getProgramParameter(o,r.ACTIVE_UNIFORMS),e=0;e<t;++e){var s=r.getActiveUniform(o,e);if(null!==s&&(n=s.name.replace(/\]/g,""))){for(a=l;null!==(i=/[.\[]/.exec(n));){var u=n.substr(0,i.index);a=a.hasOwnProperty(u)?a[u]:"."===i[0]?a[u]={}:a[u]=[],n=n.substr(i.index+1)}if(1<s.size){i=s.size;var c=Array(i);for(u=0;u<i;++u){var p=s.name+"["+u+"]";p=vt(this,r,p,s),c[u]=p}a[n]=c}else p=vt(this,r,s.name,s),a[n]=p}}this.uniform=l}function ht(e,t,r,n){if(r=t.createShader(r),t.shaderSource(r,n),t.compileShader(r),!t.getShaderParameter(r,t.COMPILE_STATUS))throw console.warn(n.split("\n")),new pt("Error compiling shader:\n"+t.getShaderInfoLog(r));return t.attachShader(e.handle,r),r}function vt(e,t,r,n){switch(e=t.getUniformLocation(e.handle,r),n.type){case t.FLOAT:return t.uniform1fv.bind(t,e);case t.FLOAT_VEC2:return t.uniform2fv.bind(t,e);case t.FLOAT_VEC3:return t.uniform3fv.bind(t,e);case t.FLOAT_VEC4:return t.uniform4fv.bind(t,e);case t.BOOL:case t.INT:case t.SAMPLER_2D:case t.SAMPLER_CUBE:return t.uniform1iv.bind(t,e);case t.BOOL_VEC2:case t.INT_VEC2:return t.uniform2iv.bind(t,e);case t.BOOL_VEC3:case t.INT_VEC3:return t.uniform3iv.bind(t,e);case t.BOOL_VEC4:case t.INT_VEC4:return t.uniform4iv.bind(t,e);case t.FLOAT_MAT2:return t.uniformMatrix2fv.bind(t,e,!1);case t.FLOAT_MAT3:return t.uniformMatrix3fv.bind(t,e,!1);case t.FLOAT_MAT4:return t.uniformMatrix4fv.bind(t,e,!1);default:throw new pt("Unknown data type for uniform "+r)}}Ve.add=function(e){var t=ve(Ge.map((function(e){return[[e,e],e,qe("+")]})).concat([[[K.w,K.w],K.F,xe("addpoints")]]))(e);return t||([t=e[0],e=e[1]].every((function(e){return ee(e)||te(e)}))&&oe(t,e)?{o:[e=he(le(t),le(e)),e],s:e,l:Le(e)}:void 0)},Ve.sub=function(e){var t=ve(Ge.map((function(e){return[[e,e],e,qe("-")]})).concat(Ge.map((function(e){return[[K.T,e],e,qe("-")]}))).concat([[[K.w,K.w],K.F,xe("subpoints")]]))(e);return t||([t=e[0],e=e[1]].every((function(e){return ee(e)||te(e)}))&&oe(t,e)?{o:[e=he(le(t),le(e)),e],s:e,l:Ee(e)}:void 0)},Ve["+"]=Ve.add,Ve["-"]=Ve.sub,Ve._=function(e){var t=ne(e[0]);if(t!==K.w&&t!==K.line||(t=K.J),"list"===t.type&&re(e[1])){var r=Number(e[1].value.value.real);return 1<=Math.abs(r)&&Math.abs(r)<=t.length?(0<r&&--r,0>r&&(r=t.length+r),{o:e,s:t.parameters,l:ke(t,r)}):{o:e,s:t.parameters,l:function(){return console.error("try to access "+r+"-th Element of "+t.length+"-list "+JSON.stringify(e[0]))}}}return!1},Ve.mult=function(e){var t=ve([[[K.u,K.u],K.u,qe("*")],[[K.f,K.f],K.f,qe("*")],[[K.h,K.f],K.h,qe("*")],[[K.f,K.h],K.h,qe("*")],[[K.h,K.h],K.h,xe("multc")],[[K.Y,K.Y],K.Y,function(e){return"("+e.reverse().join("*")+")"}],[[K.Z,K.Z],K.Z,function(e){return"("+e.reverse().join("*")+")"}],[[K.$,K.$],K.$,function(e){return"("+e.reverse().join("*")+")"}],[[K.Y,K.F],K.F,function(e){return"("+e.reverse().join("*")+")"}],[[K.Z,K.J],K.J,function(e){return"("+e.reverse().join("*")+")"}],[[K.$,K.O],K.O,function(e){return"("+e.reverse().join("*")+")"}],[[K.F,K.Y],K.F,function(e){return"("+e.reverse().join("*")+")"}],[[K.J,K.Z],K.J,function(e){return"("+e.reverse().join("*")+")"}],[[K.O,K.$],K.O,function(e){return"("+e.reverse().join("*")+")"}]])(e);if(t)return t;if(2!==e.length)return!1;t=e[0];var r=e[1];if([t,r].every((function(e){return"list"===e.type&&fe(e.parameters,K.f)}))&&t.length===r.length)return ue(e=le(t))?{o:[e,e],s:K.f,l:Ye("dot")}:{o:[e,e],s:K.f,l:Me(t.length)};if([t,r].every((function(e){return"list"===e.type&&fe(e.parameters,K.h)}))&&t.length===r.length)return{o:[e=se(t),e],s:K.h,l:Ie(t.length)};if(ee(t)&&2===ie(t)&&ee(r)&&1===ie(r)&&t.parameters.length===r.length)return{o:[le(t),le(r)],s:K.aa(t.length),l:Te(le(t))};if(te(t)&&2===ie(t)&&te(r)&&1===ie(r)&&t.parameters.length===r.length)return{o:[se(t),se(r)],s:K.da(t.length),l:Te(se(t))};for(t={H:0};2>t.H;(t={V:t.V,H:t.H,ba:t.ba}).H++){if(fe(e[0^t.H],K.f)&&(ee(e[1^t.H])||te(e[1^t.H])))return t.V=le(e[1^t.H]),{o:t.H?[t.V,K.f]:[K.f,t.V],s:t.V,l:function(e){return function(t,r,n){return ze(e.V)([t[0^e.H],t[1^e.H]],r,n)}}(t)};if(fe(e[0^t.H],K.h)&&te(e[1^t.H]))return t.ba=se(e[1^t.H]),{o:t.H?[t.ba,K.h]:[K.h,t.ba],s:t.ba,l:function(e){return function(t,r,n){return je(e.ba)([t[0^e.H],t[1^e.H]],r,n)}}(t)}}},Ve["*"]=Ve.mult,Ve.div=function(e){var t=ve([[[K.f,K.f],K.f,qe("/")],[[K.f,K.h],K.h,xe("divfc")],[[K.h,K.f],K.h,qe("/")],[[K.h,K.h],K.h,xe("divc")]])(e);return t||!!(fe(e[1],K.f)&&te(e[0])&&(e=le(e[0]),ue(e)))&&{o:[e,K.f],s:e,l:qe("/")}},Ve["/"]=Ve.div,Ve.re=ve([[[K.h],K.f,xe("realc")]]),Ve.im=ve([[[K.h],K.f,xe("imagc")]]),Ve.floor=ve([[[K.f],K.u,function(e){return"int(floor("+e+"))"}],[[K.h],K.h,Ye("floor")]]),Ve.round=ve([[[K.f],K.u,function(e){return"int(floor("+e+"+.5))"}],[[K.h],K.h,function(e){return"floor("+e+"+vec2(.5))"}]]),Ve.ceil=ve([[[K.f],K.u,function(e){return"int(ceil("+e+"))"}],[[K.h],K.h,Ye("ceil")]]),Ve.mod=ve([[[K.u,K.u],K.u,function(e,t){return"int("+Ye("mod")("float("+e[0]+"), float("+e[1]+")",t)+")"}],[[K.f,K.f],K.f,Ye("mod")],[[K.h,K.h],K.h,xe("mod")]]),Ve.random=ve([[[],K.f,xe("random")],[[K.f],K.f,function(e,t,r){return xe("random")([],t,r)+"*"+e[0]}],[[K.h],K.h,function(e,t,r){return"vec2("+xe("random")([],t,r)+","+xe("random")([],t,r)+")*"+e[0]}]]),Ve.randomint=ve([[[K.u],K.u,function(e,t,r){return"int(floor("+xe("random")([],t,r)+"*float("+e[0]+")))"}],[[K.f],K.u,function(e,t,r){return"int(floor("+xe("random")([],t,r)+"*floor("+e[0]+")))"}]]),Ve.randominteger=Ve.randomint,Ve.randombool=ve([[[],K.A,function(e,t,r){return"("+xe("random")([],t,r)+">.5)"}]]),Ve.randomnormal=ve([[[],K.f,xe("randomnormal")]]),Ve.arctan2=ve([[[K.f,K.f],K.f,function(e){return"atan("+e[1]+", "+e[0]+")"}],[[K.h,K.h],K.h,xe("arctan2c")],[[K.h],K.f,xe("arctan2vec2")],[[K.F],K.f,xe("arctan2vec2")],[[K.da(2)],K.h,xe("arctan2cvec2")]]),["red","green","blue","gray","hue"].forEach((function(e){Ve[e]=ve([[[K.f],K.J,xe(e)]])})),Ve.grey=Ve.gray,Ve.min=function(e){var t=ve([[[K.f,K.f],K.f,Ye("min")]])(e);return t||(1===e.length&&1===ie(e[0])&&ee(e[0])?{o:e,s:e[0].parameters,l:Be(e[0])}:void 0)},Ve.max=function(e){var t=ve([[[K.u,K.u],K.u,Ye("max")],[[K.f,K.f],K.f,Ye("max")]])(e);return t||(1===e.length&&1===ie(e[0])&&ee(e[0])?{o:e,s:e[0].parameters,l:Fe(e[0])}:void 0)},Ve.pow=function(e){if(re(e[1])&&fe(e[0],K.f)){var t=Number(e[1].value.value.real);if(0<=t)return{o:[K.f,e[1]],s:K.f,l:Je(t)}}return ve([[[K.f,K.u],K.f,xe("powi")],[[K.h,K.h],K.h,xe("powc")]])(e)},Ve["^"]=Ve.pow,Ve.re=ve([[[K.h],K.f,function(e){return"("+e+").x"}]]),Ve.conjugate=ve([[[K.h],K.h,xe("conjugate")]]),Ve.im=ve([[[K.h],K.f,function(e){return"("+e+").y"}]]),Ve.genList=function(e){var t=e.length;if(0<t){var r,n=!1;for(r in e)n=he(n,e[r]);if(n)return e=H(t,n),{o:Array(t).fill(n),s:e,l:Ne(e)}}return!1},Ve["&"]=ve([[[K.A,K.A],K.A,qe("&&")]]),Ve["%"]=ve([[[K.A,K.A],K.A,qe("||")]]),"> < >= <= == !=".split(" ").forEach((function(e){Ve[e]=ve([[[K.u,K.u],K.A,qe(e)],[[K.f,K.f],K.A,qe(e)]])})),Ve["!"]=ve([[[K.A],K.A,Ye("!")],[[K.T,K.A],K.A,function(e){return Ye("!")([e[1]])}]]),Ve.not=Ve["!"],Ve.imagergb=ve([[[K.image,K.K],K.J,function(e,t,r){return r.add("uniforms","corners",(function(){return"uniform vec2 _lowerleft, _lowerright;"})),["(_imagergba",st(e[0],t,r),"(_lowerleft, _lowerright, ",e[1],").rgb)"].join("")}],[[K.K,K.K,K.image,K.K],K.J,function(e,t,r){return["(_imagergba",st(e[2],t,r),"(",e[0],",",e[1],",",e[3],").rgb)"].join("")}]]),Ve.imagergba=ve([[[K.image,K.K],K.O,function(e,t,r){return r.add("uniforms","corners",(function(){return"uniform vec2 _lowerleft, _lowerright;"})),["_imagergba",st(e[0],t,r),"(_lowerleft, _lowerright, ",e[1],")"].join("")}],[[K.K,K.K,K.image,K.K],K.O,function(e,t,r){return["_imagergba",st(e[2],t,r),"(",e[0],",",e[1],",",e[3],")"].join("")}]]),Ve.reverse=function(e){return 1===e.length&&"list"===e[0].type&&{o:e,s:e[0],l:De(e[0])}},Ve.sort=function(e){return!(1!==e.length||1!==ie(e[0])||!ee(e[0]))&&{o:e,s:e[0],l:$e(e[0])}},Ve.transpose=function(e){return 1===e.length&&2<=ie(e[0])&&{o:e,s:H(e[0].parameters.length,H(e[0].length,e[0].parameters.parameters)),l:Xe(e[0])}},Ve.det=ve([[[K.Y],K.f,xe("det2")],[[K.Z],K.f,xe("det3")],[[K.$],K.f,xe("det4")],[[K.w,K.w,K.w],K.f,xe("det3v")]]),Object.freeze(Ve),ye.powc=["expc","multc","logc"],ye.sqrtc=["expc","multc","logc"],ye.arccosc=["multc","negc","sqrtc","addc","logc"],ye.arcsinc=["multc","negc","sqrtc","addc","logc"],ye.tanc=["sinc","cosc","divc"],ye.arctanc=["logc","addc","multc","subc"],ye.arctan2c=["logc","divc","sqrtc","multc"],ye.arctan2vec2c=["arctan2c"],ye.hue=["hsv2rgb"],ye.randomnormal=["random"],ye.subpoints=["dehomogenize"],ye.addpoints=["dehomogenize"],Object.freeze(ye),Ze.prototype.add=function(e,t,r){this.mark(e,t),this.j[e].ia[t]||(this.j[e].ia[t]=r(),this.j[e].ga[t]=!0,this.j[e].order.push(t))},Ze.prototype.mark=function(e,t){this.j[e]||(this.j[e]={order:[],ga:{},ia:{}});var r=this.j[e].ga[t]||!1;return this.j[e].ga[t]=!0,r},pt.prototype.toString=function(){return this.message},ft.prototype.use=function(e){return e.useProgram(this.handle),this}}).call({});(function(){"use strict";CindyJS.registerPlugin(1,"symbolic",(function(e){function t(e){if(null==e||"object"!=typeof e)return e;if(e instanceof Array){for(var r=[],n=0,i=e.length;n<i;n++)r[n]=t(e[n]);return r}if(e instanceof Object){for(n in r={},e)e.hasOwnProperty(n)&&0<="oper impl args ctype stack name arglist value real imag key obj body".split(" ").indexOf(n)&&(r[n]=t(e[n]));return e.modifs&&(r.modifs=e.modifs),r}}var r=function(e){return{ctype:"number",value:{real:e,imag:0}}},n=function(e,t){return{ctype:"function",oper:e,args:t,modifs:{}}},i={sin$1:function(e){return[n("cos$1",[e[0]])]},cos$1:function(e){return[n("sub$2",[r(0),n("sin$1",[e[0]])])]},exp$1:function(e){return[n("exp$1",[e[0]])]},log$1:function(e){return[n("div$2",[r(1),e[0]])]},sqrt$1:function(e){return[n("div$2",[r(.5),n("sqrt$1",[e[0]])])]},add$2:function(e){return[r(1),r(1)]},sub$2:function(e){return[r(1),r(-1)]},mult$2:function(e){return[e[1],e[0]]},div$2:function(e){return[n("div$2",[r(1),e[1]]),n("div$2",[n("sub$2",[r(0),e[0]]),n("mult$2",[e[1],e[1]])])]},pow$2:function(e){return[n("mult$2",[e[1],n("pow$2",[e[0],n("sub$2",[e[1],r(1)])])]),n("mult$2",[n("log$1",[e[0]]),n("pow$2",[e[0],e[1]])])]},";":function(e){return"void"==e[1].ctype?[r(1),r(0)]:[r(0),r(1)]}},a={sin$1:function(e,t){return 1/0},cos$1:function(e,t){return 1/0},exp$1:function(e,t){return 1/0},log$1:function(e,t){return 1/0},sqrt$1:function(e,t){return 1/0},add$2:function(e,t){return Math.max(p(e[0],t),p(e[1],t))},sub$2:function(e,t){return Math.max(p(e[0],t),p(e[1],t))},mult$2:function(e,t){return p(e[0],t)+p(e[1],t)},div$2:function(e,t){return 0===p(e[1],t)?p(e[0],t):1/0},pow$2:function(t,r){return 0===p(t[1],r)?p(t[0],r)*e.evaluate(t[1]).value.real:1/0},";":function(t,r){return"void"===t[1].ctype?p(t[0],r):(e.evaluate(t[0]),p(t[1],r))}},o={"+":"add$2","-":"sub$2","*":"mult$2","/":"div$2","^":"pow$2"},l=function(e,t){return"variable"===e.ctype&&t[e.name]?t[e.name]:(e.args&&(e.args=e.args.map((function(e){return l(e,t)}))),e)},s=function(e,t){return e&&"number"===e.ctype&&0===e.value.imag&&e.value.real===t},u=function(t){if(t.args&&(t.args=t.args.map(u),t.args.every((function(e){return"number"===e.ctype}))))return e.evaluate(t);if("add$2"===t.oper||"+"===t.oper){if(s(t.args[0],0))return t.args[1];if(s(t.args[1],0))return t.args[0]}else if("sub$2"===t.oper||"-"===t.oper){if(s(t.args[1],0))return t.args[0]}else if("mult$2"===t.oper||"*"===t.oper){if(s(t.args[0],0)||s(t.args[1],0))return r(0);if(s(t.args[0],1))return t.args[1];if(s(t.args[1],1))return t.args[0]}else if(("pow$2"===t.oper||"^"===t.oper)&&s(t.args[1],1))return t.args[0];return t},c=function(a,u){if("variable"===a.ctype)return u[a.name]?u[a.name]:r(0);if("number"===a.ctype)return r(0);if("infix"===a.ctype||"function"===a.ctype){var p=e.getMyfunction(a.oper),f=r(0),h={};if(p)for(var v in a.args)h[p.arglist[v].name]=a.args[v];for(var d in a.args){v=c(a.args[d],u);var m=r(0);s(v,0)||(p?((m={})[p.arglist[d].name]=r(1),m=l(t(c(t(p.body),m)),h)):i[o[a.oper]||a.oper]&&(m=i[o[a.oper]||a.oper](a.args)[d]),s(m,0)||(s(v,1)||(m=n("mult$2",[m,v])),f=s(f,0)?m:n("add$2",[f,m])))}return f}return console.error("Do not know how to differentiate:"),console.log(a),r(0)},p=function(r,n){if("variable"===r.ctype)return n[r.name]?n[r.name]:0;if("number"===r.ctype)return 0;if("infix"===r.ctype||"function"===r.ctype){if(";"!=r.oper&&r.args.every((function(e){return 0===p(e,n)})))return 0;var i=e.getMyfunction(r.oper);if(i){var l,s={};for(l in r.args)s[i.arglist[l].name]=p(r.args[l],n);return p(u(t(i.body)),s)}if(i=a[o[r.oper]||r.oper])return i(r.args,n)}else if("void"===r.ctype)return 0;return console.log("Do not know how to compute the degree of:"),console.log(r),1/0};e.defineFunction("diff",3,(function(n,i){return i={},n[1].name?(i[n[1].name]=r(1),i=u(c(t(n[0]),i)),e.evaluate(l(t(n[2]),{"#":i}))):e.nada})),e.defineFunction("simplify",2,(function(r,n){return e.evaluate(l(t(r[1]),{"#":u(t(r[0]))}))}));for(var f=function(n,i){for(var a in i={},n)if(1<=a){if("variable"!==n[a].ctype)return e.nada;i[n[a].name]=1}return 1/0==(n=p(u(t(n[0])),i))&&(n=-1),r(n)},h=1;3>=h;h++)e.defineFunction("degree",1+h,f)}))}).call({});var p={};e(p),t(p,"default",(function(){return g})),t(p,"SurferCoreGpu",(function(){return v}));CindyJS;const f=`${n("//initialize some variables\nmat = [\n    [0.3513, -0.4908, -0.7973],\n    [-0.8171, -0.5765, -0.0051],\n    [-0.4571, 0.6533, -0.6036]\n];\nsx = mouse().x;\nsy = mouse().y;\ndragging = false;\nN = 5;\nzoom = 2.2;\na = 0.3;\nalpha = .7;\naspectRatio = 1.0;\n\n//we stand at position mat*(0, 0, -2.2) and watch to (0,0,0).\n//ray(pixel, t) is the point in R^3 that lies at position t the ray behind the pixel at location pixel(vec2)\n//t=0 is corresponds to points within the interesting area near (0,0,0)\nray(pixel, t) := mat * ((t+2.2) * (pixel.x, pixel.y, 1) + (0, 0, -2.2));\n\n//sphere with radius 1 for clipping\nS(r) := (r * r - 1);\n\n//fun is the user defined trivariate polynomial\nfun(x, y, z) := x^2 + 1;\n\n//F takes vec3 instead of 3 variables\nF(p) := (p=p/zoom;fun(p.x, p.y, p.z));\n    \n//casteljau algorithm to evaluate and subdivide polynomials in Bernstein form.\n//poly is a vector containing the coefficients, i.e. p(x) = sum(0..N, i, poly_(i+1) * b_(i,N)(x)) where b_(i,N)(x) = choose(N, i)*x^i*(1-x)^(N-1)\ncasteljau(poly, x) := (\n  regional(alpha, beta);\n  alpha = 1-x;\n  beta = x;\n  forall(0..N, k,\n    repeat(N-k,\n      poly_# = alpha*poly_# + beta*poly_(#+1);\n    );\n  );\n  poly //the bernstein-coefficients of the polynomial in the interval [x,1]\n);\n\n//evaluates a polynomial, represented as vector of coefficients in bernstein-form\neval(poly, x) := casteljau(poly, x)_1;\n\n//this function has to be called whenever fun changes\ninit() := (\n  dx = .05; dy =.02;\n  diff(fun(x,y,z), x, dxF(x,y,z) := #);\n  diff(fun(x,y,z), y, dyF(x,y,z) := #);\n  diff(fun(x,y,z), z, dzF(x,y,z) := #);\n  \n    newN = degree(fun(x,y,z), x, y, z);\n    if(newN==-1, newN=1000);\n    if(newN!=N,\n      N = newN;\n      //The following line is DIRTY, but it makes the application run smooth for high degrees. :-)\n      //Nethertheless, it might cause render errors for high degree surfaces. In fact, only a subset of the surface is rendered.\n      //Adapt limit according to hardware.\n      //values of kind 4*n-1 are good values, as it means to use vectors of length 4*n.\n      N = min(N,7); \n      \n      //N+1 Chebyshev nodes for interval (0, 1)\n      li = apply(1..(N+1), k, (cos((2 * k - 1) / (2 * (N+1)) * pi)+1)/2);\n      \n      //A is the matrix of the linear map that evaluates a polynomial in bernstein-form at the Chebyshev nodes\n      A = apply(li, node,\n        //the i-th column contains the values of the (i,N) bernstein polynomial evaluated at the Chebyshev nodes\n        apply(0..N, i, eval(\n          apply(0..N, if(#==i,1,0)), // e_i = [0,0,0,1,0,0]\n          node //evaluate  b_(i,N)(node)\n        )) \n      );\n      \n      B = (inverse(A)); //B interpolates polynomials (in Bernstein basis), given the values [p(li_1), p(li_2), ...]\n    )\n    \n);\n\n//B3 is a matrix that interpolates quadratic polynomials (in monomial basis), given the values [p(-2), p(0), p(2)]\nB3 = inverse(apply([-2, 0, 2], c, apply(0 .. 2, i, c ^ i))); \n\n//use symbolic differentation function\ndF(p) := (p=p/zoom; (\n    dxF(p.x,p.y,p.z),\n    dyF(p.x,p.y,p.z),\n    dzF(p.x,p.y,p.z)\n));\n\n//update the color color for the pixel at position pixel assuming that the surface has been intersected at ray(pixel, dst)\n//because of the alpha-transparency updatecolor should be called for the intersections with large dst first\n// color is a float[4] representing RGBA with premultiplied alpha\nupdatecolor(pixel, dst, color) := (\n  regional(x, normal);\n  x = ray(pixel, dst); //the intersection point in R^3\n  color = (1 - alpha) * color;\n        \n  normal = dF(x);\n  normal = normal / |normal|;\n\n  colorHit = (0., 0., 0.);\n  forall(1..length(lightdirs),\n    //illuminate if the normal and lightdir point in the same direction\n    illumination = max(0, (lightdirs_# / abs(lightdirs_#)) * normal);\n    colorHit = colorHit + alpha * (illumination ^ gamma_#) * colors_#;\n  );\n  color = color + (colorHit_1, colorHit_2, colorHit_3, alpha);\n);\n\n\nnsign(pixel, a, b) := ( //Descartes rule of sign for the interval (a,b)\n  //obtain the coefficients in bernstein basis of F along the ray in interval (a,b) by interpolation within this interval\n  poly = B * apply(li,\n    F(ray(pixel, a+#*(b-a))) //evaluate F(ray(pixel, ·)) along Chebyshev nodes for (a,b)\n  );\n  //count the number of sign changes\n  ans = 0;\n  //last = poly_1;\n  forall(2..(N+1), k,\n    //if(last == 0, last = poly_k;); this (almost) never happens\n    if(min(poly_(k-1), poly_k) <= 0 & 0 <= max(poly_(k-1), poly_k), //sign switch; avoid products due numerics\n      ans = ans + 1;\n    );\n  );\n  ans //return value   \n);\n\n\n//bisect F(ray(pixel, ·)) in [x0, x1] assuming that F(ray(pixel, x0)) and F(ray(pixel, x1)) have opposite signs\nbisectf(pixel, x0, x1) := (\n    regional(v0, v1, m, vm);\n    v0 = F(ray(pixel, x0));\n    v1 = F(ray(pixel, x1));\n    repeat(11,\n        m = (x0 + x1) / 2; vm = F(ray(pixel, m));\n        if (min(v0,vm) <= 0 & 0 <= max(v0, vm), //sgn(v0)!=sgn(vm); avoid products due numerics\n            (x1 = m; v1 = vm;),\n            (x0 = m; v0 = vm;)\n        );\n    );\n    m //return value   \n);\n\n//id encodes a node in a binary tree using heap-indices\n//1 is root node and node v has children 2*v and 2*v+1\n//computes s=2^depth of a node id: Compute floor(log_2(id));\n//purpose: id corresponds interval [id-s,id+1-s]/s\ngets(id) := (\n  s = 1;\n  repeat(15,\n    if(2*s<=id,\n      s = 2*s;\n    )\n  );\n  s //return value\n);\n\n//determines the next node in the binary tree that would be visited by a regular in DFS\n//if the children of id are not supposed to be visited\n//In interval logic: finds the biggest unvisited interval directly right of the interval of id.\nnext(id) := (\n  id = id+1;\n  //now: remove zeros from right (in binary representation) while(id&1) id=id>>1;\n  repeat(15,\n    if(mod(id,2)==0, \n      id = floor(id/2);\n    )\n  );\n  if(id==1, 0, id) //return value - id 0 means we stop our DFS\n);\n\n//what color should be given to pixel with pixel-coordinate pixel (vec2)\n// color is a float[4] representing RGBA with premultiplied alpha\ncomputeColor(pixel, l, u, color) := (\n  regional(a, b);\n  //traverse binary tree (DFS) using heap-indices\n  //1 is root node and node v has children 2*v and 2*v+1\n  id = 1; \n  //maximum number of steps\n  repeat(min(newN*8,80),\n    //id=0 means we are done; do only a DFS-step if we are not finished yet\n    if(id>0,\n      s = gets(id); //s = floor(log_2(id))\n      \n      //the intervals [a,b] are chossen such that (id in binary notation)\n      //id = 1   => [a,b]=[l,u]\n      //id = 10  => [a,b]=[l,(u+l)/2]\n      //id = 101 => [a,b]=[l,(u+3*l)/4]\n      //id = 11  => [a,b]=[(u+l)/2,u]\n      //...\n      if(findAllRoots,(\n        // back to front\n        a = u - (u-l)*((id+1)/s-1);\n        b = u - (u-l)*((id+0)/s-1);\n      ),(\n        // front to back\n        a = l + (u-l)*((id+0)/s-1);\n        b = l + (u-l)*((id+1)/s-1);\n      ));\n\n      //how many sign changes has F(ray(pixel, ·)) in (a,b)?\n      cnt = nsign(pixel, a, b);\n      if(cnt == 1 % (b-a)<1e-4, //in this case we found a root (or it is likely to have a multiple root)\n        //=>colorize and break DFS\n        color = updatecolor(pixel, bisectf(pixel, a, b), color);\n        if(findAllRoots,\n          id = next(id), // break DFS\n          id = 0 // stop searching\n        ),\n      if(cnt == 0, //there is no root\n        id = next(id), //break DFS\n        \n        //otherwise cnt>=2: there are cnt - 2*k roots.\n        id = 2*id;  //visit first child within DFS\n      )\n  );  \n  ));\n  color\n);\n")}; csInitDone();`,h=new Map;CindyJS.registerPlugin(1,"surfer-js-core-gpu",(e=>{const t=e.instance,r=h.get(t)?.onInit;if(void 0===r)throw new Error("Unknown CindyJS instance.");e.defineFunction("csInitDone",0,(()=>r(t)))}));class v{cdy;element;canvas;expression="x^2 - 1";alpha=1;zoom=1;parameters={};constructor(e,t,r){this.cdy=e,this.element=t,this.canvas=r,this.setExpression(this.expression),this.setAlpha(this.alpha),this.setZoom(this.zoom),Object.entries(this.parameters).forEach((([e,t])=>this.setParameter(e,t)))}getExpression(){return this.expression}getAlpha(){return this.alpha}getZoom(){return this.zoom}getParameter(e){return this.parameters[e]}getParameters(){return{...this.parameters}}getParameterNames(){return Object.keys(this.parameters)}setExpression(e){return this.expression=e,this.cdy.evokeCS(`fun(x,y,z) := (${e}); init();`),this}setAlpha(e){return this.alpha=e,this.cdy.evokeCS(`alpha = (${e});`),this}setZoom(e){return this.zoom=e,this.cdy.evokeCS(`zoom = (${e});`),this}setParameter(e,t){return this.parameters[e]=t,this.cdy.evokeCS(`${e} = (${t});`),this}static async create(e,t=256,r=256){const i=e.ownerDocument.createElement("canvas");i.width=t,i.height=r,e.appendChild(i);const a=CindyJS.newInstance({scripts:{init:f,draw:n("gsave();\nif(aspectRatio > 1.0,scale(1.0/aspectRatio));\n\n//the following is executed for every rendered frame\nif (dragging,\n    dx = 3 * (sx - mouse().x); dy = 3 * (sy - mouse().y);,\n    dx = .9*dx; dy = .9*dy;\n);\n\nsx = mouse().x;\nsy = mouse().y;\n\n//the rotation matrix: It is modified either if the user is dragging or time passes\nmat = mat * (\n    (1, 0, 0),\n    (0, cos(dy), -sin(dy)),\n    (0, sin(dy), cos(dy))\n) * (\n    (cos(dx), 0, -sin(dx)),\n    (0, 1, 0),\n    (sin(dx), 0, cos(dx))\n);\n\n\n//configuration for the lights in the scene. A light has a position, a gamma-parameter for its shininess and a color\nlightdirs = [\n    ray((.0, .0), -100), //enlights parts of the surface which normal points away from the camera\n    ray((.0, .0), -100),\n    ray((.0, .0), 100), //Has an effect, if the normal of the surface points to the camera\n    ray((.0, .0), 100),\n    (-10, 10, -2.),\n    (10, -8, 3.)\n];\n\ngamma = [1, 10, 1, 10, 5, 5];\n\n        \ncolors = [\n    (.3, .5, 1.),\n    (1, 2, 2) / 2,\n    (1., 0.2, 0.1),\n    (2, 2, 1) / 2,\n    .9 * (.7, .8, .3),\n    .9 * (.6, .1, .6)\n];\n\n\n// translucent surface: find all roots from back to front\n// opaque surface: stop after first root has been found\nfindAllRoots = alpha < .99;\n\n\ncolorplot(\n  spolyvalues = apply([-2, 0, 2], v, S(ray(#, v))); //evaluate S along ray\n  spoly = B3 * spolyvalues;                         //interpolate to monomial basis\n  D = (spoly_2 * spoly_2) - 4. * spoly_3 * spoly_1; //discriminant of spoly\n  \n  color = (0., 0., 0., 0.); // background color: fully transparent\n  if (D >= 0, //ray intersects ball\n    color = computeColor(\n      #, \n      (-spoly_2 - re(sqrt(D))) / (2 * spoly_3), //intersection entering the ball\n      (-spoly_2 + re(sqrt(D))) / (2 * spoly_3), //intersection leaving the ball\n      color\n    );              \n  );\n  color //return value: WebGL uses premultiplied alpha by default for RGBA which is already our internal representation!!!\n); //render the scene. # is the pixel coordinate\n\ngrestore();\n"),mousedown:n("sx = mouse().x;\nsy = mouse().y;\ndragging = sx < .5;\n"),mouseup:n("dragging = false;\n")},animation:{autoplay:!0},use:["CindyGL","symbolic","surfer-js-core-gpu"],ports:[{element:i,transform:[{visibleRect:[-.51,-.51,.51,.51]}]}]});return new Promise((e=>{h.set(a,{onInit:()=>{const t=i.parentElement;if(null===t)throw new Error("Something went wrong during startup of Cinderella applet");const r=new v(a,t,i);new ResizeObserver((()=>{const e=i.width/i.height;a.evokeCS(`aspectRatio = ${e};`)})).observe(i),e(r)}}),a.startup()}))}}var d,m,g=v,y=g;d=module.exports,m=p,Object.keys(m).forEach((function(e){"default"===e||"__esModule"===e||d.hasOwnProperty(e)||Object.defineProperty(d,e,{enumerable:!0,get:function(){return m[e]}})}));
//# sourceMappingURL=surfer-core-gpu-bundled-cindyjs.min.js.map
